(function(c,b,d){"function"==typeof define&&define.amd?define(["jquery"],function(a){return d(a,c,b),a.mobile}):d(c.jQuery,c,b)})(this,document,function(c,b,d){c.mobile={};(function(a,b){function e(e,h){var b,i,c,d=e.nodeName.toLowerCase();return"area"===d?(b=e.parentNode,i=b.name,e.href&&i&&"map"===b.nodeName.toLowerCase()?(c=a("img[usemap=#"+i+"]")[0],!!c&&f(c)):!1):(/input|select|textarea|button|object/.test(d)?!e.disabled:"a"===d?e.href||h:h)&&f(e)}function f(e){return a.expr.filters.visible(e)&&
!a(e).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var i=0,h=/^ui-id-\d+$/;a.ui=a.ui||{};a.extend(a.ui,{version:"c0ab71056b936627e8a7821f03c044aec6280a40",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});a.fn.extend({focus:function(e){return function(f,h){return"number"==typeof f?this.each(function(){var e=this;setTimeout(function(){a(e).focus();
h&&h.call(e)},f)}):e.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var e;return e=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,
"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?a(this[0].ownerDocument||d):e},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){h.test(this.id)&&a(this).removeAttr("id")})}});a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(e){return function(f){return!!a.data(f,e)}}):function(e,f,h){return!!a.data(e,h[3])},focusable:function(f){return e(f,!isNaN(a.attr(f,"tabindex")))},
tabbable:function(f){var h=a.attr(f,"tabindex"),b=isNaN(h);return(b||h>=0)&&e(f,!b)}});a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(e,f){function h(e,f,b,c){return a.each(i,function(){f-=parseFloat(a.css(e,"padding"+this))||0;b&&(f-=parseFloat(a.css(e,"border"+this+"Width"))||0);c&&(f-=parseFloat(a.css(e,"margin"+this))||0)}),f}var i="Width"===f?["Left","Right"]:["Top","Bottom"],c=f.toLowerCase(),d={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,
outerHeight:a.fn.outerHeight};a.fn["inner"+f]=function(e){return e===b?d["inner"+f].call(this):this.each(function(){a(this).css(c,h(this,e)+"px")})};a.fn["outer"+f]=function(e,b){return"number"!=typeof e?d["outer"+f].call(this,e):this.each(function(){a(this).css(c,h(this,e,!0,b)+"px")})}});a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))});a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(e){return function(f){return arguments.length?
e.call(this,a.camelCase(f)):e.call(this)}}(a.fn.removeData));a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());a.support.selectstart="onselectstart"in d.createElement("div");a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(e!==b)return this.css("zIndex",e);if(this.length)for(var f,
h,e=a(this[0]);e.length&&e[0]!==d;){if(f=e.css("position"),("absolute"===f||"relative"===f||"fixed"===f)&&(h=parseInt(e.css("zIndex"),10),!isNaN(h)&&0!==h))return h;e=e.parent()}return 0}});a.ui.plugin={add:function(e,f,h){var b,e=a.ui[e].prototype;for(b in h)e.plugins[b]=e.plugins[b]||[],e.plugins[b].push([f,h[b]])},call:function(a,e,f,h){if((e=a.plugins[e])&&(h||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(h=0;h<e.length;h++)a.options[e[h][0]]&&e[h][1].apply(a.element,f)}}})(c);
(function(a,b){var e=function(e,b){var h=e.parent(),c=[],d=function(){var e=a(this),e=a.mobile.toolbar&&e.data("mobile-toolbar")?e.toolbar("option"):{position:e.attr("data-"+a.mobile.ns+"position"),updatePagePadding:e.attr("data-"+a.mobile.ns+"update-page-padding")!==!1};return!("fixed"===e.position&&e.updatePagePadding===!0)},g=h.children(":jqmData(role='header')").filter(d),m=e.children(":jqmData(role='header')"),h=h.children(":jqmData(role='footer')").filter(d),d=e.children(":jqmData(role='footer')");
return 0===m.length&&g.length>0&&(c=c.concat(g.toArray())),0===d.length&&h.length>0&&(c=c.concat(h.toArray())),a.each(c,function(e,f){b-=a(f).outerHeight()}),Math.max(0,b)};a.extend(a.mobile,{window:a(b),document:a(d),keyCode:a.ui.keyCode,behaviors:{},silentScroll:function(e){"number"!==a.type(e)&&(e=a.mobile.defaultHomeScroll);a.event.special.scrollstart.enabled=!1;setTimeout(function(){b.scrollTo(0,e);a.mobile.document.trigger("silentscroll",{x:0,y:e})},20);setTimeout(function(){a.event.special.scrollstart.enabled=
!0},150)},getClosestBaseUrl:function(e){var e=a(e).closest(".ui-page").jqmData("url"),b=a.mobile.path.documentBase.hrefNoHash;return a.mobile.dynamicBaseEnabled&&e&&a.mobile.path.isPath(e)||(e=b),a.mobile.path.makeUrlAbsolute(e,b)},removeActiveLinkClass:function(e){!a.mobile.activeClickedLink||a.mobile.activeClickedLink.closest("."+a.mobile.activePageClass).length&&!e||a.mobile.activeClickedLink.removeClass(a.mobile.activeBtnClass);a.mobile.activeClickedLink=null},getInheritedTheme:function(a,e){for(var h,
b,c=a[0],d="",g=/ui-(bar|body|overlay)-([a-z])\b/;c&&(h=c.className||"",!(h&&(b=g.exec(h))&&(d=b[2])));)c=c.parentNode;return d||e||"a"},enhanceable:function(a){return this.haveParents(a,"enhance")},hijackable:function(a){return this.haveParents(a,"ajax")},haveParents:function(e,b){if(!a.mobile.ignoreContentEnabled)return e;var h,c,d,g,m,n=e.length,o=a();for(g=0;n>g;g++){c=e.eq(g);d=!1;for(h=e[g];h;){if(m=h.getAttribute?h.getAttribute("data-"+a.mobile.ns+b):"","false"===m){d=!0;break}h=h.parentNode}d||
(o=o.add(c))}return o},getScreenHeight:function(){return b.innerHeight||a.mobile.window.height()},resetActivePageHeight:function(f){var b=a("."+a.mobile.activePageClass),h=b.height(),c=b.outerHeight(!0),f=e(b,"number"==typeof f?f:a.mobile.getScreenHeight());b.css("min-height","");b.height()<f&&b.css("min-height",f-(c-h))},loading:function(){var e=this.loading._widget||a(a.mobile.loader.prototype.defaultHtml).loader(),b=e.loader.apply(e,arguments);return this.loading._widget=e,b}});a.addDependents=
function(e,b){var h=a(e),c=h.jqmData("dependents")||a();h.jqmData("dependents",a(c).add(b))};a.fn.extend({removeWithDependents:function(){a.removeWithDependents(this)},enhanceWithin:function(){var e,b={},h=a.mobile.page.prototype.keepNativeSelector(),c=this;a.mobile.nojs&&a.mobile.nojs(this);a.mobile.links&&a.mobile.links(this);a.mobile.degradeInputsWithin&&a.mobile.degradeInputsWithin(this);a.fn.buttonMarkup&&this.find(a.fn.buttonMarkup.initSelector).not(h).jqmEnhanceable().buttonMarkup();a.fn.fieldcontain&&
this.find(":jqmData(role='fieldcontain')").not(h).jqmEnhanceable().fieldcontain();a.each(a.mobile.widgets,function(e,f){if(f.initSelector){var d=a.mobile.enhanceable(c.find(f.initSelector));d.length>0&&(d=d.not(h));d.length>0&&(b[f.prototype.widgetName]=d)}});for(e in b)b[e][e]();return this},addDependents:function(e){a.addDependents(this,e)},getEncodedText:function(){return a("<a>").text(this.text()).html()},jqmEnhanceable:function(){return a.mobile.enhanceable(this)},jqmHijackable:function(){return a.mobile.hijackable(this)}});
a.removeWithDependents=function(e){e=a(e);(e.jqmData("dependents")||a()).remove();e.remove()};a.addDependents=function(e,b){var h=a(e),c=h.jqmData("dependents")||a();h.jqmData("dependents",a(c).add(b))};a.find.matches=function(e,b){return a.find(e,null,null,b)};a.find.matchesSelector=function(e,b){return a.find(b,null,null,[e]).length>0}})(c,this);c.extend(c.mobile,{version:"1.4.5",subPageUrlKey:"ui-page",hideUrlBar:!0,keepNative:":jqmData(role='none'), :jqmData(role='nojs')",activePageClass:"ui-page-active",
activeBtnClass:"ui-btn-active",focusClass:"ui-focus",ajaxEnabled:!0,hashListeningEnabled:!0,linkBindingEnabled:!0,defaultPageTransition:"fade",maxTransitionWidth:!1,minScrollBack:0,defaultDialogTransition:"pop",pageLoadErrorMessage:"Error Loading Page",pageLoadErrorMessageTheme:"a",phonegapNavigationEnabled:!1,autoInitializePage:!0,pushStateEnabled:!0,ignoreContentEnabled:!1,buttonMarkup:{hoverDelay:200},dynamicBaseEnabled:!0,pageContainer:c(),allowCrossDomainPages:!1,dialogHashKey:"&ui-state=dialog"});
(function(a,b){var e=0,f=Array.prototype.slice,c=a.cleanData;a.cleanData=function(e){for(var b,f=0;null!=(b=e[f]);f++)try{a(b).triggerHandler("remove")}catch(d){}c(e)};a.widget=function(e,b,f){var c,i,d,g,q={},p=e.split(".")[0];return e=e.split(".")[1],c=p+"-"+e,f||(f=b,b=a.Widget),a.expr[":"][c.toLowerCase()]=function(e){return!!a.data(e,c)},a[p]=a[p]||{},i=a[p][e],d=a[p][e]=function(a,e){return this._createWidget?void(arguments.length&&this._createWidget(a,e)):new d(a,e)},a.extend(d,i,{version:f.version,
_proto:a.extend({},f),_childConstructors:[]}),g=new b,g.options=a.widget.extend({},g.options),a.each(f,function(e,f){return a.isFunction(f)?void(q[e]=function(){var a=function(){return b.prototype[e].apply(this,arguments)},h=function(a){return b.prototype[e].apply(this,a)};return function(){var e,b=this._super,c=this._superApply;return this._super=a,this._superApply=h,e=f.apply(this,arguments),this._super=b,this._superApply=c,e}}()):void(q[e]=f)}),d.prototype=a.widget.extend(g,{widgetEventPrefix:i?
g.widgetEventPrefix||e:e},q,{constructor:d,namespace:p,widgetName:e,widgetFullName:c}),i?(a.each(i._childConstructors,function(e,b){var f=b.prototype;a.widget(f.namespace+"."+f.widgetName,d,b._proto)}),delete i._childConstructors):b._childConstructors.push(d),a.widget.bridge(e,d),d};a.widget.extend=function(e){for(var c,i,d=f.call(arguments,1),m=0,n=d.length;n>m;m++)for(c in d[m])i=d[m][c],d[m].hasOwnProperty(c)&&i!==b&&(e[c]=a.isPlainObject(i)?a.isPlainObject(e[c])?a.widget.extend({},e[c],i):a.widget.extend({},
i):i);return e};a.widget.bridge=function(e,c){var i=c.prototype.widgetFullName||e;a.fn[e]=function(d){var m="string"==typeof d,n=f.call(arguments,1),o=this;return d=!m&&n.length?a.widget.extend.apply(null,[d].concat(n)):d,this.each(m?function(){var f,c=a.data(this,i);return"instance"===d?(o=c,!1):c?a.isFunction(c[d])&&"_"!==d.charAt(0)?(f=c[d].apply(c,n),f!==c&&f!==b?(o=f&&f.jquery?o.pushStack(f.get()):f,!1):void 0):a.error("no such method '"+d+"' for "+e+" widget instance"):a.error("cannot call methods on "+
e+" prior to initialization; attempted to call method '"+d+"'")}:function(){var e=a.data(this,i);e?e.option(d||{})._init():a.data(this,i,new c(d,this))}),o}};a.Widget=function(){};a.Widget._childConstructors=[];a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,f){f=a(f||this.defaultElement||this)[0];this.element=a(f);this.uuid=e++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=a.widget.extend({},
this.options,this._getCreateOptions(),b);this.bindings=a();this.hoverable=a();this.focusable=a();f!==this&&(a.data(f,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===f&&this.destroy()}}),this.document=a(f.style?f.ownerDocument:f.document||f),this.window=a(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,
_init:a.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(e,
f){var c,i,d,n=e;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof e)if(n={},c=e.split("."),e=c.shift(),c.length){i=n[e]=a.widget.extend({},this.options[e]);for(d=0;d<c.length-1;d++)i[c[d]]=i[c[d]]||{},i=i[c[d]];if(e=c.pop(),f===b)return i[e]===b?null:i[e];i[e]=f}else{if(f===b)return this.options[e]===b?null:this.options[e];n[e]=f}return this._setOptions(n),this},_setOptions:function(a){for(var e in a)this._setOption(e,a[e]);return this},_setOption:function(a,e){return this.options[a]=
e,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,b,f){var c,i=this;"boolean"!=typeof e&&(f=b,b=e,e=!1);f?(b=c=a(b),this.bindings=this.bindings.add(b)):(f=b,b=this.element,c=this.widget());a.each(f,function(f,d){function g(){return e||i.options.disabled!==
!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof d?i[d]:d).apply(i,arguments):void 0}"string"!=typeof d&&(g.guid=d.guid=d.guid||g.guid||a.guid++);var l=f.match(/^(\w+)\s*(.*)$/),u=l[1]+i.eventNamespace;(l=l[2])?c.delegate(l,u,g):b.bind(u,g)})},_off:function(a,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(e).undelegate(e)},_delay:function(a,e){var b=this;return setTimeout(function(){return("string"==typeof a?b[a]:a).apply(b,arguments)},e||0)},_hoverable:function(e){this.hoverable=
this.hoverable.add(e);this._on(e,{mouseenter:function(e){a(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){a(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e);this._on(e,{focusin:function(e){a(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){a(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,b,f){var c,i=this.options[e];if(f=f||{},b=a.Event(b),b.type=(e===this.widgetEventPrefix?
e:this.widgetEventPrefix+e).toLowerCase(),b.target=this.element[0],e=b.originalEvent)for(c in e)c in b||(b[c]=e[c]);return this.element.trigger(b,f),!(a.isFunction(i)&&i.apply(this.element[0],[b].concat(f))===!1||b.isDefaultPrevented())}};a.each({show:"fadeIn",hide:"fadeOut"},function(e,b){a.Widget.prototype["_"+e]=function(f,c,i){"string"==typeof c&&(c={effect:c});var d,g=c?c===!0||"number"==typeof c?b:c.effect||b:e,c=c||{};"number"==typeof c&&(c={duration:c});d=!a.isEmptyObject(c);c.complete=i;
c.delay&&f.delay(c.delay);d&&a.effects&&a.effects.effect[g]?f[e](c):g!==e&&f[g]?f[g](c.duration,c.easing,i):f.queue(function(b){a(this)[e]();i&&i.call(f[0]);b()})}})})(c);(function(a,b,e){var f={},c=a.find,d=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,k=/:jqmData\(([^)]*)\)/g;a.extend(a.mobile,{ns:"",getAttribute:function(e,b){var f;(e=e.jquery?e[0]:e)&&e.getAttribute&&(f=e.getAttribute("data-"+a.mobile.ns+b));try{f="true"===f?!0:"false"===f?!1:"null"===f?null:+f+""===f?+f:d.test(f)?JSON.parse(f):f}catch(c){}return f},
nsNormalizeDict:f,nsNormalize:function(e){return f[e]||(f[e]=a.camelCase(a.mobile.ns+e))},closestPageData:function(a){return a.closest(":jqmData(role='page'), :jqmData(role='dialog')").data("mobile-page")}});a.fn.jqmData=function(b,f){var c;return"undefined"!=typeof b&&(b&&(b=a.mobile.nsNormalize(b)),c=arguments.length<2||f===e?this.data(b):this.data(b,f)),c};a.jqmData=function(e,b,f){var c;return"undefined"!=typeof b&&(c=a.data(e,b?a.mobile.nsNormalize(b):b,f)),c};a.fn.jqmRemoveData=function(e){return this.removeData(a.mobile.nsNormalize(e))};
a.jqmRemoveData=function(e,b){return a.removeData(e,a.mobile.nsNormalize(b))};a.find=function(e,b,f,d){return e.indexOf(":jqmData")>-1&&(e=e.replace(k,"[data-"+(a.mobile.ns||"")+"$1]")),c.call(this,e,b,f,d)};a.extend(a.find,c)})(c,this);(function(a){var b=/[A-Z]/g,e=function(a){return"-"+a.toLowerCase()};a.extend(a.Widget.prototype,{_getCreateOptions:function(){var f,c,d=this.element[0],k={};if(!a.mobile.getAttribute(d,"defaults"))for(f in this.options)c=a.mobile.getAttribute(d,f.replace(b,e)),null!=
c&&(k[f]=c);return k}});a.mobile.widget=a.Widget})(c);(function(a){var b=a("html");a.widget("mobile.loader",{options:{theme:"a",textVisible:!1,html:"",text:"loading"},defaultHtml:"<div class='ui-loader'><span class='ui-icon-loading'></span><h1></h1></div>",fakeFixLoader:function(){var e=a("."+a.mobile.activeBtnClass).first();this.element.css({top:a.support.scrollTop&&this.window.scrollTop()+this.window.height()/2||e.length&&e.offset().top||100})},checkLoaderPosition:function(){var e=this.element.offset(),
b=this.window.scrollTop(),c=a.mobile.getScreenHeight();(e.top<b||e.top-b>c)&&(this.element.addClass("ui-loader-fakefix"),this.fakeFixLoader(),this.window.unbind("scroll",this.checkLoaderPosition).bind("scroll",a.proxy(this.fakeFixLoader,this)))},resetHtml:function(){this.element.html(a(this.defaultHtml).html())},show:function(e,f,c){var d,k;this.resetHtml();"object"===a.type(e)?(k=a.extend({},this.options,e),e=k.theme):(k=this.options,e=e||k.theme);d=f||(k.text===!1?"":k.text);b.addClass("ui-loading");
this.element.attr("class","ui-loader ui-corner-all ui-body-"+e+" ui-loader-"+(k.textVisible||f||e.text?"verbose":"default")+(k.textonly||c?" ui-loader-textonly":""));k.html?this.element.html(k.html):this.element.find("h1").text(d);this.element.appendTo(a(a.mobile.pagecontainer?":mobile-pagecontainer":"body"));this.checkLoaderPosition();this.window.bind("scroll",a.proxy(this.checkLoaderPosition,this))},hide:function(){b.removeClass("ui-loading");this.options.text&&this.element.removeClass("ui-loader-fakefix");
this.window.unbind("scroll",this.fakeFixLoader);this.window.unbind("scroll",this.checkLoaderPosition)}})})(c,this);(function(a,b,e){function f(a){return a=a||location.href,"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}var c,h="hashchange",k=a.event.special,l=d.documentMode,j="on"+h in b&&(l===e||l>7);a.fn[h]=function(a){return a?this.bind(h,a):this.trigger(h)};a.fn[h].delay=50;k[h]=a.extend(k[h],{setup:function(){return j?!1:void a(c.start)},teardown:function(){return j?!1:void a(c.stop)}});c=function(){function c(){var e=
f(),d=s(l);e!==l?(u(l=e,d),a(b).trigger(h)):d!==l&&(location.href=location.href.replace(/#.*/,"")+d);i=setTimeout(c,a.fn[h].delay)}var i,k={},l=f(),p=function(a){return a},u=p,s=p;return k.start=function(){i||c()},k.stop=function(){i&&clearTimeout(i);i=e},b.attachEvent&&!b.addEventListener&&!j&&function(){var e,b;k.start=function(){e||(b=a.fn[h].src,b=b&&b+f(),e=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){b||u(f());c()}).attr("src",b||"javascript:0").insertAfter("body")[0].contentWindow,
d.onpropertychange=function(){try{"title"===event.propertyName&&(e.document.title=d.title)}catch(a){}})};k.stop=p;s=function(){return f(e.location.href)};u=function(b,f){var c=e.document,i=a.fn[h].domain;b!==f&&(c.title=d.title,c.open(),i&&c.write('<script>document.domain="'+i+'"<\/script>'),c.close(),e.location.hash=b)}}(),k}()})(c,this);(function(a){b.matchMedia=b.matchMedia||function(a){var e,b=a.documentElement,c=b.firstElementChild||b.firstChild,d=a.createElement("body"),k=a.createElement("div");
return k.id="mq-test-1",k.style.cssText="position:absolute;top:-100em",d.style.background="none",d.appendChild(k),function(a){return k.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',b.insertBefore(d,c),e=42===k.offsetWidth,b.removeChild(d),{matches:e,media:a}}}(d);a.mobile.media=function(a){return b.matchMedia(a).matches}})(c);(function(a){var b={touch:"ontouchend"in d};a.mobile.support=a.mobile.support||{};a.extend(a.support,b);a.extend(a.mobile.support,b)})(c);c.extend(c.support,
{orientation:"orientation"in b&&"onorientationchange"in b});(function(a,c){function e(a){var e,b=a.charAt(0).toUpperCase()+a.substr(1),a=(a+" "+k.join(b+" ")+b).split(" ");for(e in a)if(h[a[e]]!==c)return!0}var f,i=a("<body>").prependTo("html"),h=i[0].style,k=["Webkit","Moz","O"];f="palmGetResource"in b;var l=b.operamini&&"[object OperaMini]"==={}.toString.call(b.operamini),j=b.blackberry&&!e("-webkit-transform");a.extend(a.mobile,{browser:{}});a.mobile.browser.oldIE=function(){var a=3,e=d.createElement("div"),
b=e.all||[];do e.innerHTML="<\!--[if gt IE "+ ++a+"]><br><![endif]--\>";while(b[0]);return a>4?a:!a}();a.extend(a.support,{pushState:"pushState"in history&&"replaceState"in history&&!(b.navigator.userAgent.indexOf("Firefox")>=0&&b.top!==b)&&-1===b.navigator.userAgent.search(/CriOS/),mediaquery:a.mobile.media("only all"),cssPseudoElement:!!e("content"),touchOverflow:!!e("overflowScrolling"),cssTransform3d:function(){var e,f,h,l=a.mobile.media("(-"+k.join("-transform-3d),(-")+"-transform-3d),(transform-3d)");
if(l)return!!l;e=d.createElement("div");f={MozTransform:"-moz-transform",transform:"transform"};i.append(e);for(h in f)e.style[h]!==c&&(e.style[h]="translate3d( 100px, 1px, 1px )",l=b.getComputedStyle(e).getPropertyValue(f[h]));return!!l&&"none"!==l}(),boxShadow:!!e("boxShadow")&&!j,fixedPosition:function(){var a=navigator.userAgent,e=navigator.platform,f=a.match(/AppleWebKit\/([0-9]+)/),f=!!f&&f[1],c=a.match(/Fennec\/([0-9]+)/),c=!!c&&c[1],d=a.match(/Opera Mobi\/([0-9]+)/),i=!!d&&d[1];return(e.indexOf("iPhone")>
-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1)&&f&&534>f||b.operamini&&"[object OperaMini]"==={}.toString.call(b.operamini)||d&&7458>i||a.indexOf("Android")>-1&&f&&533>f||c&&6>c||"palmGetResource"in b&&f&&534>f||a.indexOf("MeeGo")>-1&&a.indexOf("NokiaBrowser/8.5.0")>-1?!1:!0}(),scrollTop:("pageXOffset"in b||"scrollTop"in d.documentElement||"scrollTop"in i[0])&&!f&&!l,dynamicBaseTag:function(){var e,b,f=location.protocol+"//"+location.host+location.pathname+"ui-dir/",c=a("head base"),d=null,h="";
return c.length?h=c.attr("href"):c=d=a("<base>",{href:f}).appendTo("head"),e=a("<a href='testurl' />").prependTo(i),b=e[0].href,c[0].href=h||location.pathname,d&&d.remove(),0===b.indexOf(f)}(),cssPointerEvents:function(){var a,e=d.createElement("x"),f=d.documentElement,c=b.getComputedStyle;return"pointerEvents"in e.style?(e.style.pointerEvents="auto",e.style.pointerEvents="x",f.appendChild(e),a=c&&"auto"===c(e,"").pointerEvents,f.removeChild(e),!!a):!1}(),boundingRect:"undefined"!=typeof d.createElement("div").getBoundingClientRect,
inlineSVG:function(){var e=!(!b.document.createElementNS||!b.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||b.opera&&-1===navigator.userAgent.indexOf("Chrome")),f=function(b){b&&e||a("html").addClass("ui-nosvg")},c=new b.Image;c.onerror=function(){f(!1)};c.onload=function(){f(1===c.width&&1===c.height)};c.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}});i.remove();f=function(){var a=b.navigator.userAgent;return a.indexOf("Nokia")>-1&&(a.indexOf("Symbian/3")>
-1||a.indexOf("Series60/5")>-1)&&a.indexOf("AppleWebKit")>-1&&a.match(/(BrowserNG|NokiaBrowser)\/7\.[0-3]/)}();a.mobile.gradeA=function(){return(a.support.mediaquery&&a.support.cssPseudoElement||a.mobile.browser.oldIE&&a.mobile.browser.oldIE>=8)&&(a.support.boundingRect||null!==a.fn.jquery.match(/1\.[0-7+]\.[0-9+]?/))};a.mobile.ajaxBlacklist=b.blackberry&&!b.WebKitPoint||l||f;f&&a(function(){a("head link[rel='stylesheet']").attr("rel","alternate stylesheet").attr("rel","stylesheet")});a.support.boxShadow||
a("html").addClass("ui-noboxshadow")})(c);(function(a,b){var e,f=a.mobile.window,c=function(){};a.event.special.beforenavigate={setup:function(){f.on("navigate",c)},teardown:function(){f.off("navigate",c)}};a.event.special.navigate=e={bound:!1,pushStateEnabled:!0,originalEventName:b,isPushStateEnabled:function(){return a.support.pushState&&a.mobile.pushStateEnabled===!0&&this.isHashChangeEnabled()},isHashChangeEnabled:function(){return a.mobile.hashListeningEnabled===!0},popstate:function(e){var b=
new a.Event("navigate"),c=new a.Event("beforenavigate"),d=e.originalEvent.state||{};c.originalEvent=e;f.trigger(c);c.isDefaultPrevented()||(e.historyState&&a.extend(d,e.historyState),b.originalEvent=e,setTimeout(function(){f.trigger(b,{state:d})},0))},hashchange:function(e){var b=new a.Event("navigate"),c=new a.Event("beforenavigate");c.originalEvent=e;f.trigger(c);c.isDefaultPrevented()||(b.originalEvent=e,f.trigger(b,{state:e.hashchangeState||{}}))},setup:function(){e.bound||(e.bound=!0,e.isPushStateEnabled()?
(e.originalEventName="popstate",f.bind("popstate.navigate",e.popstate)):e.isHashChangeEnabled()&&(e.originalEventName="hashchange",f.bind("hashchange.navigate",e.hashchange)))}}})(c);(function(a,c){var e,f;a.mobile.path=e={uiStateKey:"&ui-state",urlParseRE:/^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,getLocation:function(a){var e=this.parseUrl(a||location.href),
a=a?e:location,b=e.hash;return b="#"===b?"":b,a.protocol+e.doubleSlash+a.host+(""!==a.protocol&&"/"!==a.pathname.substring(0,1)?"/":"")+a.pathname+a.search+b},getDocumentUrl:function(b){return b?a.extend({},e.documentUrl):e.documentUrl.href},parseLocation:function(){return this.parseUrl(this.getLocation())},parseUrl:function(b){if("object"===a.type(b))return b;b=e.urlParseRE.exec(b||"")||[];return{href:b[0]||"",hrefNoHash:b[1]||"",hrefNoSearch:b[2]||"",domain:b[3]||"",protocol:b[4]||"",doubleSlash:b[5]||
"",authority:b[6]||"",username:b[8]||"",password:b[9]||"",host:b[10]||"",hostname:b[11]||"",port:b[12]||"",pathname:b[13]||"",directory:b[14]||"",filename:b[15]||"",search:b[16]||"",hash:b[17]||""}},makePathAbsolute:function(a,e){var b,f,c,d;if(a&&"/"===a.charAt(0))return a;a=a||"";b=(e=e?e.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"")?e.split("/"):[];f=a.split("/");for(c=0;c<f.length;c++)switch(d=f[c]){case ".":break;case "..":b.length&&b.pop();break;default:b.push(d)}return"/"+b.join("/")},isSameDomain:function(a,
b){return e.parseUrl(a).domain.toLowerCase()===e.parseUrl(b).domain.toLowerCase()},isRelativeUrl:function(a){return""===e.parseUrl(a).protocol},isAbsoluteUrl:function(a){return""!==e.parseUrl(a).protocol},makeUrlAbsolute:function(a,b){if(!e.isRelativeUrl(a))return a;b===c&&(b=this.documentBase);var f=e.parseUrl(a),d=e.parseUrl(b),j=f.protocol||d.protocol,m=f.protocol?f.doubleSlash:f.doubleSlash||d.doubleSlash,n=f.authority||d.authority,o=""!==f.pathname,q=e.makePathAbsolute(f.pathname||d.filename,
d.pathname);return j+m+n+q+(f.search||!o&&d.search||"")+f.hash},addSearchParams:function(b,f){var c=e.parseUrl(b),d="object"==typeof f?a.param(f):f,g=c.search||"?";return c.hrefNoSearch+g+("?"!==g.charAt(g.length-1)?"&":"")+d+(c.hash||"")},convertUrlToDataUrl:function(a){var f=a,a=e.parseUrl(a);return e.isEmbeddedPage(a)?f=a.hash.split("&ui-state=dialog")[0].replace(/^#/,"").replace(/\?.*$/,""):e.isSameDomain(a,this.documentBase)&&(f=a.hrefNoHash.replace(this.documentBase.domain,"").split("&ui-state=dialog")[0]),
b.decodeURIComponent(f)},get:function(a){return a===c&&(a=e.parseLocation().hash),e.stripHash(a).replace(/[^\/]*\.[^\/*]+$/,"")},set:function(a){location.hash=a},isPath:function(a){return/\//.test(a)},clean:function(a){return a.replace(this.documentBase.domain,"")},stripHash:function(a){return a.replace(/^#/,"")},stripQueryParams:function(a){return a.replace(/\?.*$/,"")},cleanHash:function(a){return e.stripHash(a.replace(/\?.*$/,"").replace("&ui-state=dialog",""))},isHashValid:function(a){return/^#[^#]+$/.test(a)},
isExternal:function(a){a=e.parseUrl(a);return!(!a.protocol||a.domain.toLowerCase()===this.documentUrl.domain.toLowerCase())},hasProtocol:function(a){return/^(:?\w+:)/.test(a)},isEmbeddedPage:function(a){a=e.parseUrl(a);return""!==a.protocol?!this.isPath(a.hash)&&a.hash&&(a.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&a.hrefNoHash===this.documentBase.hrefNoHash):/^#/.test(a.href)},squash:function(a,b){var f,c,d,g,n,o=this.isPath(a),q=this.parseUrl(a),p=q.hash,u="";return b||
(o?b=e.getLocation():(n=e.getDocumentUrl(!0),b=e.isPath(n.hash)?e.squash(n.href):n.href)),c=o?e.stripHash(a):a,c=e.isPath(q.hash)?e.stripHash(q.hash):c,g=c.indexOf(this.uiStateKey),g>-1&&(u=c.slice(g),c=c.slice(0,g)),f=e.makeUrlAbsolute(c,b),d=this.parseUrl(f).search,o?((e.isPath(p)||0===p.replace("#","").indexOf(this.uiStateKey))&&(p=""),u&&-1===p.indexOf(this.uiStateKey)&&(p+=u),-1===p.indexOf("#")&&""!==p&&(p="#"+p),f=e.parseUrl(f),f=f.protocol+f.doubleSlash+f.host+f.pathname+d+p):f+=f.indexOf("#")>
-1?u:"#"+u,f},isPreservableHash:function(a){return 0===a.replace("#","").indexOf(this.uiStateKey)},hashToSelector:function(a){var e="#"===a.substring(0,1);return e&&(a=a.substring(1)),(e?"#":"")+a.replace(/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g,"\\$1")},getFilePath:function(a){return a&&a.split("&ui-state=dialog")[0]},isFirstPageUrl:function(b){var b=e.parseUrl(e.makeUrlAbsolute(b,this.documentBase)),f=a.mobile.firstPage,f=f&&f[0]?f[0].id:c;return(b.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&
b.hrefNoHash===this.documentBase.hrefNoHash)&&(!b.hash||"#"===b.hash||f&&b.hash.replace(/^#/,"")===f)},isPermittedCrossDomainRequest:function(e,b){return a.mobile.allowCrossDomainPages&&("file:"===e.protocol||"content:"===e.protocol)&&-1!==b.search(/^https?:/)}};e.documentUrl=e.parseLocation();f=a("head").find("base");e.documentBase=f.length?e.parseUrl(e.makeUrlAbsolute(f.attr("href"),e.documentUrl.href)):e.documentUrl;e.documentBaseDiffers=e.documentUrl.hrefNoHash!==e.documentBase.hrefNoHash;e.getDocumentBase=
function(b){return b?a.extend({},e.documentBase):e.documentBase.href};a.extend(a.mobile,{getDocumentUrl:e.getDocumentUrl,getDocumentBase:e.getDocumentBase})})(c);(function(a,b){a.mobile.History=function(a,b){this.stack=a||[];this.activeIndex=b||0};a.extend(a.mobile.History.prototype,{getActive:function(){return this.stack[this.activeIndex]},getLast:function(){return this.stack[this.previousIndex]},getNext:function(){return this.stack[this.activeIndex+1]},getPrev:function(){return this.stack[this.activeIndex-
1]},add:function(a,b){b=b||{};this.getNext()&&this.clearForward();b.hash&&-1===b.hash.indexOf("#")&&(b.hash="#"+b.hash);b.url=a;this.stack.push(b);this.activeIndex=this.stack.length-1},clearForward:function(){this.stack=this.stack.slice(0,this.activeIndex+1)},find:function(a,b,c){var b=b||this.stack,d,g,l,j=b.length;for(g=0;j>g;g++)if(d=b[g],(decodeURIComponent(a)===decodeURIComponent(d.url)||decodeURIComponent(a)===decodeURIComponent(d.hash))&&(l=g,c))break;return l},closest:function(a){var f,c=
this.activeIndex;return f=this.find(a,this.stack.slice(0,c)),f===b&&(f=this.find(a,this.stack.slice(c),!0),f=f===b?f:f+c),f},direct:function(e){var f=this.closest(e.url),c=this.activeIndex;f!==b&&(this.activeIndex=f,this.previousIndex=c);c>f?(e.present||e.back||a.noop)(this.getActive(),"back"):f>c?(e.present||e.forward||a.noop)(this.getActive(),"forward"):f===b&&e.missing&&e.missing(this.getActive())}})})(c);(function(a){var c=a.mobile.path,e=location.href;a.mobile.Navigator=function(e){this.history=
e;this.ignoreInitialHashChange=!0;a.mobile.window.bind({"popstate.history":a.proxy(this.popstate,this),"hashchange.history":a.proxy(this.hashchange,this)})};a.extend(a.mobile.Navigator.prototype,{squash:function(e,i){var h,k,l=c.isPath(e)?c.stripHash(e):e;return k=c.squash(e),h=a.extend({hash:l,url:k},i),b.history.replaceState(h,h.title||d.title,k),h},hash:function(a,e){var b,d,l,j;return b=c.parseUrl(a),d=c.parseLocation(),d.pathname+d.search===b.pathname+b.search?l=b.hash?b.hash:b.pathname+b.search:
c.isPath(a)?(j=c.parseUrl(e),l=j.pathname+j.search+(c.isPreservableHash(j.hash)?j.hash.replace("#",""):"")):l=a,l},go:function(e,i,h){var k,l,j,m=a.event.special.navigate.isPushStateEnabled();k=c.squash(e);l=this.hash(e,k);h&&l!==c.stripHash(c.parseLocation().hash)&&(this.preventNextHashChange=h);this.preventHashAssignPopState=!0;b.location.hash=l;this.preventHashAssignPopState=!1;i=a.extend({url:k,hash:l,title:d.title},i);m&&(j=new a.Event("popstate"),j.originalEvent={type:"popstate",state:null},
this.squash(e,i),h||(this.ignorePopState=!0,a.mobile.window.trigger(j)));this.history.add(i.url,i)},popstate:function(b){var d,h;if(a.event.special.navigate.isPushStateEnabled())return this.preventHashAssignPopState?(this.preventHashAssignPopState=!1,void b.stopImmediatePropagation()):this.ignorePopState?void(this.ignorePopState=!1):!b.originalEvent.state&&1===this.history.stack.length&&this.ignoreInitialHashChange&&(this.ignoreInitialHashChange=!1,location.href===e)?void b.preventDefault():(d=c.parseLocation().hash,
!b.originalEvent.state&&d?(h=this.squash(d),this.history.add(h.url,h),void(b.historyState=h)):void this.history.direct({url:(b.originalEvent.state||{}).url||d,present:function(e,c){b.historyState=a.extend({},e);b.historyState.direction=c}}))},hashchange:function(e){var b,h;if(a.event.special.navigate.isHashChangeEnabled()&&!a.event.special.navigate.isPushStateEnabled()){if(this.preventNextHashChange)return this.preventNextHashChange=!1,void e.stopImmediatePropagation();b=this.history;h=c.parseLocation().hash;
this.history.direct({url:h,present:function(b,c){e.hashchangeState=a.extend({},b);e.hashchangeState.direction=c},missing:function(){b.add(h,{hash:h,title:d.title})}})}}})})(c);(function(a){a.mobile.navigate=function(e,b,c){a.mobile.navigate.navigator.go(e,b,c)};a.mobile.navigate.history=new a.mobile.History;a.mobile.navigate.navigator=new a.mobile.Navigator(a.mobile.navigate.history);var b=a.mobile.path.parseLocation();a.mobile.navigate.history.add(b.href,{hash:b.hash})})(c);(function(a,b){var e=
{animation:{},transition:{}},c=d.createElement("a"),i=["","webkit-","moz-","o-"];a.each(["animation","transition"],function(d,k){var l=0===d?k+"-name":k;a.each(i,function(d,h){return c.style[a.camelCase(h+l)]!==b?(e[k].prefix=h,!1):void 0});e[k].duration=a.camelCase(e[k].prefix+k+"-duration");e[k].event=a.camelCase(e[k].prefix+k+"-end");""===e[k].prefix&&(e[k].event=e[k].event.toLowerCase())});a.support.cssTransitions=e.transition.prefix!==b;a.support.cssAnimations=e.animation.prefix!==b;a(c).remove();
a.fn.animationComplete=function(c,f,i){var j,m,n=this,o=function(){clearTimeout(j);c.apply(this,arguments)},q=f&&"animation"!==f?"transition":"animation";return a.support.cssTransitions&&"transition"===q||a.support.cssAnimations&&"animation"===q?(i===b&&(a(this).context!==d&&(m=3E3*parseFloat(a(this).css(e[q].duration))),(0===m||m===b||isNaN(m))&&(m=a.fn.animationComplete.defaultDuration)),j=setTimeout(function(){a(n).off(e[q].event,o);c.apply(n)},m),a(this).one(e[q].event,o)):(setTimeout(a.proxy(c,
this),0),a(this))};a.fn.animationComplete.defaultDuration=1E3})(c);(function(a,b,e,c){function d(a){for(;a&&"undefined"!=typeof a.originalEvent;)a=a.originalEvent;return a}function h(e){for(var b,c,f={};e;){b=a.data(e,v);for(c in b)b[c]&&(f[c]=f.hasVirtualBinding=!0);e=e.parentNode}return f}function k(){A&&(clearTimeout(A),A=0);A=setTimeout(function(){I=A=0;J.length=0;H=!1;F=!0},a.vmouse.resetTimerDuration)}function l(e,b,h){var g,k;if(!(k=h&&h[e])){if(h=!h)a:{for(var h=b.target,l;h;){if(l=a.data(h,
v),l&&(!e||l[e]))break a;h=h.parentNode}h=null}k=h}if(k){g=b;var j,m,n,o;l=g.type;if(g=a.Event(g),g.type=e,j=g.originalEvent,h=a.event.props,l.search(/^(mouse|click)/)>-1&&(h=y),j)for(k=h.length;k;)e=h[--k],g[e]=j[e];if(l.search(/mouse(down|up)|click/)>-1&&!g.which&&(g.which=1),-1!==l.search(/^touch/)&&(m=d(j),l=m.touches,n=m.changedTouches,o=l&&l.length?l[0]:n&&n.length?n[0]:c)){j=0;for(m=w.length;m>j;j++)e=w[j],g[e]=o[e]}a(b.target).trigger(g)}return g}function j(e){var b,c=a.data(e.target,x);H||
I&&I===c||(b=l("v"+e.type,e),b&&(b.isDefaultPrevented()&&e.preventDefault(),b.isPropagationStopped()&&e.stopPropagation(),b.isImmediatePropagationStopped()&&e.stopImmediatePropagation()))}function m(e){var b,c;if((c=d(e).touches)&&1===c.length)if(b=e.target,c=h(b),c.hasVirtualBinding)I=X++,a.data(b,x,I),A&&(clearTimeout(A),A=0),E=F=!1,b=d(e).touches[0],C=b.pageX,B=b.pageY,l("vmouseover",e,c),l("vmousedown",e,c)}function n(a){F||(E||l("vmousecancel",a,h(a.target)),E=!0,k())}function o(e){if(!F){var b=
d(e).touches[0],c=E,f=a.vmouse.moveDistanceThreshold,g=h(e.target);(E=E||Math.abs(b.pageX-C)>f||Math.abs(b.pageY-B)>f)&&!c&&l("vmousecancel",e,g);l("vmousemove",e,g);k()}}function q(a){if(!F){F=!0;var e,b,c=h(a.target);l("vmouseup",a,c);E||(e=l("vclick",a,c),e&&e.isDefaultPrevented()&&(b=d(a).changedTouches[0],J.push({touchID:I,x:b.clientX,y:b.clientY}),H=!0));l("vmouseout",a,c);E=!1;k()}}function p(e){var b;if(e=a.data(e,v))for(b in e)if(e[b])return!0;return!1}function u(){}function s(e){var b=e.substr(1);
return{setup:function(){p(this)||a.data(this,v,{});a.data(this,v)[e]=!0;z[e]=(z[e]||0)+1;1===z[e]&&K.bind(b,j);a(this).bind(b,u);S&&(z.touchstart=(z.touchstart||0)+1,1===z.touchstart&&K.bind("touchstart",m).bind("touchend",q).bind("touchmove",o).bind("scroll",n))},teardown:function(){--z[e];z[e]||K.unbind(b,j);S&&(--z.touchstart,z.touchstart||K.unbind("touchstart",m).unbind("touchmove",o).unbind("touchend",q).unbind("scroll",n));var c=a(this),f=a.data(this,v);f&&(f[e]=!1);c.unbind(b,u);p(this)||c.removeData(v)}}}
var r,v="virtualMouseBindings",x="virtualTouchID",t="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),w="clientX clientY pageX pageY screenX screenY".split(" "),y=a.event.props.concat(a.event.mouseHooks?a.event.mouseHooks.props:[]),z={},A=0,C=0,B=0,E=!1,J=[],H=!1,F=!1,S="addEventListener"in e,K=a(e),X=1,I=0;a.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500};for(b=0;b<t.length;b++)a.event.special[t[b]]=s(t[b]);S&&e.addEventListener("click",
function(e){var b,c,f,d,h,i=J.length,g=e.target;if(i){b=e.clientX;c=e.clientY;r=a.vmouse.clickDistanceThreshold;for(f=g;f;){for(d=0;i>d;d++)if(h=J[d],f===g&&Math.abs(h.x-b)<r&&Math.abs(h.y-c)<r||a.data(f,x)===h.touchID)return e.preventDefault(),void e.stopPropagation();f=f.parentNode}}},!0)})(c,b,d);(function(a,b,e){function c(b,f,d,h){var i=d.type;d.type=f;h?a.event.trigger(d,e,b):a.event.dispatch.call(b,d);d.type=i}var i=a(d),h=a.mobile.support.touch,k=h?"touchstart":"mousedown",l=h?"touchend":
"mouseup",j=h?"touchmove":"mousemove";a.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(e,b){a.fn[b]=function(a){return a?this.bind(b,a):this.trigger(b)};a.attrFn&&(a.attrFn[b]=!0)});a.event.special.scrollstart={enabled:!0,setup:function(){function e(a,d){b=d;c(h,b?"scrollstart":"scrollstop",a)}var b,d,h=this;a(h).bind("touchmove scroll",function(c){a.event.special.scrollstart.enabled&&(b||e(c,!0),clearTimeout(d),d=setTimeout(function(){e(c,
!1)},50))})},teardown:function(){a(this).unbind("touchmove scroll")}};a.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var e=this,b=a(e),d=!1;b.bind("vmousedown",function(h){function g(){clearTimeout(j)}function k(){g();b.unbind("vclick",l).unbind("vmouseup",g);i.unbind("vmousecancel",k)}function l(a){k();d||v!==a.target?d&&a.preventDefault():c(e,"tap",a)}if(d=!1,h.which&&1!==h.which)return!1;var j,v=h.target;b.bind("vmouseup",g).bind("vclick",l);i.bind("vmousecancel",
k);j=setTimeout(function(){a.event.special.tap.emitTapOnTaphold||(d=!0);c(e,"taphold",a.Event("taphold",{target:v}))},a.event.special.tap.tapholdThreshold)})},teardown:function(){a(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup");i.unbind("vmousecancel")}};a.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1E3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(a){var e=b.pageXOffset,c=b.pageYOffset,f=a.clientX,d=a.clientY;return 0===a.pageY&&
Math.floor(d)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(f)>Math.floor(a.pageX)?(f-=e,d-=c):(d<a.pageY-c||f<a.pageX-e)&&(f=a.pageX-e,d=a.pageY-c),{x:f,y:d}},start:function(e){var b=a.event.special.swipe.getLocation(e.originalEvent.touches?e.originalEvent.touches[0]:e);return{time:(new Date).getTime(),coords:[b.x,b.y],origin:a(e.target)}},stop:function(e){e=a.event.special.swipe.getLocation(e.originalEvent.touches?e.originalEvent.touches[0]:e);return{time:(new Date).getTime(),coords:[e.x,e.y]}},
handleSwipe:function(e,b,d,h){if(b.time-e.time<a.event.special.swipe.durationThreshold&&Math.abs(e.coords[0]-b.coords[0])>a.event.special.swipe.horizontalDistanceThreshold&&Math.abs(e.coords[1]-b.coords[1])<a.event.special.swipe.verticalDistanceThreshold){var i=e.coords[0]>b.coords[0]?"swipeleft":"swiperight";return c(d,"swipe",a.Event("swipe",{target:h,swipestart:e,swipestop:b}),!0),c(d,i,a.Event(i,{target:h,swipestart:e,swipestop:b}),!0),!0}return!1},eventInProgress:!1,setup:function(){var e,b=
this,c=a(b),f={};(e=a.data(this,"mobile-events"))||(e={length:0},a.data(this,"mobile-events",e));e.length++;e.swipe=f;f.start=function(e){if(!a.event.special.swipe.eventInProgress){a.event.special.swipe.eventInProgress=!0;var c,d=a.event.special.swipe.start(e),h=e.target,g=!1;f.move=function(e){d&&!e.isDefaultPrevented()&&(c=a.event.special.swipe.stop(e),g||(g=a.event.special.swipe.handleSwipe(d,c,b,h),g&&(a.event.special.swipe.eventInProgress=!1)),Math.abs(d.coords[0]-c.coords[0])>a.event.special.swipe.scrollSupressionThreshold&&
e.preventDefault())};f.stop=function(){g=!0;a.event.special.swipe.eventInProgress=!1;i.off(j,f.move);f.move=null};i.on(j,f.move).one(l,f.stop)}};c.on(k,f.start)},teardown:function(){var e,b;(e=a.data(this,"mobile-events"))&&(b=e.swipe,delete e.swipe,e.length--,0===e.length&&a.removeData(this,"mobile-events"));b&&(b.start&&a(this).off(k,b.start),b.move&&i.off(j,b.move),b.stop&&i.off(l,b.stop))}};a.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(e,
b){a.event.special[e]={setup:function(){a(this).bind(b,a.noop)},teardown:function(){a(this).unbind(b)}}})})(c,this);(function(a){a.event.special.throttledresize={setup:function(){a(this).bind("resize",d)},teardown:function(){a(this).unbind("resize",d)}};var b,e,c,d=function(){e=(new Date).getTime();c=e-h;c>=250?(h=e,a(this).trigger("throttledresize")):(b&&clearTimeout(b),b=setTimeout(d,250-c))},h=0})(c);(function(a,b){function e(){var a=c();a!==i&&(i=a,m.trigger(n))}var c,i,h,k,l,j,m=a(b),n="orientationchange",
o={0:!0,180:!0};a.support.orientation&&(l=b.innerWidth||m.width(),j=b.innerHeight||m.height(),h=l>j&&l-j>50,k=o[b.orientation],(h&&k||!h&&!k)&&(o={"-90":!0,90:!0}));a.event.special.orientationchange=a.extend({},a.event.special.orientationchange,{setup:function(){return a.support.orientation&&!a.event.special.orientationchange.disabled?!1:(i=c(),void m.bind("throttledresize",e))},teardown:function(){return a.support.orientation&&!a.event.special.orientationchange.disabled?!1:void m.unbind("throttledresize",
e)},add:function(a){var e=a.handler;a.handler=function(a){return a.orientation=c(),e.apply(this,arguments)}}});a.event.special.orientationchange.orientation=c=function(){var e=!0,c=d.documentElement;return e=a.support.orientation?o[b.orientation]:c&&c.clientWidth/c.clientHeight<1.1,e?"portrait":"landscape"};a.fn[n]=function(a){return a?this.bind(n,a):this.trigger(n)};a.attrFn&&(a.attrFn[n]=!0)})(c,this);(function(a){var b=a("head").children("base"),e={element:b.length?b:a("<base>",{href:a.mobile.path.documentBase.hrefNoHash}).prependTo(a("head")),
linkSelector:"[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]",set:function(b){a.mobile.dynamicBaseEnabled&&a.support.dynamicBaseTag&&e.element.attr("href",a.mobile.path.makeUrlAbsolute(b,a.mobile.path.documentBase))},rewrite:function(b,c){var d=a.mobile.path.get(b);c.find(e.linkSelector).each(function(e,b){var c=a(b).is("[href]")?"href":a(b).is("[src]")?"src":"action",f=a.mobile.path.parseLocation(),i=a(b).attr(c),i=i.replace(f.protocol+f.doubleSlash+f.host+f.pathname,"");
/^(\w+:|#|\/)/.test(i)||a(b).attr(c,d+i)})},reset:function(){e.element.attr("href",a.mobile.path.documentBase.hrefNoSearch)}};a.mobile.base=e})(c);(function(a,b){a.mobile.widgets={};var e=a.widget,c=a.mobile.keepNative;a.widget=function(e){return function(){var c=e.apply(this,arguments),f=c.prototype.widgetName;return c.initSelector=c.prototype.initSelector!==b?c.prototype.initSelector:":jqmData(role='"+f+"')",a.mobile.widgets[f]=c,c}}(a.widget);a.extend(a.widget,e);a.mobile.document.on("create",
function(e){a(e.target).enhanceWithin()});a.widget("mobile.page",{options:{theme:"a",domCache:!1,keepNativeDefault:a.mobile.keepNative,contentTheme:null,enhanced:!1},_createWidget:function(){a.Widget.prototype._createWidget.apply(this,arguments);this._trigger("init")},_create:function(){return this._trigger("beforecreate")===!1?!1:(this.options.enhanced||this._enhance(),this._on(this.element,{pagebeforehide:"removeContainerBackground",pagebeforeshow:"_handlePageBeforeShow"}),this.element.enhanceWithin(),
void("dialog"===a.mobile.getAttribute(this.element[0],"role")&&a.mobile.dialog&&this.element.dialog()))},_enhance:function(){var e="data-"+a.mobile.ns,c=this;this.options.role&&this.element.attr("data-"+a.mobile.ns+"role",this.options.role);this.element.attr("tabindex","0").addClass("ui-page ui-page-theme-"+this.options.theme);this.element.find("["+e+"role='content']").each(function(){var f=a(this),d=this.getAttribute(e+"theme")||b;c.options.contentTheme=d||c.options.contentTheme||c.options.dialog&&
c.options.theme||"dialog"===c.element.jqmData("role")&&c.options.theme;f.addClass("ui-content");c.options.contentTheme&&f.addClass("ui-body-"+c.options.contentTheme);f.attr("role","main").addClass("ui-content")})},bindRemove:function(e){var b=this.element;!b.data("mobile-page").options.domCache&&b.is(":jqmData(external-page='true')")&&b.bind("pagehide.remove",e||function(e,b){if(!b.samePage){var c=a(this),f=new a.Event("pageremove");c.trigger(f);f.isDefaultPrevented()||c.removeWithDependents()}})},
_setOptions:function(e){e.theme!==b&&this.element.removeClass("ui-page-theme-"+this.options.theme).addClass("ui-page-theme-"+e.theme);e.contentTheme!==b&&this.element.find("[data-"+a.mobile.ns+"='content']").removeClass("ui-body-"+this.options.contentTheme).addClass("ui-body-"+e.contentTheme)},_handlePageBeforeShow:function(){this.setContainerBackground()},removeContainerBackground:function(){this.element.closest(":mobile-pagecontainer").pagecontainer({theme:"none"})},setContainerBackground:function(a){this.element.parent().pagecontainer({theme:a||
this.options.theme})},keepNativeSelector:function(){var e=this.options,b=a.trim(e.keepNative||""),d=a.trim(a.mobile.keepNative),e=a.trim(e.keepNativeDefault),d=c===d?"":d,e=""===d?e:"";return(b?[b]:[]).concat(d?[d]:[]).concat(e?[e]:[]).join(", ")}})})(c);(function(a,c){a.widget("mobile.pagecontainer",{options:{theme:"a"},initSelector:!1,_create:function(){this._trigger("beforecreate");this.setLastScrollEnabled=!0;this._on(this.window,{navigate:"_disableRecordScroll",scrollstop:"_delayedRecordScroll"});
this._on(this.window,{navigate:"_filterNavigateEvents"});this._on({pagechange:"_afterContentChange"});this.window.one("navigate",a.proxy(function(){this.setLastScrollEnabled=!0},this))},_setOptions:function(a){a.theme!==c&&"none"!==a.theme?this.element.removeClass("ui-overlay-"+this.options.theme).addClass("ui-overlay-"+a.theme):a.theme!==c&&this.element.removeClass("ui-overlay-"+this.options.theme);this._super(a)},_disableRecordScroll:function(){this.setLastScrollEnabled=!1},_enableRecordScroll:function(){this.setLastScrollEnabled=
!0},_afterContentChange:function(){this.setLastScrollEnabled=!0;this._off(this.window,"scrollstop");this._on(this.window,{scrollstop:"_delayedRecordScroll"})},_recordScroll:function(){if(this.setLastScrollEnabled){var a,e,b,c=this._getActiveHistory();c&&(a=this._getScroll(),e=this._getMinScroll(),b=this._getDefaultScroll(),c.lastScroll=e>a?b:a)}},_delayedRecordScroll:function(){setTimeout(a.proxy(this,"_recordScroll"),100)},_getScroll:function(){return this.window.scrollTop()},_getMinScroll:function(){return a.mobile.minScrollBack},
_getDefaultScroll:function(){return a.mobile.defaultHomeScroll},_filterNavigateEvents:function(e,b){var c;e.originalEvent&&e.originalEvent.isDefaultPrevented()||(c=e.originalEvent.type.indexOf("hashchange")>-1?b.state.hash:b.state.url,c||(c=this._getHash()),c&&"#"!==c&&0!==c.indexOf("#"+a.mobile.path.uiStateKey)||(c=location.href),this._handleNavigate(c,b.state))},_getHash:function(){return a.mobile.path.parseLocation().hash},getActivePage:function(){return this.activePage},_getInitialContent:function(){return a.mobile.firstPage},
_getHistory:function(){return a.mobile.navigate.history},_getActiveHistory:function(){return this._getHistory().getActive()},_getDocumentBase:function(){return a.mobile.path.documentBase},back:function(){this.go(-1)},forward:function(){this.go(1)},go:function(e){if(a.mobile.hashListeningEnabled)b.history.go(e);else{var c=a.mobile.navigate.history.activeIndex,f=c+parseInt(e,10),d=a.mobile.navigate.history.stack[f].url;a.mobile.navigate.history.activeIndex=f;a.mobile.navigate.history.previousIndex=
c;this.change(d,{direction:e>=1?"forward":"back",changeHash:!1,fromHashChange:!0})}},_handleDestination:function(e){return"string"===a.type(e)&&(e=a.mobile.path.stripHash(e)),e&&(this._getHistory(),e=a.mobile.path.isPath(e)?e:a.mobile.path.makeUrlAbsolute("#"+e,this._getDocumentBase())),e||this._getInitialContent()},_transitionFromHistory:function(a,e){var b=this._getHistory();return(b="back"===a?b.getLast():b.getActive())&&b.transition||e},_handleDialog:function(e,b){var c,f,d=this.getActivePage();
return d&&!d.data("mobile-dialog")?("back"===b.direction?this.back():this.forward(),!1):(c=b.pageUrl,f=this._getActiveHistory(),a.extend(e,{role:f.role,transition:this._transitionFromHistory(b.direction,e.transition),reverse:"back"===b.direction}),c)},_handleNavigate:function(e,b){var c=a.mobile.path.stripHash(e),f=this._getHistory(),d=0===f.stack.length?"none":this._transitionFromHistory(b.direction),g={changeHash:!1,fromHashChange:!0,reverse:"back"===b.direction};a.extend(g,b,{transition:d});f.activeIndex>
0&&c.indexOf(a.mobile.dialogHashKey)>-1&&(c=this._handleDialog(g,b),c===!1)||this._changeContent(this._handleDestination(c),g)},_changeContent:function(e,b){a.mobile.changePage(e,b)},_getBase:function(){return a.mobile.base},_getNs:function(){return a.mobile.ns},_enhance:function(a,e){return a.page({role:e})},_include:function(a,e){a.appendTo(this.element);this._enhance(a,e.role);a.page("bindRemove")},_find:function(e){var b,c=this._createFileUrl(e),e=this._createDataUrl(e),f=this._getInitialContent();
return b=this.element.children("[data-"+this._getNs()+"url='"+a.mobile.path.hashToSelector(e)+"']"),0===b.length&&e&&!a.mobile.path.isPath(e)&&(b=this.element.children(a.mobile.path.hashToSelector("#"+e)).attr("data-"+this._getNs()+"url",e).jqmData("url",e)),0===b.length&&a.mobile.path.isFirstPageUrl(c)&&f&&f.parent().length&&(b=a(f)),b},_getLoader:function(){return a.mobile.loading()},_showLoading:function(e,b,c,f){this._loadMsg||(this._loadMsg=setTimeout(a.proxy(function(){this._getLoader().loader("show",
b,c,f);this._loadMsg=0},this),e))},_hideLoading:function(){clearTimeout(this._loadMsg);this._loadMsg=0;this._getLoader().loader("hide")},_showError:function(){this._hideLoading();this._showLoading(0,a.mobile.pageLoadErrorMessageTheme,a.mobile.pageLoadErrorMessage,!0);setTimeout(a.proxy(this,"_hideLoading"),1500)},_parse:function(e,b){var c,f=a("<div></div>");return f.get(0).innerHTML=e,c=f.find(":jqmData(role='page'), :jqmData(role='dialog')").first(),c.length||(c=a("<div data-"+this._getNs()+"role='page'>"+
(e.split(/<\/?body[^>]*>/gim)[1]||"")+"</div>")),c.attr("data-"+this._getNs()+"url",this._createDataUrl(b)).attr("data-"+this._getNs()+"external-page",!0),c},_setLoadedTitle:function(e,b){var c=b.match(/<title[^>]*>([^<]*)/)&&RegExp.$1;c&&!e.jqmData("title")&&(c=a("<div>"+c+"</div>").text(),e.jqmData("title",c))},_isRewritableBaseTag:function(){return a.mobile.dynamicBaseEnabled&&!a.support.dynamicBaseTag},_createDataUrl:function(e){return a.mobile.path.convertUrlToDataUrl(e)},_createFileUrl:function(e){return a.mobile.path.getFilePath(e)},
_triggerWithDeprecated:function(e,b,c){var f=a.Event("page"+e),d=a.Event(this.widgetName+e);return(c||this.element).trigger(f,b),this._trigger(e,d,b),{deprecatedEvent:f,event:d}},_loadSuccess:function(e,b,f,d){var j=this._createFileUrl(e);return a.proxy(function(m,n,o){var q;q=RegExp("(<[^>]+\\bdata-"+this._getNs()+"role=[\"']?page[\"']?[^>]*>)");var p=RegExp("\\bdata-"+this._getNs()+"url=[\"']?([^\"'>]*)[\"']?");q.test(m)&&RegExp.$1&&p.test(RegExp.$1)&&RegExp.$1&&(j=a.mobile.path.getFilePath(a("<div>"+
RegExp.$1+"</div>").text()),j=this.window[0].encodeURIComponent(j));f.prefetch===c&&this._getBase().set(j);q=this._parse(m,j);this._setLoadedTitle(q,m);b.xhr=o;b.textStatus=n;b.page=q;b.content=q;b.toPage=q;this._triggerWithDeprecated("load",b).event.isDefaultPrevented()||(this._isRewritableBaseTag()&&q&&this._getBase().rewrite(j,q),this._include(q,f),f.showLoadMsg&&this._hideLoading(),d.resolve(e,f,q))},this)},_loadDefaults:{type:"get",data:c,reloadPage:!1,reload:!1,role:c,showLoadMsg:!1,loadMsgDelay:50},
load:function(e,b){var f,d,j,m,n=b&&b.deferred||a.Deferred(),o=a.extend({},this._loadDefaults,b,b&&b.reload===c&&b.reloadPage!==c?{reload:b.reloadPage}:{}),q=null,p=a.mobile.path.makeUrlAbsolute(e,this._findBaseWithDefault());return o.data&&"get"===o.type&&(p=a.mobile.path.addSearchParams(p,o.data),o.data=c),o.data&&"post"===o.type&&(o.reload=!0),f=this._createFileUrl(p),d=this._createDataUrl(p),q=this._find(p),0===q.length&&a.mobile.path.isEmbeddedPage(f)&&!a.mobile.path.isFirstPageUrl(f)?(n.reject(p,
o),n.promise()):(this._getBase().reset(),q.length&&!o.reload?(this._enhance(q,o.role),n.resolve(p,o,q),o.prefetch||this._getBase().set(e),n.promise()):(m={url:e,absUrl:p,toPage:e,prevPage:b?b.fromPage:c,dataUrl:d,deferred:n,options:o},j=this._triggerWithDeprecated("beforeload",m),j.deprecatedEvent.isDefaultPrevented()||j.event.isDefaultPrevented()?n.promise():(o.showLoadMsg&&this._showLoading(o.loadMsgDelay),o.prefetch===c&&this._getBase().reset(),a.mobile.allowCrossDomainPages||a.mobile.path.isSameDomain(a.mobile.path.documentUrl,
p)?(a.ajax({url:f,type:o.type,data:o.data,contentType:o.contentType,dataType:"html",success:this._loadSuccess(p,m,o,n),error:this._loadError(p,m,o,n)}),n.promise()):(n.reject(p,o),n.promise()))))},_loadError:function(e,b,c,f){return a.proxy(function(d,g,n){this._getBase().set(a.mobile.path.get());b.xhr=d;b.textStatus=g;b.errorThrown=n;d=this._triggerWithDeprecated("loadfailed",b);d.deprecatedEvent.isDefaultPrevented()||d.event.isDefaultPrevented()||(c.showLoadMsg&&this._showError(),f.reject(e,c))},
this)},_getTransitionHandler:function(e){return e=a.mobile._maybeDegradeTransition(e),a.mobile.transitionHandlers[e]||a.mobile.defaultTransitionHandler},_triggerCssTransitionEvents:function(e,b,c){var f,c=c||"";b&&(e[0]===b[0]&&(f=!0),this._triggerWithDeprecated(c+"hide",{nextPage:e,toPage:e,prevPage:b,samePage:!1},b));this._triggerWithDeprecated(c+"show",{prevPage:b||a(""),toPage:e},e)},_cssTransition:function(e,b,c){var f=c.transition,d=c.reverse,g=c.deferred;this._triggerCssTransitionEvents(e,
b,"before");this._hideLoading();c=(new (this._getTransitionHandler(f))(f,d,e,b)).transition();c.done(a.proxy(function(){this._triggerCssTransitionEvents(e,b)},this));c.done(function(){g.resolve.apply(g,arguments)})},_releaseTransitionLock:function(){f=!1;e.length>0&&a.mobile.changePage.apply(null,e.pop())},_removeActiveLinkClass:function(e){a.mobile.removeActiveLinkClass(e)},_loadUrl:function(e,b,c){c.target=e;c.deferred=a.Deferred();this.load(e,c);c.deferred.done(a.proxy(function(a,e,c){f=!1;e.absUrl=
b.absUrl;this.transition(c,b,e)},this));c.deferred.fail(a.proxy(function(){this._removeActiveLinkClass(!0);this._releaseTransitionLock();this._triggerWithDeprecated("changefailed",b)},this))},_triggerPageBeforeChange:function(e,b,c){var f;return b.prevPage=this.activePage,a.extend(b,{toPage:e,options:c}),b.absUrl="string"===a.type(e)?a.mobile.path.makeUrlAbsolute(e,this._findBaseWithDefault()):c.absUrl,f=this._triggerWithDeprecated("beforechange",b),f.event.isDefaultPrevented()||f.deprecatedEvent.isDefaultPrevented()?
!1:!0},change:function(b,c){if(f)return void e.unshift(arguments);var d=a.extend({},a.mobile.changePage.defaults,c),g={};d.fromPage=d.fromPage||this.activePage;this._triggerPageBeforeChange(b,g,d)&&(b=g.toPage,"string"===a.type(b)?(f=!0,this._loadUrl(b,g,d)):this.transition(b,g,d))},transition:function(b,h,k){var l,j,m,n,o,q,p,u,s,r,v;if(f)return void e.unshift([b,k]);if(this._triggerPageBeforeChange(b,h,k)&&(h.prevPage=k.fromPage,m=this._triggerWithDeprecated("beforetransition",h),!m.deprecatedEvent.isDefaultPrevented()&&
!m.event.isDefaultPrevented())){if(f=!0,b[0]!==a.mobile.firstPage[0]||k.dataUrl||(k.dataUrl=a.mobile.path.documentUrl.hrefNoHash),l=k.fromPage,j=k.dataUrl&&a.mobile.path.convertUrlToDataUrl(k.dataUrl)||b.jqmData("url"),m=j,a.mobile.path.getFilePath(j),n=a.mobile.navigate.history.getActive(),o=0===a.mobile.navigate.history.activeIndex,q=0,p=d.title,u=("dialog"===k.role||"dialog"===b.jqmData("role"))&&b.jqmData("dialog")!==!0,l&&l[0]===b[0]&&!k.allowSamePageTransition)return f=!1,this._triggerWithDeprecated("transition",
h),this._triggerWithDeprecated("change",h),void(k.fromHashChange&&a.mobile.navigate.history.direct({url:j}));b.page({role:k.role});k.fromHashChange&&(q="back"===k.direction?-1:1);try{d.activeElement&&"body"!==d.activeElement.nodeName.toLowerCase()?a(d.activeElement).blur():a("input:focus, textarea:focus, select:focus").blur()}catch(x){}s=!1;u&&n&&(n.url&&n.url.indexOf(a.mobile.dialogHashKey)>-1&&this.activePage&&!this.activePage.hasClass("ui-dialog")&&a.mobile.navigate.history.activeIndex>0&&(k.changeHash=
!1,s=!0),j=n.url||"",j+=!s&&j.indexOf("#")>-1?a.mobile.dialogHashKey:"#"+a.mobile.dialogHashKey);(r=n?b.jqmData("title")||b.children(":jqmData(role='header')").find(".ui-title").text():p)&&p===d.title&&(p=r);b.jqmData("title")||b.jqmData("title",p);k.transition=k.transition||(q&&!o?n.transition:c)||(u?a.mobile.defaultDialogTransition:a.mobile.defaultPageTransition);!q&&s&&(a.mobile.navigate.history.getActive().pageUrl=m);j&&!k.fromHashChange&&(!a.mobile.path.isPath(j)&&j.indexOf("#")<0&&(j="#"+j),
v={transition:k.transition,title:p,pageUrl:m,role:k.role},k.changeHash!==!1&&a.mobile.hashListeningEnabled?a.mobile.navigate(this.window[0].encodeURI(j),v,!0):b[0]!==a.mobile.firstPage[0]&&a.mobile.navigate.history.add(j,v));d.title=p;this.activePage=a.mobile.activePage=b;k.reverse=k.reverse||0>q;j=a.Deferred();this._cssTransition(b,l,{transition:k.transition,reverse:k.reverse,deferred:j});j.done(a.proxy(function(e,c,f,d,g){a.mobile.removeActiveLinkClass();k.duplicateCachedPage&&k.duplicateCachedPage.remove();
g||a.mobile.focusPage(b);this._releaseTransitionLock();this._triggerWithDeprecated("transition",h);this._triggerWithDeprecated("change",h)},this))}},_findBaseWithDefault:function(){return this.activePage&&a.mobile.getClosestBaseUrl(this.activePage)||a.mobile.path.documentBase.hrefNoHash}});a.mobile.navreadyDeferred=a.Deferred();var e=[],f=!1})(c);(function(a,c){function e(a){for(;a&&("string"!=typeof a.nodeName||"a"!==a.nodeName.toLowerCase());)a=a.parentNode;return a}var f=a.Deferred(),i=a.Deferred(),
h=function(){i.resolve();i=null},k=a.mobile.path.documentUrl,l=null;a.mobile.loadPage=function(e,b){var c;return b=b||{},c=b.pageContainer||a.mobile.pageContainer,b.deferred=a.Deferred(),c.pagecontainer("load",e,b),b.deferred.promise()};a.mobile.back=function(){var e=b.navigator;this.phonegapNavigationEnabled&&e&&e.app&&e.app.backHistory?e.app.backHistory():a.mobile.pageContainer.pagecontainer("back")};a.mobile.focusPage=function(a){var e=a.find("[autofocus]"),b=a.find(".ui-title:eq(0)");return e.length?
void e.focus():void(b.length?b.focus():a.focus())};a.mobile._maybeDegradeTransition=a.mobile._maybeDegradeTransition||function(a){return a};a.mobile.changePage=function(e,b){a.mobile.pageContainer.pagecontainer("change",e,b)};a.mobile.changePage.defaults={transition:c,reverse:!1,changeHash:!0,fromHashChange:!1,role:c,duplicateCachedPage:c,pageContainer:c,showLoadMsg:!0,dataUrl:c,fromPage:c,allowSamePageTransition:!1};a.mobile._registerInternalEvents=function(){var f=function(e,b){var c,f,d,h,i=!0;
return!a.mobile.ajaxEnabled||e.is(":jqmData(ajax='false')")||!e.jqmHijackable().length||e.attr("target")?!1:(c=l&&l.attr("formaction")||e.attr("action"),h=(e.attr("method")||"get").toLowerCase(),c||(c=a.mobile.getClosestBaseUrl(e),"get"===h&&(c=a.mobile.path.parseUrl(c).hrefNoSearch),c===a.mobile.path.documentBase.hrefNoHash&&(c=k.hrefNoSearch)),c=a.mobile.path.makeUrlAbsolute(c,a.mobile.getClosestBaseUrl(e)),a.mobile.path.isExternal(c)&&!a.mobile.path.isPermittedCrossDomainRequest(k,c)?!1:(b||(f=
e.serializeArray(),l&&l[0].form===e[0]&&(d=l.attr("name"),d&&(a.each(f,function(a,e){return e.name===d?(d="",!1):void 0}),d&&f.push({name:d,value:l.attr("value")}))),i={url:c,options:{type:h,data:a.param(f),transition:e.jqmData("transition"),reverse:"reverse"===e.jqmData("direction"),reloadPage:!0}}),i))};a.mobile.document.delegate("form","submit",function(e){var b;e.isDefaultPrevented()||(b=f(a(this)),b&&(a.mobile.changePage(b.url,b.options),e.preventDefault()))});a.mobile.document.bind("vclick",
function(b){var c,d=b.target,h=!1;if(!(b.which>1)&&a.mobile.linkBindingEnabled){if(l=a(d),a.data(d,"mobile-button")){if(!f(a(d).closest("form"),!0))return;d.parentNode&&(d=d.parentNode)}else{if(d=e(d),!d||"#"===a.mobile.path.parseUrl(d.getAttribute("href")||"#").hash)return;if(!a(d).jqmHijackable().length)return}~d.className.indexOf("ui-link-inherit")?d.parentNode&&(c=a.data(d.parentNode,"buttonElements")):c=a.data(d,"buttonElements");c?d=c.outer:h=!0;b=a(d);h&&(b=b.closest(".ui-btn"));b.length>0&&
!b.hasClass("ui-state-disabled")&&(a.mobile.removeActiveLinkClass(!0),a.mobile.activeClickedLink=b,a.mobile.activeClickedLink.addClass(a.mobile.activeBtnClass))}});a.mobile.document.bind("click",function(f){if(a.mobile.linkBindingEnabled&&!f.isDefaultPrevented()){var d,h,i,l;l=e(f.target);var j=a(l),s=function(){b.setTimeout(function(){a.mobile.removeActiveLinkClass(!0)},200)};if(a.mobile.activeClickedLink&&a.mobile.activeClickedLink[0]===f.target.parentNode&&s(),l&&!(f.which>1)&&j.jqmHijackable().length){if(j.is(":jqmData(rel='back')"))return a.mobile.back(),
!1;if(d=a.mobile.getClosestBaseUrl(j),h=a.mobile.path.makeUrlAbsolute(j.attr("href")||"#",d),!a.mobile.ajaxEnabled&&!a.mobile.path.isEmbeddedPage(h))return void s();if(!(-1===h.search("#")||a.mobile.path.isExternal(h)&&a.mobile.path.isAbsoluteUrl(h))){if(h=h.replace(/[^#]*#/,""),!h)return void f.preventDefault();h=a.mobile.path.isPath(h)?a.mobile.path.makeUrlAbsolute(h,d):a.mobile.path.makeUrlAbsolute("#"+h,k.hrefNoHash)}if(i=j.is("[rel='external']")||j.is(":jqmData(ajax='false')")||j.is("[target]"),
i||a.mobile.path.isExternal(h)&&!a.mobile.path.isPermittedCrossDomainRequest(k,h))return void s();d=j.jqmData("transition");i="reverse"===j.jqmData("direction")||j.jqmData("back");l=j.attr("data-"+a.mobile.ns+"rel")||c;a.mobile.changePage(h,{transition:d,reverse:i,role:l,link:j});f.preventDefault()}}});a.mobile.document.delegate(".ui-page","pageshow.prefetch",function(){var e=[];a(this).find("a:jqmData(prefetch)").each(function(){var b=a(this),c=b.attr("href");c&&-1===a.inArray(c,e)&&(e.push(c),a.mobile.loadPage(c,
{role:b.attr("data-"+a.mobile.ns+"rel"),prefetch:!0}))})});a.mobile.pageContainer.pagecontainer();a.mobile.document.bind("pageshow",function(){i?i.done(a.mobile.resetActivePageHeight):a.mobile.resetActivePageHeight()});a.mobile.window.bind("throttledresize",a.mobile.resetActivePageHeight)};a(function(){f.resolve()});"complete"===d.readyState?h():a.mobile.window.load(h);a.when(f,a.mobile.navreadyDeferred).done(function(){a.mobile._registerInternalEvents()})})(c);(function(a,b){a.mobile.Transition=
function(){this.init.apply(this,arguments)};a.extend(a.mobile.Transition.prototype,{toPreClass:" ui-page-pre-in",init:function(e,b,c,d){a.extend(this,{name:e,reverse:b,$to:c,$from:d,deferred:new a.Deferred})},cleanFrom:function(){this.$from.removeClass(a.mobile.activePageClass+" out in reverse "+this.name).height("")},beforeDoneIn:function(){},beforeDoneOut:function(){},beforeStartOut:function(){},doneIn:function(){this.beforeDoneIn();this.$to.removeClass("out in reverse "+this.name).height("");this.toggleViewportClass();
a.mobile.window.scrollTop()!==this.toScroll&&this.scrollPage();this.sequential||this.$to.addClass(a.mobile.activePageClass);this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},doneOut:function(a,b,c,d){this.beforeDoneOut();this.startIn(a,b,c,d)},hideIn:function(a){this.$to.css("z-index",-10);a.call(this);this.$to.css("z-index","")},scrollPage:function(){a.event.special.scrollstart.enabled=!1;(a.mobile.hideUrlBar||this.toScroll!==a.mobile.defaultHomeScroll)&&b.scrollTo(0,this.toScroll);
setTimeout(function(){a.event.special.scrollstart.enabled=!0},150)},startIn:function(e,b,c,d){this.hideIn(function(){this.$to.addClass(a.mobile.activePageClass+this.toPreClass);d||a.mobile.focusPage(this.$to);this.$to.height(e+this.toScroll);c||this.scrollPage()});this.$to.removeClass(this.toPreClass).addClass(this.name+" in "+b);c?this.doneIn():this.$to.animationComplete(a.proxy(function(){this.doneIn()},this))},startOut:function(e,b,c){this.beforeStartOut(e,b,c);this.$from.height(e+a.mobile.window.scrollTop()).addClass(this.name+
" out"+b)},toggleViewportClass:function(){a.mobile.pageContainer.toggleClass("ui-mobile-viewport-transitioning viewport-"+this.name)},transition:function(){var e,b=this.reverse?" reverse":"",c=a.mobile.getScreenHeight(),d=a.mobile.maxTransitionWidth!==!1&&a.mobile.window.width()>a.mobile.maxTransitionWidth;return this.toScroll=a.mobile.navigate.history.getActive().lastScroll||a.mobile.defaultHomeScroll,e=!a.support.cssTransitions||!a.support.cssAnimations||d||!this.name||"none"===this.name||Math.max(a.mobile.window.scrollTop(),
this.toScroll)>a.mobile.getMaxScrollForTransition(),this.toggleViewportClass(),this.$from&&!e?this.startOut(c,b,e):this.doneOut(c,b,e,!0),this.deferred.promise()}})})(c,this);(function(a){a.mobile.SerialTransition=function(){this.init.apply(this,arguments)};a.extend(a.mobile.SerialTransition.prototype,a.mobile.Transition.prototype,{sequential:!0,beforeDoneOut:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(b,e,c){this.$from.animationComplete(a.proxy(function(){this.doneOut(b,e,c)},
this))}})})(c);(function(a){a.mobile.ConcurrentTransition=function(){this.init.apply(this,arguments)};a.extend(a.mobile.ConcurrentTransition.prototype,a.mobile.Transition.prototype,{sequential:!1,beforeDoneIn:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(a,e,b){this.doneOut(a,e,b)}})})(c);(function(a){var b;a.mobile.transitionHandlers={sequential:a.mobile.SerialTransition,simultaneous:a.mobile.ConcurrentTransition};a.mobile.defaultTransitionHandler=a.mobile.transitionHandlers.sequential;
a.mobile.transitionFallbacks={};a.mobile._maybeDegradeTransition=function(e){return e&&!a.support.cssTransform3d&&a.mobile.transitionFallbacks[e]&&(e=a.mobile.transitionFallbacks[e]),e};a.mobile.getMaxScrollForTransition=a.mobile.getMaxScrollForTransition||function(){return 3*a.mobile.getScreenHeight()}})(c);c.mobile.transitionFallbacks.flip="fade";c.mobile.transitionFallbacks.flow="fade";c.mobile.transitionFallbacks.pop="fade";(function(a){a.mobile.transitionHandlers.slide=a.mobile.transitionHandlers.simultaneous;
a.mobile.transitionFallbacks.slide="fade"})(c,this);c.mobile.transitionFallbacks.slidedown="fade";c.mobile.transitionFallbacks.slidefade="fade";c.mobile.transitionFallbacks.slideup="fade";c.mobile.transitionFallbacks.turn="fade";(function(a){a.mobile.degradeInputs={color:!1,date:!1,datetime:!1,"datetime-local":!1,email:!1,month:!1,number:!1,range:"number",search:"text",tel:!1,time:!1,url:!1,week:!1};a.mobile.page.prototype.options.degradeInputs=a.mobile.degradeInputs;a.mobile.degradeInputsWithin=
function(b){b=a(b);b.find("input").not(a.mobile.page.prototype.keepNativeSelector()).each(function(){var e,b,c,d,g=a(this),l=this.getAttribute("type"),j=a.mobile.degradeInputs[l]||"text";a.mobile.degradeInputs[l]&&(e=a("<div>").html(g.clone()).html(),b=e.indexOf(" type=")>-1,c=b?/\s+type=["']?\w+['"]?/:/\/?>/,d=' type="'+j+'" data-'+a.mobile.ns+'type="'+l+'"'+(b?"":">"),g.replaceWith(e.replace(c,d)))})}})(c);(function(a,b,e){a.widget("mobile.page",a.mobile.page,{options:{closeBtn:"left",closeBtnText:"Close",
overlayTheme:"a",corners:!0,dialog:!1},_create:function(){this._super();this.options.dialog&&(a.extend(this,{_inner:this.element.children(),_headerCloseButton:null}),this.options.enhanced||this._setCloseBtn(this.options.closeBtn))},_enhance:function(){this._super();this.options.dialog&&this.element.addClass("ui-dialog").wrapInner(a("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(this.options.corners?" ui-corner-all":"")}))},_setOptions:function(b){var c,d,g=this.options;b.corners!==
e&&this._inner.toggleClass("ui-corner-all",!!b.corners);b.overlayTheme!==e&&a.mobile.activePage[0]===this.element[0]&&(g.overlayTheme=b.overlayTheme,this._handlePageBeforeShow());b.closeBtnText!==e&&(c=g.closeBtn,d=b.closeBtnText);b.closeBtn!==e&&(c=b.closeBtn);c&&this._setCloseBtn(c,d);this._super(b)},_handlePageBeforeShow:function(){this.options.overlayTheme&&this.options.dialog?(this.removeContainerBackground(),this.setContainerBackground(this.options.overlayTheme)):this._super()},_setCloseBtn:function(e,
b){var c,d=this._headerCloseButton,e="left"===e?"left":"right"===e?"right":"none";"none"===e?d&&(d.remove(),d=null):d?(d.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+e),b&&d.text(b)):(c=this._inner.find(":jqmData(role='header')").first(),d=a("<a></a>",{href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+e}).attr("data-"+a.mobile.ns+"rel","back").text(b||this.options.closeBtnText||"").prependTo(c));this._headerCloseButton=d}})})(c,this);(function(a,b,e){a.widget("mobile.dialog",
{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0},_handlePageBeforeShow:function(){this._isCloseable=!0;this.options.overlayTheme&&this.element.page("removeContainerBackground").page("setContainerBackground",this.options.overlayTheme)},_handlePageBeforeHide:function(){this._isCloseable=!1},_handleVClickSubmit:function(e){var b,e=a(e.target).closest("vclick"===e.type?"a":"form");e.length&&!e.jqmData("transition")&&(b={},b["data-"+a.mobile.ns+"transition"]=(a.mobile.navigate.history.getActive()||
{}).transition||a.mobile.defaultDialogTransition,b["data-"+a.mobile.ns+"direction"]="reverse",e.attr(b))},_create:function(){var e=this.element,b=this.options;e.addClass("ui-dialog").wrapInner(a("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(b.corners?" ui-corner-all":"")}));a.extend(this,{_isCloseable:!1,_inner:e.children(),_headerCloseButton:null});this._on(e,{vclick:"_handleVClickSubmit",submit:"_handleVClickSubmit",pagebeforeshow:"_handlePageBeforeShow",pagebeforehide:"_handlePageBeforeHide"});
this._setCloseBtn(b.closeBtn)},_setOptions:function(b){var c,d,g=this.options;b.corners!==e&&this._inner.toggleClass("ui-corner-all",!!b.corners);b.overlayTheme!==e&&a.mobile.activePage[0]===this.element[0]&&(g.overlayTheme=b.overlayTheme,this._handlePageBeforeShow());b.closeBtnText!==e&&(c=g.closeBtn,d=b.closeBtnText);b.closeBtn!==e&&(c=b.closeBtn);c&&this._setCloseBtn(c,d);this._super(b)},_setCloseBtn:function(e,b){var c,d=this._headerCloseButton,e="left"===e?"left":"right"===e?"right":"none";"none"===
e?d&&(d.remove(),d=null):d?(d.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+e),b&&d.text(b)):(c=this._inner.find(":jqmData(role='header')").first(),d=a("<a></a>",{role:"button",href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+e}).text(b||this.options.closeBtnText||"").prependTo(c),this._on(d,{click:"close"}));this._headerCloseButton=d},close:function(){var e=a.mobile.navigate.history;this._isCloseable&&(this._isCloseable=!1,a.mobile.hashListeningEnabled&&
e.activeIndex>0?a.mobile.back():a.mobile.pageContainer.pagecontainer("back"))}})})(c,this);(function(a,b){var e=/([A-Z])/g,c=function(a){return"ui-btn-icon-"+(null===a?"left":a)};a.widget("mobile.collapsible",{options:{enhanced:!1,expandCueText:null,collapseCueText:null,collapsed:!0,heading:"h1,h2,h3,h4,h5,h6,legend",collapsedIcon:null,expandedIcon:null,iconpos:null,theme:null,contentTheme:null,inset:null,corners:null,mini:null},_create:function(){var e=this.element,b={accordion:e.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')"+
(a.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=b;this._renderedOptions=this._getOptions(this.options);this.options.enhanced?(b.heading=this.element.children(".ui-collapsible-heading"),b.content=b.heading.next(),b.anchor=b.heading.children(),b.status=b.anchor.children(".ui-collapsible-heading-status")):this._enhance(e,b);this._on(b.heading,{tap:function(){b.heading.find("a").first().addClass(a.mobile.activeBtnClass)},click:function(a){this._handleExpandCollapse(!b.heading.hasClass("ui-collapsible-heading-collapsed"));
a.preventDefault();a.stopPropagation()}})},_getOptions:function(b){var c,d=this._ui.accordion,f=this._ui.accordionWidget,b=a.extend({},b);d.length&&!f&&(this._ui.accordionWidget=f=d.data("mobile-collapsibleset"));for(c in b)b[c]=null!=b[c]?b[c]:f?f.options[c]:d.length?a.mobile.getAttribute(d[0],c.replace(e,"-$1").toLowerCase()):null,null==b[c]&&(b[c]=a.mobile.collapsible.defaults[c]);return b},_themeClassFromOption:function(a,e){return e?"none"===e?"":a+e:""},_enhance:function(e,b){var d,g=this._renderedOptions,
j=this._themeClassFromOption("ui-body-",g.contentTheme);return e.addClass("ui-collapsible "+(g.inset?"ui-collapsible-inset ":"")+(g.inset&&g.corners?"ui-corner-all ":"")+(j?"ui-collapsible-themed-content ":"")),b.originalHeading=e.children(this.options.heading).first(),b.content=e.wrapInner("<div class='ui-collapsible-content "+j+"'></div>").children(".ui-collapsible-content"),b.heading=b.originalHeading,b.heading.is("legend")&&(b.heading=a("<div role='heading'>"+b.heading.html()+"</div>"),b.placeholder=
a("<div><\!-- placeholder for legend --\></div>").insertBefore(b.originalHeading),b.originalHeading.remove()),d=g.collapsed?g.collapsedIcon?"ui-icon-"+g.collapsedIcon:"":g.expandedIcon?"ui-icon-"+g.expandedIcon:"",b.status=a("<span class='ui-collapsible-heading-status'></span>"),b.anchor=b.heading.detach().addClass("ui-collapsible-heading").append(b.status).wrapInner("<a href='#' class='ui-collapsible-heading-toggle'></a>").find("a").first().addClass("ui-btn "+(d?d+" ":"")+(d?c(g.iconpos)+" ":"")+
this._themeClassFromOption("ui-btn-",g.theme)+" "+(g.mini?"ui-mini ":"")),b.heading.insertBefore(b.content),this._handleExpandCollapse(this.options.collapsed),b},refresh:function(){this._applyOptions(this.options);this._renderedOptions=this._getOptions(this.options)},_applyOptions:function(a){var e,d,l,j,m=this.element,n=this._renderedOptions,o=this._ui,q=o.anchor;j=o.status;var p=this._getOptions(a);a.collapsed!==b&&this._handleExpandCollapse(a.collapsed);(a=m.hasClass("ui-collapsible-collapsed"))?
p.expandCueText!==b&&j.text(p.expandCueText):p.collapseCueText!==b&&j.text(p.collapseCueText);j=p.collapsedIcon!==b?p.collapsedIcon!==!1:n.collapsedIcon!==!1;(p.iconpos!==b||p.collapsedIcon!==b||p.expandedIcon!==b)&&(q.removeClass([c(n.iconpos)].concat(n.expandedIcon?["ui-icon-"+n.expandedIcon]:[]).concat(n.collapsedIcon?["ui-icon-"+n.collapsedIcon]:[]).join(" ")),j&&q.addClass([c(p.iconpos!==b?p.iconpos:n.iconpos)].concat(a?["ui-icon-"+(p.collapsedIcon!==b?p.collapsedIcon:n.collapsedIcon)]:["ui-icon-"+
(p.expandedIcon!==b?p.expandedIcon:n.expandedIcon)]).join(" ")));p.theme!==b&&(d=this._themeClassFromOption("ui-btn-",n.theme),e=this._themeClassFromOption("ui-btn-",p.theme),q.removeClass(d).addClass(e));p.contentTheme!==b&&(d=this._themeClassFromOption("ui-body-",n.contentTheme),e=this._themeClassFromOption("ui-body-",p.contentTheme),o.content.removeClass(d).addClass(e));p.inset!==b&&(m.toggleClass("ui-collapsible-inset",p.inset),l=!(!p.inset||!p.corners&&!n.corners));p.corners!==b&&(l=!(!p.corners||
!p.inset&&!n.inset));l!==b&&m.toggleClass("ui-corner-all",l);p.mini!==b&&q.toggleClass("ui-mini",p.mini)},_setOptions:function(a){this._applyOptions(a);this._super(a);this._renderedOptions=this._getOptions(this.options)},_handleExpandCollapse:function(e){var b=this._renderedOptions,c=this._ui;c.status.text(e?b.expandCueText:b.collapseCueText);c.heading.toggleClass("ui-collapsible-heading-collapsed",e).find("a").first().toggleClass("ui-icon-"+b.expandedIcon,!e).toggleClass("ui-icon-"+b.collapsedIcon,
e||b.expandedIcon===b.collapsedIcon).removeClass(a.mobile.activeBtnClass);this.element.toggleClass("ui-collapsible-collapsed",e);c.content.toggleClass("ui-collapsible-content-collapsed",e).attr("aria-hidden",e).trigger("updatelayout");this.options.collapsed=e;this._trigger(e?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var a=this._ui;this.options.enhanced||(a.placeholder?(a.originalHeading.insertBefore(a.placeholder),
a.placeholder.remove(),a.heading.remove()):(a.status.remove(),a.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()),a.anchor.contents().unwrap(),a.content.contents().unwrap(),this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))}});a.mobile.collapsible.defaults={expandCueText:" click to expand contents",collapseCueText:" click to collapse contents",collapsedIcon:"plus",
contentTheme:"inherit",expandedIcon:"minus",iconpos:"left",inset:!0,corners:!0,theme:"inherit",mini:!1}})(c);(function(a){function b(c){var d,h=c.length,g=[];for(d=0;h>d;d++)c[d].className.match(e)||g.push(c[d]);return a(g)}var e=/\bui-screen-hidden\b/;a.mobile.behaviors.addFirstLastClasses={_getVisibles:function(a,e){var c;return e?c=b(a):(c=a.filter(":visible"),0===c.length&&(c=b(a))),c},_addFirstLastClasses:function(a,e,b){a.removeClass("ui-first-child ui-last-child");e.eq(0).addClass("ui-first-child").end().last().addClass("ui-last-child");
b||this.element.trigger("updatelayout")},_removeFirstLastClasses:function(a){a.removeClass("ui-first-child ui-last-child")}}})(c);(function(a,b){var e=":mobile-collapsible, "+a.mobile.collapsible.initSelector;a.widget("mobile.collapsibleset",a.extend({initSelector:":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')",options:a.extend({enhanced:!1},a.mobile.collapsible.defaults),_handleCollapsibleExpand:function(e){e=a(e.target).closest(".ui-collapsible");e.parent().is(":mobile-collapsibleset, :jqmData(role='collapsible-set')")&&
e.siblings(".ui-collapsible:not(.ui-collapsible-collapsed)").collapsible("collapse")},_create:function(){var e=this.element,b=this.options;a.extend(this,{_classes:""});b.enhanced||(e.addClass("ui-collapsible-set "+this._themeClassFromOption("ui-group-theme-",b.theme)+" "+(b.corners&&b.inset?"ui-corner-all ":"")),this.element.find(a.mobile.collapsible.initSelector).collapsible());this._on(e,{collapsibleexpand:"_handleCollapsibleExpand"})},_themeClassFromOption:function(a,e){return e?"none"===e?"":
a+e:""},_init:function(){this._refresh(!0);this.element.children(e).filter(":jqmData(collapsed='false')").collapsible("expand")},_setOptions:function(a){var e,c,d=this.element,l=this._themeClassFromOption("ui-group-theme-",a.theme);return l&&d.removeClass(this._themeClassFromOption("ui-group-theme-",this.options.theme)).addClass(l),a.inset!==b&&(c=!(!a.inset||!a.corners&&!this.options.corners)),a.corners!==b&&(c=!(!a.corners||!a.inset&&!this.options.inset)),c!==b&&d.toggleClass("ui-corner-all",c),
e=this._super(a),this.element.children(":mobile-collapsible").collapsible("refresh"),e},_destroy:function(){var a=this.element;this._removeFirstLastClasses(a.children(e));a.removeClass("ui-collapsible-set ui-corner-all "+this._themeClassFromOption("ui-group-theme-",this.options.theme)).children(":mobile-collapsible").collapsible("destroy")},_refresh:function(b){var c=this.element.children(e);this.element.find(a.mobile.collapsible.initSelector).not(".ui-collapsible").collapsible();this._addFirstLastClasses(c,
this._getVisibles(c,b),b)},refresh:function(){this._refresh(!1)}},a.mobile.behaviors.addFirstLastClasses))})(c);(function(a){a.fn.fieldcontain=function(){return this.addClass("ui-field-contain")}})(c);(function(a){a.fn.grid=function(b){return this.each(function(){var e,c=a(this),d=a.extend({grid:null},b),h=c.children(),k={solo:1,a:2,b:3,c:4,d:5},d=d.grid;if(!d)if(h.length<=5)for(e in k)k[e]===h.length&&(d=e);else d="a",c.addClass("ui-grid-duo");e=k[d];c.addClass("ui-grid-"+d);h.filter(":nth-child("+
e+"n+1)").addClass("ui-block-a");e>1&&h.filter(":nth-child("+e+"n+2)").addClass("ui-block-b");e>2&&h.filter(":nth-child("+e+"n+3)").addClass("ui-block-c");e>3&&h.filter(":nth-child("+e+"n+4)").addClass("ui-block-d");e>4&&h.filter(":nth-child("+e+"n+5)").addClass("ui-block-e")})}})(c);(function(a,b){a.widget("mobile.navbar",{options:{iconpos:"top",grid:null},_create:function(){var e=this.element,c=e.find("a, button"),i=c.filter(":jqmData(icon)").length?this.options.iconpos:b;e.addClass("ui-navbar").attr("role",
"navigation").find("ul").jqmEnhanceable().grid({grid:this.options.grid});c.each(function(){var e=a.mobile.getAttribute(this,"icon"),b=a.mobile.getAttribute(this,"theme"),c="ui-btn";b&&(c+=" ui-btn-"+b);e&&(c+=" ui-icon-"+e+" ui-btn-icon-"+i);a(this).addClass(c)});e.delegate("a","vclick",function(){var e=a(this);e.hasClass("ui-state-disabled")||e.hasClass("ui-disabled")||e.hasClass(a.mobile.activeBtnClass)||(c.removeClass(a.mobile.activeBtnClass),e.addClass(a.mobile.activeBtnClass),a(d).one("pagehide",
function(){e.removeClass(a.mobile.activeBtnClass)}))});e.closest(".ui-page").bind("pagebeforeshow",function(){c.filter(".ui-state-persist").addClass(a.mobile.activeBtnClass)})}})})(c);(function(a){var b=a.mobile.getAttribute;a.widget("mobile.listview",a.extend({options:{theme:null,countTheme:null,dividerTheme:null,icon:"carat-r",splitIcon:"carat-r",splitTheme:null,corners:!0,shadow:!0,inset:!1},_create:function(){var a="";a+=this.options.inset?" ui-listview-inset":"";this.options.inset&&(a+=this.options.corners?
" ui-corner-all":"",a+=this.options.shadow?" ui-shadow":"");this.element.addClass(" ui-listview"+a);this.refresh(!0)},_findFirstElementByTagName:function(a,b,c,d){var g={};for(g[c]=g[d]=!0;a;){if(g[a.nodeName])return a;a=a[b]}return null},_addThumbClasses:function(b){var c,d,h=b.length;for(c=0;h>c;c++)d=a(this._findFirstElementByTagName(b[c].firstChild,"nextSibling","img","IMG")),d.length&&a(this._findFirstElementByTagName(d[0].parentNode,"parentNode","li","LI")).addClass(d.hasClass("ui-li-icon")?
"ui-li-has-icon":"ui-li-has-thumb")},_getChildrenByTagName:function(b,c,d){var h=[],g={};g[c]=g[d]=!0;for(b=b.firstChild;b;)g[b.nodeName]&&h.push(b),b=b.nextSibling;return a(h)},_beforeListviewRefresh:a.noop,_afterListviewRefresh:a.noop,refresh:function(e){var c,d,h,k,l,j,m,n,o,q,p,u,s,r,v,x,t,w,y,z=this.options;h=this.element;var A=!!a.nodeName(h[0],"ol");k=h.attr("start");var C={},B=h.find(".ui-li-count"),E=b(h[0],"counttheme")||this.options.countTheme,E=E?"ui-body-"+E:"ui-body-inherit";z.theme&&
h.addClass("ui-group-theme-"+z.theme);A&&(k||0===k)&&(d=parseInt(k,10)-1,h.css("counter-reset","listnumbering "+d));this._beforeListviewRefresh();y=this._getChildrenByTagName(h[0],"li","LI");d=0;for(h=y.length;h>d;d++)k=y.eq(d),l="",(e||k[0].className.search(/\bui-li-static\b|\bui-li-divider\b/)<0)&&(o=this._getChildrenByTagName(k[0],"a","A"),q="list-divider"===b(k[0],"role"),u=k.attr("value"),j=b(k[0],"theme"),o.length&&o[0].className.search(/\bui-btn\b/)<0&&!q?(m=b(k[0],"icon"),n=m===!1?!1:m||z.icon,
o.removeClass("ui-link"),c="ui-btn",j&&(c+=" ui-btn-"+j),o.length>1?(l="ui-li-has-alt",s=o.last(),r=b(s[0],"theme")||z.splitTheme||b(k[0],"theme",!0),v=r?" ui-btn-"+r:"",x=b(s[0],"icon")||b(k[0],"icon")||z.splitIcon,t="ui-btn ui-btn-icon-notext ui-icon-"+x+v,s.attr("title",a.trim(s.getEncodedText())).addClass(t).empty(),o=o.first()):n&&(c+=" ui-btn-icon-right ui-icon-"+n),o.addClass(c)):q?(w=b(k[0],"theme")||z.dividerTheme||z.theme,l="ui-li-divider ui-bar-"+(w?w:"inherit"),k.attr("role","heading")):
o.length<=0&&(l="ui-li-static ui-body-"+(j?j:"inherit")),A&&u&&(p=parseInt(u,10)-1,k.css("counter-reset","listnumbering "+p))),C[l]||(C[l]=[]),C[l].push(k[0]);for(l in C)a(C[l]).addClass(l);B.each(function(){a(this).closest("li").addClass("ui-li-has-count")});E&&B.not("[class*='ui-body-']").addClass(E);this._addThumbClasses(y);this._addThumbClasses(y.find(".ui-btn"));this._afterListviewRefresh();this._addFirstLastClasses(y,this._getVisibles(y,e),e)}},a.mobile.behaviors.addFirstLastClasses))})(c);
(function(a){a.widget("mobile.listview",a.mobile.listview,{options:{autodividers:!1,autodividersSelector:function(b){return(b=a.trim(b.text())||null)?b.slice(0,1).toUpperCase():null}},_beforeListviewRefresh:function(){this.options.autodividers&&(this._replaceDividers(),this._superApply(arguments))},_replaceDividers:function(){var b,e,c,i,h,k=null;b=this.element;b.children("li:jqmData(role='list-divider')").remove();e=b.children("li");for(b=0;b<e.length;b++)c=e[b],(i=this.options.autodividersSelector(a(c)))&&
k!==i&&(h=d.createElement("li"),h.appendChild(d.createTextNode(i)),h.setAttribute("data-"+a.mobile.ns+"role","list-divider"),c.parentNode.insertBefore(h,c)),k=i}})})(c);(function(a){var b=/(^|\s)ui-li-divider($|\s)/,e=/(^|\s)ui-screen-hidden($|\s)/;a.widget("mobile.listview",a.mobile.listview,{options:{hideDividers:!1},_afterListviewRefresh:function(){var a,c,d,k=!0;if(this._superApply(arguments),this.options.hideDividers){a=this._getChildrenByTagName(this.element[0],"li","LI");for(c=a.length-1;c>
-1;c--)d=a[c],d.className.match(b)?(k&&(d.className+=" ui-screen-hidden"),k=!0):d.className.match(e)||(k=!1)}}})})(c);(function(a){a.mobile.nojs=function(b){a(":jqmData(role='nojs')",b).addClass("ui-nojs")}})(c);(function(a){a.mobile.behaviors.formReset={_handleFormReset:function(){this._on(this.element.closest("form"),{reset:function(){this._delay("_reset")}})}}})(c);(function(a,b){var e=a.mobile.path.hashToSelector;a.widget("mobile.checkboxradio",a.extend({initSelector:"input:not( :jqmData(role='flipswitch' ) )[type='checkbox'],input[type='radio']:not( :jqmData(role='flipswitch' ))",
options:{theme:"inherit",mini:!1,wrapperClass:null,enhanced:!1,iconpos:"left"},_create:function(){var b=this.element,e=this.options,c=this.options.enhanced?{element:this.element.siblings("label"),isParent:!1}:this._findLabel(),d=b[0].type,g="ui-"+d+"-on",j="ui-"+d+"-off";("checkbox"===d||"radio"===d)&&(this.element[0].disabled&&(this.options.disabled=!0),e.iconpos=b.jqmData("iconpos")||b.closest("form, fieldset").jqmData("iconpos")||c.element.attr("data-"+a.mobile.ns+"iconpos")||e.iconpos,e.mini=
b.jqmData("mini")||b.closest("form, fieldset").jqmData("mini")||e.mini,a.extend(this,{input:b,label:c.element,labelIsParent:c.isParent,inputtype:d,checkedClass:g,uncheckedClass:j}),this.options.enhanced||this._enhance(),this._on(c.element,{vmouseover:"_handleLabelVMouseOver",vclick:"_handleLabelVClick"}),this._on(b,{vmousedown:"_cacheVals",vclick:"_handleInputVClick",focus:"_handleInputFocus",blur:"_handleInputBlur"}),this._handleFormReset(),this.refresh())},_findLabel:function(){var b,c,d,g=this.element,
l=g[0].labels;return l&&l.length>0?(c=a(l[0]),d=a.contains(c[0],g[0])):(b=g.closest("label"),d=b.length>0,c=d?b:a(this.document[0].getElementsByTagName("label")).filter("[for='"+e(g[0].id)+"']").first()),{element:c,isParent:d}},_enhance:function(){this.label.addClass("ui-btn ui-corner-all");this.labelIsParent?this.input.add(this.label).wrapAll(this._wrapper()):(this.element.wrap(this._wrapper()),this.element.parent().prepend(this.label));this._setOptions({theme:this.options.theme,iconpos:this.options.iconpos,
mini:this.options.mini})},_wrapper:function(){return a("<div class='"+(this.options.wrapperClass?this.options.wrapperClass:"")+" ui-"+this.inputtype+(this.options.disabled?" ui-state-disabled":"")+"' ></div>")},_handleInputFocus:function(){this.label.addClass(a.mobile.focusClass)},_handleInputBlur:function(){this.label.removeClass(a.mobile.focusClass)},_handleInputVClick:function(){this.element.prop("checked",this.element.is(":checked"));this._getInputSet().not(this.element).prop("checked",!1);this._updateAll(!0)},
_handleLabelVMouseOver:function(a){this.label.parent().hasClass("ui-state-disabled")&&a.stopPropagation()},_handleLabelVClick:function(a){var b=this.element;return b.is(":disabled")?void a.preventDefault():(this._cacheVals(),b.prop("checked","radio"===this.inputtype&&!0||!b.prop("checked")),b.triggerHandler("click"),this._getInputSet().not(b).prop("checked",!1),this._updateAll(),!1)},_cacheVals:function(){this._getInputSet().each(function(){a(this).attr("data-"+a.mobile.ns+"cacheVal",this.checked)})},
_getInputSet:function(){var b,c,d=this.element[0],g=d.name,l=d.form,d=this.element.parents().last().get(0),j=this.element;return g&&"radio"===this.inputtype&&d&&(b="input[type='radio'][name='"+e(g)+"']",l?(c=l.getAttribute("id"),c&&(j=a(b+"[form='"+e(c)+"']",d)),j=a(l).find(b).filter(function(){return this.form===l}).add(j)):j=a(b,d).filter(function(){return!this.form})),j},_updateAll:function(b){var e=this;this._getInputSet().each(function(){var c=a(this);!this.checked&&"checkbox"!==e.inputtype||
b||c.trigger("change")}).checkboxradio("refresh")},_reset:function(){this.refresh()},_hasIcon:function(){var b,e,c=a.mobile.controlgroup;return c&&(b=this.element.closest(":mobile-controlgroup,"+c.prototype.initSelector),b.length>0)?(e=a.data(b[0],"mobile-controlgroup"),"horizontal"!==(e?e.options.type:b.attr("data-"+a.mobile.ns+"type"))):!0},refresh:function(){var b=this.element[0].checked,e=a.mobile.activeBtnClass,c="ui-btn-icon-"+this.options.iconpos,d=[],g=[];this._hasIcon()?(g.push(e),d.push(c)):
(g.push(c),(b?d:g).push(e));b?(d.push(this.checkedClass),g.push(this.uncheckedClass)):(d.push(this.uncheckedClass),g.push(this.checkedClass));this.widget().toggleClass("ui-state-disabled",this.element.prop("disabled"));this.label.addClass(d.join(" ")).removeClass(g.join(" "))},widget:function(){return this.label.parent()},_setOptions:function(a){var e=this.label,c=this.options,d=this.widget(),l=this._hasIcon();a.disabled!==b&&(this.input.prop("disabled",!!a.disabled),d.toggleClass("ui-state-disabled",
!!a.disabled));a.mini!==b&&d.toggleClass("ui-mini",!!a.mini);a.theme!==b&&e.removeClass("ui-btn-"+c.theme).addClass("ui-btn-"+a.theme);a.wrapperClass!==b&&d.removeClass(c.wrapperClass).addClass(a.wrapperClass);a.iconpos!==b&&l?e.removeClass("ui-btn-icon-"+c.iconpos).addClass("ui-btn-icon-"+a.iconpos):l||e.removeClass("ui-btn-icon-"+c.iconpos);this._super(a)}},a.mobile.behaviors.formReset))})(c);(function(a,b){a.widget("mobile.button",{initSelector:"input[type='button'], input[type='submit'], input[type='reset']",
options:{theme:null,icon:null,iconpos:"left",iconshadow:!1,corners:!0,shadow:!0,inline:null,mini:null,wrapperClass:null,enhanced:!1},_create:function(){this.element.is(":disabled")&&(this.options.disabled=!0);this.options.enhanced||this._enhance();a.extend(this,{wrapper:this.element.parent()});this._on({focus:function(){this.widget().addClass(a.mobile.focusClass)},blur:function(){this.widget().removeClass(a.mobile.focusClass)}});this.refresh(!0)},_enhance:function(){this.element.wrap(this._button())},
_button:function(){var b=this.options,c=this._getIconClasses(this.options);return a("<div class='ui-btn ui-input-btn"+(b.wrapperClass?" "+b.wrapperClass:"")+(b.theme?" ui-btn-"+b.theme:"")+(b.corners?" ui-corner-all":"")+(b.shadow?" ui-shadow":"")+(b.inline?" ui-btn-inline":"")+(b.mini?" ui-mini":"")+(b.disabled?" ui-state-disabled":"")+(c?" "+c:"")+"' >"+this.element.val()+"</div>")},widget:function(){return this.wrapper},_destroy:function(){this.element.insertBefore(this.wrapper);this.wrapper.remove()},
_getIconClasses:function(a){return a.icon?"ui-icon-"+a.icon+(a.iconshadow?" ui-shadow-icon":"")+" ui-btn-icon-"+a.iconpos:""},_setOptions:function(e){var c=this.widget();e.theme!==b&&c.removeClass(this.options.theme).addClass("ui-btn-"+e.theme);e.corners!==b&&c.toggleClass("ui-corner-all",e.corners);e.shadow!==b&&c.toggleClass("ui-shadow",e.shadow);e.inline!==b&&c.toggleClass("ui-btn-inline",e.inline);e.mini!==b&&c.toggleClass("ui-mini",e.mini);e.disabled!==b&&(this.element.prop("disabled",e.disabled),
c.toggleClass("ui-state-disabled",e.disabled));(e.icon!==b||e.iconshadow!==b||e.iconpos!==b)&&c.removeClass(this._getIconClasses(this.options)).addClass(this._getIconClasses(a.extend({},this.options,e)));this._super(e)},refresh:function(b){var c,d=this.element.prop("disabled");this.options.icon&&"notext"===this.options.iconpos&&this.element.attr("title")&&this.element.attr("title",this.element.val());b||(c=this.element.detach(),a(this.wrapper).text(this.element.val()).append(c));this.options.disabled!==
d&&this._setOptions({disabled:d})}})})(c);(function(a){var b=a("meta[name=viewport]"),e=b.attr("content"),c=e+",maximum-scale=1, user-scalable=no",d=e+",maximum-scale=10, user-scalable=yes",h=/(user-scalable[\s]*=[\s]*no)|(maximum-scale[\s]*=[\s]*1)[$,\s]/.test(e);a.mobile.zoom=a.extend({},{enabled:!h,locked:!1,disable:function(e){h||a.mobile.zoom.locked||(b.attr("content",c),a.mobile.zoom.enabled=!1,a.mobile.zoom.locked=e||!1)},enable:function(e){h||a.mobile.zoom.locked&&e!==!0||(b.attr("content",
d),a.mobile.zoom.enabled=!0,a.mobile.zoom.locked=!1)},restore:function(){h||(b.attr("content",e),a.mobile.zoom.enabled=!0)}})})(c);(function(a,b){a.widget("mobile.textinput",{initSelector:"input[type='text'],input[type='search'],:jqmData(type='search'),input[type='number'],:jqmData(type='number'),input[type='password'],input[type='email'],input[type='url'],input[type='tel'],textarea,input[type='time'],input[type='date'],input[type='month'],input[type='week'],input[type='datetime'],input[type='datetime-local'],input[type='color'],input:not([type]),input[type='file']",
options:{theme:null,corners:!0,mini:!1,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,wrapperClass:"",enhanced:!1},_create:function(){var b=this.options,c=this.element.is("[type='search'], :jqmData(type='search')"),d="TEXTAREA"===this.element[0].tagName,h=this.element.is("[data-"+(a.mobile.ns||"")+"type='range']"),g=(this.element.is("input")||this.element.is("[data-"+(a.mobile.ns||"")+"type='search']"))&&!h;this.element.prop("disabled")&&
(b.disabled=!0);a.extend(this,{classes:this._classesFromOptions(),isSearch:c,isTextarea:d,isRange:h,inputNeedsWrap:g});this._autoCorrect();b.enhanced||this._enhance();this._on({focus:"_handleFocus",blur:"_handleBlur"})},refresh:function(){this.setOptions({disabled:this.element.is(":disabled")})},_enhance:function(){var a=[];this.isTextarea&&a.push("ui-input-text");(this.isTextarea||this.isRange)&&a.push("ui-shadow-inset");this.inputNeedsWrap?this.element.wrap(this._wrap()):a=a.concat(this.classes);
this.element.addClass(a.join(" "))},widget:function(){return this.inputNeedsWrap?this.element.parent():this.element},_classesFromOptions:function(){var a=this.options,b=[];return b.push("ui-body-"+(null===a.theme?"inherit":a.theme)),a.corners&&b.push("ui-corner-all"),a.mini&&b.push("ui-mini"),a.disabled&&b.push("ui-state-disabled"),a.wrapperClass&&b.push(a.wrapperClass),b},_wrap:function(){return a("<div class='"+(this.isSearch?"ui-input-search ":"ui-input-text ")+this.classes.join(" ")+" ui-shadow-inset'></div>")},
_autoCorrect:function(){"undefined"==typeof this.element[0].autocorrect||a.support.touchOverflow||(this.element[0].setAttribute("autocorrect","off"),this.element[0].setAttribute("autocomplete","off"))},_handleBlur:function(){this.widget().removeClass(a.mobile.focusClass);this.options.preventFocusZoom&&a.mobile.zoom.enable(!0)},_handleFocus:function(){this.options.preventFocusZoom&&a.mobile.zoom.disable(!0);this.widget().addClass(a.mobile.focusClass)},_setOptions:function(a){var c=this.widget();this._super(a);
(a.disabled!==b||a.mini!==b||a.corners!==b||a.theme!==b||a.wrapperClass!==b)&&(c.removeClass(this.classes.join(" ")),this.classes=this._classesFromOptions(),c.addClass(this.classes.join(" ")));a.disabled!==b&&this.element.prop("disabled",!!a.disabled)},_destroy:function(){this.options.enhanced||(this.inputNeedsWrap&&this.element.unwrap(),this.element.removeClass("ui-input-text "+this.classes.join(" ")))}})})(c);(function(a,c){a.widget("mobile.slider",a.extend({initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",
widgetEventPrefix:"slide",options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!1},_create:function(){var e,f,i,h,k,l,j,m=this.element,n=this.options.trackTheme||a.mobile.getAttribute(m[0],"theme");i=n?" ui-bar-"+n:" ui-bar-inherit";h=this.options.corners||m.jqmData("corners")?" ui-corner-all":"";k=this.options.mini||m.jqmData("mini")?" ui-mini":"";l=m[0].nodeName.toLowerCase();var n="select"===l,o=m.parent().is(":jqmData(role='rangeslider')");j=n?"ui-slider-switch":"";e=m.attr("id");
var q=a("[for='"+e+"']"),p=q.attr("id")||e+"-label",u=n?0:parseFloat(m.attr("min")),s=n?m.find("option").length-1:parseFloat(m.attr("max")),r=b.parseFloat(m.attr("step")||1),v=d.createElement("a"),x=a(v);e=d.createElement("div");var t=a(e),w=this.options.highlight&&!n?function(){var b=d.createElement("div");return b.className="ui-slider-bg "+a.mobile.activeBtnClass,a(b).prependTo(t)}():!1;if(q.attr("id",p),this.isToggleSwitch=n,v.setAttribute("href","#"),e.setAttribute("role","application"),e.className=
[this.isToggleSwitch?"ui-slider ui-slider-track ui-shadow-inset ":"ui-slider-track ui-shadow-inset ",j,i,h,k].join(""),v.className="ui-slider-handle",e.appendChild(v),x.attr({role:"slider","aria-valuemin":u,"aria-valuemax":s,"aria-valuenow":this._value(),"aria-valuetext":this._value(),title:this._value(),"aria-labelledby":p}),a.extend(this,{slider:t,handle:x,control:m,type:l,step:r,max:s,min:u,valuebg:w,isRangeslider:o,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1}),n){(f=m.attr("tabindex"))&&
x.attr("tabindex",f);m.attr("tabindex","-1").focus(function(){a(this).blur();x.focus()});f=d.createElement("div");f.className="ui-slider-inneroffset";i=0;for(h=e.childNodes.length;h>i;i++)f.appendChild(e.childNodes[i]);e.appendChild(f);x.addClass("ui-slider-handle-snapping");e=m.find("option");i=0;for(h=e.length;h>i;i++)k=i?"a":"b",l=i?" "+a.mobile.activeBtnClass:"",j=d.createElement("span"),j.className=["ui-slider-label ui-slider-label-",k,l].join(""),j.setAttribute("role","img"),j.appendChild(d.createTextNode(e[i].innerHTML)),
a(j).prependTo(t);this._labels=a(".ui-slider-label",t)}m.addClass(n?"ui-slider-switch":"ui-slider-input");this._on(m,{change:"_controlChange",keyup:"_controlKeyup",blur:"_controlBlur",vmouseup:"_controlVMouseUp"});t.bind("vmousedown",a.proxy(this._sliderVMouseDown,this)).bind("vclick",!1);this._on(d,{vmousemove:"_preventDocumentDrag"});this._on(t.add(d),{vmouseup:"_sliderVMouseUp"});t.insertAfter(m);n||o||(f=this.options.mini?"<div class='ui-slider ui-mini'>":"<div class='ui-slider'>",m.add(t).wrapAll(f));
this._on(this.handle,{vmousedown:"_handleVMouseDown",keydown:"_handleKeydown",keyup:"_handleKeyup"});this.handle.bind("vclick",!1);this._handleFormReset();this.refresh(c,c,!0)},_setOptions:function(a){a.theme!==c&&this._setTheme(a.theme);a.trackTheme!==c&&this._setTrackTheme(a.trackTheme);a.corners!==c&&this._setCorners(a.corners);a.mini!==c&&this._setMini(a.mini);a.highlight!==c&&this._setHighlight(a.highlight);a.disabled!==c&&this._setDisabled(a.disabled);this._super(a)},_controlChange:function(a){return this._trigger("controlchange",
a)===!1?!1:void(this.mouseMoved||this.refresh(this._value(),!0))},_controlKeyup:function(){this.refresh(this._value(),!0,!0)},_controlBlur:function(){this.refresh(this._value(),!0)},_controlVMouseUp:function(){this._checkedRefresh()},_handleVMouseDown:function(){this.handle.focus()},_handleKeydown:function(b){var c=this._value();if(!this.options.disabled){switch(b.keyCode){case a.mobile.keyCode.HOME:case a.mobile.keyCode.END:case a.mobile.keyCode.PAGE_UP:case a.mobile.keyCode.PAGE_DOWN:case a.mobile.keyCode.UP:case a.mobile.keyCode.RIGHT:case a.mobile.keyCode.DOWN:case a.mobile.keyCode.LEFT:b.preventDefault(),
this._keySliding||(this._keySliding=!0,this.handle.addClass("ui-state-active"))}switch(b.keyCode){case a.mobile.keyCode.HOME:this.refresh(this.min);break;case a.mobile.keyCode.END:this.refresh(this.max);break;case a.mobile.keyCode.PAGE_UP:case a.mobile.keyCode.UP:case a.mobile.keyCode.RIGHT:this.refresh(c+this.step);break;case a.mobile.keyCode.PAGE_DOWN:case a.mobile.keyCode.DOWN:case a.mobile.keyCode.LEFT:this.refresh(c-this.step)}}},_handleKeyup:function(){this._keySliding&&(this._keySliding=!1,
this.handle.removeClass("ui-state-active"))},_sliderVMouseDown:function(a){return this.options.disabled||1!==a.which&&0!==a.which&&a.which!==c?!1:this._trigger("beforestart",a)===!1?!1:(this.dragging=!0,this.userModified=!1,this.mouseMoved=!1,this.isToggleSwitch&&(this.beforeStart=this.element[0].selectedIndex),this.refresh(a),this._trigger("start"),!1)},_sliderVMouseUp:function(){return this.dragging?(this.dragging=!1,this.isToggleSwitch&&(this.handle.addClass("ui-slider-handle-snapping"),this.refresh(this.mouseMoved?
this.userModified?0===this.beforeStart?1:0:this.beforeStart:0===this.beforeStart?1:0)),this.mouseMoved=!1,this._trigger("stop"),!1):void 0},_preventDocumentDrag:function(a){return this._trigger("drag",a)===!1?!1:this.dragging&&!this.options.disabled?(this.mouseMoved=!0,this.isToggleSwitch&&this.handle.removeClass("ui-slider-handle-snapping"),this.refresh(a),this.userModified=this.beforeStart!==this.element[0].selectedIndex,!1):void 0},_checkedRefresh:function(){this.value!==this._value()&&this.refresh(this._value())},
_value:function(){return this.isToggleSwitch?this.element[0].selectedIndex:parseFloat(this.element.val())},_reset:function(){this.refresh(c,!1,!0)},refresh:function(b,c,g){var h,k,l,j,m,n,o,q,p,u,s,r,v,x,t,w,y,z=this;q=a.mobile.getAttribute(this.element[0],"theme");p=(p=this.options.theme||q)?" ui-btn-"+p:"";q=this.options.trackTheme||q;if(z.slider[0].className=[this.isToggleSwitch?"ui-slider ui-slider-switch ui-slider-track ui-shadow-inset":"ui-slider-track ui-shadow-inset",q?" ui-bar-"+q:" ui-bar-inherit",
this.options.corners?" ui-corner-all":"",this.options.mini?" ui-mini":""].join(""),(this.options.disabled||this.element.prop("disabled"))&&this.disable(),this.value=this._value(),this.options.highlight&&!this.isToggleSwitch&&0===this.slider.find(".ui-slider-bg").length&&(this.valuebg=function(){var b=d.createElement("div");return b.className="ui-slider-bg "+a.mobile.activeBtnClass,a(b).prependTo(z.slider)}()),this.handle.addClass("ui-btn"+p+" ui-shadow"),m=this.element,n=!this.isToggleSwitch,o=n?
[]:m.find("option"),q=n?parseFloat(m.attr("min")):0,p=n?parseFloat(m.attr("max")):o.length-1,u=n&&parseFloat(m.attr("step"))>0?parseFloat(m.attr("step")):1,"object"==typeof b){if(l=b,h=this.slider.offset().left,k=this.slider.width(),j=k/((p-q)/u),!this.dragging||l.pageX<h-8||l.pageX>h+k+8)return;h=j>1?(l.pageX-h)/k*100:Math.round((l.pageX-h)/k*100)}else null==b&&(b=n?parseFloat(m.val()||0):m[0].selectedIndex),h=(parseFloat(b)-q)/(p-q)*100;if(!isNaN(h)&&(s=h/100*(p-q)+q,r=(s-q)%u,v=s-r,2*Math.abs(r)>=
u&&(v+=r>0?u:-u),x=100/((p-q)/u),s=parseFloat(v.toFixed(5)),"undefined"==typeof j&&(j=k/((p-q)/u)),j>1&&n&&(h=(s-q)*x*(1/u)),0>h&&(h=0),h>100&&(h=100),q>s&&(s=q),s>p&&(s=p),this.handle.css("left",h+"%"),this.handle[0].setAttribute("aria-valuenow",n?s:o.eq(s).attr("value")),this.handle[0].setAttribute("aria-valuetext",n?s:o.eq(s).getEncodedText()),this.handle[0].setAttribute("title",n?s:o.eq(s).getEncodedText()),this.valuebg&&this.valuebg.css("width",h+"%"),this._labels&&(t=this.handle.width()/this.slider.width()*
100,w=h&&t+(100-t)*h/100,y=100===h?0:Math.min(t+100-w,100),this._labels.each(function(){var b=a(this).hasClass("ui-slider-label-a");a(this).width((b?w:y)+"%")})),!g)){if(g=!1,n?(g=parseFloat(m.val())!==s,m.val(s)):(g=m[0].selectedIndex!==s,m[0].selectedIndex=s),this._trigger("beforechange",b)===!1)return!1;!c&&g&&m.trigger("change")}},_setHighlight:function(a){(a=!!a)?(this.options.highlight=!!a,this.refresh()):this.valuebg&&(this.valuebg.remove(),this.valuebg=!1)},_setTheme:function(a){this.handle.removeClass("ui-btn-"+
this.options.theme).addClass("ui-btn-"+a);a=a?a:"inherit";this.control.removeClass("ui-body-"+(this.options.theme?this.options.theme:"inherit")).addClass("ui-body-"+a)},_setTrackTheme:function(a){a=a?a:"inherit";this.slider.removeClass("ui-body-"+(this.options.trackTheme?this.options.trackTheme:"inherit")).addClass("ui-body-"+a)},_setMini:function(a){a=!!a;this.isToggleSwitch||this.isRangeslider||(this.slider.parent().toggleClass("ui-mini",a),this.element.toggleClass("ui-mini",a));this.slider.toggleClass("ui-mini",
a)},_setCorners:function(a){this.slider.toggleClass("ui-corner-all",a);this.isToggleSwitch||this.control.toggleClass("ui-corner-all",a)},_setDisabled:function(a){a=!!a;this.element.prop("disabled",a);this.slider.toggleClass("ui-state-disabled",a).attr("aria-disabled",a);this.element.toggleClass("ui-state-disabled",a)}},a.mobile.behaviors.formReset))})(c);(function(a){var b;a.widget("mobile.slider",a.mobile.slider,{options:{popupEnabled:!1,showValue:!1},_create:function(){this._super();a.extend(this,
{_currentValue:null,_popup:null,_popupVisible:!1});this._setOption("popupEnabled",this.options.popupEnabled);this._on(this.handle,{vmousedown:"_showPopup"});this._on(this.slider.add(this.document),{vmouseup:"_hidePopup"});this._refresh()},_positionPopup:function(){var a=this.handle.offset();this._popup.offset({left:a.left+(this.handle.width()-this._popup.width())/2,top:a.top-this._popup.outerHeight()-5})},_setOption:function(e,c){this._super(e,c);"showValue"===e?this.handle.html(c&&!this.options.mini?
this._value():""):"popupEnabled"===e&&c&&!this._popup&&(this._popup=(b||(b=a("<div></div>",{"class":"ui-slider-popup ui-shadow ui-corner-all"})),b.clone()).addClass("ui-body-"+(this.options.theme||"a")).hide().insertBefore(this.element))},refresh:function(){this._super.apply(this,arguments);this._refresh()},_refresh:function(){var a,b=this.options;b.popupEnabled&&this.handle.removeAttr("title");a=this._value();a!==this._currentValue&&(this._currentValue=a,b.popupEnabled&&this._popup&&(this._positionPopup(),
this._popup.html(a)),b.showValue&&!this.options.mini&&this.handle.html(a))},_showPopup:function(){this.options.popupEnabled&&!this._popupVisible&&(this.handle.html(""),this._popup.show(),this._positionPopup(),this._popupVisible=!0)},_hidePopup:function(){var a=this.options;a.popupEnabled&&this._popupVisible&&(a.showValue&&!a.mini&&this.handle.html(this._value()),this._popup.hide(),this._popupVisible=!1)}})})(c);(function(a,b){a.widget("mobile.flipswitch",a.extend({options:{onText:"On",offText:"Off",
theme:null,enhanced:!1,wrapperClass:null,corners:!0,mini:!1},_create:function(){this.options.enhanced?a.extend(this,{flipswitch:this.element.parent(),on:this.element.find(".ui-flipswitch-on").eq(0),off:this.element.find(".ui-flipswitch-off").eq(0),type:this.element.get(0).tagName}):this._enhance();this._handleFormReset();this._originalTabIndex=this.element.attr("tabindex");null!=this._originalTabIndex&&this.on.attr("tabindex",this._originalTabIndex);this.element.attr("tabindex","-1");this._on({focus:"_handleInputFocus"});
this.element.is(":disabled")&&this._setOptions({disabled:!0});this._on(this.flipswitch,{click:"_toggle",swipeleft:"_left",swiperight:"_right"});this._on(this.on,{keydown:"_keydown"});this._on({change:"refresh"})},_handleInputFocus:function(){this.on.focus()},widget:function(){return this.flipswitch},_left:function(){this.flipswitch.removeClass("ui-flipswitch-active");"SELECT"===this.type?this.element.get(0).selectedIndex=0:this.element.prop("checked",!1);this.element.trigger("change")},_right:function(){this.flipswitch.addClass("ui-flipswitch-active");
"SELECT"===this.type?this.element.get(0).selectedIndex=1:this.element.prop("checked",!0);this.element.trigger("change")},_enhance:function(){var b=a("<div>"),c=this.options,d=this.element,h=c.theme?c.theme:"inherit",g=a("<a></a>",{href:"#"}),l=a("<span></span>"),j=d.get(0).tagName,m="INPUT"===j?c.onText:d.find("option").eq(1).text(),n="INPUT"===j?c.offText:d.find("option").eq(0).text();g.addClass("ui-flipswitch-on ui-btn ui-shadow ui-btn-inherit").text(m);l.addClass("ui-flipswitch-off").text(n);b.addClass("ui-flipswitch ui-shadow-inset ui-bar-"+
h+" "+(c.wrapperClass?c.wrapperClass:"")+" "+(d.is(":checked")||d.find("option").eq(1).is(":selected")?"ui-flipswitch-active":"")+(d.is(":disabled")?" ui-state-disabled":"")+(c.corners?" ui-corner-all":"")+(c.mini?" ui-mini":"")).append(g,l);d.addClass("ui-flipswitch-input").after(b).appendTo(b);a.extend(this,{flipswitch:b,on:g,off:l,type:j})},_reset:function(){this.refresh()},refresh:function(){var a,b=this.flipswitch.hasClass("ui-flipswitch-active")?"_right":"_left";a="SELECT"===this.type?this.element.get(0).selectedIndex>
0?"_right":"_left":this.element.prop("checked")?"_right":"_left";a!==b&&this[a]()},_toggle:function(){this[this.flipswitch.hasClass("ui-flipswitch-active")?"_left":"_right"]()},_keydown:function(b){b.which===a.mobile.keyCode.LEFT?this._left():b.which===a.mobile.keyCode.RIGHT?this._right():b.which===a.mobile.keyCode.SPACE&&(this._toggle(),b.preventDefault())},_setOptions:function(a){if(a.theme!==b){var c=a.theme?a.theme:"inherit",d=a.theme?a.theme:"inherit";this.widget().removeClass("ui-bar-"+c).addClass("ui-bar-"+
d)}a.onText!==b&&this.on.text(a.onText);a.offText!==b&&this.off.text(a.offText);a.disabled!==b&&this.widget().toggleClass("ui-state-disabled",a.disabled);a.mini!==b&&this.widget().toggleClass("ui-mini",a.mini);a.corners!==b&&this.widget().toggleClass("ui-corner-all",a.corners);this._super(a)},_destroy:function(){this.options.enhanced||(null!=this._originalTabIndex?this.element.attr("tabindex",this._originalTabIndex):this.element.removeAttr("tabindex"),this.on.remove(),this.off.remove(),this.element.unwrap(),
this.flipswitch.remove(),this.removeClass("ui-flipswitch-input"))}},a.mobile.behaviors.formReset))})(c);(function(a,b){a.widget("mobile.rangeslider",a.extend({options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!0},_create:function(){var b=this.element,c=this.options.mini?"ui-rangeslider ui-mini":"ui-rangeslider",d=b.find("input").first(),h=b.find("input").last(),g=b.find("label").first(),l=a.data(d.get(0),"mobile-slider")||a.data(d.slider().get(0),"mobile-slider"),j=a.data(h.get(0),
"mobile-slider")||a.data(h.slider().get(0),"mobile-slider"),m=l.slider,j=j.slider,l=l.handle,n=a("<div class='ui-rangeslider-sliders' />").appendTo(b);d.addClass("ui-rangeslider-first");h.addClass("ui-rangeslider-last");b.addClass(c);m.appendTo(n);j.appendTo(n);g.insertBefore(b);l.prependTo(j);a.extend(this,{_inputFirst:d,_inputLast:h,_sliderFirst:m,_sliderLast:j,_label:g,_targetVal:null,_sliderTarget:!1,_sliders:n,_proxy:!1});this.refresh();this._on(this.element.find("input.ui-slider-input"),{slidebeforestart:"_slidebeforestart",
slidestop:"_slidestop",slidedrag:"_slidedrag",slidebeforechange:"_change",blur:"_change",keyup:"_change"});this._on({mousedown:"_change"});this._on(this.element.closest("form"),{reset:"_handleReset"});this._on(l,{vmousedown:"_dragFirstHandle"})},_handleReset:function(){var a=this;setTimeout(function(){a._updateHighlight()},0)},_dragFirstHandle:function(b){return a.data(this._inputFirst.get(0),"mobile-slider").dragging=!0,a.data(this._inputFirst.get(0),"mobile-slider").refresh(b),a.data(this._inputFirst.get(0),
"mobile-slider")._trigger("start"),!1},_slidedrag:function(b){var c=a(b.target).is(this._inputFirst),d=c?this._inputLast:this._inputFirst;return this._sliderTarget=!1,"first"===this._proxy&&c||"last"===this._proxy&&!c?(a.data(d.get(0),"mobile-slider").dragging=!0,a.data(d.get(0),"mobile-slider").refresh(b),!1):void 0},_slidestop:function(b){b=a(b.target).is(this._inputFirst);this._proxy=!1;this.element.find("input").trigger("vmouseup");this._sliderFirst.css("z-index",b?1:"")},_slidebeforestart:function(b){this._sliderTarget=
!1;a(b.originalEvent.target).hasClass("ui-slider-track")&&(this._sliderTarget=!0,this._targetVal=a(b.target).val())},_setOptions:function(a){a.theme!==b&&this._setTheme(a.theme);a.trackTheme!==b&&this._setTrackTheme(a.trackTheme);a.mini!==b&&this._setMini(a.mini);a.highlight!==b&&this._setHighlight(a.highlight);a.disabled!==b&&this._setDisabled(a.disabled);this._super(a);this.refresh()},refresh:function(){var a=this.element,b=this.options;(this._inputFirst.is(":disabled")||this._inputLast.is(":disabled"))&&
(this.options.disabled=!0);a.find("input").slider({theme:b.theme,trackTheme:b.trackTheme,disabled:b.disabled,corners:b.corners,mini:b.mini,highlight:b.highlight}).slider("refresh");this._updateHighlight()},_change:function(b){if("keyup"===b.type)return this._updateHighlight(),!1;var c=this,d=parseFloat(this._inputFirst.val(),10),h=parseFloat(this._inputLast.val(),10),g=a(b.target).hasClass("ui-rangeslider-first"),l=g?this._inputFirst:this._inputLast,j=g?this._inputLast:this._inputFirst;if(this._inputFirst.val()>
this._inputLast.val()&&"mousedown"===b.type&&!a(b.target).hasClass("ui-slider-handle"))l.blur();else if("mousedown"===b.type)return;return d>h&&!this._sliderTarget?(l.val(g?h:d).slider("refresh"),this._trigger("normalize")):d>h&&(l.val(this._targetVal).slider("refresh"),setTimeout(function(){j.val(g?d:h).slider("refresh");a.data(j.get(0),"mobile-slider").handle.focus();c._sliderFirst.css("z-index",g?"":1);c._trigger("normalize")},0),this._proxy=g?"first":"last"),d===h?(a.data(l.get(0),"mobile-slider").handle.css("z-index",
1),a.data(j.get(0),"mobile-slider").handle.css("z-index",0)):(a.data(j.get(0),"mobile-slider").handle.css("z-index",""),a.data(l.get(0),"mobile-slider").handle.css("z-index","")),this._updateHighlight(),d>=h?!1:void 0},_updateHighlight:function(){var b=parseInt(a.data(this._inputFirst.get(0),"mobile-slider").handle.get(0).style.left,10),c=parseInt(a.data(this._inputLast.get(0),"mobile-slider").handle.get(0).style.left,10)-b;this.element.find(".ui-slider-bg").css({"margin-left":b+"%",width:c+"%"})},
_setTheme:function(a){this._inputFirst.slider("option","theme",a);this._inputLast.slider("option","theme",a)},_setTrackTheme:function(a){this._inputFirst.slider("option","trackTheme",a);this._inputLast.slider("option","trackTheme",a)},_setMini:function(a){this._inputFirst.slider("option","mini",a);this._inputLast.slider("option","mini",a);this.element.toggleClass("ui-mini",!!a)},_setHighlight:function(a){this._inputFirst.slider("option","highlight",a);this._inputLast.slider("option","highlight",a)},
_setDisabled:function(a){this._inputFirst.prop("disabled",a);this._inputLast.prop("disabled",a)},_destroy:function(){this._label.prependTo(this.element);this.element.removeClass("ui-rangeslider ui-mini");this._inputFirst.after(this._sliderFirst);this._inputLast.after(this._sliderLast);this._sliders.remove();this.element.find("input").removeClass("ui-rangeslider-first ui-rangeslider-last").slider("destroy")}},a.mobile.behaviors.formReset))})(c);(function(a,b){a.widget("mobile.textinput",a.mobile.textinput,
{options:{clearBtn:!1,clearBtnText:"Clear text"},_create:function(){this._super();this.isSearch&&(this.options.clearBtn=!0);this.options.clearBtn&&this.inputNeedsWrap&&this._addClearBtn()},clearButton:function(){return a("<a href='#' tabindex='-1' aria-hidden='true' class='ui-input-clear ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all'></a>").attr("title",this.options.clearBtnText).text(this.options.clearBtnText)},_clearBtnClick:function(a){this.element.val("").focus().trigger("change");this._clearBtn.addClass("ui-input-clear-hidden");
a.preventDefault()},_addClearBtn:function(){this.options.enhanced||this._enhanceClear();a.extend(this,{_clearBtn:this.widget().find("a.ui-input-clear")});this._bindClearEvents();this._toggleClear()},_enhanceClear:function(){this.clearButton().appendTo(this.widget());this.widget().addClass("ui-input-has-clear")},_bindClearEvents:function(){this._on(this._clearBtn,{click:"_clearBtnClick"});this._on({keyup:"_toggleClear",change:"_toggleClear",input:"_toggleClear",focus:"_toggleClear",blur:"_toggleClear",
cut:"_toggleClear",paste:"_toggleClear"})},_unbindClear:function(){this._off(this._clearBtn,"click");this._off(this.element,"keyup change input focus blur cut paste")},_setOptions:function(a){this._super(a);a.clearBtn===b||this.element.is("textarea, :jqmData(type='range')")||(a.clearBtn?this._addClearBtn():this._destroyClear());a.clearBtnText!==b&&this._clearBtn!==b&&this._clearBtn.text(a.clearBtnText).attr("title",a.clearBtnText)},_toggleClear:function(){this._delay("_toggleClearClass",0)},_toggleClearClass:function(){this._clearBtn.toggleClass("ui-input-clear-hidden",
!this.element.val())},_destroyClear:function(){this.widget().removeClass("ui-input-has-clear");this._unbindClear();this._clearBtn.remove()},_destroy:function(){this._super();this.options.clearBtn&&this._destroyClear()}})})(c);(function(a,b){a.widget("mobile.textinput",a.mobile.textinput,{options:{autogrow:!0,keyupTimeoutBuffer:100},_create:function(){this._super();this.options.autogrow&&this.isTextarea&&this._autogrow()},_autogrow:function(){this.element.addClass("ui-textinput-autogrow");this._on({keyup:"_timeout",
change:"_timeout",input:"_timeout",paste:"_timeout"});this._on(!0,this.document,{pageshow:"_handleShow",popupbeforeposition:"_handleShow",updatelayout:"_handleShow",panelopen:"_handleShow"})},_handleShow:function(b){a.contains(b.target,this.element[0])&&this.element.is(":visible")&&("popupbeforeposition"!==b.type&&this.element.addClass("ui-textinput-autogrow-resize").animationComplete(a.proxy(function(){this.element.removeClass("ui-textinput-autogrow-resize")},this),"transition"),this._prepareHeightUpdate())},
_unbindAutogrow:function(){this.element.removeClass("ui-textinput-autogrow");this._off(this.element,"keyup change input paste");this._off(this.document,"pageshow popupbeforeposition updatelayout panelopen")},keyupTimeout:null,_prepareHeightUpdate:function(a){this.keyupTimeout&&clearTimeout(this.keyupTimeout);a===b?this._updateHeight():this.keyupTimeout=this._delay("_updateHeight",a)},_timeout:function(){this._prepareHeightUpdate(this.options.keyupTimeoutBuffer)},_updateHeight:function(){var a,b,c,
d,g,l,j,m=this.window.scrollTop();this.keyupTimeout=0;"onpage"in this.element[0]||this.element.css({height:0,"min-height":0,"max-height":0});d=this.element[0].scrollHeight;g=this.element[0].clientHeight;l=parseFloat(this.element.css("border-top-width"));j=parseFloat(this.element.css("border-bottom-width"));d=d+(l+j)+15;0===g&&(a=parseFloat(this.element.css("padding-top")),b=parseFloat(this.element.css("padding-bottom")),c=a+b,d+=c);this.element.css({height:d,"min-height":"","max-height":""});this.window.scrollTop(m)},
refresh:function(){this.options.autogrow&&this.isTextarea&&this._updateHeight()},_setOptions:function(a){this._super(a);a.autogrow!==b&&this.isTextarea&&(a.autogrow?this._autogrow():this._unbindAutogrow())}})})(c);(function(a){a.widget("mobile.selectmenu",a.extend({initSelector:"select:not( :jqmData(role='slider')):not( :jqmData(role='flipswitch') )",options:{theme:null,icon:"carat-d",iconpos:"right",inline:!1,corners:!0,shadow:!0,iconshadow:!1,overlayTheme:null,dividerTheme:null,hidePlaceholderMenuItems:!0,
closeText:"Close",nativeMenu:!0,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,mini:!1},_button:function(){return a("<div/>")},_setDisabled:function(a){return this.element.attr("disabled",a),this.button.attr("aria-disabled",a),this._setOption("disabled",a)},_focusButton:function(){var a=this;setTimeout(function(){a.button.focus()},40)},_selectOptions:function(){return this.select.find("option")},_preExtension:function(){var b=this.options.inline||
this.element.jqmData("inline"),c=this.options.mini||this.element.jqmData("mini"),d="";~this.element[0].className.indexOf("ui-btn-left")&&(d=" ui-btn-left");~this.element[0].className.indexOf("ui-btn-right")&&(d=" ui-btn-right");b&&(d+=" ui-btn-inline");c&&(d+=" ui-mini");this.select=this.element.removeClass("ui-btn-left ui-btn-right").wrap("<div class='ui-select"+d+"'>");this.selectId=this.select.attr("id")||"select-"+this.uuid;this.buttonId=this.selectId+"-button";this.label=a("label[for='"+this.selectId+
"']");this.isMultiple=this.select[0].multiple},_destroy:function(){var a=this.element.parents(".ui-select");a.length>0&&(a.is(".ui-btn-left, .ui-btn-right")&&this.element.addClass(a.hasClass("ui-btn-left")?"ui-btn-left":"ui-btn-right"),this.element.insertAfter(a),a.remove())},_create:function(){this._preExtension();this.button=this._button();var c=this,e=this.options,d=e.icon?e.iconpos||this.select.jqmData("iconpos"):!1,d=this.button.insertBefore(this.select).attr("id",this.buttonId).addClass("ui-btn"+
(e.icon?" ui-icon-"+e.icon+" ui-btn-icon-"+d+(e.iconshadow?" ui-shadow-icon":""):"")+(e.theme?" ui-btn-"+e.theme:"")+(e.corners?" ui-corner-all":"")+(e.shadow?" ui-shadow":""));this.setButtonText();e.nativeMenu&&b.opera&&b.opera.version&&d.addClass("ui-select-nativeonly");this.isMultiple&&(this.buttonCount=a("<span>").addClass("ui-li-count ui-body-inherit").hide().appendTo(d.addClass("ui-li-has-count")));(e.disabled||this.element.attr("disabled"))&&this.disable();this.select.change(function(){c.refresh();
e.nativeMenu&&c._delay(function(){c.select.blur()})});this._handleFormReset();this._on(this.button,{keydown:"_handleKeydown"});this.build()},build:function(){var b=this;this.select.appendTo(b.button).bind("vmousedown",function(){b.button.addClass(a.mobile.activeBtnClass)}).bind("focus",function(){b.button.addClass(a.mobile.focusClass)}).bind("blur",function(){b.button.removeClass(a.mobile.focusClass)}).bind("focus vmouseover",function(){b.button.trigger("vmouseover")}).bind("vmousemove",function(){b.button.removeClass(a.mobile.activeBtnClass)}).bind("change blur vmouseout",
function(){b.button.trigger("vmouseout").removeClass(a.mobile.activeBtnClass)});b.button.bind("vmousedown",function(){b.options.preventFocusZoom&&a.mobile.zoom.disable(!0)});b.label.bind("click focus",function(){b.options.preventFocusZoom&&a.mobile.zoom.disable(!0)});b.select.bind("focus",function(){b.options.preventFocusZoom&&a.mobile.zoom.disable(!0)});b.button.bind("mouseup",function(){b.options.preventFocusZoom&&setTimeout(function(){a.mobile.zoom.enable(!0)},0)});b.select.bind("blur",function(){b.options.preventFocusZoom&&
a.mobile.zoom.enable(!0)})},selected:function(){return this._selectOptions().filter(":selected")},selectedIndices:function(){var a=this;return this.selected().map(function(){return a._selectOptions().index(this)}).get()},setButtonText:function(){var b=this,c=this.selected(),f=this.placeholder,i=a(d.createElement("span"));this.button.children("span").not(".ui-li-count").remove().end().end().prepend(function(){return f=c.length?c.map(function(){return a(this).text()}).get().join(", "):b.placeholder,
f?i.text(f):i.html("&#160;"),i.addClass(b.select.attr("class")).addClass(c.attr("class")).removeClass("ui-screen-hidden")}())},setButtonCount:function(){var a=this.selected();this.isMultiple&&this.buttonCount[a.length>1?"show":"hide"]().text(a.length)},_handleKeydown:function(){this._delay("_refreshButton")},_reset:function(){this.refresh()},_refreshButton:function(){this.setButtonText();this.setButtonCount()},refresh:function(){this._refreshButton()},open:a.noop,close:a.noop,disable:function(){this._setDisabled(!0);
this.button.addClass("ui-state-disabled")},enable:function(){this._setDisabled(!1);this.button.removeClass("ui-state-disabled")}},a.mobile.behaviors.formReset))})(c);(function(a){a.mobile.links=function(b){a(b).find("a").jqmEnhanceable().filter(":jqmData(rel='popup')[href][href!='']").each(function(){var a=this.getAttribute("href").substring(1);a&&(this.setAttribute("aria-haspopup",!0),this.setAttribute("aria-owns",a),this.setAttribute("aria-expanded",!1))}).end().not(".ui-btn, :jqmData(role='none'), :jqmData(role='nojs')").addClass("ui-link")}})(c);
(function(a,c){function e(a){return{x:a.scrollLeft(),y:a.scrollTop(),cx:a[0].innerWidth||a.width(),cy:a[0].innerHeight||a.height()}}a.widget("mobile.popup",{options:{wrapperClass:null,theme:null,overlayTheme:null,shadow:!0,corners:!0,transition:"none",positionTo:"origin",tolerance:null,closeLinkSelector:"a:jqmData(rel='back')",closeLinkEvents:"click.popup",navigateEvents:"navigate.popup",closeEvents:"navigate.popup pagebeforechange.popup",dismissible:!0,enhanced:!1,history:!a.mobile.browser.oldIE},
_handleDocumentVmousedown:function(b){this._isOpen&&a.contains(this._ui.container[0],b.target)&&this._ignoreResizeEvents()},_create:function(){var b=this.element,c=b.attr("id"),e=this.options;e.history=e.history&&a.mobile.ajaxEnabled&&a.mobile.hashListeningEnabled;this._on(this.document,{vmousedown:"_handleDocumentVmousedown"});a.extend(this,{_scrollTop:0,_page:b.closest(".ui-page"),_ui:null,_fallbackTransition:"",_currentTransition:!1,_prerequisites:null,_isOpen:!1,_tolerance:null,_resizeData:null,
_ignoreResizeTo:0,_orientationchangeInProgress:!1});0===this._page.length&&(this._page=a("body"));e.enhanced?this._ui={container:b.parent(),screen:b.parent().prev(),placeholder:a(this.document[0].getElementById(c+"-placeholder"))}:(this._ui=this._enhance(b,c),this._applyTransition(e.transition));this._setTolerance(e.tolerance)._ui.focusElement=this._ui.container;this._on(this._ui.screen,{vclick:"_eatEventAndClose"});this._on(this.window,{orientationchange:a.proxy(this,"_handleWindowOrientationchange"),
resize:a.proxy(this,"_handleWindowResize"),keyup:a.proxy(this,"_handleWindowKeyUp")});this._on(this.document,{focusin:"_handleDocumentFocusIn"})},_enhance:function(b,c){var e=this.options,d=e.wrapperClass,d={screen:a("<div class='ui-screen-hidden ui-popup-screen "+this._themeClassFromOption("ui-overlay-",e.overlayTheme)+"'></div>"),placeholder:a("<div style='display: none;'><\!-- placeholder --\></div>"),container:a("<div class='ui-popup-container ui-popup-hidden ui-popup-truncate"+(d?" "+d:"")+"'></div>")},
g=this.document[0].createDocumentFragment();return g.appendChild(d.screen[0]),g.appendChild(d.container[0]),c&&(d.screen.attr("id",c+"-screen"),d.container.attr("id",c+"-popup"),d.placeholder.attr("id",c+"-placeholder").html("<\!-- placeholder for "+c+" --\>")),this._page[0].appendChild(g),d.placeholder.insertAfter(b),b.detach().addClass("ui-popup "+this._themeClassFromOption("ui-body-",e.theme)+" "+(e.shadow?"ui-overlay-shadow ":"")+(e.corners?"ui-corner-all ":"")).appendTo(d.container),d},_eatEventAndClose:function(a){return a.preventDefault(),
a.stopImmediatePropagation(),this.options.dismissible&&this.close(),!1},_resizeScreen:function(){var a=this._ui.screen,b=this._ui.container.outerHeight(!0),c=a.removeAttr("style").height(),e=this.document.height()-1;e>c?a.height(e):b>c&&a.height(b)},_handleWindowKeyUp:function(b){return this._isOpen&&b.keyCode===a.mobile.keyCode.ESCAPE?this._eatEventAndClose(b):void 0},_expectResizeEvent:function(){var a=e(this.window);if(this._resizeData){if(a.x===this._resizeData.windowCoordinates.x&&a.y===this._resizeData.windowCoordinates.y&&
a.cx===this._resizeData.windowCoordinates.cx&&a.cy===this._resizeData.windowCoordinates.cy)return!1;clearTimeout(this._resizeData.timeoutId)}return this._resizeData={timeoutId:this._delay("_resizeTimeout",200),windowCoordinates:a},!0},_resizeTimeout:function(){this._isOpen?this._expectResizeEvent()||(this._ui.container.hasClass("ui-popup-hidden")&&(this._ui.container.removeClass("ui-popup-hidden ui-popup-truncate"),this.reposition({positionTo:"window"}),this._ignoreResizeEvents()),this._resizeScreen(),
this._resizeData=null,this._orientationchangeInProgress=!1):(this._resizeData=null,this._orientationchangeInProgress=!1)},_stopIgnoringResizeEvents:function(){this._ignoreResizeTo=0},_ignoreResizeEvents:function(){this._ignoreResizeTo&&clearTimeout(this._ignoreResizeTo);this._ignoreResizeTo=this._delay("_stopIgnoringResizeEvents",1E3)},_handleWindowResize:function(){this._isOpen&&0===this._ignoreResizeTo&&(!this._expectResizeEvent()&&!this._orientationchangeInProgress||this._ui.container.hasClass("ui-popup-hidden")||
this._ui.container.addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style"))},_handleWindowOrientationchange:function(){!this._orientationchangeInProgress&&this._isOpen&&0===this._ignoreResizeTo&&(this._expectResizeEvent(),this._orientationchangeInProgress=!0)},_handleDocumentFocusIn:function(b){var c,e=b.target,d=this._ui;if(this._isOpen){if(e!==d.container[0]){if(c=a(e),!a.contains(d.container[0],e))return a(this.document[0].activeElement).one("focus",a.proxy(function(){this._safelyBlur(e)},
this)),d.focusElement.focus(),b.preventDefault(),b.stopImmediatePropagation(),!1;d.focusElement[0]===d.container[0]&&(d.focusElement=c)}this._ignoreResizeEvents()}},_themeClassFromOption:function(a,b){return b?"none"===b?"":a+b:a+"inherit"},_applyTransition:function(b){return b&&(this._ui.container.removeClass(this._fallbackTransition),"none"!==b&&(this._fallbackTransition=a.mobile._maybeDegradeTransition(b),"none"===this._fallbackTransition&&(this._fallbackTransition=""),this._ui.container.addClass(this._fallbackTransition))),
this},_setOptions:function(a){var b=this.options,e=this.element,d=this._ui.screen;return a.wrapperClass!==c&&this._ui.container.removeClass(b.wrapperClass).addClass(a.wrapperClass),a.theme!==c&&e.removeClass(this._themeClassFromOption("ui-body-",b.theme)).addClass(this._themeClassFromOption("ui-body-",a.theme)),a.overlayTheme!==c&&(d.removeClass(this._themeClassFromOption("ui-overlay-",b.overlayTheme)).addClass(this._themeClassFromOption("ui-overlay-",a.overlayTheme)),this._isOpen&&d.addClass("in")),
a.shadow!==c&&e.toggleClass("ui-overlay-shadow",a.shadow),a.corners!==c&&e.toggleClass("ui-corner-all",a.corners),a.transition!==c&&(this._currentTransition||this._applyTransition(a.transition)),a.tolerance!==c&&this._setTolerance(a.tolerance),a.disabled!==c&&a.disabled&&this.close(),this._super(a)},_setTolerance:function(b){var e,d={t:30,r:15,b:30,l:15};if(b!==c)switch(e=String(b).split(","),a.each(e,function(a,b){e[a]=parseInt(b,10)}),e.length){case 1:isNaN(e[0])||(d.t=d.r=d.b=d.l=e[0]);break;case 2:isNaN(e[0])||
(d.t=d.b=e[0]);isNaN(e[1])||(d.l=d.r=e[1]);break;case 4:isNaN(e[0])||(d.t=e[0]),isNaN(e[1])||(d.r=e[1]),isNaN(e[2])||(d.b=e[2]),isNaN(e[3])||(d.l=e[3])}return this._tolerance=d,this},_clampPopupWidth:function(a){var b,c=e(this.window),c={x:this._tolerance.l,y:c.y+this._tolerance.t,cx:c.cx-this._tolerance.l-this._tolerance.r,cy:c.cy-this._tolerance.t-this._tolerance.b};return a||this._ui.container.css("max-width",c.cx),b={cx:this._ui.container.outerWidth(!0),cy:this._ui.container.outerHeight(!0)},
{rc:c,menuSize:b}},_calculateFinalLocation:function(a,b){var c,e=b.rc,d=b.menuSize;return c={left:d.cx>e.cx?e.x+(e.cx-d.cx)/2:Math.min(Math.max(e.x,a.x-d.cx/2),e.x+e.cx-d.cx),top:d.cy>e.cy?e.y+(e.cy-d.cy)/2:Math.min(Math.max(e.y,a.y-d.cy/2),e.y+e.cy-d.cy)},c.top=Math.max(0,c.top),c.top-=Math.min(c.top,Math.max(0,c.top+d.cy-this.document.height())),c},_placementCoords:function(a){return this._calculateFinalLocation(a,this._clampPopupWidth())},_createPrerequisites:function(b,c,e){var d,g=this;d={screen:a.Deferred(),
container:a.Deferred()};d.screen.then(function(){d===g._prerequisites&&b()});d.container.then(function(){d===g._prerequisites&&c()});a.when(d.screen,d.container).done(function(){d===g._prerequisites&&(g._prerequisites=null,e())});g._prerequisites=d},_animate:function(b){return this._ui.screen.removeClass(b.classToRemove).addClass(b.screenClassToAdd),b.prerequisites.screen.resolve(),b.transition&&"none"!==b.transition&&(b.applyTransition&&this._applyTransition(b.transition),this._fallbackTransition)?
void this._ui.container.addClass(b.containerClassToAdd).removeClass(b.classToRemove).animationComplete(a.proxy(b.prerequisites.container,"resolve")):(this._ui.container.removeClass(b.classToRemove),void b.prerequisites.container.resolve())},_desiredCoords:function(b){var c,d=null,g=e(this.window),l=b.x,j=b.y;if((b=b.positionTo)&&"origin"!==b)if("window"===b)l=g.cx/2+g.x,j=g.cy/2+g.y;else{try{d=a(b)}catch(m){d=null}d&&(d.filter(":visible"),0===d.length&&(d=null))}return d&&(c=d.offset(),l=c.left+d.outerWidth()/
2,j=c.top+d.outerHeight()/2),("number"!==a.type(l)||isNaN(l))&&(l=g.cx/2+g.x),("number"!==a.type(j)||isNaN(j))&&(j=g.cy/2+g.y),{x:l,y:j}},_reposition:function(a){a={x:a.x,y:a.y,positionTo:a.positionTo};this._trigger("beforeposition",c,a);this._ui.container.offset(this._placementCoords(this._desiredCoords(a)))},reposition:function(a){this._isOpen&&this._reposition(a)},_safelyBlur:function(b){b!==this.window[0]&&"body"!==b.nodeName.toLowerCase()&&a(b).blur()},_openPrerequisitesComplete:function(){var b=
this.element.attr("id"),c=this._ui.container.find(":focusable").first();this._ui.container.addClass("ui-popup-active");this._isOpen=!0;this._resizeScreen();a.contains(this._ui.container[0],this.document[0].activeElement)||this._safelyBlur(this.document[0].activeElement);c.length>0&&(this._ui.focusElement=c);this._ignoreResizeEvents();b&&this.document.find("[aria-haspopup='true'][aria-owns='"+b+"']").attr("aria-expanded",!0);this._trigger("afteropen")},_open:function(b){var b=a.extend({},this.options,
b),c=function(){var a=navigator.userAgent,b=a.match(/AppleWebKit\/([0-9\.]+)/),b=!!b&&b[1],c=a.match(/Android (\d+(?:\.\d+))/),e=!!c&&c[1],a=a.indexOf("Chrome")>-1;return null!==c&&"4.0"===e&&b&&b>534.13&&!a?!0:!1}();this._createPrerequisites(a.noop,a.noop,a.proxy(this,"_openPrerequisitesComplete"));this._currentTransition=b.transition;this._applyTransition(b.transition);this._ui.screen.removeClass("ui-screen-hidden");this._ui.container.removeClass("ui-popup-truncate");this._reposition(b);this._ui.container.removeClass("ui-popup-hidden");
this.options.overlayTheme&&c&&this.element.closest(".ui-page").addClass("ui-popup-open");this._animate({additionalCondition:!0,transition:b.transition,classToRemove:"",screenClassToAdd:"in",containerClassToAdd:"in",applyTransition:!1,prerequisites:this._prerequisites})},_closePrerequisiteScreen:function(){this._ui.screen.removeClass("out").addClass("ui-screen-hidden")},_closePrerequisiteContainer:function(){this._ui.container.removeClass("reverse out").addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style")},
_closePrerequisitesDone:function(){var b=this._ui.container,e=this.element.attr("id");a.mobile.popup.active=c;a(":focus",b[0]).add(b[0]).blur();e&&this.document.find("[aria-haspopup='true'][aria-owns='"+e+"']").attr("aria-expanded",!1);this._trigger("afterclose")},_close:function(b){this._ui.container.removeClass("ui-popup-active");this._page.removeClass("ui-popup-open");this._isOpen=!1;this._createPrerequisites(a.proxy(this,"_closePrerequisiteScreen"),a.proxy(this,"_closePrerequisiteContainer"),
a.proxy(this,"_closePrerequisitesDone"));this._animate({additionalCondition:this._ui.screen.hasClass("in"),transition:b?"none":this._currentTransition,classToRemove:"in",screenClassToAdd:"out",containerClassToAdd:"reverse out",applyTransition:!0,prerequisites:this._prerequisites})},_unenhance:function(){this.options.enhanced||(this._setOptions({theme:a.mobile.popup.prototype.options.theme}),this.element.detach().insertAfter(this._ui.placeholder).removeClass("ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit"),
this._ui.screen.remove(),this._ui.container.remove(),this._ui.placeholder.remove())},_destroy:function(){return a.mobile.popup.active===this?(this.element.one("popupafterclose",a.proxy(this,"_unenhance")),this.close()):this._unenhance(),this},_closePopup:function(c,e){var d,g,l=this.options,j=!1;c&&c.isDefaultPrevented()||a.mobile.popup.active!==this||(b.scrollTo(0,this._scrollTop),c&&"pagebeforechange"===c.type&&e&&(d="string"==typeof e.toPage?e.toPage:e.toPage.jqmData("url"),d=a.mobile.path.parseUrl(d),
g=d.pathname+d.search+d.hash,this._myUrl!==a.mobile.path.makeUrlAbsolute(g)?j=!0:c.preventDefault()),this.window.off(l.closeEvents),this.element.undelegate(l.closeLinkSelector,l.closeLinkEvents),this._close(j))},_bindContainerClose:function(){this.window.on(this.options.closeEvents,a.proxy(this,"_closePopup"))},widget:function(){return this._ui.container},open:function(b){var c,e,d,g,j,m=this,n=this.options;return a.mobile.popup.active||n.disabled?this:(a.mobile.popup.active=this,this._scrollTop=
this.window.scrollTop(),n.history?(j=a.mobile.navigate.history,e=a.mobile.dialogHashKey,d=a.mobile.activePage,g=d?d.hasClass("ui-dialog"):!1,this._myUrl=c=j.getActive().url,c.indexOf(e)>-1&&!g&&j.activeIndex>0?(m._open(b),m._bindContainerClose(),this):(-1!==c.indexOf(e)||g?c=a.mobile.path.parseLocation().hash+e:c+=c.indexOf("#")>-1?e:"#"+e,this.window.one("beforenavigate",function(a){a.preventDefault();m._open(b);m._bindContainerClose()}),this.urlAltered=!0,a.mobile.navigate(c,{role:"dialog"}),this)):
(m._open(b),m._bindContainerClose(),m.element.delegate(n.closeLinkSelector,n.closeLinkEvents,function(a){m.close();a.preventDefault()}),this))},close:function(){return a.mobile.popup.active!==this?this:(this._scrollTop=this.window.scrollTop(),this.options.history&&this.urlAltered?(a.mobile.back(),this.urlAltered=!1):this._closePopup(),this)}});a.mobile.popup.handleLink=function(b){var c,e=a.mobile.path,e=a(e.hashToSelector(e.parseUrl(b.attr("href")).hash)).first();e.length>0&&e.data("mobile-popup")&&
(c=b.offset(),e.popup("open",{x:c.left+b.outerWidth()/2,y:c.top+b.outerHeight()/2,transition:b.jqmData("transition"),positionTo:b.jqmData("position-to")}));setTimeout(function(){b.removeClass(a.mobile.activeBtnClass)},300)};a.mobile.document.on("pagebeforechange",function(b,c){"popup"===c.options.role&&(a.mobile.popup.handleLink(c.options.link),b.preventDefault())})})(c);(function(a,b){var c=function(a,b,c){a=a[c+"All"]().not(".ui-disabled,.ui-state-disabled,.ui-li-divider,.ui-screen-hidden,:jqmData(role='placeholder')").first();
a.length&&(b.blur().attr("tabindex","-1"),a.find("a").first().focus())};a.widget("mobile.selectmenu",a.mobile.selectmenu,{_create:function(){var a=this.options;return a.nativeMenu=a.nativeMenu||this.element.parents(":jqmData(role='popup'),:mobile-popup").length>0,this._super()},_handleSelectFocus:function(){this.element.blur();this.button.focus()},_handleKeydown:function(a){this._super(a);this._handleButtonVclickKeydown(a)},_handleButtonVclickKeydown:function(b){this.options.disabled||this.isOpen||
this.options.nativeMenu||("vclick"===b.type||b.keyCode&&(b.keyCode===a.mobile.keyCode.ENTER||b.keyCode===a.mobile.keyCode.SPACE))&&(this._decideFormat(),"overlay"===this.menuType?this.button.attr("href","#"+this.popupId).attr("data-"+(a.mobile.ns||"")+"rel","popup"):this.button.attr("href","#"+this.dialogId).attr("data-"+(a.mobile.ns||"")+"rel","dialog"),this.isOpen=!0)},_handleListFocus:function(b){var c="focusin"===b.type?{tabindex:"0",event:"vmouseover"}:{tabindex:"-1",event:"vmouseout"};a(b.target).attr("tabindex",
c.tabindex).trigger(c.event)},_handleListKeydown:function(b){var d=a(b.target),h=d.closest("li");switch(b.keyCode){case 38:return c(h,d,"prev"),!1;case 40:return c(h,d,"next"),!1;case 13:case 32:return d.trigger("click"),!1}},_handleMenuPageHide:function(){this._delayedTrigger();this.thisPage.page("bindRemove")},_handleHeaderCloseClick:function(){return"overlay"===this.menuType?(this.close(),!1):void 0},_handleListItemClick:function(b){var c=a(b.target).closest("li"),e=this.select[0].selectedIndex,
d=a.mobile.getAttribute(c,"option-index"),g=this._selectOptions().eq(d)[0];g.selected=this.isMultiple?!g.selected:!0;this.isMultiple&&c.find("a").toggleClass("ui-checkbox-on",g.selected).toggleClass("ui-checkbox-off",!g.selected);this.isMultiple||e===d||(this._triggerChange=!0);this.isMultiple?(this.select.trigger("change"),this.list.find("li:not(.ui-li-divider)").eq(d).find("a").first().focus()):this.close();b.preventDefault()},build:function(){var c,e,d,k,l,j,m,n,o,q,p,u,s,r,v,x,t,w=this.options;
return w.nativeMenu?this._super():(c=this.selectId,e=c+"-listbox",d=c+"-dialog",k=this.label,l=this.element.closest(".ui-page"),j=this.element[0].multiple,m=c+"-menu",n=w.theme?" data-"+a.mobile.ns+"theme='"+w.theme+"'":"",o=w.overlayTheme||w.theme||null,q=o?" data-"+a.mobile.ns+"overlay-theme='"+o+"'":"",p=w.dividerTheme&&j?" data-"+a.mobile.ns+"divider-theme='"+w.dividerTheme+"'":"",u=a("<div data-"+a.mobile.ns+"role='dialog' class='ui-selectmenu' id='"+d+"'"+n+q+"><div data-"+a.mobile.ns+"role='header'><div class='ui-title'></div></div><div data-"+
a.mobile.ns+"role='content'></div></div>"),s=a("<div"+n+q+" id='"+e+"' class='ui-selectmenu'></div>").insertAfter(this.select).popup(),r=a("<ul class='ui-selectmenu-list' id='"+m+"' role='listbox' aria-labelledby='"+this.buttonId+"'"+n+p+"></ul>").appendTo(s),v=a("<div class='ui-header ui-bar-"+(w.theme?w.theme:"inherit")+"'></div>").prependTo(s),x=a("<h1 class='ui-title'></h1>").appendTo(v),this.isMultiple&&(t=a("<a>",{role:"button",text:w.closeText,href:"#","class":"ui-btn ui-corner-all ui-btn-left ui-btn-icon-notext ui-icon-delete"}).appendTo(v)),
a.extend(this,{selectId:c,menuId:m,popupId:e,dialogId:d,thisPage:l,menuPage:u,label:k,isMultiple:j,theme:w.theme,listbox:s,list:r,header:v,headerTitle:x,headerClose:t,menuPageContent:void 0,menuPageClose:void 0,placeholder:""}),this.refresh(),this._origTabIndex===b&&(this._origTabIndex=null===this.select[0].getAttribute("tabindex")?!1:this.select.attr("tabindex")),this.select.attr("tabindex","-1"),this._on(this.select,{focus:"_handleSelectFocus"}),this._on(this.button,{vclick:"_handleButtonVclickKeydown"}),
this.list.attr("role","listbox"),this._on(this.list,{focusin:"_handleListFocus",focusout:"_handleListFocus",keydown:"_handleListKeydown","click li:not(.ui-disabled,.ui-state-disabled,.ui-li-divider)":"_handleListItemClick"}),this._on(this.menuPage,{pagehide:"_handleMenuPageHide"}),this._on(this.listbox,{popupafterclose:"_popupClosed"}),this.isMultiple&&this._on(this.headerClose,{click:"_handleHeaderCloseClick"}),this)},_popupClosed:function(){this.close();this._delayedTrigger()},_delayedTrigger:function(){this._triggerChange&&
this.element.trigger("change");this._triggerChange=!1},_isRebuildRequired:function(){var a=this.list.find("li");return this._selectOptions().not(".ui-screen-hidden").text()!==a.text()},selected:function(){return this._selectOptions().filter(":selected:not( :jqmData(placeholder='true') )")},refresh:function(b){var c,e;return this.options.nativeMenu?this._super(b):(c=this,(b||this._isRebuildRequired())&&c._buildList(),e=this.selectedIndices(),c.setButtonText(),c.setButtonCount(),void c.list.find("li:not(.ui-li-divider)").find("a").removeClass(a.mobile.activeBtnClass).end().attr("aria-selected",
!1).each(function(b){var d=a(this);a.inArray(b,e)>-1?(d.attr("aria-selected",!0),c.isMultiple?d.find("a").removeClass("ui-checkbox-off").addClass("ui-checkbox-on"):d.hasClass("ui-screen-hidden")?d.next().find("a").addClass(a.mobile.activeBtnClass):d.find("a").addClass(a.mobile.activeBtnClass)):c.isMultiple&&d.find("a").removeClass("ui-checkbox-on").addClass("ui-checkbox-off")}))},close:function(){if(!this.options.disabled&&this.isOpen)"page"===this.menuType?(this.menuPage.dialog("close"),this.list.appendTo(this.listbox)):
this.listbox.popup("close"),this._focusButton(),this.isOpen=!1},open:function(){this.button.click()},_focusMenuItem:function(){var b=this.list.find("a."+a.mobile.activeBtnClass);0===b.length&&(b=this.list.find("li:not(.ui-disabled,.ui-state-disabled,.ui-li-divider,.ui-screen-hidden,:jqmData(role='placeholder')) a.ui-btn"));b.first().focus()},_decideFormat:function(){var b=this.window,c=this.list.parent().outerHeight(),e=b.scrollTop(),d=this.button.offset().top,b=b.height();c>b-80||!a.support.scrollTop?
(this.menuPage.appendTo(a.mobile.pageContainer).page(),this.menuPageContent=this.menuPage.find(".ui-content"),this.menuPageClose=this.menuPage.find(".ui-header a"),this.thisPage.unbind("pagehide.remove"),0===e&&d>b&&this.thisPage.one("pagehide",function(){a(this).jqmData("lastScroll",d)}),this.menuPage.one({pageshow:a.proxy(this,"_focusMenuItem"),pagehide:a.proxy(this,"close")}),this.menuType="page",this.menuPageContent.append(this.list),this.menuPage.find("div .ui-title").text(this.label.getEncodedText()||
this.placeholder)):(this.menuType="overlay",this.listbox.one({popupafteropen:a.proxy(this,"_focusMenuItem")}))},_buildList:function(){var b,c,e,g,l,j,m,n,o,q,p,u,s,r,v=this.options,x=this.placeholder,t=!0;b="data-"+a.mobile.ns;var w=b+"option-index",y=b+"icon",z=b+"role",A=b+"placeholder",C=d.createDocumentFragment(),B=!1;this.list.empty().filter(".ui-listview").listview("destroy");b=this._selectOptions();c=b.length;e=this.select[0];for(l=0;c>l;l++,B=!1)j=b[l],m=a(j),m.hasClass("ui-screen-hidden")||
(n=j.parentNode,p=[],o=m.text(),q=d.createElement("a"),q.setAttribute("href","#"),q.appendChild(d.createTextNode(o)),n!==e&&"optgroup"===n.nodeName.toLowerCase()&&(u=n.getAttribute("label"),u!==g&&(s=d.createElement("li"),s.setAttribute(z,"list-divider"),s.setAttribute("role","option"),s.setAttribute("tabindex","-1"),s.appendChild(d.createTextNode(u)),C.appendChild(s),g=u)),!t||j.getAttribute("value")&&0!==o.length&&!m.jqmData("placeholder")||(t=!1,B=!0,null===j.getAttribute(A)&&(this._removePlaceholderAttr=
!0),j.setAttribute(A,!0),v.hidePlaceholderMenuItems&&p.push("ui-screen-hidden"),x!==o&&(x=this.placeholder=o)),r=d.createElement("li"),j.disabled&&(p.push("ui-state-disabled"),r.setAttribute("aria-disabled",!0)),r.setAttribute(w,l),r.setAttribute(y,"false"),B&&r.setAttribute(A,!0),r.className=p.join(" "),r.setAttribute("role","option"),q.setAttribute("tabindex","-1"),this.isMultiple&&a(q).addClass("ui-btn ui-checkbox-off ui-btn-icon-right"),r.appendChild(q),C.appendChild(r));this.list[0].appendChild(C);
this.isMultiple||x.length?this.headerTitle.text(this.placeholder):this.header.addClass("ui-screen-hidden");this.list.listview()},_button:function(){return this.options.nativeMenu?this._super():a("<a>",{href:"#",role:"button",id:this.buttonId,"aria-haspopup":"true","aria-owns":this.menuId})},_destroy:function(){this.options.nativeMenu||(this.close(),this._origTabIndex!==b&&(this._origTabIndex!==!1?this.select.attr("tabindex",this._origTabIndex):this.select.removeAttr("tabindex")),this._removePlaceholderAttr&&
this._selectOptions().removeAttr("data-"+a.mobile.ns+"placeholder"),this.listbox.remove(),this.menuPage.remove());this._super()}})})(c);(function(a,b){function c(a){return"-"+a.toLowerCase()}var d={"ui-shadow":"shadow","ui-corner-all":"corners","ui-btn-inline":"inline","ui-shadow-icon":"iconshadow","ui-mini":"mini"},i=function(){var c=a.mobile.getAttribute.apply(this,arguments);return null==c?b:c},h=/[A-Z]/g;a.fn.buttonMarkup=function(k,l){var e;var j,m,n,o,q,p=a.fn.buttonMarkup.defaults;for(j=0;j<
this.length;j++){n=this[j];var u;if(l)u={alreadyEnhanced:!1,unknownClasses:[]};else{u=n.className;var s=o=void 0,r=void 0,v=!1,x=!0,t={icon:"",inline:!1,shadow:!1,corners:!1,iconshadow:!1,mini:!1},w=[];u=u.split(" ");for(o=0;o<u.length;o++)r=!0,s=d[u[o]],s!==b?(r=!1,t[s]=!0):0===u[o].indexOf("ui-btn-icon-")?(r=!1,x=!1,t.iconpos=u[o].substring(12)):0===u[o].indexOf("ui-icon-")?(r=!1,t.icon=u[o].substring(8)):0===u[o].indexOf("ui-btn-")&&8===u[o].length?(r=!1,t.theme=u[o].substring(7)):"ui-btn"===u[o]&&
(r=!1,v=!0),r&&w.push(u[o]);u=(x&&(t.icon=""),{options:t,unknownClasses:w,alreadyEnhanced:v})}if(m=u,o=a.extend({},m.alreadyEnhanced?m.options:{},k),!m.alreadyEnhanced)for(q in p)o[q]===b&&(o[q]=i(n,q.replace(h,c)));u=n;o=a.extend({},p,o);s=(s=m.unknownClasses)?s:[];e=(s.push("ui-btn"),o.theme&&s.push("ui-btn-"+o.theme),o.icon&&(s=s.concat(["ui-icon-"+o.icon,"ui-btn-icon-"+o.iconpos]),o.iconshadow&&s.push("ui-shadow-icon")),o.inline&&s.push("ui-btn-inline"),o.shadow&&s.push("ui-shadow"),o.corners&&
s.push("ui-corner-all"),o.mini&&s.push("ui-mini"),s),o=e;u.className=o.join.call(o," ");"button"!==n.tagName.toLowerCase()&&n.setAttribute("role","button")}return this};a.fn.buttonMarkup.defaults={icon:"",iconpos:"left",theme:null,inline:!1,shadow:!0,corners:!0,iconshadow:!1,mini:!1};a.extend(a.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a, button:not(:jqmData(role='navbar') button)"})})(c);(function(a,b){a.widget("mobile.controlgroup",
a.extend({options:{enhanced:!1,theme:null,shadow:!1,corners:!0,excludeInvisible:!0,type:"vertical",mini:!1},_create:function(){var b=this.element,c=this.options,d=a.mobile.page.prototype.keepNativeSelector();a.fn.buttonMarkup&&this.element.find(a.fn.buttonMarkup.initSelector).not(d).buttonMarkup();a.each(this._childWidgets,a.proxy(function(b,c){a.mobile[c]&&this.element.find(a.mobile[c].initSelector).not(d)[c]()},this));a.extend(this,{_ui:null,_initialRefresh:!0});this._ui=c.enhanced?{groupLegend:b.children(".ui-controlgroup-label").children(),
childWrapper:b.children(".ui-controlgroup-controls")}:this._enhance()},_childWidgets:["checkboxradio","selectmenu","button"],_themeClassFromOption:function(a){return a?"none"===a?"":"ui-group-theme-"+a:""},_enhance:function(){var b=this.element,c=this.options,c={groupLegend:b.children("legend"),childWrapper:b.addClass("ui-controlgroup ui-controlgroup-"+("horizontal"===c.type?"horizontal":"vertical")+" "+this._themeClassFromOption(c.theme)+" "+(c.corners?"ui-corner-all ":"")+(c.mini?"ui-mini ":"")).wrapInner("<div class='ui-controlgroup-controls "+
(c.shadow===!0?"ui-shadow":"")+"'></div>").children()};return c.groupLegend.length>0&&a("<div role='heading' class='ui-controlgroup-label'></div>").append(c.groupLegend).prependTo(b),c},_init:function(){this.refresh()},_setOptions:function(a){var c,d,h=this.element;return a.type!==b&&(h.removeClass("ui-controlgroup-horizontal ui-controlgroup-vertical").addClass("ui-controlgroup-"+("horizontal"===a.type?"horizontal":"vertical")),c=!0),a.theme!==b&&h.removeClass(this._themeClassFromOption(this.options.theme)).addClass(this._themeClassFromOption(a.theme)),
a.corners!==b&&h.toggleClass("ui-corner-all",a.corners),a.mini!==b&&h.toggleClass("ui-mini",a.mini),a.shadow!==b&&this._ui.childWrapper.toggleClass("ui-shadow",a.shadow),a.excludeInvisible!==b&&(this.options.excludeInvisible=a.excludeInvisible,c=!0),d=this._super(a),c&&this.refresh(),d},container:function(){return this._ui.childWrapper},refresh:function(){var b=this.container(),c=b.find(".ui-btn").not(".ui-slider-handle"),d=this._initialRefresh;a.mobile.checkboxradio&&b.find(":mobile-checkboxradio").checkboxradio("refresh");
this._addFirstLastClasses(c,this.options.excludeInvisible?this._getVisibles(c,d):c,d);this._initialRefresh=!1},_destroy:function(){var a,b,c=this.options;return c.enhanced?this:(a=this._ui,b=this.element.removeClass("ui-controlgroup ui-controlgroup-horizontal ui-controlgroup-vertical ui-corner-all ui-mini "+this._themeClassFromOption(c.theme)).find(".ui-btn").not(".ui-slider-handle"),this._removeFirstLastClasses(b),a.groupLegend.unwrap(),void a.childWrapper.children().unwrap())}},a.mobile.behaviors.addFirstLastClasses))})(c);
(function(a,b){a.widget("mobile.toolbar",{initSelector:":jqmData(role='footer'), :jqmData(role='header')",options:{theme:null,addBackBtn:!1,backBtnTheme:null,backBtnText:"Back"},_create:function(){var b=this.element.is(":jqmData(role='header')")?"header":"footer",c=this.element.closest(".ui-page");0===c.length&&(c=!1,this._on(this.document,{pageshow:"refresh"}));a.extend(this,{role:b,page:c,leftbtn:void 0,rightbtn:void 0});this.element.attr("role","header"===b?"banner":"contentinfo").addClass("ui-"+
b);this.refresh();this._setOptions(this.options)},_setOptions:function(a){if(a.addBackBtn!==b&&this._updateBackButton(),null!=a.backBtnTheme&&this.element.find(".ui-toolbar-back-btn").addClass("ui-btn ui-btn-"+a.backBtnTheme),a.backBtnText!==b&&this.element.find(".ui-toolbar-back-btn .ui-btn-text").text(a.backBtnText),a.theme!==b){var c=a.theme?a.theme:"inherit";this.element.removeClass("ui-bar-"+(this.options.theme?this.options.theme:"inherit")).addClass("ui-bar-"+c)}this._super(a)},refresh:function(){"header"===
this.role&&this._addHeaderButtonClasses();this.page||(this._setRelative(),"footer"===this.role?this.element.appendTo("body"):"header"===this.role&&this._updateBackButton());this._addHeadingClasses();this._btnMarkup()},_setRelative:function(){a("[data-"+a.mobile.ns+"role='page']").css({position:"relative"})},_btnMarkup:function(){this.element.children("a").filter(":not([data-"+a.mobile.ns+"role='none'])").attr("data-"+a.mobile.ns+"role","button");this.element.trigger("create")},_addHeaderButtonClasses:function(){var a=
this.element.children("a, button");this.leftbtn=a.hasClass("ui-btn-left")&&!a.hasClass("ui-toolbar-back-btn");this.rightbtn=a.hasClass("ui-btn-right");this.leftbtn=this.leftbtn||a.eq(0).not(".ui-btn-right,.ui-toolbar-back-btn").addClass("ui-btn-left").length;this.rightbtn=this.rightbtn||a.eq(1).addClass("ui-btn-right").length},_updateBackButton:function(){var b,c=this.options,d=c.backBtnTheme||c.theme;b=this._backButton=this._backButton||{};this.options.addBackBtn&&"header"===this.role&&a(".ui-page").length>
1&&(this.page?this.page[0].getAttribute("data-"+a.mobile.ns+"url")!==a.mobile.path.stripHash(location.hash):a.mobile.navigate&&a.mobile.navigate.history&&a.mobile.navigate.history.activeIndex>0)&&!this.leftbtn?b.attached||(this.backButton=b.element=(b.element||a("<a role='button' href='javascript:void(0);' class='ui-btn ui-corner-all ui-shadow ui-btn-left "+(d?"ui-btn-"+d+" ":"")+"ui-toolbar-back-btn ui-icon-carat-l ui-btn-icon-left' data-"+a.mobile.ns+"rel='back'>"+c.backBtnText+"</a>")).prependTo(this.element),
b.attached=!0):b.element&&(b.element.detach(),b.attached=!1)},_addHeadingClasses:function(){this.element.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({role:"heading","aria-level":"1"})},_destroy:function(){this.element.children("h1, h2, h3, h4, h5, h6").removeClass("ui-title").removeAttr("role").removeAttr("aria-level");"header"===this.role&&(this.element.children("a, button").removeClass("ui-btn-left ui-btn-right ui-btn ui-shadow ui-corner-all"),this.backButton&&this.backButton.remove());
this.element.removeClass("ui-bar-"+(this.options.theme?this.options.theme:"inherit"));this.element.removeClass("ui-"+this.role).removeAttr("role")}})})(c);(function(a,b){a.widget("mobile.toolbar",a.mobile.toolbar,{options:{position:null,visibleOnPageShow:!0,disablePageZoom:!0,transition:"slide",fullscreen:!1,tapToggle:!0,tapToggleBlacklist:"a, button, input, select, textarea, .ui-header-fixed, .ui-footer-fixed, .ui-flipswitch, .ui-popup, .ui-panel, .ui-panel-dismiss-open",hideDuringFocus:"input, textarea, select",
updatePagePadding:!0,trackPersistentToolbars:!0,supportBlacklist:function(){return!a.support.fixedPosition}},_create:function(){this._super();this.pagecontainer=a(":mobile-pagecontainer");"fixed"!==this.options.position||this.options.supportBlacklist()||this._makeFixed()},_makeFixed:function(){this.element.addClass("ui-"+this.role+"-fixed");this.updatePagePadding();this._addTransitionClass();this._bindPageEvents();this._bindToggleHandlers()},_setOptions:function(c){if("fixed"===c.position&&"fixed"!==
this.options.position&&this._makeFixed(),"fixed"===this.options.position&&!this.options.supportBlacklist()){var d=this.page?this.page:a(".ui-page-active").length>0?a(".ui-page-active"):a(".ui-page").eq(0);c.fullscreen!==b&&(c.fullscreen?(this.element.addClass("ui-"+this.role+"-fullscreen"),d.addClass("ui-page-"+this.role+"-fullscreen")):(this.element.removeClass("ui-"+this.role+"-fullscreen"),d.removeClass("ui-page-"+this.role+"-fullscreen").addClass("ui-page-"+this.role+"-fixed")))}this._super(c)},
_addTransitionClass:function(){var a=this.options.transition;a&&"none"!==a&&("slide"===a&&(a=this.element.hasClass("ui-header")?"slidedown":"slideup"),this.element.addClass(a))},_bindPageEvents:function(){this._on(this.page?this.element.closest(".ui-page"):this.document,{pagebeforeshow:"_handlePageBeforeShow",webkitAnimationStart:"_handleAnimationStart",animationstart:"_handleAnimationStart",updatelayout:"_handleAnimationStart",pageshow:"_handlePageShow",pagebeforehide:"_handlePageBeforeHide"})},
_handlePageBeforeShow:function(){var b=this.options;b.disablePageZoom&&a.mobile.zoom.disable(!0);b.visibleOnPageShow||this.hide(!0)},_handleAnimationStart:function(){this.options.updatePagePadding&&this.updatePagePadding(this.page?this.page:".ui-page-active")},_handlePageShow:function(){this.updatePagePadding(this.page?this.page:".ui-page-active");this.options.updatePagePadding&&this._on(this.window,{throttledresize:"updatePagePadding"})},_handlePageBeforeHide:function(b,c){var d,h,g,l,j=this.options;
j.disablePageZoom&&a.mobile.zoom.enable(!0);j.updatePagePadding&&this._off(this.window,"throttledresize");j.trackPersistentToolbars&&(d=a(".ui-footer-fixed:jqmData(id)",this.page),h=a(".ui-header-fixed:jqmData(id)",this.page),g=d.length&&c.nextPage&&a(".ui-footer-fixed:jqmData(id='"+d.jqmData("id")+"')",c.nextPage)||a(),l=h.length&&c.nextPage&&a(".ui-header-fixed:jqmData(id='"+h.jqmData("id")+"')",c.nextPage)||a(),(g.length||l.length)&&(g.add(l).appendTo(a.mobile.pageContainer),c.nextPage.one("pageshow",
function(){l.prependTo(this);g.appendTo(this)})))},_visible:!0,updatePagePadding:function(c){var d=this.element,i="header"===this.role,h=parseFloat(d.css(i?"top":"bottom"));this.options.fullscreen||(c&&c.type===b&&c||this.page||d.closest(".ui-page"),c=this.page?this.page:".ui-page-active",a(c).css("padding-"+(i?"top":"bottom"),d.outerHeight()+h))},_useTransition:function(b){var c=this.element,d=this.window.scrollTop(),h=c.height(),c=this.page?c.closest(".ui-page").height():a(".ui-page-active").height(),
g=a.mobile.getScreenHeight();return!b&&(this.options.transition&&"none"!==this.options.transition&&("header"===this.role&&!this.options.fullscreen&&d>h||"footer"===this.role&&!this.options.fullscreen&&c-h>d+g)||this.options.fullscreen)},show:function(a){var b=this.element;this._useTransition(a)?b.removeClass("out ui-fixed-hidden").addClass("in").animationComplete(function(){b.removeClass("in")}):b.removeClass("ui-fixed-hidden");this._visible=!0},hide:function(a){var b=this.element,c="out"+("slide"===
this.options.transition?" reverse":"");this._useTransition(a)?b.addClass(c).removeClass("in").animationComplete(function(){b.addClass("ui-fixed-hidden").removeClass(c)}):b.addClass("ui-fixed-hidden").removeClass(c);this._visible=!1},toggle:function(){this[this._visible?"hide":"show"]()},_bindToggleHandlers:function(){var b,c,d=this,h=d.options,g=!0;(this.page?this.page:a(".ui-page")).bind("vclick",function(b){h.tapToggle&&!a(b.target).closest(h.tapToggleBlacklist).length&&d.toggle()}).bind("focusin focusout",
function(l){screen.width<1025&&a(l.target).is(h.hideDuringFocus)&&!a(l.target).closest(".ui-header-fixed, .ui-footer-fixed").length&&("focusout"!==l.type||g?"focusin"===l.type&&g&&(clearTimeout(b),g=!1,c=setTimeout(function(){d.hide()},0)):(g=!0,clearTimeout(c),b=setTimeout(function(){d.show()},0)))})},_setRelative:function(){"fixed"!==this.options.position&&a("[data-"+a.mobile.ns+"role='page']").css({position:"relative"})},_destroy:function(){var b,c,d,h,g=this.pagecontainer.pagecontainer("getActivePage");
this._super();"fixed"===this.options.position&&(c=a("body>.ui-"+this.role+"-fixed").add(g.find(".ui-"+this.options.role+"-fixed")).not(this.element).length>0,h=a("body>.ui-"+this.role+"-fixed").add(g.find(".ui-"+this.options.role+"-fullscreen")).not(this.element).length>0,this.element.removeClass("ui-header-fixed ui-footer-fixed ui-header-fullscreen in out ui-footer-fullscreen fade slidedown slideup ui-fixed-hidden"),h||(b="ui-page-"+this.role+"-fullscreen"),c||(d="header"===this.role,b+=" ui-page-"+
this.role+"-fixed",g.css("padding-"+(d?"top":"bottom"),"")),g.removeClass(b))}})})(c);(function(a){a.widget("mobile.toolbar",a.mobile.toolbar,{_makeFixed:function(){this._super();this._workarounds()},_workarounds:function(){var a=navigator.userAgent,b=navigator.platform,c=a.match(/AppleWebKit\/([0-9]+)/),c=!!c&&c[1],d=null;if(b.indexOf("iPhone")>-1||b.indexOf("iPad")>-1||b.indexOf("iPod")>-1)d="ios";else{if(!(a.indexOf("Android")>-1))return;d="android"}"ios"===d?this._bindScrollWorkaround():"android"===
d&&c&&534>c&&(this._bindScrollWorkaround(),this._bindListThumbWorkaround())},_viewportOffset:function(){var a=this.element,b=a.hasClass("ui-header"),c=Math.abs(a.offset().top-this.window.scrollTop());return b||(c=Math.round(c-this.window.height()+a.outerHeight())-60),c},_bindScrollWorkaround:function(){var a=this;this._on(this.window,{scrollstop:function(){a._viewportOffset()>2&&a._visible&&a._triggerRedraw()}})},_bindListThumbWorkaround:function(){this.element.closest(".ui-page").addClass("ui-android-2x-fixed")},
_triggerRedraw:function(){var b=parseFloat(a(".ui-page-active").css("padding-bottom"));a(".ui-page-active").css("padding-bottom",b+1+"px");setTimeout(function(){a(".ui-page-active").css("padding-bottom",b+"px")},0)},destroy:function(){this._super();this.element.closest(".ui-page-active").removeClass("ui-android-2x-fix")}})})(c);(function(a,b){var c=a.mobile.browser.oldIE&&a.mobile.browser.oldIE<=8,d=a("<div class='ui-popup-arrow-guide'></div><div class='ui-popup-arrow-container"+(c?" ie":"")+"'><div class='ui-popup-arrow'></div></div>");
a.widget("mobile.popup",a.mobile.popup,{options:{arrow:""},_create:function(){var a=this._super();return this.options.arrow&&(this._ui.arrow=this._addArrow()),a},_addArrow:function(){var a,b=this.options,c,e=d.clone();c=e.eq(0);var e=e.eq(1),g=e.children();c={arEls:e.add(c),gd:c,ct:e,ar:g};return a=this._themeClassFromOption("ui-body-",b.theme),c.ar.addClass(a+(b.shadow?" ui-overlay-shadow":"")),c.arEls.hide().appendTo(this.element),c},_unenhance:function(){var a=this._ui.arrow;return a&&a.arEls.remove(),
this._super()},_tryAnArrow:function(a,b,c,d,e){var f,g,o,q={},p={};return d.arFull[a.dimKey]>d.guideDims[a.dimKey]?e:(q[a.fst]=c[a.fst]+(d.arHalf[a.oDimKey]+d.menuHalf[a.oDimKey])*a.offsetFactor-d.contentBox[a.fst]+(d.clampInfo.menuSize[a.oDimKey]-d.contentBox[a.oDimKey])*a.arrowOffsetFactor,q[a.snd]=c[a.snd],f=d.result||this._calculateFinalLocation(q,d.clampInfo),g={x:f.left,y:f.top},p[a.fst]=g[a.fst]+d.contentBox[a.fst]+a.tipOffset,p[a.snd]=Math.max(f[a.prop]+d.guideOffset[a.prop]+d.arHalf[a.dimKey],
Math.min(f[a.prop]+d.guideOffset[a.prop]+d.guideDims[a.dimKey]-d.arHalf[a.dimKey],c[a.snd])),o=Math.abs(c.x-p.x)+Math.abs(c.y-p.y),(!e||o<e.diff)&&(p[a.snd]-=d.arHalf[a.dimKey]+f[a.prop]+d.contentBox[a.snd],e={dir:b,diff:o,result:f,posProp:a.prop,posVal:p[a.snd]}),e)},_getPlacementState:function(a){var b,c,d=this._ui.arrow,a={clampInfo:this._clampPopupWidth(!a),arFull:{cx:d.ct.width(),cy:d.ct.height()},guideDims:{cx:d.gd.width(),cy:d.gd.height()},guideOffset:d.gd.offset()};return b=this.element.offset(),
d.gd.css({left:0,top:0,right:0,bottom:0}),c=d.gd.offset(),a.contentBox={x:c.left-b.left,y:c.top-b.top,cx:d.gd.width(),cy:d.gd.height()},d.gd.removeAttr("style"),a.guideOffset={left:a.guideOffset.left-b.left,top:a.guideOffset.top-b.top},a.arHalf={cx:a.arFull.cx/2,cy:a.arFull.cy/2},a.menuHalf={cx:a.clampInfo.menuSize.cx/2,cy:a.clampInfo.menuSize.cy/2},a},_placementCoords:function(b){var d,f,g,j=this.options.arrow,m=this._ui.arrow;return m?(m.arEls.show(),d=this._getPlacementState(!0),g={l:{fst:"x",
snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:1,tipOffset:-d.arHalf.cx,arrowOffsetFactor:0},r:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:-1,tipOffset:d.arHalf.cx+d.contentBox.cx,arrowOffsetFactor:1},b:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:-1,tipOffset:d.arHalf.cy+d.contentBox.cy,arrowOffsetFactor:1},t:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:1,tipOffset:-d.arHalf.cy,arrowOffsetFactor:0}},a.each((j===!0?"l,t,r,b":
j).split(","),a.proxy(function(a,c){f=this._tryAnArrow(g[c],c,b,d,f)},this)),f?(m.ct.removeClass("ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b").addClass("ui-popup-arrow-"+f.dir).removeAttr("style").css(f.posProp,f.posVal).show(),c||(this.element.offset(),m.ct.offset()),f.result):(m.arEls.hide(),this._super(b))):this._super(b)},_setOptions:function(a){var c,d=this.options.theme,e=this._ui.arrow,f=this._super(a);if(a.arrow!==b){if(!e&&a.arrow)return void(this._ui.arrow=this._addArrow());
e&&!a.arrow&&(e.arEls.remove(),this._ui.arrow=null)}return e=this._ui.arrow,e&&(a.theme!==b&&(d=this._themeClassFromOption("ui-body-",d),c=this._themeClassFromOption("ui-body-",a.theme),e.ar.removeClass(d).addClass(c)),a.shadow!==b&&e.ar.toggleClass("ui-overlay-shadow",a.shadow)),f},_destroy:function(){var a=this._ui.arrow;return a&&a.arEls.remove(),this._super()}})})(c);(function(a,c){a.widget("mobile.panel",{options:{classes:{panel:"ui-panel",panelOpen:"ui-panel-open",panelClosed:"ui-panel-closed",
panelFixed:"ui-panel-fixed",panelInner:"ui-panel-inner",modal:"ui-panel-dismiss",modalOpen:"ui-panel-dismiss-open",pageContainer:"ui-panel-page-container",pageWrapper:"ui-panel-wrapper",pageFixedToolbar:"ui-panel-fixed-toolbar",pageContentPrefix:"ui-panel-page-content",animate:"ui-panel-animate"},animate:!0,theme:null,position:"left",dismissible:!0,display:"reveal",swipeClose:!0,positionFixed:!1},_closeLink:null,_parentPage:null,_page:null,_modal:null,_panelInner:null,_wrapper:null,_fixedToolbars:null,
_create:function(){var b=this.element,c=b.closest(".ui-page, :jqmData(role='page')");a.extend(this,{_closeLink:b.find(":jqmData(rel='close')"),_parentPage:c.length>0?c:!1,_openedPage:null,_page:this._getPage,_panelInner:this._getPanelInner(),_fixedToolbars:this._getFixedToolbars});"overlay"!==this.options.display&&this._getWrapper();this._addPanelClasses();a.support.cssTransform3d&&this.options.animate&&this.element.addClass(this.options.classes.animate);this._bindUpdateLayout();this._bindCloseEvents();
this._bindLinkListeners();this._bindPageEvents();this.options.dismissible&&this._createModal();this._bindSwipeEvents()},_getPanelInner:function(){var a=this.element.find("."+this.options.classes.panelInner);return 0===a.length&&(a=this.element.children().wrapAll("<div class='"+this.options.classes.panelInner+"' />").parent()),a},_createModal:function(){var b=this,c=b._parentPage?b._parentPage.parent():b.element.parent();b._modal=a("<div class='"+b.options.classes.modal+"'></div>").on("mousedown",
function(){b.close()}).appendTo(c)},_getPage:function(){return this._openedPage||this._parentPage||a("."+a.mobile.activePageClass)},_getWrapper:function(){var a=this._page().find("."+this.options.classes.pageWrapper);0===a.length&&(a=this._page().children(".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)").wrapAll("<div class='"+this.options.classes.pageWrapper+"'></div>").parent());this._wrapper=a},_getFixedToolbars:function(){var b=a("body").children(".ui-header-fixed, .ui-footer-fixed"),
c=this._page().find(".ui-header-fixed, .ui-footer-fixed");return b.add(c).addClass(this.options.classes.pageFixedToolbar)},_getPosDisplayClasses:function(a){return a+"-position-"+this.options.position+" "+a+"-display-"+this.options.display},_getPanelClasses:function(){var a=this.options.classes.panel+" "+this._getPosDisplayClasses(this.options.classes.panel)+" "+this.options.classes.panelClosed+" ui-body-"+(this.options.theme?this.options.theme:"inherit");return this.options.positionFixed&&(a+=" "+
this.options.classes.panelFixed),a},_addPanelClasses:function(){this.element.addClass(this._getPanelClasses())},_handleCloseClick:function(a){a.isDefaultPrevented()||this.close()},_bindCloseEvents:function(){this._on(this._closeLink,{click:"_handleCloseClick"});this._on({"click a:jqmData(ajax='false')":"_handleCloseClick"})},_positionPanel:function(b){var c=this._panelInner.outerHeight(),d=c>a.mobile.getScreenHeight();d||!this.options.positionFixed?(d&&(this._unfixPanel(),a.mobile.resetActivePageHeight(c)),
b&&this.window[0].scrollTo(0,a.mobile.defaultHomeScroll)):this._fixPanel()},_bindFixListener:function(){this._on(a(b),{throttledresize:"_positionPanel"})},_unbindFixListener:function(){this._off(a(b),"throttledresize")},_unfixPanel:function(){this.options.positionFixed&&a.support.fixedPosition&&this.element.removeClass(this.options.classes.panelFixed)},_fixPanel:function(){this.options.positionFixed&&a.support.fixedPosition&&this.element.addClass(this.options.classes.panelFixed)},_bindUpdateLayout:function(){var a=
this;a.element.on("updatelayout",function(){a._open&&a._positionPanel()})},_bindLinkListeners:function(){this._on("body",{"click a":"_handleClick"})},_handleClick:function(b){var d,i=this.element.attr("id");b.currentTarget.href.split("#")[1]===i&&i!==c&&(b.preventDefault(),d=a(b.target),d.hasClass("ui-btn")&&(d.addClass(a.mobile.activeBtnClass),this.element.one("panelopen panelclose",function(){d.removeClass(a.mobile.activeBtnClass)})),this.toggle())},_bindSwipeEvents:function(){var a=this,b=a._modal?
a.element.add(a._modal):a.element;a.options.swipeClose&&("left"===a.options.position?b.on("swipeleft.panel",function(){a.close()}):b.on("swiperight.panel",function(){a.close()}))},_bindPageEvents:function(){var a=this;this.document.on("panelbeforeopen",function(b){a._open&&b.target!==a.element[0]&&a.close()}).on("keyup.panel",function(b){27===b.keyCode&&a._open&&a.close()});this._parentPage||"overlay"===this.options.display||this._on(this.document,{pageshow:function(){this._openedPage=null;this._getWrapper()}});
a._parentPage?this.document.on("pagehide",":jqmData(role='page')",function(){a._open&&a.close(!0)}):this.document.on("pagebeforehide",function(){a._open&&a.close(!0)})},_open:!1,_pageContentOpenClasses:null,_modalOpenClasses:null,open:function(b){if(!this._open){var c=this,d=c.options,h=function(){c._off(c.document,"panelclose");c._page().jqmData("panel","open");a.support.cssTransform3d&&d.animate&&"overlay"!==d.display&&(c._wrapper.addClass(d.classes.animate),c._fixedToolbars().addClass(d.classes.animate));
!b&&a.support.cssTransform3d&&d.animate?(c._wrapper||c.element).animationComplete(g,"transition"):setTimeout(g,0);d.theme&&"overlay"!==d.display&&c._page().parent().addClass(d.classes.pageContainer+"-themed "+d.classes.pageContainer+"-"+d.theme);c.element.removeClass(d.classes.panelClosed).addClass(d.classes.panelOpen);c._positionPanel(!0);c._pageContentOpenClasses=c._getPosDisplayClasses(d.classes.pageContentPrefix);"overlay"!==d.display&&(c._page().parent().addClass(d.classes.pageContainer),c._wrapper.addClass(c._pageContentOpenClasses),
c._fixedToolbars().addClass(c._pageContentOpenClasses));c._modalOpenClasses=c._getPosDisplayClasses(d.classes.modal)+" "+d.classes.modalOpen;c._modal&&c._modal.addClass(c._modalOpenClasses).height(Math.max(c._modal.height(),c.document.height()))},g=function(){c._open&&("overlay"!==d.display&&(c._wrapper.addClass(d.classes.pageContentPrefix+"-open"),c._fixedToolbars().addClass(d.classes.pageContentPrefix+"-open")),c._bindFixListener(),c._trigger("open"),c._openedPage=c._page())};c._trigger("beforeopen");
"open"===c._page().jqmData("panel")?c._on(c.document,{panelclose:h}):h();c._open=!0}},close:function(b){if(this._open){var c=this,d=this.options,h=function(){d.theme&&"overlay"!==d.display&&c._page().parent().removeClass(d.classes.pageContainer+"-themed "+d.classes.pageContainer+"-"+d.theme);c.element.addClass(d.classes.panelClosed);"overlay"!==d.display&&(c._page().parent().removeClass(d.classes.pageContainer),c._wrapper.removeClass(d.classes.pageContentPrefix+"-open"),c._fixedToolbars().removeClass(d.classes.pageContentPrefix+
"-open"));a.support.cssTransform3d&&d.animate&&"overlay"!==d.display&&(c._wrapper.removeClass(d.classes.animate),c._fixedToolbars().removeClass(d.classes.animate));c._fixPanel();c._unbindFixListener();a.mobile.resetActivePageHeight();c._page().jqmRemoveData("panel");c._trigger("close");c._openedPage=null};c._trigger("beforeclose");c.element.removeClass(d.classes.panelOpen);"overlay"!==d.display&&(c._wrapper.removeClass(c._pageContentOpenClasses),c._fixedToolbars().removeClass(c._pageContentOpenClasses));
!b&&a.support.cssTransform3d&&d.animate?(c._wrapper||c.element).animationComplete(h,"transition"):setTimeout(h,0);c._modal&&c._modal.removeClass(c._modalOpenClasses).height("");c._open=!1}},toggle:function(){this[this._open?"close":"open"]()},_destroy:function(){var b,c=this.options,d=a("body > :mobile-panel").length+a.mobile.activePage.find(":mobile-panel").length>1;"overlay"!==c.display&&(b=a("body > :mobile-panel").add(a.mobile.activePage.find(":mobile-panel")),0===b.not(".ui-panel-display-overlay").not(this.element).length&&
this._wrapper.children().unwrap(),this._open&&(this._fixedToolbars().removeClass(c.classes.pageContentPrefix+"-open"),a.support.cssTransform3d&&c.animate&&this._fixedToolbars().removeClass(c.classes.animate),this._page().parent().removeClass(c.classes.pageContainer),c.theme&&this._page().parent().removeClass(c.classes.pageContainer+"-themed "+c.classes.pageContainer+"-"+c.theme)));d||this.document.off("panelopen panelclose");this._open&&this._page().jqmRemoveData("panel");this._panelInner.children().unwrap();
this.element.removeClass([this._getPanelClasses(),c.classes.panelOpen,c.classes.animate].join(" ")).off("swipeleft.panel swiperight.panel").off("panelbeforeopen").off("panelhide").off("keyup.panel").off("updatelayout");this._modal&&this._modal.remove()}})})(c);(function(a,b){a.widget("mobile.table",{options:{classes:{table:"ui-table"},enhanced:!1},_create:function(){this.options.enhanced||this.element.addClass(this.options.classes.table);a.extend(this,{headers:b,allHeaders:b});this._refresh(!0)},
_setHeaders:function(){var a=this.element.find("thead tr");this.headers=this.element.find("tr:eq(0)").children();this.allHeaders=this.headers.add(a.children())},refresh:function(){this._refresh()},rebuild:a.noop,_refresh:function(){var b=this.element,c=b.find("thead tr");this._setHeaders();c.each(function(){var d=0;a(this).children().each(function(){var h,g=parseInt(this.getAttribute("colspan"),10),l=":nth-child("+(d+1)+")";if(this.setAttribute("data-"+a.mobile.ns+"colstart",d+1),g)for(h=0;g-1>h;h++)d++,
l+=", :nth-child("+(d+1)+")";a(this).jqmData("cells",b.find("tr").not(c.eq(0)).not(this).children(l));d++})})}})})(c);(function(a){a.widget("mobile.table",a.mobile.table,{options:{mode:"columntoggle",columnBtnTheme:null,columnPopupTheme:null,columnBtnText:"Columns...",classes:a.extend(a.mobile.table.prototype.options.classes,{popup:"ui-table-columntoggle-popup",columnBtn:"ui-table-columntoggle-btn",priorityPrefix:"ui-table-priority-",columnToggleTable:"ui-table-columntoggle"})},_create:function(){this._super();
"columntoggle"===this.options.mode&&(a.extend(this,{_menu:null}),this.options.enhanced?(this._menu=a(this.document[0].getElementById(this._id()+"-popup")).children().first(),this._addToggles(this._menu,!0)):(this._menu=this._enhanceColToggle(),this.element.addClass(this.options.classes.columnToggleTable)),this._setupEvents(),this._setToggleState())},_id:function(){return this.element.attr("id")||this.widgetName+this.uuid},_setupEvents:function(){this._on(this.window,{throttledresize:"_setToggleState"});
this._on(this._menu,{"change input":"_menuInputChange"})},_addToggles:function(b,c){var d,i=0,h=this.options,k=b.controlgroup("container");c?d=b.find("input"):k.empty();this.headers.not("td").each(function(){var b,g,m=a(this),n=a.mobile.getAttribute(this,"priority");n&&(g=m.add(m.jqmData("cells")),g.addClass(h.classes.priorityPrefix+n),b=(c?d.eq(i++):a("<label><input type='checkbox' checked />"+(m.children("abbr").first().attr("title")||m.text())+"</label>").appendTo(k).children(0).checkboxradio({theme:h.columnPopupTheme})).jqmData("header",
m).jqmData("cells",g),m.jqmData("input",b))});c||b.controlgroup("refresh")},_menuInputChange:function(b){var b=a(b.target),c=b[0].checked;b.jqmData("cells").toggleClass("ui-table-cell-hidden",!c).toggleClass("ui-table-cell-visible",c)},_unlockCells:function(a){a.removeClass("ui-table-cell-hidden ui-table-cell-visible")},_enhanceColToggle:function(){var b,c,d,i,h=this.element,k=this.options,l=a.mobile.ns,j=this.document[0].createDocumentFragment();return b=this._id()+"-popup",c=a("<a href='#"+b+"' class='"+
k.classes.columnBtn+" ui-btn ui-btn-"+(k.columnBtnTheme||"a")+" ui-corner-all ui-shadow ui-mini' data-"+l+"rel='popup'>"+k.columnBtnText+"</a>"),d=a("<div class='"+k.classes.popup+"' id='"+b+"'></div>"),i=a("<fieldset></fieldset>").controlgroup(),this._addToggles(i,!1),i.appendTo(d),j.appendChild(d[0]),j.appendChild(c[0]),h.before(j),d.popup(),i},rebuild:function(){this._super();"columntoggle"===this.options.mode&&this._refresh(!1)},_refresh:function(b){var c,d;if(this._super(b),!b&&"columntoggle"===
this.options.mode){c=this.headers;d=[];this._menu.find("input").each(function(){var b=a(this),h=b.jqmData("header"),h=c.index(h[0]);h>-1&&!b.prop("checked")&&d.push(h)});this._unlockCells(this.element.find(".ui-table-cell-hidden, .ui-table-cell-visible"));this._addToggles(this._menu,b);for(b=d.length-1;b>-1;b--)c.eq(d[b]).jqmData("input").prop("checked",!1).checkboxradio("refresh").trigger("change")}},_setToggleState:function(){this._menu.find("input").each(function(){var b=a(this);this.checked="table-cell"===
b.jqmData("cells").eq(0).css("display");b.checkboxradio("refresh")})},_destroy:function(){this._super()}})})(c);(function(a){a.widget("mobile.table",a.mobile.table,{options:{mode:"reflow",classes:a.extend(a.mobile.table.prototype.options.classes,{reflowTable:"ui-table-reflow",cellLabels:"ui-table-cell-label"})},_create:function(){this._super();"reflow"===this.options.mode&&(this.options.enhanced||(this.element.addClass(this.options.classes.reflowTable),this._updateReflow()))},rebuild:function(){this._super();
"reflow"===this.options.mode&&this._refresh(!1)},_refresh:function(a){this._super(a);a||"reflow"!==this.options.mode||this._updateReflow()},_updateReflow:function(){var b=this,c=this.options;a(b.allHeaders.get().reverse()).each(function(){var d,i,h=a(this).jqmData("cells"),k=a.mobile.getAttribute(this,"colstart"),l=h.not(this).filter("thead th").length&&" ui-table-cell-label-top",j=a(this).clone().contents();j.length>0&&(l?(d=parseInt(this.getAttribute("colspan"),10),i="",d&&(i="td:nth-child("+d+
"n + "+k+")"),b._addLabels(h.filter(i),c.classes.cellLabels+l,j)):b._addLabels(h,c.classes.cellLabels,j))})},_addLabels:function(b,c,d){1===d.length&&"abbr"===d[0].nodeName.toLowerCase()&&(d=d.eq(0).attr("title"));b.not(":has(b."+c+")").prepend(a("<b class='"+c+"'></b>").append(d))}})})(c);(function(a,c){var d=function(b,c){return-1===(""+(a.mobile.getAttribute(this,"filtertext")||a(this).text())).toLowerCase().indexOf(c)};a.widget("mobile.filterable",{initSelector:":jqmData(filter='true')",options:{filterReveal:!1,
filterCallback:d,enhanced:!1,input:null,children:"> li, > option, > optgroup option, > tbody tr, > .ui-controlgroup-controls > .ui-btn, > .ui-controlgroup-controls > .ui-checkbox, > .ui-controlgroup-controls > .ui-radio"},_create:function(){var b=this.options;a.extend(this,{_search:null,_timer:0});this._setInput(b.input);b.enhanced||this._filterItems((this._search&&this._search.val()||"").toLowerCase())},_onKeyUp:function(){var c,d,e=this._search;if(e&&!(c=e.val().toLowerCase(),d=a.mobile.getAttribute(e[0],
"lastval")+"",d&&d===c))this._timer&&(b.clearTimeout(this._timer),this._timer=0),this._timer=this._delay(function(){return this._trigger("beforefilter",null,{input:e})===!1?!1:(e[0].setAttribute("data-"+a.mobile.ns+"lastval",c),this._filterItems(c),void(this._timer=0))},250)},_getFilterableItems:function(){var b=this.element,c=this.options.children,c=c?a.isFunction(c)?c():c.nodeName?a(c):c.jquery?c:this.element.find(c):{length:0};return 0===c.length&&(c=b.children()),c},_filterItems:function(b){var c,
h,g,l,j=[],m=[],n=this.options,o=this._getFilterableItems();if(null!=b){h=n.filterCallback||d;g=o.length;for(c=0;g>c;c++)l=h.call(o[c],c,b)?m:j,l.push(o[c])}0===m.length?o[n.filterReveal&&0===b.length?"addClass":"removeClass"]("ui-screen-hidden"):(a(m).addClass("ui-screen-hidden"),a(j).removeClass("ui-screen-hidden"));this._refreshChildWidget();this._trigger("filter",null,{items:o})},_refreshChildWidget:function(){var b,c,d=["collapsibleset","selectmenu","controlgroup","listview"];for(c=d.length-
1;c>-1;c--)b=d[c],a.mobile[b]&&(b=this.element.data("mobile-"+b),b&&a.isFunction(b.refresh)&&b.refresh())},_setInput:function(c){var d=this._search;this._timer&&(b.clearTimeout(this._timer),this._timer=0);d&&(this._off(d,"keyup change input"),d=null);c&&(d=c.jquery?c:c.nodeName?a(c):this.document.find(c),this._on(d,{keydown:"_onKeyDown",keypress:"_onKeyPress",keyup:"_onKeyUp",change:"_onKeyUp",input:"_onKeyUp"}));this._search=d},_onKeyDown:function(b){b.keyCode===a.ui.keyCode.ENTER&&(b.preventDefault(),
this._preventKeyPress=!0)},_onKeyPress:function(a){this._preventKeyPress&&(a.preventDefault(),this._preventKeyPress=!1)},_setOptions:function(a){var b=!(a.filterReveal===c&&a.filterCallback===c&&a.children===c);this._super(a);a.input!==c&&(this._setInput(a.input),b=!0);b&&this.refresh()},_destroy:function(){var a=this.options,b=this._getFilterableItems();a.enhanced?b.toggleClass("ui-screen-hidden",a.filterReveal):b.removeClass("ui-screen-hidden")},refresh:function(){this._timer&&(b.clearTimeout(this._timer),
this._timer=0);this._filterItems((this._search&&this._search.val()||"").toLowerCase())}})})(c);(function(a,b){var c=function(a,b){return function(c){b.call(this,c);a._syncTextInputOptions(c)}},d=/(^|\s)ui-li-divider(\s|$)/,i=a.mobile.filterable.prototype.options.filterCallback;a.mobile.filterable.prototype.options.filterCallback=function(a,b){return!this.className.match(d)&&i.call(this,a,b)};a.widget("mobile.filterable",a.mobile.filterable,{options:{filterPlaceholder:"Filter items...",filterTheme:null},
_create:function(){var b,c,d=this.element,e=["collapsibleset","selectmenu","controlgroup","listview"],f={};this._super();a.extend(this,{_widget:null});for(b=e.length-1;b>-1;b--)if(c=e[b],a.mobile[c]){if(this._setWidget(d.data("mobile-"+c)))break;f[c+"create"]="_handleCreate"}this._widget||this._on(d,f)},_handleCreate:function(a){this._setWidget(this.element.data("mobile-"+a.type.substring(0,a.type.length-6)))},_trigger:function(a,b,c){return this._widget&&"mobile-listview"===this._widget.widgetFullName&&
"beforefilter"===a&&this._widget._trigger("beforefilter",b,c),this._super(a,b,c)},_setWidget:function(a){return!this._widget&&a&&(this._widget=a,this._widget._setOptions=c(this,this._widget._setOptions)),this._widget&&(this._syncTextInputOptions(this._widget.options),"listview"===this._widget.widgetName&&(this._widget.options.hideDividers=!0,this._widget.element.listview("refresh"))),!!this._widget},_isSearchInternal:function(){return this._search&&this._search.jqmData("ui-filterable-"+this.uuid+
"-internal")},_setInput:function(b){var c=this.options,d=!0,e={};if(!b){if(this._isSearchInternal())return;d=!1;b=a("<input data-"+a.mobile.ns+"type='search' placeholder='"+c.filterPlaceholder+"'></input>").jqmData("ui-filterable-"+this.uuid+"-internal",!0);a("<form class='ui-filterable'></form>").append(b).submit(function(a){a.preventDefault();b.blur()}).insertBefore(this.element);a.mobile.textinput&&(null!=this.options.filterTheme&&(e.theme=c.filterTheme),b.textinput(e))}this._super(b);this._isSearchInternal()&&
d&&this._search.attr("placeholder",this.options.filterPlaceholder)},_setOptions:function(c){var d=this._super(c);return c.filterPlaceholder!==b&&this._isSearchInternal()&&this._search.attr("placeholder",c.filterPlaceholder),c.filterTheme!==b&&this._search&&a.mobile.textinput&&this._search.textinput("option","theme",c.filterTheme),d},_refreshChildWidget:function(){this._refreshingChildWidget=!0;this._superApply(arguments);this._refreshingChildWidget=!1},refresh:function(){this._refreshingChildWidget||
this._superApply(arguments)},_destroy:function(){this._isSearchInternal()&&this._search.remove();this._super()},_syncTextInputOptions:function(c){var d,e={};if(this._isSearchInternal()&&a.mobile.textinput){for(d in a.mobile.textinput.prototype.options)c[d]!==b&&(e[d]="theme"===d&&null!=this.options.filterTheme?this.options.filterTheme:c[d]);this._search.textinput("option",e)}}});a.widget("mobile.listview",a.mobile.listview,{options:{filter:!1},_create:function(){return this.options.filter!==!0||this.element.data("mobile-filterable")||
this.element.filterable(),this._super()},refresh:function(){var a;this._superApply(arguments);this.options.filter===!0&&(a=this.element.data("mobile-filterable"),a&&a.refresh())}})})(c);(function(a,b){function c(a){return a.hash.length>1&&decodeURIComponent(a.href.replace(i,""))===decodeURIComponent(location.href.replace(i,""))}var d=0,i=/#.*$/;a.widget("ui.tabs",{version:"fadf2b312a05040436451c64bbfaf4814bc62c56",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,
show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var b=this,c=this.options;this.running=!1;this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",c.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(b){a(this).is(".ui-state-disabled")&&b.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){a(this).closest("li").is(".ui-state-disabled")&&this.blur()});
this._processTabs();c.active=this._initialActive();a.isArray(c.disabled)&&(c.disabled=a.unique(c.disabled.concat(a.map(this.tabs.filter(".ui-state-disabled"),function(a){return b.tabs.index(a)}))).sort());this.active=this.options.active!==!1&&this.anchors.length?this._findActive(c.active):a();this._refresh();this.active.length&&this.load(c.active)},_initialActive:function(){var b=this.options.active,c=this.options.collapsible,d=location.hash.substring(1);return null===b&&(d&&this.tabs.each(function(c,
e){return a(e).attr("aria-controls")===d?(b=c,!1):void 0}),null===b&&(b=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===b||-1===b)&&(b=this.tabs.length?0:!1)),b!==!1&&(b=this.tabs.index(this.tabs.eq(b)),-1===b&&(b=c?!1:0)),!c&&b===!1&&this.anchors.length&&(b=0),b},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):a()}},_tabKeydown:function(b){var c=a(this.document[0].activeElement).closest("li"),d=this.tabs.index(c),e=!0;
if(!this._handlePageNav(b)){switch(b.keyCode){case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:d++;break;case a.ui.keyCode.UP:case a.ui.keyCode.LEFT:e=!1;d--;break;case a.ui.keyCode.END:d=this.anchors.length-1;break;case a.ui.keyCode.HOME:d=0;break;case a.ui.keyCode.SPACE:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d);case a.ui.keyCode.ENTER:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d===this.options.active?!1:d);default:return}b.preventDefault();
clearTimeout(this.activating);d=this._focusNextTab(d,e);b.ctrlKey||(c.attr("aria-selected","false"),this.tabs.eq(d).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",d)},this.delay))}},_panelKeydown:function(b){this._handlePageNav(b)||b.ctrlKey&&b.keyCode===a.ui.keyCode.UP&&(b.preventDefault(),this.active.focus())},_handlePageNav:function(b){return b.altKey&&b.keyCode===a.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):b.altKey&&
b.keyCode===a.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(b,c){for(var d=this.tabs.length-1;-1!==a.inArray((b>d&&(b=0),0>b&&(b=d),b),this.options.disabled);)b=c?b+1:b-1;return b},_focusNextTab:function(a,b){return a=this._findNextTab(a,b),this.tabs.eq(a).focus(),a},_setOption:function(a,b){return"active"===a?void this._activate(b):"disabled"===a?void this._setupDisabled(b):(this._super(a,b),"collapsible"===a&&(this.element.toggleClass("ui-tabs-collapsible",
b),b||this.options.active!==!1||this._activate(0)),"event"===a&&this._setupEvents(b),void("heightStyle"===a&&this._setupHeightStyle(b)))},_tabId:function(a){return a.attr("aria-controls")||"ui-tabs-"+ ++d},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var b=this.options,c=this.tablist.children(":has(a[href])");b.disabled=a.map(c.filter(".ui-state-disabled"),function(a){return c.index(a)});this._processTabs();b.active!==!1&&this.anchors.length?
this.active.length&&!a.contains(this.tablist[0],this.active[0])?this.tabs.length===b.disabled.length?(b.active=!1,this.active=a()):this._activate(this._findNextTab(Math.max(0,b.active-1),!1)):b.active=this.tabs.index(this.active):(b.active=!1,this.active=a());this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false",
"aria-hidden":"true"});this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var b=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist");this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",
tabIndex:-1});this.anchors=this.tabs.map(function(){return a("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=a();this.anchors.each(function(d,f){var g,i,n,o=a(f).uniqueId().attr("id"),q=a(f).closest("li"),p=q.attr("aria-controls");c(f)?(g=f.hash,i=b.element.find(b._sanitizeSelector(g))):(n=b._tabId(q),g="#"+n,i=b.element.find(g),i.length||(i=b._createPanel(n),i.insertAfter(b.panels[d-1]||b.tablist)),i.attr("aria-live","polite"));i.length&&(b.panels=b.panels.add(i));
p&&q.data("ui-tabs-aria-controls",p);q.attr({"aria-controls":g.substring(1),"aria-labelledby":o});i.attr("aria-labelledby",o)});this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(b){return a("<div>").attr("id",b).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(b){a.isArray(b)&&(b.length?b.length===this.anchors.length&&
(b=!0):b=!1);for(var c,d=0;c=this.tabs[d];d++)b===!0||-1!==a.inArray(d,b)?a(c).addClass("ui-state-disabled").attr("aria-disabled","true"):a(c).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=b},_setupEvents:function(b){var c={click:function(a){a.preventDefault()}};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"});this._off(this.anchors.add(this.tabs).add(this.panels));this._on(this.anchors,c);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,
{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs)},_setupHeightStyle:function(b){var c,d=this.element.parent();"fill"===b?(c=d.height(),c-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var b=a(this),d=b.css("position");"absolute"!==d&&"fixed"!==d&&(c-=b.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){c-=a(this).outerHeight(!0)}),this.panels.each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+
a(this).height()))}).css("overflow","auto")):"auto"===b&&(c=0,this.panels.each(function(){c=Math.max(c,a(this).height("").height())}).height(c))},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget).closest("li"),f=e[0]===d[0],g=f&&c.collapsible,i=g?a():this._getPanelForTab(e),q=d.length?this._getPanelForTab(d):a(),d={oldTab:d,oldPanel:q,newTab:g?a():e,newPanel:i};b.preventDefault();e.hasClass("ui-state-disabled")||e.hasClass("ui-tabs-loading")||this.running||f&&!c.collapsible||
this._trigger("beforeActivate",b,d)===!1||(c.active=g?!1:this.tabs.index(e),this.active=f?a():e,this.xhr&&this.xhr.abort(),q.length||i.length||a.error("jQuery UI Tabs: Mismatching fragment identifier."),i.length&&this.load(this.tabs.index(e),b),this._toggle(b,d))},_toggle:function(b,c){function d(){f.running=!1;f._trigger("activate",b,c)}function e(){c.newTab.closest("li").addClass("ui-tabs-active ui-state-active");g.length&&f.options.show?f._show(g,f.options.show,d):(g.show(),d())}var f=this,g=c.newPanel,
i=c.oldPanel;this.running=!0;i.length&&this.options.hide?this._hide(i,this.options.hide,function(){c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");e()}):(c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),i.hide(),e());i.attr({"aria-expanded":"false","aria-hidden":"true"});c.oldTab.attr("aria-selected","false");g.length&&i.length?c.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1);g.attr({"aria-expanded":"true",
"aria-hidden":"false"});c.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(b){var c,b=this._findActive(b);b[0]!==this.active[0]&&(b.length||(b=this.active),c=b.find(".ui-tabs-anchor")[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return b===!1?a():this.tabs.eq(b)},_getIndex:function(a){return"string"==typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))),a},_destroy:function(){this.xhr&&this.xhr.abort();this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible");
this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role");this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId();this.tabs.add(this.panels).each(function(){a.data(this,"ui-tabs-destroy")?a(this).remove():a(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")});
this.tabs.each(function(){var b=a(this),c=b.data("ui-tabs-aria-controls");c?b.attr("aria-controls",c).removeData("ui-tabs-aria-controls"):b.removeAttr("aria-controls")});this.panels.show();"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(c){var d=this.options.disabled;d!==!1&&(c===b?d=!1:(c=this._getIndex(c),d=a.isArray(d)?a.map(d,function(a){return a!==c?a:null}):a.map(this.tabs,function(a,b){return b!==c?b:null})),this._setupDisabled(d))},disable:function(c){var d=
this.options.disabled;if(d!==!0){if(c===b)d=!0;else{if(c=this._getIndex(c),-1!==a.inArray(c,d))return;d=a.isArray(d)?a.merge([c],d).sort():[c]}this._setupDisabled(d)}},load:function(b,d){var b=this._getIndex(b),f=this,g=this.tabs.eq(b),i=g.find(".ui-tabs-anchor"),n=this._getPanelForTab(g),o={tab:g,panel:n};c(i[0])||(this.xhr=a.ajax(this._ajaxSettings(i,d,o)),this.xhr&&"canceled"!==this.xhr.statusText&&(g.addClass("ui-tabs-loading"),n.attr("aria-busy","true"),this.xhr.success(function(a){setTimeout(function(){n.html(a);
f._trigger("load",d,o)},1)}).complete(function(a,b){setTimeout(function(){"abort"===b&&f.panels.stop(!1,!0);g.removeClass("ui-tabs-loading");n.removeAttr("aria-busy");a===f.xhr&&delete f.xhr},1)})))},_ajaxSettings:function(b,c,d){var e=this;return{url:b.attr("href"),beforeSend:function(b,f){return e._trigger("beforeLoad",c,a.extend({jqXHR:b,ajaxSettings:f},d))}}},_getPanelForTab:function(b){return this.element.find(this._sanitizeSelector("#"+a(b).attr("aria-controls")))}})})(c);(function(a,b){function c(a){i=
a.originalEvent;j=i.accelerationIncludingGravity;h=Math.abs(j.x);k=Math.abs(j.y);l=Math.abs(j.z);!b.orientation&&(h>7||(l>6&&8>k||8>l&&k>6)&&h>5)?d.enabled&&d.disable():d.enabled||d.enable()}a.mobile.iosorientationfixEnabled=!0;var d,i,h,k,l,j,m=navigator.userAgent;return/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(m)&&m.indexOf("AppleWebKit")>-1?(d=a.mobile.zoom,void a.mobile.document.on("mobileinit",function(){a.mobile.iosorientationfixEnabled&&a.mobile.window.bind("orientationchange.iosorientationfix",
d.enable).bind("devicemotion.iosorientationfix",c)})):void(a.mobile.iosorientationfixEnabled=!1)})(c,this);(function(a,b,c){function f(){i.removeClass("ui-mobile-rendering")}var i=a("html"),h=a.mobile.window;a(b.document).trigger("mobileinit");a.mobile.gradeA()&&(a.mobile.ajaxBlacklist&&(a.mobile.ajaxEnabled=!1),i.addClass("ui-mobile ui-mobile-rendering"),setTimeout(f,5E3),a.extend(a.mobile,{initializePage:function(){var b=a.mobile.path,g=a(":jqmData(role='page'), :jqmData(role='dialog')"),i=b.stripHash(b.stripQueryParams(b.parseLocation().hash)),
m=a.mobile.path.parseLocation(),n=i?d.getElementById(i):c;g.length||(g=a("body").wrapInner("<div data-"+a.mobile.ns+"role='page'></div>").children(0));g.each(function(){var c=a(this);c[0].getAttribute("data-"+a.mobile.ns+"url")||c.attr("data-"+a.mobile.ns+"url",c.attr("id")||b.convertUrlToDataUrl(m.pathname+m.search))});a.mobile.firstPage=g.first();a.mobile.pageContainer=a.mobile.firstPage.parent().addClass("ui-mobile-viewport").pagecontainer();a.mobile.navreadyDeferred.resolve();h.trigger("pagecontainercreate");
a.mobile.loading("show");f();a.mobile.hashListeningEnabled&&a.mobile.path.isHashValid(location.hash)&&(a(n).is(":jqmData(role='page')")||a.mobile.path.isPath(i)||i===a.mobile.dialogHashKey)?a.event.special.navigate.isPushStateEnabled()?(a.mobile.navigate.history.stack=[],a.mobile.navigate(a.mobile.path.isPath(location.hash)?location.hash:location.href)):h.trigger("hashchange",[!0]):(a.event.special.navigate.isPushStateEnabled()&&a.mobile.navigate.navigator.squash(b.parseLocation().href),a.mobile.changePage(a.mobile.firstPage,
{transition:"none",reverse:!0,changeHash:!1,fromHashChange:!0}))}}),a(function(){a.support.inlineSVG();a.mobile.hideUrlBar&&b.scrollTo(0,1);a.mobile.defaultHomeScroll=a.support.scrollTop&&1!==a.mobile.window.scrollTop()?1:0;a.mobile.autoInitializePage&&a.mobile.initializePage();a.mobile.hideUrlBar&&h.load(a.mobile.silentScroll);a.support.cssPointerEvents||a.mobile.document.delegate(".ui-state-disabled,.ui-disabled","vclick",function(a){a.preventDefault();a.stopImmediatePropagation()})}))})(c,this)});jQuery.fn.center=function(c){return this.each(function(){var b=jQuery(this);b.css({position:c?"absolute":"fixed",left:"50%",top:"50%",zIndex:"99"}).css({marginLeft:"-"+b.outerWidth()/2+"px",marginTop:"-"+b.outerHeight()/2+"px"});c&&b.css({marginTop:parseInt(b.css("marginTop"),10)+jQuery(window).scrollTop(),marginLeft:parseInt(b.css("marginLeft"),10)+jQuery(window).scrollLeft()})})};(function(c){c.widget("mobile.datebox",{initSelector:"input[data-role='datebox']",options:{version:"3-1.4.4-01",theme:!1,themeDefault:"a",themeHeader:"a",mode:!1,transition:"fade",useAnimation:!0,hideInput:!1,hideContainer:!1,lockInput:!0,zindex:"1100",clickEvent:"vclick",clickEventAlt:"click",defaultValue:!1,showInitialValue:!1,popupPosition:!1,popupForceX:!1,popupForceY:!1,useModal:!0,useModalTheme:"b",useInline:!1,useInlineBlind:!1,useHeader:!0,useImmediate:!1,useButton:!0,buttonIcon:!1,buttonIconDate:"calendar",
buttonIconTime:"clock",useFocus:!1,useClearButton:!1,useCollapsedBut:!1,usePlaceholder:!1,openCallback:!1,openCallbackArgs:[],closeCallback:!1,closeCallbackArgs:[],startOffsetYears:!1,startOffsetMonths:!1,startOffsetDays:!1,afterToday:!1,beforeToday:!1,notToday:!1,maxDays:!1,minDays:!1,maxYear:!1,minYear:!1,blackDates:!1,blackDatesRec:!1,blackDays:!1,whiteDates:!0,minHour:!1,maxHour:!1,minuteStep:1,minuteStepRound:0,rolloverMode:{m:!0,d:!0,h:!0,i:!0,s:!0},useLang:"default",lang:{"default":{setDateButtonLabel:"Set Date",
setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",calTomorrowButtonLabel:"Jump to Tomorrow",titleDateDialogLabel:"Set Date",titleTimeDialogLabel:"Set Time",daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysOfWeekShort:["Su","Mo","Tu","We","Th","Fr","Sa"],monthsOfYear:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsOfYearShort:["Jan","Feb",
"Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],timeFormat:24,headerFormat:"%A, %B %-d, %Y",tooltip:"Open Date Picker",nextMonth:"Next Month",prevMonth:"Previous Month",dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],dateFormat:"%Y-%m-%d",useArabicIndic:!1,isRTL:!1,calStartDay:0,clearButton:"Clear",durationOrder:["d","h","i","s"],meridiem:["AM","PM"],timeOutput:"%k:%M",
durationFormat:"%Dd %DA, %Dl:%DM:%DS",calDateListLabel:"Other Dates",calHeaderFormat:"%B %Y"}}},_enhanceDate:function(){c.extend(this._date.prototype,{copy:function(b,d){b=c.extend([0,0,0,0,0,0,0],b);d=c.extend([0,0,0,0,0,0,0],d);return new Date(d[0]>0?d[0]:this.get(0)+b[0],d[1]>0?d[1]:this.get(1)+b[1],d[2]>0?d[2]:this.get(2)+b[2],d[3]>0?d[3]:this.get(3)+b[3],d[4]>0?d[4]:this.get(4)+b[4],d[5]>0?d[5]:this.get(5)+b[5],d[6]>0?d[5]:this.get(6)+b[6])},adj:function(b,c){if(typeof c!=="number"||typeof b!==
"number")throw Error("Invalid Arguments");switch(b){case 0:this.setD(0,this.get(0)+c);break;case 1:this.setD(1,this.get(1)+c);break;case 2:this.setD(2,this.get(2)+c);break;case 3:c*=60;case 4:c*=60;case 5:c*=1E3;case 6:this.setTime(this.getTime()+c)}return this},setD:function(b,c){switch(b){case 0:this.setFullYear(c);break;case 1:this.setMonth(c);break;case 2:this.setDate(c);break;case 3:this.setHours(c);break;case 4:this.setMinutes(c);break;case 5:this.setSeconds(c);break;case 6:this.setMilliseconds(c)}return this},
get:function(b){switch(b){case 0:return this.getFullYear();case 1:return this.getMonth();case 2:return this.getDate();case 3:return this.getHours();case 4:return this.getMinutes();case 5:return this.getSeconds();case 6:return this.getMilliseconds()}return!1},get12hr:function(){return this.get(3)===0?12:this.get(3)<13?this.get(3):this.get(3)-12},iso:function(){for(var b=[0,0,0],c=0,c=0;c<3;c++)b[c]=this.get(c),c===1&&b[c]++,b[c]<10&&(b[c]="0"+String(b[c]));return b.join("-")},comp:function(){return parseInt(this.iso().replace(/-/g,
""),10)},getEpoch:function(){return Math.floor(this.getTime()/1E3)},getArray:function(){for(var b=[0,0,0,0,0,0],c=0,c=0;c<6;c++)b[c]=this.get(c);return b},setFirstDay:function(b){this.setD(2,1).adj(2,b-this.getDay());this.get(2)>10&&this.adj(2,7);return this},setDWeek:function(b,c){return b===4?this.setD(1,0).setD(2,1).setFirstDay(4).adj(2,-3).adj(2,(c-1)*7):this.setD(1,0).setD(2,1).setFirstDay(b).adj(2,(c-1)*7)},getDWeek:function(b){switch(b){case 0:return b=this.copy([0,-1*this.getMonth()]).setFirstDay(0),
Math.floor((this.getTime()-(b.getTime()+(this.getTimezoneOffset()-b.getTimezoneOffset())*6E4))/6048E5)+1;case 1:return b=this.copy([0,-1*this.getMonth()]).setFirstDay(1),Math.floor((this.getTime()-(b.getTime()+(this.getTimezoneOffset()-b.getTimezoneOffset())*6E4))/6048E5)+1;case 4:if(this.getMonth()===11&&this.getDate()>28)return 1;b=this.copy([0,-1*this.getMonth()],!0).setFirstDay(4).adj(2,-3);b=Math.floor((this.getTime()-(b.getTime()+(this.getTimezoneOffset()-b.getTimezoneOffset())*6E4))/6048E5)+
1;return b<1?(b=this.copy([-1,-1*this.getMonth()]).setFirstDay(4).adj(2,-3),Math.floor((this.getTime()-b.getTime())/6048E5)+1):b;default:return 0}}})},_event:function(b,d){var a,g=c(this).data("mobile-datebox");if(!b.isPropagationStopped())switch(d.method){case "close":g.close();break;case "open":g.open();break;case "set":typeof d.value==="object"?(g.theDate=d.value,g._t({method:"doset"})):(c(this).val(d.value),c(this).trigger("change"));break;case "doset":a="_"+g.options.mode+"DoSet";c.isFunction(g[a])?
g[a].apply(g,[]):g._t({method:"set",value:g._formatter(g.__fmt(),g.theDate),date:g.theDate});break;case "dooffset":d.type&&g._offset(d.type,d.amount,!0);break;case "dorefresh":g.refresh();break;case "doclear":c(this).val("").trigger("change");break;case "clear":c(this).trigger("change")}},_ord:{"default":function(b){var c=b%10;return b>9&&b<21||c>3?"th":["th","st","nd","rd"][c]}},_dur:function(b){var d=[b/864E5,b/36E5%24,b/6E4%60,b/1E3%60];c.each(d,function(a,b){d[a]=parseInt(b,10)});return d},_gridblk:{g:[0,
0,"a","b","c","d","e"],b:["a","b","c","d","e","f"]},__:function(b){var c=this.options,a=c.lang[c.useLang],g=c[c.mode+"lang"],e="override"+b.charAt(0).toUpperCase()+b.slice(1);return typeof c[e]!=="undefined"?c[e]:typeof a[b]!=="undefined"?a[b]:typeof g!=="undefined"&&typeof g[b]!=="undefined"?g[b]:c.lang["default"][b]},__fmt:function(){if(typeof this.fmtOver!=="undefined"&&this.fmtOver!==!1)return this.fmtOver;switch(this.options.mode){case "timebox":case "timeflipbox":return this.__("timeOutput");
case "durationbox":case "durationflipbox":return this.__("durationFormat");default:return this.__("dateFormat")}},_zPad:function(b,c){return typeof c!=="undefined"&&c==="-"?String(b):(b<10?"0":"")+String(b)},_dRep:function(b,c){var a,g,e=48,f=57,i=1584,h="";c===-1&&(e+=i,f+=i,i=-1584);for(g=0;g<b.length;g++)a=b.charCodeAt(g),h+=a>=e&&a<=f?String.fromCharCode(a+i):String.fromCharCode(a);return h},_doIndic:function(){var b=this;b.d.intHTML.find("*").each(function(){c(this).children().length<1?c(this).text(b._dRep(c(this).text())):
c(this).hasClass("ui-datebox-slideday")&&c(this).html(b._dRep(c(this).html()))});b.d.intHTML.find("input").each(function(){c(this).val(b._dRep(c(this).val()))})},_parser:{"default":function(){return!1}},_n:function(b,c){return b<0?c:b},_pa:function(b,c){return typeof c==="boolean"?new this._date(b[0],b[1],b[2],0,0,0,0):new this._date(c.get(0),c.get(1),c.get(2),b[0],b[1],b[2],0)},_makeDate:function(b){var d,a,g,e=this.options;a=this.options.defaultValue;g=this.__fmt();var f=null,i=[];d=new this._date;
var h={year:-1,mont:-1,date:-1,hour:-1,mins:-1,secs:-1,week:!1,wtyp:4,wday:!1,yday:!1,meri:0},b=c.trim(this.__("useArabicIndic")===!0?this._dRep(b,-1):b);if(typeof e.mode==="undefined")return d;if(typeof this._parser[e.mode]!=="undefined")return this._parser[e.mode].apply(this,[b]);if(e.mode==="durationbox"||e.mode==="durationflipbox"){g=g.replace(/%D([a-z])/gi,function(a,b){switch(b){case "d":case "l":case "M":case "S":return"("+a+"|[0-9]+)";default:return".+?"}});g=RegExp("^"+g+"$");f=g.exec(b);
b=g.exec(this.__fmt());if(f===null||f.length!==b.length)return typeof a==="number"&&a>0?new this._date((this.initDate.getEpoch()+parseInt(a,10))*1E3):new this._date(this.initDate.getTime());a=this.initDate.getEpoch();for(d=1;d<f.length;d++)g=parseInt(f[d],10),b[d].match(/^%Dd$/i)&&(a+=g*86400),b[d].match(/^%Dl$/i)&&(a+=g*3600),b[d].match(/^%DM$/i)&&(a+=g*60),b[d].match(/^%DS$/i)&&(a+=g);return new this._date(a*1E3)}g=g.replace(/%(0|-)*([a-z])/gi,function(a,b,c){i.push(c);switch(c){case "p":case "P":case "b":case "B":return"("+
a+"|.+?)";case "H":case "k":case "I":case "l":case "m":case "M":case "S":case "V":case "U":case "u":case "W":case "d":return"("+a+"|[0-9]{"+(b==="-"?"1,":"")+"2})";case "j":return"("+a+"|[0-9]{3})";case "s":return"("+a+"|[0-9]+)";case "g":case "y":return"("+a+"|[0-9]{2})";case "E":case "G":case "Y":return"("+a+"|[0-9]{1,4})";default:return i.pop(),".+?"}});g=RegExp("^"+g+"$");f=g.exec(b);b=g.exec(this.__fmt());if(f===null||f.length!==b.length){if(a!==!1)switch(typeof a){case "object":c.isFunction(a.getDay)?
d=a:a.length===3&&(d=this._pa(a,e.mode.substr(0,4)==="time"?d:!1));break;case "number":d=new this._date(a*1E3);break;case "string":e.mode.substr(0,4)==="time"?(a=c.extend([0,0,0],a.split(":")).slice(0,3),d=this._pa(a,d)):(a=c.extend([0,0,0],a.split("-")).slice(0,3),a[1]--,d=this._pa(a,!1))}isNaN(d.getDate())&&(d=new this._date)}else{for(d=1;d<f.length;d++)switch(g=parseInt(f[d],10),i[d-1]){case "s":return new this._date(parseInt(f[d],10)*1E3);case "Y":case "G":h.year=g;break;case "E":h.year=g-543;
break;case "y":case "g":h.year=e.afterToday||g<38?2E3+g:1900+g;break;case "m":h.mont=g-1;break;case "d":h.date=g;break;case "H":case "k":case "I":case "l":h.hour=g;break;case "M":h.mins=g;break;case "S":h.secs=g;break;case "u":h.wday=g-1;break;case "w":h.wday=g;break;case "j":h.yday=g;break;case "V":h.week=g;h.wtyp=4;break;case "U":h.week=g;h.wtyp=0;break;case "W":h.week=g;h.wtyp=1;break;case "p":case "P":g=RegExp("^"+f[d]+"$","i");h.meri=g.test(this.__("meridiem")[0])?-1:1;break;case "b":a=c.inArray(f[d],
this.__("monthsOfYearShort"));if(a>-1)h.mont=a;break;case "B":if(a=c.inArray(f[d],this.__("monthsOfYear")),a>-1)h.mont=a}if(h.meri!==0){if(h.meri===-1&&h.hour===12)h.hour=0;h.meri===1&&h.hour!==12&&(h.hour+=12)}d=new this._date(this._n(h.year,0),this._n(h.mont,0),this._n(h.date,1),this._n(h.hour,0),this._n(h.mins,0),this._n(h.secs,0),0);h.year<100&&h.year!==-1&&d.setFullYear(h.year);if(h.mont>-1&&h.date>-1||h.hour>-1&&h.mins>-1&&h.secs>-1)return d;h.week!==!1&&(d.setDWeek(h.wtyp,h.week),h.date>-1&&
d.setDate(h.date));h.yday!==!1&&d.setD(1,0).setD(2,1).adj(2,h.yday-1);h.wday!==!1&&d.adj(2,h.wday-d.getDay())}return d},_customformat:{"default":function(){return!1}},_formatter:function(b,c){var a=this,g=this.options,e,f=0;g.mode.substr(0,4)==="dura"&&(f=a._dur(this.theDate.getTime()-this.initDate.getTime()),b.match(/%Dd/)||(f[1]+=f[0]*24),b.match(/%Dl/)||(f[2]+=f[1]*60),b.match(/%DM/)||(f[3]+=f[2]*60));b=b.replace(/%(D|X|0|-)*([1-9a-zA-Z])/g,function(b,h,k){if(h==="X")return typeof a._customformat[g.mode]!==
"undefined"?a._customformat[g.mode](k,c,g):b;if(h==="D")switch(k){case "d":return f[0];case "l":return a._zPad(f[1]);case "M":return a._zPad(f[2]);case "S":return a._zPad(f[3]);case "A":return a.__("durationDays")[f[0]===1?0:1];default:return b}switch(k){case "a":return a.__("daysOfWeekShort")[c.getDay()];case "A":return a.__("daysOfWeek")[c.getDay()];case "b":return a.__("monthsOfYearShort")[c.getMonth()];case "B":return a.__("monthsOfYear")[c.getMonth()];case "C":return parseInt(c.getFullYear()/
100);case "d":return a._zPad(c.getDate(),h);case "H":case "k":return a._zPad(c.getHours(),h);case "I":case "l":return a._zPad(c.get12hr(),h);case "m":return a._zPad(c.getMonth()+1,h);case "M":return a._zPad(c.getMinutes(),h);case "p":case "P":return e=a.__("meridiem")[c.get(3)<12?0:1].toUpperCase(),k==="P"?e.toLowerCase():e;case "s":return c.getEpoch();case "S":return a._zPad(c.getSeconds(),h);case "u":return a._zPad(c.getDay()+1,h);case "w":return c.getDay();case "y":return a._zPad(c.getFullYear()%
100);case "Y":return c.getFullYear();case "E":return c.getFullYear()+543;case "V":return a._zPad(c.getDWeek(4),h);case "U":return a._zPad(c.getDWeek(0),h);case "W":return a._zPad(c.getDWeek(1),h);case "o":return typeof a._ord[g.useLang]!=="undefined"?a._ord[g.useLang](c.getDate()):a._ord["default"](c.getDate());case "j":return e=new Date(c.getFullYear(),0,1),e="000"+String(Math.ceil((c-e)/864E5)+1),e.slice(-3);case "G":return e=c.getFullYear(),c.getDWeek(4)===1&&c.getMonth()>0?e+1:c.getDWeek(4)>51&&
c.getMonth()<11?e-1:e;case "g":return e=c.getFullYear%100,c.getDWeek(4)===1&&c.getMonth()>0&&++e,c.getDWeek(4)>51&&c.getMonth()<11&&--e,a._zpad(e);default:return b}});a.__("useArabicIndic")===!0&&(b=a._dRep(b));return b},_btwn:function(b,c,a){return b>c&&b<a},_minStepFix:function(){var b=this.theDate.get(4),c=this.options.minuteStep,a=this.options.minStepRound,g=b%c;c>1&&g>0&&(a<0?b-=g:a>0?b+=c-g:b%c<c/2?b-=g:b+=c-g,this.theDate.setMinutes(b))},_offset:function(b,d,a){var g=this.options,e=this.theDate,
f=!1,b=(b||"").toLowerCase();typeof a==="undefined"&&(a=!0);if(b!=="a"&&(typeof g.rolloverMode[b]==="undefined"||g.rolloverMode[b]===!0))f=c.inArray(b,["y","m","d","h","i","s"]);else switch(b){case "y":f=0;break;case "m":this._btwn(e.get(1)+d,-1,12)&&(f=1);break;case "d":this._btwn(e.get(2)+d,0,32-e.copy([0],[0,0,32,13]).get(3)+1)&&(f=2);break;case "h":this._btwn(e.get(3)+d,-1,24)&&(f=3);break;case "i":this._btwn(e.get(4)+d,-1,60)&&(f=4);break;case "s":this._btwn(e.get(5)+d,-1,60)&&(f=5);break;case "a":this._offset("h",
(d>0?1:-1)*12,!1)}f!==!1&&this.theDate.adj(f,d);a===!0&&this.refresh();g.useImmediate&&this._t({method:"doset"});this._t({method:"offset",type:b,amount:d,newDate:this.theDate})},_startOffset:function(b){var c=this.options;c.startOffsetYears!==!1&&b.adj(0,c.startOffsetYears);c.startOffsetMonths!==!1&&b.adj(1,c.startOffsetMonths);c.startOffsetDays!==!1&&b.adj(2,c.startOffsetDays);return b},_destroy:function(){var b=this.options,d=this.d.wrap.find("a");this.d.wrap.removeClass("ui-input-has-clear");d.remove();
b.lockInput&&this.d.input.removeAttr("readonly");this.d.input.off("datebox").off("focus.datebox").off("blur.datebox").off("change.datebox");c(document).off(this.drag.eMove).off(this.drag.eEnd).off(this.drag.eEndA)},_create:function(){c(document).trigger("dateboxcreate");var b=this,d=c.extend(this.options,this._getLongOptions(this.element),this.element.data("options")),a=d.theme===!1?c.mobile.getInheritedTheme(this.element):d.theme,g=d.useAnimation?d.transition:"none",g={input:this.element,wrap:this.element.parent(),
mainWrap:c("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden "+g+" ui-body-"+a}).css("zIndex",d.zindex),intHTML:!1},e=".datebox"+this.uuid,f=typeof window.ontouchstart!=="undefined",e={eStart:(f?"touchstart":"mousedown")+e,eMove:(f?"touchmove":"mousemove")+e,eEnd:(f?"touchend":"mouseup")+e,eEndA:f?["mouseup","touchend","touchcanel","touchmove"].join(e+" ")+e:"mouseup"+e,move:!1,start:!1,end:!1,pos:!1,target:!1,delta:!1,tmp:!1};c.extend(b,{d:g,drag:e,touch:f});
d.usePlaceholder!==!1&&(d.usePlaceholder===!0&&b._grabLabel()!==""&&b.d.input.attr("placeholder",b._grabLabel()),typeof d.usePlaceholder==="string"&&b.d.input.attr("placeholder",d.usePlaceholder));d.theme=a;b.disabled=!1;b.runButton=!1;b._date=window.Date;b._enhanceDate();b.baseID=b.d.input.attr("id");b.initDate=new b._date;b.initDate.setMilliseconds(0);b.theDate=d.defaultValue?b._makeDate():b.d.input.val()!==""?b._makeDate(b.d.input.val()):new b._date;b.d.input.val()===""&&b._startOffset(b.theDate);
b.initDone=!1;d.showInitialValue&&b.d.input.val(b._formatter(b.__fmt(),b.theDate));if(d.useButton&&d.mode!==!1){b.d.wrap.addClass("ui-input-has-clear");if(d.buttonIcon===!1)d.buttonIcon=d.mode.substr(0,4)==="time"||d.mode.substr(0,3)==="dur"?d.buttonIconTime:d.buttonIconDate;c("<a href='#' class='ui-input-clear ui-btn ui-icon-"+d.buttonIcon+" ui-btn-icon-notext ui-corner-all'></a>").attr("title",b.__("tooltip")).text(b.__("tooltip")).appendTo(b.d.wrap).on(d.clickEvent,function(a){a.preventDefault();
d.useFocus?b.d.input.focus():b.disabled||b._t({method:"open"})})}d.hideInput&&b.d.wrap.hide();d.hideContainer&&b.d.wrap.parent().hide();b.d.input.on("focus.datebox",function(){b.d.input.addClass("ui-focus");b.disabled===!1&&d.useFocus&&b._t({method:"open"})}).on("blur.datebox",function(){b.d.input.removeClass("ui-focus")}).on("change.datebox",function(){b.theDate=b._makeDate(b.d.input.val());b.refresh()}).on("datebox",b._event);d.lockInput&&b.d.input.attr("readonly","readonly");if(typeof c.event.special.mousewheel!==
"undefined")b.wheelExists=!0;b.d.input.is(":disabled")&&b.disable();b.applyMinMax(!1,!1);(d.useInline||d.useInlineBlind)&&b.open();c(document).trigger("dateboxaftercreate")},applyMinMax:function(b,c){var a,g,e=this.options;a=this._pa([0,0,0],new this._date);typeof b==="undefined"&&(b=!0);typeof c==="undefined"&&(c=!0);if((c===!0||e.minDays===!1)&&typeof this.d.input.attr("min")!=="undefined")g=this.d.input.attr("min").split("-"),g=new this._date(g[0],g[1]-1,g[2],0,0,0,0),g=(g.getTime()-a.getTime())/
864E5,e.minDays=parseInt(g*-1,10)+1;if((c===!0||e.maxDays===!1)&&typeof this.d.input.attr("max")!=="undefined")g=this.d.input.attr("max").split("-"),g=new this._date(g[0],g[1]-1,g[2],0,0,0,0),g=(g.getTime()-a.getTime())/864E5,e.maxDays=parseInt(g,10)-1;b===!0&&this._t({method:"refresh"})},_build:{"default":function(){this.d.headerText="Error";this.d.intHTML!==!1&&this.d.intHTML.remove().empty();this.d.intHTML=c("<div class='ui-body-b'><h2 style='text-align:center'>Unknown Mode</h2></div>")}},_drag:{"default":function(){return!1}},
open:function(){var b=this,d=this.options,a={transition:d.useAnimation?d.transition:"none"},g={history:!1,transition:d.useAnimation?d.transition:"none"};if(d.useFocus&&b.fastReopen===!0)return b.d.input.blur(),!1;b.theDate=b._makeDate(b.d.input.val());b.d.input.val()===""&&b._startOffset(b.theDate);b.d.input.blur();typeof b._build[d.mode]==="undefined"?b._build["default"].apply(b,[]):b._build[d.mode].apply(b,[]);typeof b._drag[d.mode]!=="undefined"&&b._drag[d.mode].apply(b,[]);b._t({method:"refresh"});
b.__("useArabicIndic")===!0&&b._doIndic();if((d.useInline||d.useInlineBlind)&&b.initDone===!1){b.d.mainWrap.append(b.d.intHTML);d.hideContainer?(d.useHeader&&b.d.mainWrap.prepend(c("<div class='ui-header ui-bar-"+d.themeHeader+"'><h1 class='ui-title'>"+b.d.headerText+"</h1></div>")),b.d.wrap.parent().after(b.d.mainWrap)):b.d.wrap.parent().append(b.d.mainWrap);b.d.mainWrap.removeClass("ui-datebox-hidden ui-overlay-shadow");if(d.useInline)return b.d.mainWrap.addClass("ui-datebox-inline"),!d.hideInput&&
!d.hideContainer&&b.d.mainWrap.addClass("ui-datebox-inline-has-input"),setTimeout(function(a){return function(){a._t({method:"postrefresh"})}}(b),100),!0;else b.d.mainWrap.addClass("ui-datebox-inline ui-datebox-inline-has-input"),b.d.mainWrap.hide();b.initDone=!1;b._t({method:"postrefresh"})}if(d.useInlineBlind)return b.initDone?(b.refresh(),b.d.mainWrap.slideDown(),b._t({method:"postrefresh"})):b.initDone=!0,!0;if(b.d.intHTML.is(":visible"))return!1;b.d.mainWrap.empty();d.useHeader&&(b.d.mainWrap.append(c("<a href='#'>Close</a>").addClass("ui-btn-left ui-link ui-btn ui-btn-a ui-icon-delete ui-btn-icon-notext ui-shadow ui-corner-all").on(d.clickEventAlt,
function(a){a.preventDefault();b._t({method:"close"})})),b.d.mainWrap.append(c("<div class='ui-header ui-bar-"+d.themeHeader+"'><h1 class='ui-title'>"+b.d.headerText+"</h1></div>")));b.d.mainWrap.append(b.d.intHTML).css("zIndex",d.zindex);b._t({method:"postrefresh"});a.positionTo=d.popupPosition!==!1?d.popupPosition:typeof b.baseID!=="undefined"?"#"+b.baseID:"window";if(d.popupForceX!==!1&&d.popupForceY!==!1)a.x=parseInt(d.popupForceX,10),a.y=parseInt(d.popupForceY,10),a.positionTo="origin";if(d.useModal)g.overlayTheme=
d.useModalTheme,g.dismissible=!1;if(d.openCallback!==!1){if(!c.isFunction(d.openCallback)&&typeof window[d.openCallback]==="function")d.openCallback=window[d.openCallback];g.afteropen=function(){b._t({method:"postrefresh"});d.openCallback.apply(b,c.merge([{custom:b.customCurrent,initDate:b.initDate,date:b.theDate,duration:b.lastDuration}],d.openCallbackArgs))===!1&&b._t({method:"close"})}}else g.afteropen=function(){b._t({method:"postrefresh"})};if(d.closeCallback!==!1){if(!c.isFunction(d.closeCallback)&&
typeof window[d.closeCallback]==="function")d.closeCallback=window[d.closeCallback];g.afterclose=function(){d.closeCallback.apply(b,c.merge([{custom:b.customCurrent,initDate:b.initDate,date:b.theDate,duration:b.lastDuration}],d.closeCallbackArgs))}}b.d.mainWrap.removeClass("ui-datebox-hidden").popup(g).popup("open",a)},close:function(){var b=this.options;if(b.useInlineBlind)return this.d.mainWrap.slideUp(),!0;if(b.useInline||this.d.intHTML===!1)return!0;this.d.mainWrap.popup("close");c(document).off(this.drag.eMove).off(this.drag.eEnd).off(this.drag.eEndA);
if(b.useFocus)this.fastReopen=!0,setTimeout(function(b){return function(){b.fastReopen=!1}}(this),300)},refresh:function(){var b=this.options;typeof this._build[b.mode]==="undefined"?this._build["default"].apply(this,[]):this._build[b.mode].apply(this,[]);this.__("useArabicIndic")===!0&&this._doIndic();this.d.mainWrap.append(this.d.intHTML);this._t({method:"postrefresh"})},_check:function(){var b,d,a,g,e=this.options,f=this.theDate;this.dateOK=!0;if(typeof e.mode==="undefined")return!0;e.afterToday&&
(b=new this._date,f<b&&(f=b));e.beforeToday&&(b=new this._date,f>b&&(f=b));e.maxDays!==!1&&(b=new this._date,b.adj(2,e.maxDays),f>b&&(f=b));e.minDays!==!1&&(b=new this._date,b.adj(2,-1*e.minDays),f<b&&(f=b));e.minHour!==!1&&f.get(3)<e.minHour&&f.setD(3,e.minHour);e.maxHour!==!1&&f.get(3)>e.maxHour&&f.setD(3,e.maxHour);e.maxYear!==!1&&(b=new this._date(e.maxYear,11,31),f>b&&(f=b));e.minYear!==!1&&(b=new this._date(e.minYear,0,1),f<b&&(f=b));if(e.mode.substr(0,4)==="time"||e.mode.substr(0,3)==="dur"){if(e.mode===
"timeflipbox"&&e.validHours!==!1&&c.inArray(f.get(3),e.validHours)<0)this.dateOK=!1}else{if(e.blackDatesRec!==!1){b=f.get(0);d=f.get(1);a=f.get(2);for(g=0;g<e.blackDatesRec.length;g++)if((e.blackDatesRec[g][0]===-1||e.blackDatesRec[g][0]===b)&&(e.blackDatesRec[g][1]===-1||e.blackDatesRec[g][1]===d)&&(e.blackDatesRec[g][2]===-1||e.blackDatesRec[g][2]===a))this.dateOK=!1}if(e.blackDates!==!1&&c.inArray(f.iso(),e.blackDates)>-1)this.dateOK=!1;if(e.blackDays!==!1&&c.inArray(f.getDay(),e.blackDays)>-1)this.dateOK=
!1;if(e.whiteDates!==!1&&c.inArray(f.iso(),e.whiteDates)>-1)this.dateOK=!0}this.theDate=f},_grabLabel:function(){var b,d;b=this.options;d=!1;if(typeof b.overrideDialogLabel==="undefined"){b=this.d.input.attr("placeholder");d=this.d.input.attr("title");if(typeof b!=="undefined")return b;if(typeof d!=="undefined")return d;d=c(document).find("label[for='"+this.d.input.attr("id")+"']").text();return d===""?!1:d}return b.overrideDialogLabel},_stdBtn:{clear:function(){var b=this,d=this.options;return c("<a href='#' role='button'>"+
b.__("clearButton")+"</a>").addClass("ui-btn ui-btn-"+d.theme+" ui-icon-delete ui-btn-icon-left ui-shadow ui-corner-all").on(d.clickEventAlt,function(a){a.preventDefault();b.d.input.val("");b._t({method:"clear"});b._t({method:"close"})})},close:function(b){var d=this,a=this.options;return c("<a href='#' role='button'>"+b+"</a>").addClass("ui-btn ui-btn-"+a.theme+" ui-icon-check ui-btn-icon-left ui-shadow ui-corner-all"+(d.dateOK===!0?"":" ui-state-disabled")).on(a.clickEventAlt,function(a){a.preventDefault();
d.dateOK===!0&&(d._t({method:"set",value:d._formatter(d.__fmt(),d.theDate),date:d.theDate}),d._t({method:"close"}))})}},_makeEl:function(b,c){var a=!1,g=!1,g=b.clone();if(typeof c.attr!=="undefined")for(a in c.attr)c.attr.hasOwnProperty(a)&&g.data(a,c.attr[a]);return g},_getLongOptions:function(b){var c,a,g={};for(c in b.data())c.substr(0,7)==="datebox"&&c.length>7&&(a=c.substr(7),a=a.charAt(0).toLowerCase()+a.slice(1),a!=="options"&&(g[a]=b.data(c)));return g},disable:function(){this.d.input.attr("disabled",
!0);this.d.wrap.addClass("ui-state-disabled").blur();this.disabled=!0;this.d.mainWrap.addClass("ui-state-disabled");this._t({method:"disable"})},enable:function(){this.d.input.attr("disabled",!1);this.d.wrap.removeClass("ui-state-disabled");this.disabled=!1;this.d.mainWrap.removeClass("ui-state-disabled");this._t({method:"enable"})},_setOption:function(){c.Widget.prototype._setOption.apply(this,arguments);this.refresh()},getTheDate:function(){return this.theDate},getLastDur:function(){return this.lastDuration},
setTheDate:function(b){this.theDate=typeof b==="object"?b:this._makeDate(b);this.refresh();this._t({method:"doset"})},parseDate:function(b,c){var a;this.fmtOver=b;a=this._makeDate(c);this.fmtOver=!1;return a},callFormat:function(b,c){return this._formatter(b,c)},getOption:function(b){var c=this.__(b);return typeof c!=="undefined"?c:this.options[b]},_t:function(b){this.d.input.trigger("datebox",b)}})})(jQuery);
(function(c){c.extend(c.mobile.datebox.prototype.options,{themeButton:"a",themeInput:"a",useSetButton:!0,validHours:!1,repButton:!0,durationStep:1,durationSteppers:{d:1,h:1,i:1,s:1}});c.extend(c.mobile.datebox.prototype,{_dbox_run:function(){var b=this,c=this.drag,a=150;c.cnt>10&&(a=100);c.cnt>30&&(a=50);c.cnt>60&&(a=20);c.cnt>120&&(a=10);c.cnt>240&&(a=3);c.didRun=!0;c.cnt++;b._offset(c.target[0],c.target[1],!1);b._dbox_run_update();b.runButton=setTimeout(function(){b._dbox_run()},a)},_dbox_fixstep:function(b){var d=
this.options.durationSteppers,a=this.options.durationStep;if(c.inArray("s",b)>-1)d.i=1,d.s=a;if(c.inArray("i",b)>-1)d.h=1,d.s=a;if(c.inArray("h",b)>-1)d.d=1,d.s=a},_dbox_run_update:function(b){var d=this,a=this.options,g=d.theDate.getTime()-d.initDate.getTime(),e=a.mode==="durationbox"?!0:!1,f=d._dur(g<0?0:g);if(g<0)d.lastDuration=0,e&&d.theDate.setTime(d.initDate.getTime());b!==!0&&e!==!0&&(d._check(),a.mode==="datebox"&&d.d.intHTML.find(".ui-datebox-header").find("h4").text(d._formatter(d.__("headerFormat"),
d.theDate)),a.useSetButton&&(d.dateOK===!1?d.setBut.addClass("ui-state-disabled"):d.setBut.removeClass("ui-state-disabled")));d.d.divIn.find("input").each(function(){switch(c(this).data("field")){case "y":c(this).val(d.theDate.get(0));break;case "m":c(this).val(d.theDate.get(1)+1);break;case "d":c(this).val(e?f[0]:d.theDate.get(2));break;case "h":e?c(this).val(f[1]):d.__("timeFormat")===12?c(this).val(d.theDate.get12hr()):c(this).val(d.theDate.get(3));break;case "i":e?c(this).val(f[2]):c(this).val(d._zPad(d.theDate.get(4)));
break;case "M":c(this).val(d.__("monthsOfYearShort")[d.theDate.get(1)]);break;case "a":c(this).val(d.__("meridiem")[d.theDate.get(3)>11?1:0]);break;case "s":c(this).val(f[3])}});d.__("useArabicIndic")===!0&&d._doIndic()},_dbox_vhour:function(b){var d=this.options,a,g=[25,0],e=[25,0];if(d.validHours===!1)return!0;if(c.inArray(this.theDate.getHours(),d.validHours)>-1)return!0;a=this.theDate.getHours();c.each(d.validHours,function(){(a<this?1:-1)===b?g[0]>Math.abs(this-a)&&(g=[Math.abs(this-a),parseInt(this,
10)]):e[0]>Math.abs(this-a)&&(e=[Math.abs(this-a),parseInt(this,10)])});g[1]!==0?this.theDate.setHours(g[1]):this.theDate.setHours(e[1])},_dbox_enter:function(b){var d,a=0;b.data("field")==="M"&&(d=c.inArray(b.val(),this.__("monthsOfYearShort")),d>-1&&this.theDate.setMonth(d));if(b.val()!==""&&b.val().toString().search(/^[0-9]+$/)===0)switch(b.data("field")){case "y":this.theDate.setD(0,parseInt(b.val(),10));break;case "m":this.theDate.setD(1,parseInt(b.val(),10)-1);break;case "d":this.theDate.setD(2,
parseInt(b.val(),10));a+=86400*parseInt(b.val(),10);break;case "h":this.theDate.setD(3,parseInt(b.val(),10));a+=3600*parseInt(b.val(),10);break;case "i":this.theDate.setD(4,parseInt(b.val(),10));a+=60*parseInt(b.val(),10);break;case "s":a+=parseInt(b.val(),10)}this.options.mode==="durationbox"&&this.theDate.setTime(this.initDate.getTime()+a*1E3);this.refresh()}});c.extend(c.mobile.datebox.prototype._build,{timebox:function(){this._build.datebox.apply(this,[])},durationbox:function(){this._build.datebox.apply(this,
[])},datebox:function(){var b,d,a,g,e=this,f=this.drag,i=this.options,h=i.mode==="durationbox"?!0:!1;a=-2;b=c("<div>");var k=c("<fieldset>"),l=b.clone(),j=k.clone(),m=b.clone(),n=c("<div><input type='text'></div>").addClass("ui-input-text ui-body-"+i.themeInput+" ui-corner-all ui-mini ui-shadow-inset"),o=c("<div></div>"),q="ui-btn-inline ui-link ui-btn ui-btn-"+i.themeButton+" ui-btn-icon-notext ui-shadow ui-corner-all";typeof e.d.intHTML!=="boolean"&&e.d.intHTML.empty().remove();e.d.headerText=e._grabLabel()!==
!1?e._grabLabel():i.mode==="datebox"?e.__("titleDateDialogLabel"):e.__("titleTimeDialogLabel");e.d.intHTML=c("<span>");e.fldOrder=i.mode==="datebox"?e.__("dateFieldOrder"):h?e.__("durationOrder"):e.__("timeFieldOrder");h?(e.dateOK=!0,e._dbox_fixstep(e.fldOrder)):(e._check(),e._minStepFix(),e._dbox_vhour(typeof e._dbox_delta!=="undefined"?e._dbox_delta:1));i.mode==="datebox"&&c("<div class='ui-datebox-header'><h4>"+e._formatter(e.__("headerFormat"),e.theDate)+"</h4></div>").appendTo(e.d.intHTML);for(d=
0;d<e.fldOrder.length;d++)if(g=e._gridblk.b[d],b=h?i.durationSteppers[e.fldOrder[d]]:e.fldOrder[d]==="i"?i.minuteStep:1,e.fldOrder[d]!=="a"||e.__("timeFormat")===12)c("<div>").append(h?"<label>"+e.__("durationLabel")[d]+"</label>":"").addClass("ui-block-"+g).appendTo(m),c("<div>").append(e._makeEl(n,{attr:{field:e.fldOrder[d],amount:b}})).addClass("ui-block-"+g).appendTo(l).find("input").data({field:e.fldOrder[d],amount:b}),e._makeEl(o,{attr:{field:e.fldOrder[d],amount:b}}).addClass("ui-datebox-cbut ui-block-"+
g+" ui-icon-plus "+q).appendTo(k).prepend(h?"<label>"+e.__("durationLabel")[d]+"</label>":""),e._makeEl(o,{attr:{field:e.fldOrder[d],amount:b*-1}}).addClass("ui-datebox-cbut ui-block-"+g+" ui-icon-minus "+q).appendTo(j),a++;h&&m.addClass("ui-datebox-dboxlab ui-grid-"+e._gridblk.b[a]).appendTo(e.d.intHTML);k.addClass("ui-grid-"+e._gridblk.b[a]).appendTo(e.d.intHTML);l.addClass("ui-datebox-dboxin ui-grid-"+e._gridblk.b[a]).appendTo(e.d.intHTML);j.addClass("ui-grid-"+e._gridblk.b[a]).appendTo(e.d.intHTML);
e.d.divIn=l;e._dbox_run_update(!0);e.dateOK!==!0?l.find("input").addClass("ui-state-disable"):l.find(".ui-state-disable").removeClass("ui-state-disable");if(i.useSetButton||i.useClearButton){a=c("<div>",{"class":"ui-datebox-controls"});if(i.useSetButton)e.setBut=e._stdBtn.close.apply(e,[i.mode==="datebox"?e.__("setDateButtonLabel"):h?e.__("setDurationButtonLabel"):e.__("setTimeButtonLabel")]),e.setBut.appendTo(a);i.useClearButton&&a.append(e._stdBtn.clear.apply(e));i.useCollapsedBut?(a.controlgroup({type:"horizontal"}),
a.addClass("ui-datebox-collapse")):a.controlgroup();a.appendTo(e.d.intHTML)}if(!i.repButton)e.d.intHTML.on(i.clickEvent,".ui-datebox-cbut",function(a){l.find(":focus").blur();a.preventDefault();e._dbox_delta=c(this).data("amount")>1?1:-1;e._offset(c(this).data("field"),c(this).data("amount"))});l.on("change","input",function(){e._dbox_enter(c(this))});if(e.wheelExists)l.on("mousewheel","input",function(a,b){a.preventDefault();e._dbox_delta=b<0?-1:1;e._offset(c(this).data("field"),(b<0?-1:1)*c(this).data("amount"))});
i.repButton&&(e.d.intHTML.on(f.eStart,".ui-datebox-cbut",function(){l.find(":focus").blur();g=[c(this).data("field"),c(this).data("amount")];f.move=!0;f.cnt=0;e._dbox_delta=c(this).data("amount")>1?1:-1;e._offset(g[0],g[1],!1);e._dbox_run_update();if(!e.runButton)f.target=g,e.runButton=setTimeout(function(){e._dbox_run()},500)}),e.d.intHTML.on(f.eEndA,".ui-datebox-cbut",function(a){if(f.move)a.preventDefault(),clearTimeout(e.runButton),e.runButton=!1,f.move=!1}))}})})(jQuery);
jQuery.extend(jQuery.mobile.datebox.prototype.options.lang,{en:{setDateButtonLabel:"Set Date",setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",titleDateDialogLabel:"Choose Date",titleTimeDialogLabel:"Choose Time",daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysOfWeekShort:["Su","Mo","Tu","We","Th","Fr","Sa"],monthsOfYear:["January","February","March","April","May","June","July","August","September","October",
"November","December"],monthsOfYearShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],tooltip:"Open Date Picker",nextMonth:"Next Month",prevMonth:"Previous Month",timeFormat:12,headerFormat:"%A, %B %-d, %Y",dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],dateFormat:"%-m/%-d/%Y",useArabicIndic:!1,isRTL:!1,calStartDay:0,clearButton:"Clear",durationOrder:["d",
"h","i","s"],meridiem:["AM","PM"],timeOutput:"%l:%M %p",durationFormat:"%Dd %DA, %Dl:%DM:%DS",calDateListLabel:"Other Dates",calHeaderFormat:"%B %Y",calTomorrowButtonLabel:"Jump to Tomorrow"}});jQuery.extend(jQuery.mobile.datebox.prototype.options,{useLang:"en"});/*

 eventsource.js
 Available under MIT License (MIT)
 https://github.com/Yaffle/EventSource/
*/
(function(c){function b(a){this.xhr=a;this.abort=q}function d(){this._data={}}function a(){this._listeners=new d}function g(a){l(function(){throw a;},0)}function e(a){this.type=a;this.target=void 0}function f(a,b){e.call(this,a);this.data=b.data;this.lastEventId=b.lastEventId}function i(a,b){this._listeners=new d;this.onerror=this.onmessage=this.onopen=void 0;this.url="";this.readyState=r;this.withCredentials=!1;this._internal=new h(this,a,b)}function h(a,c,d){this.url=c.toString();this.readyState=
r;this.withCredentials=p&&d!=void 0&&Boolean(d.withCredentials);this.es=a;this.initialRetry=y(1E3,0);this.heartbeatTimeout=y(45E3,0);this.lastEventId="";this.retry=this.initialRetry;this.wasActivity=!1;a=d!=void 0&&d.Transport!=void 0?d.Transport:u;this.headers=d!=void 0&&d.headers!=void 0?JSON.parse(JSON.stringify(d.headers)):void 0;d=new a;this.transport=new b(d);this.timeout=0;this.currentState=s;this.dataBuffer=[];this.textBuffer=this.eventTypeBuffer=this.lastEventIdBuffer="";this.state=t;this.valueStart=
this.fieldStart=0;this.es.url=this.url;this.es.readyState=this.readyState;this.es.withCredentials=this.withCredentials;this.onTimeout()}function k(){this.CONNECTING=r;this.OPEN=v;this.CLOSED=x}var l=c.setTimeout,j=c.clearTimeout,m=c.XMLHttpRequest,n=c.XDomainRequest,o=c.EventSource,q=function(){};b.prototype.open=function(a,b,c,d,e,f,g){this.abort(!0);var h=this.xhr,i=1,k=0,n=0;this.abort=function(a){if(i===1||i===2||i===3)i=4,h.onload=q,h.onerror=q,h.onabort=q,h.onprogress=q,h.onreadystatechange=
q,h.abort(),n!==0&&(j(n),n=0),a||c.call(d);i=0};var o=function(){if(i===1){var b=0,c="",e=void 0;if("contentType"in h)b=200,c="OK",e=h.contentType;else try{b=h.status,c=h.statusText,e=h.getResponseHeader("Content-Type")}catch(f){b=0,c="",e=void 0}b!==0&&(i=2,a.call(d,b,c,e))}},p=function(){o();if(i===2||i===3){i=3;var a="";try{a=h.responseText}catch(c){}a=a.slice(k);k+=a.length;b.call(d,a)}},r=function(){p();if(i===1||i===2||i===3)i=4,n!==0&&(j(n),n=0),c.call(d)},s=function(){n=l(function(){s()},
500);h.readyState===3&&p()};h.onload=r;h.onerror=r;h.onabort=r;if(m!=void 0&&!("sendAsBinary"in m.prototype)&&!("mozAnon"in m.prototype))h.onprogress=p;h.onreadystatechange=function(){h!=void 0&&(h.readyState===4?r():h.readyState===3?p():h.readyState===2&&o())};h.open("GET",e,!0);h.withCredentials=f;h.responseType="text";if("setRequestHeader"in h)for(var u in g)Object.prototype.hasOwnProperty.call(g,u)&&h.setRequestHeader(u,g[u]);try{h.send(void 0)}catch(t){throw t;}"readyState"in h&&(n=l(function(){s()},
0))};b.prototype.cancel=function(){this.abort(!1)};d.prototype.get=function(a){return this._data[a+"~"]};d.prototype.set=function(a,b){this._data[a+"~"]=b};d.prototype["delete"]=function(a){delete this._data[a+"~"]};a.prototype.dispatchEvent=function(a){a.target=this;var b=this._listeners.get(a.type.toString());if(b!=void 0)for(var c=b.length,d=void 0,e=0;e<c;e+=1){d=b[e];try{typeof d.handleEvent==="function"?d.handleEvent(a):d.call(this,a)}catch(f){g(f)}}};a.prototype.addEventListener=function(a,
b){var a=a.toString(),c=this._listeners,d=c.get(a);d==void 0&&(d=[],c.set(a,d));for(c=d.length;c>=0;c-=1)if(d[c]===b)return;d.push(b)};a.prototype.removeEventListener=function(a,b){var a=a.toString(),c=this._listeners,d=c.get(a);if(d!=void 0){for(var e=d.length,f=[],g=0;g<e;g+=1)d[g]!==b&&f.push(d[g]);if(f.length===0)c["delete"](a);else c.set(a,f)}};f.prototype=e.prototype;var p=m!=void 0&&(new m).withCredentials!=void 0,u=p||m!=void 0&&n==void 0?m:n,s=-1,r=0,v=1,x=2,t=4,w=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,
y=function(a,b){var c=a;c!==c&&(c=b);return c<1E3?1E3:c>18E6?18E6:c},z=function(a,b,c){try{typeof b==="function"&&b.call(a,c)}catch(d){g(d)}};h.prototype.onStart=function(a,b,c){if(this.currentState===r)if(a===200&&c!=void 0&&w.test(c))this.currentState=v,this.wasActivity=!0,this.retry=this.initialRetry,this.readyState=v,this.es.readyState=v,a=new e("open"),this.es.dispatchEvent(a),z(this.es,this.es.onopen,a);else{var d="";a!==200?(b&&(b=b.replace(/\s+/g," ")),d="EventSource's response has a status "+
a+" "+b+" that is not 200. Aborting the connection."):d="EventSource's response has a Content-Type specifying an unsupported type: "+(c==void 0?"-":c.replace(/\s+/g," "))+". Aborting the connection.";g(Error(d));this.close();a=new e("error");this.es.dispatchEvent(a);z(this.es,this.es.onerror,a)}};h.prototype.onProgress=function(a){if(this.currentState===v){for(var b=-1,c=0;c<a.length;c+=1){var d=a.charCodeAt(c);if(d==="\n".charCodeAt(0)||d==="\r".charCodeAt(0))b=c}c=(b!==-1?this.textBuffer:"")+a.slice(0,
b+1);this.textBuffer=(b===-1?this.textBuffer:"")+a.slice(b+1);a=c.length;if(a!==0)this.wasActivity=!0;for(b=0;b<a;b+=1)if(d=c.charCodeAt(b),this.state===3&&d==="\n".charCodeAt(0))this.state=t;else{if(this.state===3)this.state=t;if(d==="\r".charCodeAt(0)||d==="\n".charCodeAt(0)){if(this.state!==t){if(this.state===5)this.valueStart=b+1;var e=c.slice(this.fieldStart,this.valueStart-1),g=c.slice(this.valueStart+(this.valueStart<b&&c.charCodeAt(this.valueStart)===" ".charCodeAt(0)?1:0),b);if(e==="data")this.dataBuffer.push(g);
else if(e==="id")this.lastEventIdBuffer=g;else if(e==="event")this.eventTypeBuffer=g;else if(e==="retry")this.retry=this.initialRetry=y(Number(g),this.initialRetry);else if(e==="heartbeatTimeout"&&(this.heartbeatTimeout=y(Number(g),this.heartbeatTimeout),this.timeout!==0)){j(this.timeout);var h=this;this.timeout=l(function(){h.onTimeout()},this.heartbeatTimeout)}}if(this.state===t){if(this.dataBuffer.length!==0){this.lastEventId=this.lastEventIdBuffer;if(this.eventTypeBuffer==="")this.eventTypeBuffer=
"message";e=new f(this.eventTypeBuffer,{data:this.dataBuffer.join("\n"),lastEventId:this.lastEventIdBuffer});this.es.dispatchEvent(e);this.eventTypeBuffer==="message"&&z(this.es,this.es.onmessage,e);if(this.currentState===x)break}this.dataBuffer.length=0;this.eventTypeBuffer=""}this.state=d==="\r".charCodeAt(0)?3:t}else{if(this.state===t)this.fieldStart=b,this.state=5;if(this.state===5){if(d===":".charCodeAt(0))this.valueStart=b+1,this.state=6}else if(this.state===6)this.state=7}}}};h.prototype.onFinish=
function(){if(this.currentState===v||this.currentState===r){this.currentState=s;if(this.timeout!==0)j(this.timeout),this.timeout=0;if(this.retry>this.initialRetry*16)this.retry=this.initialRetry*16;if(this.retry>18E6)this.retry=18E6;var a=this;this.timeout=l(function(){a.onTimeout()},this.retry);this.retry=this.retry*2+1;this.readyState=r;this.es.readyState=r;var b=new e("error");this.es.dispatchEvent(b);z(this.es,this.es.onerror,b)}};h.prototype.onTimeout=function(){this.timeout=0;if(this.currentState===
s&&m!=void 0&&!("ontimeout"in m.prototype)&&c.document!=void 0&&c.document.readyState!=void 0&&c.document.readyState!=="complete"){var a=this;this.timeout=l(function(){a.onTimeout()},4)}else if(this.currentState!==s)this.wasActivity?(this.wasActivity=!1,a=this,this.timeout=l(function(){a.onTimeout()},this.heartbeatTimeout)):(g(Error("No activity within "+this.heartbeatTimeout+" milliseconds. Reconnecting.")),this.transport.cancel());else{this.wasActivity=!1;a=this;this.timeout=l(function(){a.onTimeout()},
this.heartbeatTimeout);this.currentState=r;this.dataBuffer.length=0;this.eventTypeBuffer="";this.lastEventIdBuffer=this.lastEventId;this.textBuffer="";this.valueStart=this.fieldStart=0;this.state=t;var b=this.url;this.url.slice(0,5)!=="data:"&&this.url.slice(0,5)!=="blob:"&&(b=this.url+((this.url.indexOf("?",0)===-1?"?":"&")+"lastEventId="+encodeURIComponent(this.lastEventId)+"&r="+(Math.random()+1).toString().slice(2)));var d={Accept:"text/event-stream"};if(this.headers!=void 0)for(var e in this.headers)Object.prototype.hasOwnProperty.call(this.headers,
e)&&(d[e]=this.headers[e]);try{this.transport.open(this.onStart,this.onProgress,this.onFinish,this,b,this.withCredentials,d)}catch(f){throw this.close(),f;}}};h.prototype.close=function(){this.currentState=x;this.transport.cancel();if(this.timeout!==0)j(this.timeout),this.timeout=0;this.readyState=x;this.es.readyState=x};k.prototype=a.prototype;i.prototype=new k;i.prototype.close=function(){this._internal.close()};k.call(i);if(p)i.prototype.withCredentials=void 0;c.EventSourcePolyfill=i;c.NativeEventSource=
o;if(u!=void 0&&(o==void 0||p&&!(o!=void 0&&"withCredentials"in o.prototype)))c.EventSource=i})(typeof window!=="undefined"?window:this);RELite.Device=function(){var c=navigator.userAgent.toLowerCase(),b=!1,d=!1,d=!1,a=!!document.createElement("canvas").getContext,g=function(){var a=navigator.userAgent.match(/Windows|Macintosh|Linux|Android/gi);return!!a&&a.length==1}(),e=function(){var a=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1)}(),d=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||
navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||
navigator.vendor||window.opera).substr(0,4))?!0:!1;c.indexOf("ipad")>=0&&(b=!0,d=!1);c.indexOf("android")>=0&&c.indexOf("mobile")==-1&&(b=!0,d=!1);return{bIsTablet:b,bIsSmartphone:d,bIsDesktop:!(d||b),bCanRunRELite:a,bCouldRunJava:g,pixelRatio:e}}();function Slider(c,b){this.min=0;this.max=100;this.pickerWidth=this.width=this.value=0;this.textEl=this.barWidth=this.bar=this.picker=this.domEl=null;this.onValueEndChange=this.onValueStartChange=this.onValueChanged=$.noop;this.dragStarted=!1;this.dragStartingPoint={x:0,y:0};this.init(c,b)}Slider.prototype.setRange=function(c,b){this.min=c;this.max=b;this.setValue(this.value)};
Slider.prototype.setValue=function(c){var b=Math.round(this.barWidth*c)/this.max;this.value=c;this.picker.setAttribute("x",b);this.textEl.textContent=c;this.onValueChanged(c)};Slider.prototype.eventDispatcher=function(c){c.preventDefault&&c.preventDefault();var b=this.slider;if(b[c.type])b[c.type](c)};
Slider.prototype.mousemove=function(c){if(this.dragStarted){var b=this.dragStartingPoint.x-c.clientX,b=parseInt(this.picker.getAttribute("x"),10)-b;if(b>=0&&b<=this.barWidth)this.picker.setAttribute("x",b),this.value=Math.round(b*this.max/this.barWidth),this.onValueChanged(this.value),this.textEl.textContent=this.value;this.dragStartingPoint.x=c.clientX}};Slider.prototype.mousedown=function(c){this.dragStarted=!0;this.dragStartingPoint.x=c.clientX;this.dragStartingPoint.y=c.clientY;this.onValueStartChange()};
Slider.prototype.mouseup=function(){this.dragStarted=!1;this.dragStartingPoint={x:0,y:0};this.onValueEndChange()};Slider.prototype.touchstart=function(c){if(c.touches)c.clientX=c.touches[0].clientX,c.clientY=c.touches[0].clientX,this.mousedown(c)};Slider.prototype.touchmove=function(c){if(c.touches)c.clientX=c.touches[0].clientX,c.clientY=c.touches[0].clientX,this.mousemove(c)};Slider.prototype.touchend=function(c){this.mouseup(c)};
Slider.prototype.initEvents=function(){this.picker.addEventListener("mousedown",this.eventDispatcher,!0);this.picker.addEventListener("mousemove",this.eventDispatcher,!0);this.picker.addEventListener("mouseup",this.eventDispatcher,!0);this.picker.addEventListener("touchstart",this.eventDispatcher,!0);this.picker.addEventListener("touchmove",this.eventDispatcher,!0);this.picker.addEventListener("touchend",this.eventDispatcher,!0)};
Slider.prototype.init=function(c,b){if(b)for(var d in b)this[d]&&(this[d]=b[d]);this.domEl=document.getElementById(c);this.picker=this.domEl.querySelector(".picker");this.domEl.slider=this;this.picker.slider=this;this.textEl=this.domEl.querySelector(".text");this.bar=this.domEl.querySelector(".bar");this.width=this.domEl.clientWidth;this.pickerWidth=this.picker.getBBox().width;this.barWidth=this.bar.getBBox().width;this.initEvents()};function SeriesPanel(c,b){this.canvas=c;this.currentImage=this.ctx=null;this.currentImageIndex=0;this.translateY=this.translateX=this.viewingSeries=null;this.zoom=1;this.imageResizedHeight=this.imageResizedWidth=0;this.isDetailPanel=!!b;this.iDetailPanelOffsetTopAdjust=b?48:0;this.borderColor="yellow";this.scaleRatio=1;this.bPlayingCine=!1;this.bCineStopped=!0;this.iCineFPS=this.iCineFrameTime=0;this.fps="";this.fpsInterval=this.cineTimeout=null;this.rotationRad=0;this.iFlipHorizontal=this.iFlipVertical=
1;this.bIsLocked=!1;if(RELite.Settings.bEnableHDOverlay)this.$overlay=$(document.createElement("div")).addClass("overlay"),this.$warningOverlay=$(document.createElement("div")).addClass("overlay");this.curRefLine=null;this.invertImageColors=!1;this.scrollBarPicker=this.scrollBarContainer=null;this.scrollBarPickerDragged=!1;this.scrollBarPickerTop=this.scrollBarPickerInitialY=0;this.scrollBarPickerHeight=SeriesPanel.MIN_SCROLLBAR_PICKER_HEIGHT}SeriesPanel.MIN_SCROLLBAR_PICKER_HEIGHT=34;
SeriesPanel.SCROLLBAR_WIDTH=RELite.Device.bIsDesktop?21:42;
SeriesPanel.prototype.setScrollBarContainer=function(c){var b=this.scrollBarContainer===null;this.scrollBarContainer=c;this.scrollBarContainer.style.width=SeriesPanel.SCROLLBAR_WIDTH+"px";this.scrollBarPicker=c.querySelector(".scrollbar-picker");this.scrollBarPicker.style.height=this.scrollBarPickerHeight+"px";b&&(RELite.Utils.addEventListener(this.scrollBarPicker,"mousedown",this.onScrollBarPickerMouseDown.bind(this)),RELite.Utils.addEventListener(this.scrollBarContainer.parentElement,"mousemove",
this.onScrollBarPickerMouseMove.bind(this)),RELite.Utils.addEventListener(this.scrollBarContainer.parentElement,"mouseup",this.onScrollBarPickerMouseUp.bind(this)),RELite.Utils.addEventListener(this.scrollBarPicker,"touchstart",this.onScrollBarPickerMouseDown.bind(this)),RELite.Utils.addEventListener(this.scrollBarContainer.parentElement,"touchmove",this.onScrollBarPickerMouseMove.bind(this)),RELite.Utils.addEventListener(this.scrollBarContainer.parentElement,"touchend",this.onScrollBarPickerMouseUp.bind(this)),
RELite.Utils.addEventListener(this.scrollBarContainer,"mousedown",this.onScrollBarContainerClicked.bind(this)),RELite.Utils.addEventListener(this.scrollBarContainer,"touchstart",this.onScrollBarContainerClicked.bind(this)))};SeriesPanel.prototype.onScrollBarContainerClicked=function(c){var b=c.clientY;if(!this.scrollBarPickerDragged&&this.viewingSeries){if(c.touches)b=c.touches[0].clientY,c.preventDefault();var c=$(this.scrollBarPicker).offset().top,d=this.currentImageIndex;b>c?d++:d--;this.setCurrentImageIndex(d)}};
SeriesPanel.prototype.onScrollBarPickerMouseDown=function(c){this.scrollBarPickerDragged=!0;var b=c.clientY;if(c.touches)b=c.touches[0].clientY;this.scrollBarPickerInitialY=b};SeriesPanel.prototype.onScrollBarPickerMouseUp=function(){this.scrollBarPickerDragged=!1;this.scrollBarPickerInitialY=0;$("#scrollBarPickerPopupContainer").addClass("hidden")};
SeriesPanel.prototype.onScrollBarPickerMouseMove=function(c){if(this.scrollBarPickerDragged&&this.viewingSeries){var b=c.clientY;if(c.touches)b=c.touches[0].clientY,c.preventDefault();this.scrollBarPickerTop+=b-this.scrollBarPickerInitialY;var c=Math.min(this.canvas.iCSSHeight-this.scrollBarPickerHeight,Math.max(0,this.scrollBarPickerTop)),d=this.currentImageIndex,a=Math.round(c/(this.canvas.iCSSHeight/this.viewingSeries.dicomImages.length));d!=a&&this.setCurrentImageIndex(a,!0);this.scrollBarPicker.style.top=
c+"px";this.scrollBarPickerInitialY=b;$("#scrollBarPickerPopupContainer").css({top:$(this.scrollBarPicker).offset().top+(this.scrollBarPickerHeight-24)/2,left:$(this.scrollBarPicker).offset().left-48,zIndex:15}).removeClass("hidden").find("#scrollBarPikerFrameNum").text(d+1)}};SeriesPanel.prototype.onScrollBarPickerMouseLeave=function(){this.scrollBarPickerDragged=!1;this.scrollBarPickerInitialY=0};
SeriesPanel.prototype.appendSeriesActionsPanel=function(){var c=RELite.Viewer.getSeriesActionsPanel();c||(c=document.getElementById("seriesActionsPanel"),RELite.Viewer.setSeriesActionsPanel(c));$(this.canvas).width();$(this.canvas).height();c.style.visibility="hidden";c.style.display="block";c.style.left="10px";c.style.zIndex=99;if(!c.slider)c.slider=new Slider("slider",{onValueChanged:this.onSliderValueChanged,onValueStartChange:this.onSliderValueStartChanging,onValueEndChange:this.onSliderValueStopChanging,
min:1,max:80});var b=$(this.canvas).offset(),d=b.top+this.canvas.clientHeight,a=b.left,b=c.slider.width+144+15;d>=$(window).height()-70&&(d-=45);a+b>$(window).width()?(c.style.right="0px",c.style.left="auto"):(c.style.left=a+"px",c.style.right="auto");c.style.top=d+"px";d=RELite.Manager.isDisplay()?"images/svgs/":"../images/svgs/";RELite.Manager.isLocalViewer()&&(d="Viewer-html5/images/svgs/");this.bPlayingCine?$("#playAction").find("image").attr("xlink:href",d+"action.stop.svg"):$("#playAction").find("image").attr("xlink:href",
d+"action.play.svg");c.slider.setValue(this.iCineFPS);if(b>$(window).width())c.style.display="none";c.style.visibility="visible"};SeriesPanel.prototype.reset=function(){this.stopCine();this.currentImage=null;this.currentImageIndex=0;this.translateY=this.translateX=this.viewingSeries=null;this.zoom=1;this.rotationRad=this.iCineFrameTime=this.iCineFPS=this.imageResizedHeight=this.imageResizedWidth=0;this.invertImageColors=!1};
SeriesPanel.prototype.resetOps=function(){var c=RELite.Manager.isLocalViewer();if(this.viewingSeries){c||this.viewingSeries.winLevLut.reset();for(var b=0;b<this.viewingSeries.dicomImages.length;b++)with(this.viewingSeries.dicomImages[b])downloaded&&(aDrawables=[],ww=0);this.translateY=this.translateX=null;this.zoom=1;this.rotationRad=0;this.iFlipVertical=this.iFlipHorizontal=1;this.invertImageColors=!1;c||((c=RELite.Manager.getForcedWL())?this.currentImage.setWindowLevel(c.ww*this.currentImage.multiplyVal,
c.wl*this.currentImage.multiplyVal+this.currentImage.additiveVal):(this.currentImage.calculateDefaultLUT(),this.currentImage.createWorkingCanvasPixels()),RELite.Viewer.refreshJPEGForSelectedPanel());this.calculateDICOMImageSize();this.redraw()}};
SeriesPanel.prototype.destroy=function(){RELite.Viewer.getSelectedImagePanel()===this&&RELite.Viewer.setSelectedImagePanel(null);this.stopCine();RELite.Utils.removeEventListener(this.canvas,"contextmenu",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"mousedown",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"mousemove",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"mouseup",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,
"mouseleave",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"touchstart",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"touchmove",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"touchend",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"mousewheel",this.canvasEventDispatcher);RELite.Utils.removeEventListener(this.canvas,"DOMMouseScroll",this.canvasEventDispatcher);"onwheel"in document?RELite.Utils.removeEventListener(this.canvas,
"wheel",this.canvasEventDispatcher):"onmousewheel"in document?RELite.Utils.removeEventListener(this.canvas,"mousewheel",this.canvasEventDispatcher):RELite.Utils.removeEventListener(this.canvas,"DOMMouseScroll",this.canvasEventDispatcher);RELite.Device.bIsDesktop&&(RELite.Utils.removeEventListener(this.canvas,"dragover",this.canvasDropHandler),RELite.Utils.removeEventListener(this.canvas,"dragenter",this.canvasDropHandler),RELite.Utils.removeEventListener(this.canvas,"drop",this.canvasDropHandler));
if(!this.isDetailPanel){var c=RELite.Utils.isMobile()?"taphold":"dblclick";$(this.canvas).unbind(c,this.canvasEventDispatcher)}this.viewingSeries&&this.viewingSeries.removeOnViewingSeriesChangedListener(this);if(this.scrollBarContainer)RELite.Utils.removeEventListener(this.scrollBarPicker,"mousedown",this.onScrollBarPickerMouseUp),RELite.Utils.removeEventListener(this.scrollBarPicker,"mousemove",this.onScrollBarPickerMouseMove),RELite.Utils.removeEventListener(this.scrollBarPicker,"mouseup",this.onScrollBarPickerMouseUp),
this.scrollBarPicker=this.scrollBarContainer=null;$(this.canvas.parentElement).remove();RELite.Settings.bEnableHDOverlay&&(this.$overlay.remove(),this.$warningOverlay.remove());for(var b in this)this[b]=void 0,delete this.key};
SeriesPanel.prototype.init=function(){this.ctx=this.canvas.getContext("2d");if(!this.ctx.strokeText)this.ctx.strokeText=$.noop;this.canvas.seriesPanel=this;RELite.Utils.addEventListener(this.canvas,"contextmenu",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,"mousedown",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,"mousemove",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,"mouseup",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,
"mouseleave",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,"touchstart",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,"touchmove",this.canvasEventDispatcher);RELite.Utils.addEventListener(this.canvas,"touchend",this.canvasEventDispatcher);"onwheel"in document?RELite.Utils.addEventListener(this.canvas,"wheel",this.canvasEventDispatcher):"onmousewheel"in document?RELite.Utils.addEventListener(this.canvas,"mousewheel",this.canvasEventDispatcher):RELite.Utils.addEventListener(this.canvas,
"DOMMouseScroll",this.canvasEventDispatcher);RELite.Device.bIsDesktop&&(RELite.Utils.addEventListener(this.canvas,"dragover",this.canvasDropHandler),RELite.Utils.addEventListener(this.canvas,"dragenter",this.canvasDropHandler),RELite.Utils.addEventListener(this.canvas,"drop",this.canvasDropHandler));var c=RELite.Utils.isMobile()?"taphold":"dblclick";$(this.canvas).bind(c,this.canvasEventDispatcher);if(this.isDetailPanel)this.borderColor="#4da9de",RELite.Settings.bEnableHDOverlay&&(this.$overlay.css("z-index",
"17"),this.$warningOverlay.css("z-index","17"))};SeriesPanel.prototype.canvasDropHandler=function(c){c.preventDefault&&c.preventDefault();c.type=="drop"&&(c=c.dataTransfer.getData("Text"))&&this.seriesPanel.loadViewingSeries(RELite.Viewer.getViewingSeries()[c]);return!1};
SeriesPanel.prototype.canvasEventDispatcher=function(c){c.preventDefault();var b=this.seriesPanel,d=RELite.Viewer.getViewerContainer().offsetTop;c.reLiteData=b;if(!(c.type=="taphold"&&RELite.Manager.getSelectedTool()===RELite.ToolsRepository.Magnifier&&b.currentImage&&b.currentImage.ds.isImage)&&(c.type=="dblclick"||c.type=="taphold"))return(c=RELite.Viewer.getDetailPanel())&&c.canvas&&(b.currentImage&&b.currentImage.open?b.currentImage.open():$(c.canvas.parentElement).is(".hidden")?RELite.Viewer.showDetailPanel(b.viewingSeries,
b.currentImageIndex):RELite.Viewer.hideDetailPanel()),!1;c.isGesture=!1;c.isGestScroll=!1;if(c.touches&&c.touches.length>0){if(c.canvasX=c.touches[0].clientX-$(this).offset().left,c.canvasY=c.touches[0].clientY-d-($(this).offset().top-48),c.isGesture=c.touches.length>1,c.touches.length===2)c.touches[0].canvasX=c.touches[0].clientX-$(this).offset().left,c.touches[0].canvasY=c.touches[0].clientY-d-($(this).offset().top-48),c.touches[1].canvasX=c.touches[1].clientX-$(this).offset().left,c.touches[1].canvasY=
c.touches[1].clientY-d-($(this).offset().top-48)}else c.canvasX=c.clientX-$(this).offset().left,c.canvasY=c.clientY-d-($(this).offset().top-48);d={x:0,y:0};if(b.currentImage){var a={x:(c.canvasX-b.translateX)/b.zoom/b.scaleRatio,y:(c.canvasY-b.translateY)/b.zoom/b.scaleRatio};if(b.iFlipHorizontal<0)a.x=b.currentImage.columns-a.x;if(b.iFlipVertical<0)a.y=b.currentImage.rows-a.y;var g={x:b.currentImage.columns/2,y:b.currentImage.rows/2},e=2*Math.PI-b.rotationRad;d.x=+(Math.cos(e)*(a.x-g.x))-Math.sin(e)*
(a.y-g.y)+g.x;d.y=+(Math.sin(e)*(a.x-g.x))+Math.cos(e)*(a.y-g.y)+g.y}c.pointOnDICOMImage=d;d=RELite.Manager.getSelectedTool();if(b.currentImage&&d&&d[c.type]&&!c.isGesture){if(c.type==="mousedown"||c.type==="touchstart")b.bIsLocked=!0;d[c.type](c)}if(c.type in RELite.GlobalEventHandler)RELite.GlobalEventHandler[c.type](c)};SeriesPanel.prototype.redrawIfImageShown=function(c){this.currentImage===c&&this.redraw()};
SeriesPanel.prototype.startCine=function(){var c=this;c.bPlayingCine=!0;var b=0,d=0,a=0;if(this.fpsInterval===null)this.fpsInterval=setInterval(function(){c.fps=c.iCineFPS+" ("+a+")";a=0},1E3);var g=function(){b=Date.now();var e=c.getNextImage(!0);if(e&&e.domImg!==void 0){if(c.showNextImage(!0),a++,d=Date.now()-b,c.bPlayingCine)c.cineTimeout=setTimeout(g,Math.round(c.iCineFrameTime-d))}else if(c.stopCine(),e)e.onJPEGImageLoaded=function(){setTimeout(function(){c.startCine()},200)}};g()};
SeriesPanel.prototype.stopCine=function(){this.bPlayingCine=!1;clearTimeout(this.cineTimeout);clearInterval(this.fpsInterval);this.fpsInterval=null;this.currentImage&&this.setCurrentImage(this.currentImage)};
SeriesPanel.prototype.drawInvertedImage=function(c,b){var d=document.createElement("canvas");d.width=c.width;d.height=c.height;var a=d.getContext("2d");a.drawImage(c,0,0,c.width,c.height);for(var g=a.getImageData(0,0,c.width,c.height),e=g.data,f=0;f<e.length;f+=4)e[f]=255-e[f],e[f+1]=255-e[f+1],e[f+2]=255-e[f+2];a.putImageData(g,0,0);b.drawImage(d,0,0,this.imageResizedWidth,this.imageResizedHeight);delete null;delete null;delete null;delete null};
SeriesPanel.prototype.redraw=function(){var c=this.ctx,b=this.canvas,d=this.canvas.iCSSWidth?this.canvas.iCSSWidth:this.canvas.width,a=this.canvas.iCSSHeight?this.canvas.iCSSHeight:this.canvas.height,g=[],e=RELite.Viewer.getPixelRatioWrtSettings();c.setTransform(e,0,0,e,0,0);c.save();c.fillStyle="black";c.strokeStyle=this.borderColor;c.fillRect(0,0,d,a);c.restore();if(RELite.Manager.getIsValidLicense()){if(this.scrollBarContainer&&this.viewingSeries)this.scrollBarPickerHeight=Math.ceil(a/this.viewingSeries.dicomImages.length),
this.scrollBarPicker.style.height=Math.max(SeriesPanel.MIN_SCROLLBAR_PICKER_HEIGHT,this.scrollBarPickerHeight)+"px";c.save();if(this.currentImage&&this.currentImage.downloaded&&!this.bPlayingCine){this.currentImage.downloading=!1;var e=this.imageResizedWidth/2,f=this.imageResizedHeight/2,i=this.translateX,h=this.translateY,k=0;this.iFlipVertical<0&&(k=this.imageResizedHeight*this.zoom);var l=0;this.iFlipHorizontal<0&&(l=this.imageResizedWidth*this.zoom);var j=this.rotationRad;c.transform(this.zoom*
this.iFlipHorizontal,0,0,this.zoom*this.iFlipVertical,i+l,h+k);c.translate(e,f);c.rotate(j);c.translate(-e,-f);this.invertImageColors?this.drawInvertedImage(this.currentImage.workingCanvas,c):c.drawImage(this.currentImage.workingCanvas,0,0,this.imageResizedWidth,this.imageResizedHeight)}else if(this.currentImage&&(!this.currentImage.downloaded||this.bPlayingCine))if(this.currentImage.domImg!==void 0){if(this.imageResizedWidth===0&&this.imageResizedHeight===0){this.scaleRatio=1;e=this.currentImage.domImg.width;
if(e==0&&this.currentImage.domImg.naturalWidth)e=this.currentImage.domImg.naturalWidth;f=this.currentImage.domImg.height;if(f==0&&this.currentImage.domImg.naturalHeight)f=this.currentImage.domImg.naturalHeight;i=d/e;h=a/f;this.scaleRatio=i<h?i:h;this.imageResizedWidth=Math.round(e*this.scaleRatio);this.imageResizedHeight=Math.round(f*this.scaleRatio);if(this.translateX===null||this.translateY===null)this.translateX=Math.round((d-this.imageResizedWidth)/2),this.translateY=Math.round((a-this.imageResizedHeight)/
2)}i=this.translateX;h=this.translateY;k=0;this.iFlipVertical<0&&(k=this.imageResizedHeight*this.zoom);l=0;this.iFlipHorizontal<0&&(l=this.imageResizedWidth*this.zoom);e=this.imageResizedWidth/2;f=this.imageResizedHeight/2;c.transform(this.zoom*this.iFlipHorizontal,0,0,this.zoom*this.iFlipVertical,i+l,h+k);c.translate(e,f);c.rotate(this.rotationRad);c.translate(-e,-f);this.invertImageColors?this.drawInvertedImage(this.currentImage.domImg,c):c.drawImage(this.currentImage.domImg,0,0,this.imageResizedWidth,
this.imageResizedHeight)}else c.fillStyle=this.borderColor,c.font="1.0em Arial",e="Loading...",c.measureText(e),i=this.viewingSeries.bIsCine?40:0,c.fillText(e,5,a-12-i);this.curRefLine&&RELite.Settings.bShowRefLines&&this.curRefLine.draw(this);for(e=0;this.currentImage&&e<this.currentImage.aDrawables.length;e++)this.currentImage.aDrawables[e].draw(this),g=this.currentImage.aDrawables[e].getMessages();c.restore();c.save();if(this.currentImage&&this.currentImage.ds){c.font="11px Arial";c.strokeStyle=
"#222";c.lineWidth=1;c.fillStyle=this.borderColor;f=0;e=this.currentImage;h="";i=null;if(RELite.Settings.bShowInfoOverlays){i=RELite.Settings.infoOverlays;i.bPatientName&&(h=RELite.Utils.beautyfyName(e.ds.patientName),i.bPatientBirthDate&&(k=RELite.Utils.beautyfyDate(e.ds.patientBirthdate),k.length>4&&(h+=" ("+k+")")),c.fillText(h,5,f+=15));i.bPatientID&&(h="ID: "+e.ds.patientID,i.bPatientSex&&(h+=" ("+e.ds.patientSex+")"),c.fillText(h,5,f+=15));i.bStudyDate&&(RELite.Manager.isLocalViewer()?c.fillText(e.ds.studyDate,
5,f+=15):(c.fillText(e.ds.imageSmartDate,5,f+=15),c.fillText(e.ds.imageSmartTime,5,f+=15)));i.bStudyDescription&&c.fillText(e.ds.studyDescr,5,f+=15);i.bAccNum&&c.fillText("Acc #: "+e.ds.accessionNum,5,f+=15);i.bStudyComments&&c.fillText(e.ds.studyComments,5,f+=15);if(i.bWinLevel&&!RELite.Manager.isLocalViewer()&&this.viewingSeries)h=this.viewingSeries.winLevLut.physicalWW,k=this.viewingSeries.winLevLut.physicalWL,e.voiLUTPresent===!0?(h=Math.round(this.viewingSeries.winLevLut.rawWW),k=Math.round(this.viewingSeries.winLevLut.rawWL)):
e.multiplyVal!=1?(h=h.toFixed(2),k=k.toFixed(2)):(h=Math.round(h),k=Math.round(k)),c.fillText("W: "+h+", L: "+k,5,f+=15);i.bNumOfFrames&&this.viewingSeries!=null&&c.fillText("Frame: "+(this.currentImageIndex+1)+"/"+this.viewingSeries.dicomImages.length,5,f+=15);i.bSeriesDescription&&(h="",i.bModality&&e.ds.modality&&(h="["+e.ds.modality+"] "),h+=e.ds.seriesDescr,c.fillText(h,5,f+=15));this.bPlayingCine&&this.fps&&(h="FPS: "+this.fps,c.fillText(h,5,f+=15));i.bSliceThickness&&e.ds.sliceThicknesses&&
e.ds.sliceThicknesses[e.frameNumber-1]&&(h=js_StringTable.SLICE_THICK+": "+e.ds.sliceThicknesses[e.frameNumber-1].toFixed(2)+"mm",c.fillText(h,5,f+15));c.save();c.font="15px sans-serif";c.strokeStyle="#222";c.lineWidth=3;c.fillStyle=this.borderColor;i=e.getOrientationMarkers(this);f=i[0];h=i[1];k=i[2];l=i[3];if(f)i=c.measureText(f).width,c.strokeText(f,(d-i)/2,15),c.fillText(f,(d-i)/2,15);if(h)i=c.measureText(h).width,c.strokeText(h,d-(i+5),(a-15)/2),c.fillText(h,d-(i+5),(a-15)/2);if(k)i=c.measureText(k).width,
c.strokeText(k,(d-i)/2,a-15),c.fillText(k,(d-i)/2,a-15);l&&(c.measureText(l),c.strokeText(l,5,(a-15)/2),c.fillText(l,5,(a-15)/2));c.restore()}f=a;if(!this.bPlayingCine){i=this.viewingSeries.bIsCine?35:0;f-=i;if(e.ds.origColumns>e.columns||e.ds.origRows>e.rows)h="SUBSAMPLED",i=c.measureText(h).width,c.strokeText(h,d-(i+5),f-=15),c.fillText(h,d-(i+5),f);if(e.ds.isLossy)h="LOSSY",i=c.measureText(h).width,c.strokeText(h,d-(i+5),f-=15),c.fillText(h,d-(i+5),f);if(e.ds.imgGeomList&&(e=e.ds.imgGeomList[e.frameNumber-
1]))if(e.dicomMeasCalibrated===!0)h=js_StringTable.SIZES_CALIBRATED+" (1:"+e.dicomMeasCalibratedAvgMagn.toFixed(2)+")",i=c.measureText(h).width,c.strokeText(h,d-(i+5),f-=15),c.fillText(h,d-(i+5),f);else if(e.dicomMeasAtDetector===!0)h=js_StringTable.SIZES_DETECTOR,i=c.measureText(h).width,c.strokeText(h,d-(i+5),f-=15),c.fillText(h,d-(i+5),f)}if(RELite.JPEGDownloadSerializer.isImageInQueue(this.currentImage)&&!this.currentImage.downloaded)c.restore(),c.save(),c.fillStyle=this.borderColor,c.font="1.0em Arial",
e="Retrieving JPEG with win / lev...",c.measureText(e),i=this.viewingSeries.bIsCine?40:0,c.fillText(e,5,a-12-i-15),c.restore();if(this.currentImage.downloading)c.restore(),c.save(),c.fillStyle=this.borderColor,c.font="1.0em Arial",e="Loading...",c.measureText(e),i=this.viewingSeries.bIsCine?40:0,c.fillText(e,5,a-12-i),c.restore();if(g.length){c.restore();c.save();if(!g.hasPositions){f=15*g.length+8;i=b.iCSSWidth;b=0;c.font="bold 13px Arial";for(e=0;e<g.length;e++)b=Math.max(b,c.measureText(g[e]).width);
i-=b+8;c.fillStyle="rgba(50,50,50,1)";c.strokeStyle="#777777";c.lineWidth=1;c.fillRect(i,0,b+8,f);c.strokeRect(i,0,b+8,f);c.fillStyle="cyan";for(e=0;e<g.length;e++)c.fillText(g[e],i+2,2+(e+1)*15)}c.restore()}}c.restore();if(RELite.Viewer.getSelectedImagePanel()===this){if(RELite.Manager.getSelectedTool()===RELite.ToolsRepository.Magnifier&&(g=RELite.ToolsRepository.Magnifier.getCanvas(),b=RELite.ToolsRepository.Magnifier.getPointOnPanel(),e=RELite.ToolsRepository.Magnifier.getEventType(),g&&b)){f=
g.iCSSWidth?g.iCSSWidth:g.width;i=g.iCSSHeight?g.iCSSHeight:g.height;h=b.x-f/2;k=b.y-i/2;if(e==="touch"&&(k=b.y-i,b.y-i/2<0))k=b.y;c.save();c.translate(h,k);c.drawImage(g,0,0,f,i);c.strokeStyle="#c0c0c0";c.lineWidth=1;c.strokeRect(0.5,0.5,f,i);c.strokeStyle="#444444";c.lineWidth=1;c.strokeRect(1.5,1.5,f-2,i-2);c.restore()}c.save();c.setLineDash([5]);c.strokeStyle=this.borderColor;c.lineWidth="2";c.strokeRect(0,0,d,a);c.restore();this.viewingSeries&&this.viewingSeries.bIsCine?this.appendSeriesActionsPanel():
RELite.Viewer.setSeriesActionsPanelVisible(!1);this.viewingSeries&&$("#forceCineTool").find("rect").attr("fill",this.viewingSeries.bIsCine?"#7be1b2":"#ebebeb")}}else b=RELite.Manager.getLicenseError(),g=js_StringTable.INV_LIC,b===4&&(g=js_StringTable.USG_NOT_ALLOWED),b===3&&(g=js_StringTable.COMM_ERR),c.save(),c.fillStyle=this.borderColor,c.font="1.0em Arial",b=c.measureText(g).width,c.fillText(g,(d-b)/2,(a-12)/2),c.restore()};
SeriesPanel.prototype.onImageDownloaded=function(c){var b=this.seriesPanel;c.reLiteData==b.currentImage&&(b.calculateDICOMImageSize(),b.redraw())};
SeriesPanel.prototype.calculateDICOMImageSize=function(){if(this.currentImage&&(this.currentImage.downloaded||this.currentImage.isLocal)){this.scaleRatio=1;var c=this.currentImage.columns,b=this.canvas.iCSSWidth,d=this.currentImage.rows,a=this.canvas.iCSSHeight,g=b/c,e=a/d;this.scaleRatio=g<e?g:e;this.imageResizedWidth=Math.round(c*this.scaleRatio);this.imageResizedHeight=Math.round(d*this.scaleRatio);if(this.translateX==null||this.translateY==null)this.translateX=Math.round((b-this.imageResizedWidth)/
2),this.translateY=Math.round((a-this.imageResizedHeight)/2)}};
SeriesPanel.prototype.setCurrentImage=function(c){var b=this;this.currentImage=c;this===RELite.Viewer.getSelectedImagePanel()&&!this.bPlayingCine&&RELite.Utils.dispatchEvent(document,"computeRefLines",this);if(c.downloaded)this.calculateDICOMImageSize(),this.redraw();else if(!c.downloading){var d=this.currentImageIndex!==0;!this.bPlayingCine&&!c.isLocal&&setTimeout(function(){b.currentImage===c&&!c.downloading&&(c.load({success:function(){b.calculateDICOMImageSize();b.redraw();b===RELite.Viewer.getSelectedImagePanel()&&
RELite.Utils.dispatchEvent(document,"computeRefLines",b)},useSharedDownloader:d}),b.redraw())},200);this.redraw()}};
SeriesPanel.prototype.onViewingSeriesChanged=function(c){this.currentImage?this.bIsLocked?this.currentImage!=c.source.dicomImages[this.currentImageIndex]&&this.setCurrentImageIndex(this.viewingSeries.dicomImages.indexOf(this.currentImage)):this.setCurrentImageIndex(0):this.setCurrentImageIndex(0);if(this.viewingSeries.bIsCine&&this.iCineFrameTime===0)RELite.Settings.bAutoStartCineSequences&&!this.bPlayingCine&&this.startCine(),this.iCineFrameTime=this.viewingSeries.frameTimeMs,this.iCineFPS=this.viewingSeries.iDefFPS;
RELite.Viewer.getSelectedImagePanel()?this.redraw():RELite.Viewer.setSelectedImagePanel(this)};
SeriesPanel.prototype.setCurrentImageIndex=function(c,b){var d=this.viewingSeries?this.viewingSeries.dicomImages[c]:null;if(d){this.currentImageIndex=c;if(this.currentImage)if(this.viewingSeries.winLevLut.isImageDefault)d.downloaded?(d.calculateDefaultLUT(),d.createWorkingCanvasPixels()):(d.ww=0,d.wl=0,this.viewingSeries.winLevLut.reset());else if(d.downloaded){var a=this.viewingSeries.winLevLut.physicalWW*d.multiplyVal,g=this.viewingSeries.winLevLut.physicalWL*d.multiplyVal+d.additiveVal;a!=this.viewingSeries.winLevLut.rawWW||
g!=this.viewingSeries.winLevLut.rawWL?d.calculateLUT(a,g):(d.ww=this.currentImage.ds.viewingSeries.winLevLut.rawWW,d.wl=this.currentImage.ds.viewingSeries.winLevLut.rawWL);d.createWorkingCanvasPixels()}else d.ww=this.currentImage.ds.viewingSeries.winLevLut.rawWW,d.wl=this.currentImage.ds.viewingSeries.winLevLut.rawWL;if(this.scrollBarContainer&&!b)this.scrollBarPickerTop=c*(this.canvas.iCSSHeight/this.viewingSeries.dicomImages.length)||0,this.scrollBarPicker.style.top=this.scrollBarPickerTop+"px";
this.setCurrentImage(d)}};SeriesPanel.prototype.getNextImage=function(c){var b=null;if(!this.currentImage)return b;var d=this.currentImageIndex+1;d<this.viewingSeries.dicomImages.length?b=this.viewingSeries.dicomImages[d]:c===!0&&(b=this.viewingSeries.dicomImages[0]);return b};SeriesPanel.prototype.showNextImage=function(c){if(this.currentImage){var b=this.currentImageIndex+1;if(b<this.viewingSeries.dicomImages.length)this.setCurrentImageIndex(b);else if(c===!0)this.currentImageIndex=-1,this.showNextImage()}};
SeriesPanel.prototype.showPreviousImage=function(){var c=this.currentImageIndex-1;this.currentImageIndex>=0&&this.setCurrentImageIndex(c)};SeriesPanel.prototype.setViewingSeries=function(c){if(this.viewingSeries!==c)this.viewingSeries&&this.viewingSeries.removeOnViewingSeriesChangedListener(this),this.reset(),this.viewingSeries=c,this.viewingSeries.addOnViewingSeriesChangedListener(this)};
SeriesPanel.prototype.onSliderValueStartChanging=function(){var c=RELite.Viewer.getSelectedImagePanel();if(c){if($("#playAction").find("image").attr("xlink:href").indexOf("action.stop.svg")>=0)c.wasPlaying=!0;c.stopCine()}};SeriesPanel.prototype.onSliderValueStopChanging=function(){var c=RELite.Viewer.getSelectedImagePanel();c&&c.wasPlaying&&(delete c.wasPlaying,c.startCine())};
SeriesPanel.prototype.onSliderValueChanged=function(c){var b=Math.round(1E3/c),d=RELite.Viewer.getSelectedImagePanel();if(d)d.iCineFrameTime=b,d.iCineFPS=c};
SeriesPanel.prototype.loadViewingSeries=function(c){if(c){this.viewingSeries=c;this.translateY=this.translateX=null;this.imageResizedHeight=this.imageResizedWidth=0;this.zoom=1;this.currentImage=null;if(this.bPlayingCine){if(!this.viewingSeries.bIsCine)this.viewingSeries.bIsCine=!0,this.viewingSeries.frameTimeMs=this.iCineFrameTime,this.viewingSeries.iDefFPS=this.iCineFPS}else if(this.viewingSeries.bIsCine)this.iCineFrameTime=this.viewingSeries.frameTimeMs,this.iCineFPS=this.viewingSeries.iDefFPS;
this.setCurrentImageIndex(0);RELite.Utils.dispatchEvent(document,"selectedPanelChanged",this)}};SeriesPanel.prototype.loadNextViewingSeries=function(){if(this.viewingSeries){for(var c=RELite.Viewer.getViewingSeries(),b=0;b<c.length&&c[b]!==this.viewingSeries;)b++;b<c.length&&(b++,b==c.length&&(b=0),this.loadViewingSeries(c[b]))}else c=RELite.Viewer.getViewingSeries(),c.length&&c[0]&&this.loadViewingSeries(c[0])};
SeriesPanel.prototype.loadPrevViewingSeries=function(){if(this.viewingSeries){for(var c=RELite.Viewer.getViewingSeries(),b=0;b<c.length&&c[b]!==this.viewingSeries;)b++;b<c.length&&(b--,b<0&&(b=c.length-1),this.loadViewingSeries(c[b]))}else c=RELite.Viewer.getViewingSeries(),c.length&&c[c.length-1]&&this.loadViewingSeries(c[c.length-1])};
SeriesPanel.prototype.addRotationDeg=function(c){this.iFlipVertical*this.iFlipHorizontal<0?this.rotationRad-=c*Math.PI/180:this.rotationRad+=c*Math.PI/180;if(Math.abs(this.rotationRad)==2*Math.PI)this.rotationRad=0;if(this.rotationRad<0)this.rotationRad=2*Math.PI+this.rotationRad;this.redraw()};SeriesPanel.prototype.flipVertical=function(){this.iFlipVertical*=-1;this.redraw()};SeriesPanel.prototype.flipHorizontal=function(){this.iFlipHorizontal*=-1;this.redraw()};this.RELite===void 0&&(RELite={});
RELite.Utils=function(){var c=null,b=function(a,g){var e={to:"",method:"GET",data:{},success:$.noop,error:$.noop,async:!0,src:null};$.extend(e,a);var f=RELite.Settings.bUseRedirect,i=RELite.Settings.sRedirectURL;if(c!=null)if(g===!0){c.abort();if(c.src&&"downloading"in c.src)c.src.downloading=!1;c.src=e.src;f?(e.data.to=e.to,e.data.method=e.method,$.ajax({url:i,data:e.data,cache:!0,ifModified:!1,type:e.method,complete:function(a,b){b=="success"||b=="notmodified"?e.success(a.responseText,b,a):e.error(a,
b,{})},dataType:"text",xhr:d,async:e.async})):$.ajax({url:e.to,data:e.data,cache:!0,ifModified:!1,type:e.method,complete:function(a,b){b=="success"||b=="notmodified"?e.success(a.responseText,b,a):e.error(a,b)},dataType:"text",xhr:d,async:e.async})}else f?(e.data.to=e.to,e.data.method=e.method,$.ajax({url:i,data:e.data,cache:!0,ifModified:!1,type:e.method,complete:function(a,b){b=="success"||b=="notmodified"?e.success(a.responseText,b,a):e.error(a,b,{})},dataType:"text",async:e.async})):$.ajax({url:e.to,
data:e.data,cache:!0,ifModified:!1,type:e.method,complete:function(a,b){b=="success"||b=="notmodified"?e.success(a.responseText,b,a):e.error(a,b,{})},dataType:"text",async:e.async});else c=new XMLHttpRequest,b(a,f,g)},d=function(){return c};return{getTodayRangeDate:function(a){var b=new Date,c="",c="",c=b.getMonth()+1<10?"0"+(b.getMonth()+1):b.getMonth()+1,d="",d=b.getDate()<10?"0"+b.getDate():b.getDate(),c=a=="dd.mm.yyyy"?d+"."+c+"."+b.getFullYear():b.getFullYear()+"."+c+"."+d;return{start:c,end:c}},
getLast7DaysDateRange:function(a){var b=new Date,c="",d="",i="",d=b.getMonth()+1<10?"0"+(b.getMonth()+1):b.getMonth()+1,i=b.getDate()<10?"0"+b.getDate():b.getDate(),c=a=="dd.mm.yyyy"?i+"."+d+"."+b.getFullYear():b.getFullYear()+"."+d+"."+i;b.setDate(b.getDate()-7);var i=b.getDate(),d=b.getMonth(),h=b.getFullYear(),k="",d=d+1<10?"0"+(d+1):d+1,i=i<10?"0"+i:i,k=a=="dd.mm.yyyy"?i+"."+d+"."+b.getFullYear():h+"."+d+"."+i;return{start:k,end:c}},getLastMonthDateRange:function(a){var b=new Date,c="",d="",i=
"",d=b.getMonth()+1<10?"0"+(b.getMonth()+1):b.getMonth()+1,i=b.getDate()<10?"0"+b.getDate():b.getDate(),c=a=="dd.mm.yyyy"?i+"."+d+"."+b.getFullYear():b.getFullYear()+"."+d+"."+i;b.setDate(b.getDate()-30);var i=b.getDate(),d=b.getMonth(),h=b.getFullYear(),k="",d=d+1<10?"0"+(d+1):d+1,i=i<10?"0"+i:i,k=a=="dd.mm.yyyy"?i+"."+d+"."+b.getFullYear():h+"."+d+"."+i;return{start:k,end:c}},beautyfyDate:function(a){var b=a;a.length==8&&(b=a.substr(0,4)+"."+a.substr(4,2)+"."+a.substr(6,2));return b},beautyfyName:function(a){return a.replace(/\^/gi,
" ")},beautyfyTime:function(a){if(a=="")return"";var b="",c="",d="",d=a.split(":");if(d.length==3)return b=d[0],c=d[1],d=d[2],d=d.substring(0,2),b+":"+c+":"+d;else if(d.length==2)return b=d[0],c=d[1],b+":"+c+":00";if(a.length==2)return a+":00:00";else if(a.length==4)return b=a.substring(0,2),c=a.substring(2,4),b+":"+c+":00";else if(a.length>=6)return b=a.substring(0,2),c=a.substring(2,4),d=a.substring(4,6),b+":"+c+":"+d;return a},addParameterToURL:function(a,b){return a.indexOf("?")>=0?a+"&"+b:a+
"?"+b},doRequest:b,sorroundWithAsterisk:function(a){return a!="*"?"*"+a+"*":a},getCookie:function(a){for(var b=void 0,c=document.cookie.split(";"),d=0;d<c.length;d++)if(c[d].indexOf(a)>=0){b=c[d].split("=")[1];b==""&&(b=void 0);break}return b},setCookie:function(a,b){document.cookie=a+"="+b},deleteCookie:function(a){document.cookie=a+"=;expires: "+(new Date((new Date).getTime()-1E3)).toGMTString()},addEventListener:function(a,b,c,d){a.addEventListener(b,c,!!d)},removeEventListener:function(a,b,c,
d){a.removeEventListener(b,c,!!d)},dispatchEvent:function(a,b,c){var d=document.createEvent("Event");d.initEvent(b,!0,!0);d.reLiteData=c;a.dispatchEvent(d)},isMobile:function(){var a=navigator.userAgent.toLocaleLowerCase();return a.indexOf("android")!=-1||a.indexOf("mobile")!=-1},b64Dec:function(a){if(window.atob)return window.atob(a);else{for(var b="",c,d,i,h,k,l=0,a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<a.length;)c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),
d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),c=c<<2|d>>4,d=(d&15)<<4|h>>2,i=(h&3)<<6|k,b+=String.fromCharCode(c),h!=64&&(b+=String.fromCharCode(d)),k!=64&&(b+=String.fromCharCode(i));a=b.replace(/\r\n/g,"\n");b="";for(h=0;h<a.length;h++)k=a.charCodeAt(h),k<128?b+=String.fromCharCode(k):
(k>127&&k<2048?b+=String.fromCharCode(k>>6|192):(b+=String.fromCharCode(k>>12|224),b+=String.fromCharCode(k>>6&63|128)),b+=String.fromCharCode(k&63|128));return b}},isNumeric:function(a){return a==null||a==""||a==void 0||isNaN(a)?!1:!0},addToolActionListener:function(a,b){var c=RELite.Manager.getEventName(),d=c.trim().split(" ");d.length===2&&(c=d[1],a.domContainer.addEventListener(d[0],b,!1));a.domContainer.addEventListener(c,b,!1)},addCustomToolToToolbar:function(a,b,c,d){b===1?RELite.Viewer.getLayout().toolsPanel.addRightActionToPosition(a,
c,d):RELite.Viewer.getLayout().toolsPanel.addLeftActionToPosition(a,c,d)},removeToolbarTool:function(a){var b=null,c=RELite.Viewer.getLayout().toolsPanel.aActions,d=RELite.Viewer.getLayout().toolsPanel.aRightActions,i=RELite.Viewer.getLayout().toolsPanel.rightActionOrder,h=RELite.Viewer.getLayout().toolsPanel.aLeftActions,k=RELite.Viewer.getLayout().toolsPanel.leftActionOrder,l=RELite.Viewer.getLayout().toolsPanel.aDrawerActions,j=RELite.Viewer.getLayout().toolsPanel.removeActionOrder.actions;c.every(function(c){return c.sID===
a?(b=c,!1):!0});if(b){var m=c.indexOf(b);m>=0&&c.splice(m,1);m=d.indexOf(b);m>=0&&d.splice(m,1);m=i.indexOf(b);m>=0&&i.splice(m,1);m=h.indexOf(b);m>=0&&h.splice(m,1);m=k.indexOf(b);m>=0&&k.splice(m,1);m=l.indexOf(b);m>=0&&l.splice(m,1);m=j.indexOf(b);m>=0&&j.splice(m,1);$(b.domContainer).remove();RELite.Viewer.getLayout().toolsPanel.invalidateLayout()}},formatBytes:function(a){a=Math.log(a)/Math.log(1024);return Math.round(Math.pow(1024,a-Math.floor(a)),2)+" "+["B","KB","MB","GB","TB"][Math.floor(a)]}}}();this.RELite===void 0&&(RELite={});
RELite.CredentialManager=function(){var c="",b="",d={},a="",g=0,e=function(e){var i=RELite.Utils,h={action:"authenticate",username:"",password:"",newPassword:void 0,success:$.noop,error:$.noop};$.extend(h,e);a=h.username;var e=function(){var a="",b=0,c;for(c in d){var e="ArgValue"+b+"=";a+="ArgName"+b+"="+encodeURIComponent(c)+"&"+e+encodeURIComponent(d[c])+"&";++b}return a=a.slice(0,-1)}(),k=RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/Authenticate";e.length&&(k+="?"+e);e={data:{Action:h.action,
CliSessID:c,Username:h.username,Password:h.password,NewPassword:h.newPassword,Encrypted:RELite.Manager.areParamsEncrypted()},to:k,method:"GET",success:function(c,d,e){if(e.getResponseHeader("LicManRetVal")==null)try{var f=JSON.parse(c);if(f.respAuthenticationStatus.toLowerCase()==="failure_password_expired")h.error(f);else if(f.respAuthenticationStatus=="Success"){b=f.respAuthenticationToken;i.setCookie("AuthenticationToken",b);i.setCookie("Username",a);if(f.respUsername)a=f.respUsername;h.success(c)}else RELite.Manager.showError(js_StringTable.INV_LOG),
h.error(f)}catch(k){RELite.Manager.showError(js_StringTable.INV_LOG),h.error()}else c=parseInt(e.getResponseHeader("LicManRetVal"),10),d=js_StringTable.INV_LIC,g=c,c===4&&(d=js_StringTable.USG_NOT_ALLOWED),c===3&&(d=js_StringTable.COMM_ERR),RELite.Manager.showError(d),h.error()},error:function(){RELite.Manager.showError(js_StringTable.COMM_ERR);h.error()}};i.doRequest(e)};(function(){c=RELite.Utils.getCookie("ClientSessionID");c===void 0&&(c="CliSessID_"+((new Date).getTime().toString()+(Math.floor(Math.random()*
1)+0).toString()),RELite.Utils.setCookie("ClientSessionID",c));var b=RELite.Utils.getCookie("Username");b!==void 0&&(a=b)})();return{cliSessID:c,requestAuthentication:e,requestChangePassword:function(a){var b={action:"changePassword",username:"",password:"",newPassword:void 0,success:$.noop,error:$.noop};$.extend(b,a);e(b)},getAuthenticationToken:function(){return b},setAuthenticationToken:function(a){b=a},invalidateAuthToken:function(){document.cookie="AuthenticationToken=;expires: "+(new Date((new Date).getTime()-
1E3)).toGMTString();document.cookie="Username=;expires: "+(new Date((new Date).getTime()-1E3)).toGMTString()},validateAuthToken:function(c){var e={sAuthToken:"",sUsername:void 0,sPassword:void 0,success:$.noop,error:$.noop};$.extend(e,c);if(e.sUsername===void 0)e.sUsername=a;var c={AuthenticationToken:e.sAuthToken,CliSessID:RELite.CredentialManager.cliSessID,Username:e.sUsername,Password:e.sPassword,Encrypted:RELite.Manager.areParamsEncrypted()},h=function(){var a="",b=0,c;for(c in d){var e="ArgValue"+
b+"=";a+="ArgName"+b+"="+encodeURIComponent(c)+"&"+e+encodeURIComponent(d[c])+"&";++b}return a=a.slice(0,-1)}();RELite.Utils.doRequest({data:c,to:RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/Authenticate?"+h,method:"POST",success:function(c,d,f){if(f.getResponseHeader("LicManRetVal")==null)try{var h=JSON.parse(c);if(h.respAuthenticationStatus=="Success"){b=h.respAuthenticationToken;RELite.Utils.setCookie("AuthenticationToken",b);RELite.Utils.setCookie("Username",e.sUsername);if(h.respUsername)a=
h.respUsername,RELite.Utils.setCookie("Username",e.sUsername);e.success()}else RELite.Manager.showError(js_StringTable.INV_LOG),e.error()}catch(n){RELite.Manager.showError(js_StringTable.INV_LOG),e.error()}else c=parseInt(f.getResponseHeader("LicManRetVal"),10),d=js_StringTable.INV_LIC,g=c,c===4&&(d=js_StringTable.USG_NOT_ALLOWED),c===3&&(d=js_StringTable.COMM_ERR),RELite.Manager.showError(d),e.error()},error:function(){RELite.Manager.showError(js_StringTable.COMM_ERR);e.error()}})},setAdditionalParamsMap:function(a){d=
a},getUsername:function(){return a},setUsername:function(b){a=b},getLicenseManagerError:function(){return g}}}();function Action(){var c=[];this.addAction=function(b){b.isChild=!0;c.push(b)};this.setIsChild=function(){};this.getChildren=function(){return c}}Action.prototype.constructor=Action;Action.prototype.sID="";Action.prototype.domContainer=null;Action.prototype.text="";Action.prototype.isToggle=!1;Action.prototype.isChild=!1;Action.prototype.isLeftAction=!1;
Action.prototype.loadFromDOM=function(c){var b=document.getElementById(c);this.domContainer=b;this.sID=c;b.actionObj=this;b.parentNode.removeChild(b);if(this.text)b.title=this.text};Action.prototype.detatch=function(){this.domContainer&&this.domContainer.parentNode&&this.domContainer.parentNode.removeChild(this.domContainer)};
Action.prototype.init=function(c){var b={id:"",title:"",svgSrc:"",action:$.noop};$.extend(b,c);if(b.id&&b.title&&b.svgSrc&&document.getElementById(b.id)===null){var d=$("#scroll").clone();d.prop("id",b.id);d.prop("title",b.title);d.find("svg image").attr("xlink:href",b.svgSrc)}c=$("#customToolsTempContainer");c.length===0&&(c=$("<div />").css({display:"none"}).appendTo(document.body));c.append(d);this.loadFromDOM(b.id);RELite.Utils.addToolActionListener(this,function(){var a=RELite.Viewer.getSelectedImagePanel(),
c=null,d=null;if(a&&(c=a.currentImage))d=c.ds;return b.action(c,d)})};function ToolsPanel(){this.aActions=[];this.aLeftActions=[];this.aRightActions=[];this.aDrawerActions=[];this.removeActionOrder={actions:[],index:0};this.leftActionOrder=[];this.rightActionOrder=[];this.domContainer=document.getElementById("toolbarContainer");this.domLeftToolbar=document.getElementById("tools");this.domRightToolbar=document.getElementById("rightToolbar");this.$drawer=$("#drawer");this.init=function(){}}ToolsPanel.prototype.pushLeftActionInPosition=function(){};
ToolsPanel.prototype.pushRightActionInPosition=function(){};ToolsPanel.prototype.doLayout=function(){};
ToolsPanel.prototype.addLeftActionToPosition=function(c,b,d){if(c)c.isLeftAction=!0,b>=0&&b<this.leftActionOrder.length?this.leftActionOrder.splice(b,0,c):this.leftActionOrder.push(c),this.aActions.push(c),this.aLeftActions.push(c),d===void 0?this.removeActionOrder.actions.unshift(c):d===-1?this.removeActionOrder.actions.push(c):(b=parseInt(d,10))&&b<this.removeActionOrder.actions.length?this.removeActionOrder.actions.splice(b,0,c):this.removeActionOrder.actions.unshift(c);this.domLeftToolbar&&c.domContainer&&
this.domLeftToolbar.appendChild(c.domContainer)};
ToolsPanel.prototype.addRightActionToPosition=function(c,b,d){c&&(b>=0&&b<this.rightActionOrder.length?this.rightActionOrder.splice(b,0,c):this.rightActionOrder.push(c),this.aActions.push(c),this.aRightActions.push(c),d===void 0?this.removeActionOrder.actions.unshift(c):d===-1?this.removeActionOrder.actions.push(c):(b=parseInt(d,10))&&b<this.removeActionOrder.actions.length?this.removeActionOrder.actions.splice(b,0,c):this.removeActionOrder.actions.unshift(c));this.domRightToolbar&&c.domContainer&&
this.domRightToolbar.appendChild(c.domContainer)};ToolsPanel.prototype.invalidateLayout=function(){this.removeActionOrder.index=0;for(var c=this.aDrawerActions.pop();c;)c.isLeftAction?this.aLeftActions.push(c):this.aRightActions.push(c),c=this.aDrawerActions.pop();for(c=0;c<this.leftActionOrder.length;c++)this.domLeftToolbar.appendChild(this.leftActionOrder[c].domContainer);for(c=0;c<this.rightActionOrder.length;c++)this.domRightToolbar.appendChild(this.rightActionOrder[c].domContainer);this.doLayout()};function DesktopToolsPanel(){this.aActions=[];this.aLeftActions=[];this.aRightActions=[];this.aDrawerActions=[];this.removeActionOrder={actions:[],index:0};this.leftActionOrder=[];this.rightActionOrder=[];this.domContainer=document.getElementById("toolbarContainer");this.domLeftToolbar=document.getElementById("tools");this.domRightToolbar=document.getElementById("rightToolbar");this.$drawer=$("#drawer");this.init=function(){var c=new Action;c.text=js_StringTable.SELSTACK_TIP;c.loadFromDOM("scroll");
c.isToggle=!0;var b=RELite.Manager.getEventName(),d=$.noop,d=b.trim().split(" ");if(d.length===2)var a=d[0],g=d[1],d=function(b,c,d){b.domContainer.addEventListener(a,c,!!d);b.domContainer.addEventListener(g,c,!!d)};else d=function(a,c,d){a.domContainer.addEventListener(b,c,!!d)};d(c,RELite.Manager.onToolClick);this.aLeftActions.push(c);this.aActions.push(c);var e=new Action;e.text=js_StringTable.PAN_TIP;e.loadFromDOM("pan");e.isToggle=!0;d(e,RELite.Manager.onToolClick);e.isLeftAction=!0;this.aLeftActions.push(e);
this.aActions.push(e);var f=new Action;f.text=js_StringTable.ZOOM_TIP;f.loadFromDOM("zoom");f.isToggle=!0;d(f,RELite.Manager.onToolClick);f.isLeftAction=!0;this.aLeftActions.push(f);this.aActions.push(f);var i=new Action;i.text=js_StringTable.WINLEV_TIP;i.loadFromDOM("windowLevel");i.isToggle=!0;d(i,RELite.Manager.onToolClick);i.isLeftAction=!0;this.aLeftActions.push(i);this.aActions.push(i);var h=new Action;h.text=js_StringTable.MEAS_TIP;h.loadFromDOM("measMenu");h.isToggle=!0;d(h,RELite.Manager.onToolClick);
h.isLeftAction=!0;this.aLeftActions.push(h);this.aActions.push(h);var k=new Action;k.text=js_StringTable.MEAS_LINE_TIP;k.loadFromDOM("measLineTool");k.isToggle=!0;d(k,RELite.Manager.onToolClick);h.addAction(k);k=new Action;k.text=js_StringTable.MEAS_RECT_TIP;k.loadFromDOM("measRectAreaTool");k.isToggle=!0;d(k,RELite.Manager.onToolClick);h.addAction(k);k=new Action;k.text=js_StringTable.MEAS_ELLIPT_TIP;k.loadFromDOM("measElliptAreaTool");k.isToggle=!0;d(k,RELite.Manager.onToolClick);h.addAction(k);
k=new Action;k.text=js_StringTable.MEAS_ANGLE_TIP;k.loadFromDOM("measAngle");k.isToggle=!0;d(k,RELite.Manager.onToolClick);h.addAction(k);k=new Action;k.text=js_StringTable.MEAS_DENS_TIP;k.loadFromDOM("measDensity");k.isToggle=!0;d(k,RELite.Manager.onToolClick);k.isLeftAction=!0;this.aLeftActions.push(k);this.aActions.push(k);var l=new Action;l.text=js_StringTable.MAGNIFIER_TIP;l.loadFromDOM("magnifier");l.isToggle=!0;d(l,RELite.Manager.onToolClick);l.isLeftAction=!0;this.aLeftActions.push(l);this.aActions.push(l);
var j=new Action;j.text=js_StringTable.RESET_TIP;j.loadFromDOM("resetTool");j.isToggle=!1;d(j,RELite.Manager.onResetToolClicked);j.isLeftAction=!0;this.aLeftActions.push(j);this.aActions.push(j);var m=new Action;m.text=js_StringTable.FORCE_CINE;m.loadFromDOM("forceCineTool");m.isToggle=!1;d(m,RELite.Manager.onForceCineActionClicked);this.aRightActions.push(m);this.aActions.push(m);var n=new Action;n.text=js_StringTable.ROTATE_COUNTER_CLOCKWISE;n.loadFromDOM("rotateCounterClockwiseTool");n.isToggle=
!1;d(n,RELite.Manager.onRotateActionClicked);this.aRightActions.push(n);this.aActions.push(n);var o=new Action;o.text=js_StringTable.ROTATE_CLOCKWISE;o.loadFromDOM("rotateClockwiseTool");o.isToggle=!1;d(o,RELite.Manager.onRotateActionClicked);this.aRightActions.push(o);this.aActions.push(o);var q=new Action;q.text=js_StringTable.FLIP_H;q.loadFromDOM("flipHorizontalTool");q.isToggle=!1;d(q,RELite.Manager.onFlipActionClicked);this.aRightActions.push(q);this.aActions.push(q);var p=new Action;p.text=
js_StringTable.FLIP_V;p.loadFromDOM("flipVerticalTool");p.isToggle=!1;d(p,RELite.Manager.onFlipActionClicked);this.aRightActions.push(p);this.aActions.push(p);var u=new Action;u.text=js_StringTable.PREV_SERIES_TIP;u.loadFromDOM("prevSeriesTool");u.isToggle=!1;d(u,RELite.Manager.onPrevSeriesToolClicked);this.aRightActions.push(u);this.aActions.push(u);var s=new Action;s.text=js_StringTable.NEXT_SERIES_TIP;s.loadFromDOM("nextSeriesTool");s.isToggle=!1;d(s,RELite.Manager.onNextSeriesToolClicked);this.aRightActions.push(s);
this.aActions.push(s);var r=new Action;r.text=js_StringTable.PREV_IMG_TIP;r.loadFromDOM("prevFrameTool");r.isToggle=!1;d(r,RELite.Manager.onPrevImageToolClicked);this.aRightActions.push(r);this.aActions.push(r);var v=new Action;v.text=js_StringTable.NEXT_IMG_TIP;v.loadFromDOM("nextFrameTool");v.isToggle=!1;d(v,RELite.Manager.onNextImageToolClicked);this.aRightActions.push(v);this.aActions.push(v);var x=new Action;x.text=js_StringTable.LAYOUT_TIP;x.loadFromDOM("selectLayoutTool");x.isToggle=!1;d(x,
RELite.Manager.onSelectLayoutToolClicked);this.aRightActions.push(x);this.aActions.push(x);var t=new Action;t.text=js_StringTable.OVERLAYS_TIP;t.loadFromDOM("overlayTool");t.isToggle=!1;d(t,RELite.Manager.onOverlayToolClicked);this.aRightActions.push(t);this.aActions.push(t);var w=new Action;w.text=js_StringTable.VIEW_REPORT;w.loadFromDOM("showReports");w.isToggle=!1;d(w,RELite.Manager.onShowReportsToolClicked);this.aRightActions.push(w);this.aActions.push(w);var y=new Action;y.text=js_StringTable.INVERT_IMAGE;
y.loadFromDOM("invertImage");y.isToggle=!1;d(y,RELite.Manager.onInvertImageActionClicked);this.aRightActions.push(y);this.aActions.push(y);var z=new Action;z.loadFromDOM("menuOverflow");z.isToggle=!1;d(z,RELite.Manager.onShowPanelButtonClicked);this.aRightActions.push(z);this.aActions.push(z);var A=new Action;A.text=js_StringTable.BACK;A.loadFromDOM("goBack");A.isToggle=!1;d(A,RELite.Manager.onBackButtonClicked);this.aRightActions.push(A);this.aActions.push(A);this.removeActionOrder.actions=[y,w,
m,A,n,o,q,p,t,x,k,l,j,h,u,s,r,v];this.leftActionOrder=[c,e,f,i,h,k,l,j];this.rightActionOrder=[m,n,o,q,p,u,s,r,v,x,t,y,w,z,A];$(this.domLeftToolbar).empty();$(this.domRightToolbar).empty();for(c=0;c<this.leftActionOrder.length;c++)this.domLeftToolbar.appendChild(this.leftActionOrder[c].domContainer);for(c=0;c<this.rightActionOrder.length;c++)this.domRightToolbar.appendChild(this.rightActionOrder[c].domContainer)};this.init()}DesktopToolsPanel.prototype=new ToolsPanel;
DesktopToolsPanel.prototype.constructor=DesktopToolsPanel;DesktopToolsPanel.prototype.pushLeftActionInPosition=function(c){if(this.leftActionOrder.indexOf(c)>=0){$(this.domLeftToolbar.children).detach();for(c=0;c<this.leftActionOrder.length;c++){var b=this.leftActionOrder[c];this.aLeftActions.indexOf(b)>=0&&this.domLeftToolbar.appendChild(b.domContainer)}}};
DesktopToolsPanel.prototype.pushRightActionInPosition=function(c){if(this.rightActionOrder.indexOf(c)>=0){$(this.domRightToolbar.children).detach();for(c=0;c<this.rightActionOrder.length;c++){var b=this.rightActionOrder[c];this.aRightActions.indexOf(b)>=0&&this.domRightToolbar.appendChild(b.domContainer)}}};
DesktopToolsPanel.prototype.doLayout=function(){var c=this.domContainer;c.style.width=window.innerWidth+"px";c.style.display="block";for(var c=window.innerWidth,b=53*(this.aLeftActions.length+this.aRightActions.length)+32;b>c&&this.removeActionOrder.index<this.removeActionOrder.actions.length;){var d=this.removeActionOrder.actions[this.removeActionOrder.index++],b=this.aRightActions.indexOf(d),a=this.aLeftActions.indexOf(d);a!==-1?(d=this.aLeftActions[a],this.aLeftActions.splice(a,1)):b!==-1&&(d=
this.aRightActions[b],this.aRightActions.splice(b,1));d.detatch();b=53*(this.aLeftActions.length+this.aRightActions.length)+32;this.aDrawerActions.push(d);$("#drawerActionContainer").append(d.domContainer)}for(b=53*(this.aLeftActions.length+this.aRightActions.length+1)+32;b<c&&this.removeActionOrder.index>0;)d=this.removeActionOrder.actions[--this.removeActionOrder.index],d.detatch(),this.aDrawerActions.splice(this.aDrawerActions.indexOf(d),1),d.isLeftAction?(this.aLeftActions.push(d),this.pushLeftActionInPosition(d)):
(this.aRightActions.push(d),this.pushRightActionInPosition(d)),b=53*(this.aLeftActions.length+this.aRightActions.length+1)+32};function DesktopToolsPanelForLocalViewer(){this.aActions=[];this.aLeftActions=[];this.aRightActions=[];this.aDrawerActions=[];this.removeActionOrder={actions:[],index:0};this.leftActionOrder=[];this.rightActionOrder=[];this.domContainer=document.getElementById("toolbarContainer");this.domLeftToolbar=document.getElementById("tools");this.domRightToolbar=document.getElementById("rightToolbar");this.$drawer=$("#drawer");this.init=function(){var c=new Action;c.text=js_StringTable.SELSTACK_TIP;c.loadFromDOM("scroll");
c.isToggle=!0;var b=RELite.Manager.getEventName(),d=$.noop,d=b.trim().split(" ");if(d.length===2)var a=d[0],g=d[1],d=function(b,c,d){b.domContainer.addEventListener(a,c,!!d);b.domContainer.addEventListener(g,c,!!d)};else d=function(a,c,d){a.domContainer.addEventListener(b,c,!!d)};d(c,RELite.Manager.onToolClick);this.aLeftActions.push(c);this.aActions.push(c);var e=new Action;e.text=js_StringTable.PAN_TIP;e.loadFromDOM("pan");e.isToggle=!0;d(e,RELite.Manager.onToolClick);e.isLeftAction=!0;this.aLeftActions.push(e);
this.aActions.push(e);var f=new Action;f.text=js_StringTable.ZOOM_TIP;f.loadFromDOM("zoom");f.isToggle=!0;d(f,RELite.Manager.onToolClick);f.isLeftAction=!0;this.aLeftActions.push(f);this.aActions.push(f);var i=new Action;i.text=js_StringTable.RESET_TIP;i.loadFromDOM("resetTool");i.isToggle=!1;d(i,RELite.Manager.onResetToolClicked);i.isLeftAction=!0;this.aLeftActions.push(i);this.aActions.push(i);var h=null,k=null,l=null;if(RELite.Settings.bLocalEyeViewerPresent)k=new Action,k.text=js_StringTable.OPEN_LE,
k.loadFromDOM("openWithLocalEye"),k.isToggle=!1,d(k,RELite.Manager.onLaunchLocalEyeButtonClicked),this.aRightActions.push(k),this.aActions.push(k),h=new Action,h.text=js_StringTable.EXP_DROP,h.loadFromDOM("exportToDropbox"),h.isToggle=!1,d(h,RELite.Manager.onExportToDropBoxActionClicked),this.aRightActions.push(h),this.aActions.push(h);if(RELite.localNonDicomTree&&RELite.localNonDicomTree.length)l=new Action,l.text=js_StringTable.SHOW_NON_DICOM_FILES,l.loadFromDOM("showNonDICOM"),l.isToggle=!1,d(l,
RELite.Manager.onShowNonDICOMClicked),this.aRightActions.push(l),this.aActions.push(l);var j=new Action;j.text=js_StringTable.FORCE_CINE;j.loadFromDOM("forceCineTool");j.isToggle=!1;d(j,RELite.Manager.onForceCineActionClicked);this.aRightActions.push(j);this.aActions.push(j);var m=new Action;m.text=js_StringTable.ROTATE_COUNTER_CLOCKWISE;m.loadFromDOM("rotateCounterClockwiseTool");m.isToggle=!1;d(m,RELite.Manager.onRotateActionClicked);this.aRightActions.push(m);this.aActions.push(m);var n=new Action;
n.text=js_StringTable.ROTATE_CLOCKWISE;n.loadFromDOM("rotateClockwiseTool");n.isToggle=!1;d(n,RELite.Manager.onRotateActionClicked);this.aRightActions.push(n);this.aActions.push(n);var o=new Action;o.text=js_StringTable.FLIP_H;o.loadFromDOM("flipHorizontalTool");o.isToggle=!1;d(o,RELite.Manager.onFlipActionClicked);this.aRightActions.push(o);this.aActions.push(o);var q=new Action;q.text=js_StringTable.FLIP_V;q.loadFromDOM("flipVerticalTool");q.isToggle=!1;d(q,RELite.Manager.onFlipActionClicked);this.aRightActions.push(q);
this.aActions.push(q);var p=new Action;p.text=js_StringTable.PREV_SERIES_TIP;p.loadFromDOM("prevSeriesTool");p.isToggle=!1;d(p,RELite.Manager.onPrevSeriesToolClicked);this.aRightActions.push(p);this.aActions.push(p);var u=new Action;u.text=js_StringTable.NEXT_SERIES_TIP;u.loadFromDOM("nextSeriesTool");u.isToggle=!1;d(u,RELite.Manager.onNextSeriesToolClicked);this.aRightActions.push(u);this.aActions.push(u);var s=new Action;s.text=js_StringTable.PREV_IMG_TIP;s.loadFromDOM("prevFrameTool");s.isToggle=
!1;d(s,RELite.Manager.onPrevImageToolClicked);this.aRightActions.push(s);this.aActions.push(s);var r=new Action;r.text=js_StringTable.NEXT_IMG_TIP;r.loadFromDOM("nextFrameTool");r.isToggle=!1;d(r,RELite.Manager.onNextImageToolClicked);this.aRightActions.push(r);this.aActions.push(r);var v=new Action;v.text=js_StringTable.LAYOUT_TIP;v.loadFromDOM("selectLayoutTool");v.isToggle=!1;d(v,RELite.Manager.onSelectLayoutToolClicked);this.aRightActions.push(v);this.aActions.push(v);var x=new Action;x.text=
js_StringTable.OVERLAYS_TIP;x.loadFromDOM("overlayTool");x.isToggle=!1;d(x,RELite.Manager.onOverlayToolClicked);this.aRightActions.push(x);this.aActions.push(x);var t=new Action;t.loadFromDOM("menuOverflow");t.isToggle=!1;d(t,RELite.Manager.onShowPanelButtonClicked);this.aRightActions.push(t);this.aActions.push(t);var w=null,w=new Action;w.text=js_StringTable.FIND_PAGE_TITLE;w.loadFromDOM("showStudies");w.isToggle=!1;d(w,RELite.Manager.onLocalShowStudiesButtonClicked);this.aRightActions.push(w);this.aActions.push(w);
this.aRightActions.push(w);this.aActions.push(w);this.removeActionOrder.actions=[j,w,m,n,o,q,x,v,i,p,u,s,r];this.leftActionOrder=[c,e,f,i];this.rightActionOrder=[j,m,n,o,q,p,u,s,r,v,x,w,t];l&&(this.removeActionOrder.actions.push(l),this.rightActionOrder.unshift(l));h&&(this.removeActionOrder.actions.push(h),this.rightActionOrder.unshift(h));k&&(this.removeActionOrder.actions.push(k),this.rightActionOrder.unshift(k));$(this.domLeftToolbar).empty();$(this.domRightToolbar).empty();for(c=0;c<this.aLeftActions.length;c++)this.domLeftToolbar.appendChild(this.aLeftActions[c].domContainer);
for(c=0;c<this.aRightActions.length;c++)this.domRightToolbar.appendChild(this.aRightActions[c].domContainer)};this.init()}DesktopToolsPanelForLocalViewer.prototype=new ToolsPanel;DesktopToolsPanelForLocalViewer.prototype.constructor=DesktopToolsPanelForLocalViewer;
DesktopToolsPanelForLocalViewer.prototype.pushLeftActionInPosition=function(c){var b=this.leftActionOrder.indexOf(c);if(b>=0){var d=this.domLeftToolbar.children;b===0?this.domLeftToolbar.insertBefore(c.domContainer,this.domLeftToolbar.firstChild):b>=d.length?this.domLeftToolbar.appendChild(c.domContainer):this.domLeftToolbar.insertBefore(c.domContainer,d[b-1])}};
DesktopToolsPanelForLocalViewer.prototype.pushRightActionInPosition=function(c){if(this.rightActionOrder.indexOf(c)>=0){$(this.domRightToolbar.children).detach();for(c=0;c<this.rightActionOrder.length;c++){var b=this.rightActionOrder[c];this.aRightActions.indexOf(b)>=0&&this.domRightToolbar.appendChild(b.domContainer)}}};
DesktopToolsPanelForLocalViewer.prototype.doLayout=function(){var c=this.domContainer;c.style.width=window.innerWidth+"px";c.style.display="block";var c=window.innerWidth,b=53*(this.aLeftActions.length+this.aRightActions.length)+32;for($("#rightToolbar #openWithLocalEye").length>0&&(b=b-48+165);b>c&&this.removeActionOrder.index<this.removeActionOrder.actions.length;){var d=this.removeActionOrder.actions[this.removeActionOrder.index++],b=this.aRightActions.indexOf(d),a=this.aLeftActions.indexOf(d);
a!==-1?(d=this.aLeftActions[a],this.aLeftActions.splice(a,1)):b!==-1&&(d=this.aRightActions[b],this.aRightActions.splice(b,1));d.detatch();b=53*(this.aLeftActions.length+this.aRightActions.length)+32;$("#rightToolbar #openWithLocalEye").length>0&&(b=b-48+165);this.aDrawerActions.push(d);$("#drawerActionContainer").append(d.domContainer)}b=53*(this.aLeftActions.length+this.aRightActions.length+1)+32;d=this.removeActionOrder.index-1;for(d>=0&&this.removeActionOrder.actions[d].sID==="openWithLocalEye"&&
(b=b-48+165);b<c&&this.removeActionOrder.index>0;)d=this.removeActionOrder.actions[--this.removeActionOrder.index],d.detatch(),this.aDrawerActions.splice(this.aDrawerActions.indexOf(d),1),d.isLeftAction?(this.aLeftActions.push(d),this.pushLeftActionInPosition(d)):(this.aRightActions.push(d),this.pushRightActionInPosition(d)),b=53*(this.aLeftActions.length+this.aRightActions.length+1)+32,$("#rightToolbar #openWithLocalEye").length>0&&(b=b-48+165)};function MobileToolsPanel(){this.aActions=[];this.aLeftActions=[];this.aRightActions=[];this.aDrawerActions=[];this.removeActionOrder={actions:[],index:0};this.leftActionOrder=[];this.rightActionOrder=[];this.domContainer=document.getElementById("toolbarContainer");this.domLeftToolbar=document.getElementById("tools");this.domRightToolbar=document.getElementById("rightToolbar");this.$drawer=$("#drawer");this.init=function(){var c=new Action;c.loadFromDOM("scroll");c.text=js_StringTable.SELSTACK_TIP;
c.isToggle=!0;c.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);this.aLeftActions.push(c);this.aActions.push(c);var b=new Action;b.loadFromDOM("pan");b.text=js_StringTable.PAN_TIP;b.isToggle=!0;b.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);b.isLeftAction=!0;this.aLeftActions.push(b);this.aActions.push(b);var d=new Action;d.loadFromDOM("zoom");d.text=js_StringTable.ZOOM_TIP;d.isToggle=!0;d.domContainer.addEventListener(RELite.Manager.getEventName(),
RELite.Manager.onToolClick,!1);d.isLeftAction=!0;this.aLeftActions.push(d);this.aActions.push(d);var a=new Action;a.loadFromDOM("windowLevel");a.text=js_StringTable.WINLEV_TIP;a.isToggle=!0;a.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);a.isLeftAction=!0;this.aLeftActions.push(a);this.aActions.push(a);var g=new Action;g.loadFromDOM("measMenu");g.text=js_StringTable.MEAS_TIP;g.isToggle=!0;g.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,
!1);g.isLeftAction=!0;this.aLeftActions.push(g);this.aActions.push(g);var e=new Action;e.loadFromDOM("measLineTool");e.text=js_StringTable.MEAS_LINE_TIP;e.isToggle=!0;e.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);g.addAction(e);e=new Action;e.loadFromDOM("measRectAreaTool");e.text=js_StringTable.MEAS_RECT_TIP;e.isToggle=!0;e.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);g.addAction(e);e=new Action;e.loadFromDOM("measElliptAreaTool");
e.text=js_StringTable.MEAS_ELLIPT_TIP;e.isToggle=!0;e.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);g.addAction(e);e=new Action;e.text=js_StringTable.MEAS_ANGLE_TIP;e.loadFromDOM("measAngle");e.isToggle=!0;e.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);g.addAction(e);e=new Action;e.text=js_StringTable.MEAS_DENS_TIP;e.loadFromDOM("measDensity");e.isToggle=!0;e.domContainer.addEventListener(RELite.Manager.getEventName(),
RELite.Manager.onToolClick,!1);e.isLeftAction=!0;this.aLeftActions.push(e);this.aActions.push(e);var f=new Action;f.text=js_StringTable.MAGNIFIER_TIP;f.loadFromDOM("magnifier");f.isToggle=!0;f.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onToolClick,!1);f.isLeftAction=!0;this.aLeftActions.push(f);this.aActions.push(f);var i=new Action;i.loadFromDOM("resetTool");i.text=js_StringTable.RESET_TIP;i.isToggle=!1;i.domContainer.addEventListener(RELite.Manager.getEventName(),
RELite.Manager.onResetToolClicked,!1);i.isLeftAction=!0;this.aLeftActions.push(i);this.aActions.push(i);var h=new Action;h.text=js_StringTable.FORCE_CINE;h.loadFromDOM("forceCineTool");h.isToggle=!1;h.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onForceCineActionClicked,!1);this.aRightActions.push(h);this.aActions.push(h);var k=new Action;k.text=js_StringTable.ROTATE_COUNTER_CLOCKWISE;k.loadFromDOM("rotateCounterClockwiseTool");k.isToggle=!1;k.domContainer.addEventListener(RELite.Manager.getEventName(),
RELite.Manager.onRotateActionClicked,!1);this.aRightActions.push(k);this.aActions.push(k);var l=new Action;l.text=js_StringTable.ROTATE_CLOCKWISE;l.loadFromDOM("rotateClockwiseTool");l.isToggle=!1;l.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onRotateActionClicked,!1);this.aRightActions.push(l);this.aActions.push(l);var j=new Action;j.text=js_StringTable.FLIP_H;j.loadFromDOM("flipHorizontalTool");j.isToggle=!1;j.domContainer.addEventListener(RELite.Manager.getEventName(),
RELite.Manager.onFlipActionClicked,!1);this.aRightActions.push(j);this.aActions.push(j);var m=new Action;m.text=js_StringTable.FLIP_V;m.loadFromDOM("flipVerticalTool");m.isToggle=!1;m.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onFlipActionClicked,!1);this.aRightActions.push(m);this.aActions.push(m);var n=new Action;n.loadFromDOM("prevSeriesTool");n.text=js_StringTable.PREV_SERIES_TIP;n.isToggle=!1;n.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onPrevSeriesToolClicked,
!1);this.aRightActions.push(n);this.aActions.push(n);var o=new Action;o.loadFromDOM("nextSeriesTool");o.text=js_StringTable.NEXT_SERIES_TIP;o.isToggle=!1;o.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onNextSeriesToolClicked,!1);this.aRightActions.push(o);this.aActions.push(o);var q=new Action;q.loadFromDOM("prevFrameTool");q.text=js_StringTable.PREV_IMG_TIP;q.isToggle=!1;q.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onPrevImageToolClicked,
!1);this.aRightActions.push(q);this.aActions.push(q);var p=new Action;p.loadFromDOM("nextFrameTool");p.text=js_StringTable.NEXT_IMG_TIP;p.isToggle=!1;p.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onNextImageToolClicked,!1);this.aRightActions.push(p);this.aActions.push(p);var u=new Action;u.loadFromDOM("showThumbnails");u.text=js_StringTable.SERIE_THUM_TIP;u.isToggle=!1;u.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onChooseSeriesToolClicked,
!1);this.aRightActions.push(u);this.aActions.push(u);var s=new Action;s.loadFromDOM("selectLayoutTool");s.text=js_StringTable.LAYOUT_TIP;s.isToggle=!1;s.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onSelectLayoutToolClicked,!1);this.aRightActions.push(s);this.aActions.push(s);var r=new Action;r.loadFromDOM("overlayTool");r.text=js_StringTable.OVERLAYS_TIP;r.isToggle=!1;r.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onOverlayToolClicked,!1);
this.aRightActions.push(r);this.aActions.push(r);var v=new Action;v.text=js_StringTable.INVERT_IMAGE;v.loadFromDOM("invertImage");v.isToggle=!1;v.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onInvertImageActionClicked,!1);this.aRightActions.push(v);this.aActions.push(v);var x=new Action;x.text=js_StringTable.VIEW_REPORT;x.loadFromDOM("showReports");x.isToggle=!1;x.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onShowReportsToolClicked,!1);
this.aRightActions.push(x);this.aActions.push(x);var t=new Action;t.loadFromDOM("menuOverflow");t.isToggle=!1;t.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onShowPanelButtonClicked,!1);this.aRightActions.push(t);this.aActions.push(t);var w=new Action;w.loadFromDOM("goBack");w.text=js_StringTable.BACK;w.isToggle=!1;w.domContainer.addEventListener(RELite.Manager.getEventName(),RELite.Manager.onBackButtonClicked,!1);this.aRightActions.push(w);this.aActions.push(w);this.removeActionOrder.actions=
[v,x,h,w,k,l,j,m,r,s,e,f,u,i,g,q,p,b,d];this.leftActionOrder=[c,b,d,a,g,e,f,i];this.rightActionOrder=[h,k,l,j,m,n,o,q,p,s,r,v,x,u,t,w];$(this.domLeftToolbar).empty();$(this.domRightToolbar).empty();for(c=0;c<this.aLeftActions.length;c++)this.domLeftToolbar.appendChild(this.aLeftActions[c].domContainer);for(c=0;c<this.aRightActions.length;c++)this.domRightToolbar.appendChild(this.aRightActions[c].domContainer)};this.init()}MobileToolsPanel.prototype=new ToolsPanel;
MobileToolsPanel.prototype.constructor=MobileToolsPanel;MobileToolsPanel.prototype.pushLeftActionInPosition=function(c){if(this.leftActionOrder.indexOf(c)>=0){$(this.domLeftToolbar.children).detach();for(c=0;c<this.leftActionOrder.length;c++){var b=this.leftActionOrder[c];this.aLeftActions.indexOf(b)>=0&&this.domLeftToolbar.appendChild(b.domContainer)}}};
MobileToolsPanel.prototype.pushRightActionInPosition=function(c){if(this.rightActionOrder.indexOf(c)>=0){$(this.domRightToolbar.children).detach();for(c=0;c<this.rightActionOrder.length;c++){var b=this.rightActionOrder[c];this.aRightActions.indexOf(b)>=0&&this.domRightToolbar.appendChild(b.domContainer)}}};
MobileToolsPanel.prototype.doLayout=function(){var c=this.domContainer;c.style.width=window.innerWidth+"px";c.style.display="block";for(var c=window.innerWidth,b=53*(this.aLeftActions.length+this.aRightActions.length)+32;b>c&&this.removeActionOrder.index<this.removeActionOrder.actions.length;){var d=this.removeActionOrder.actions[this.removeActionOrder.index++],b=this.aRightActions.indexOf(d),a=this.aLeftActions.indexOf(d);a!==-1?(d=this.aLeftActions[a],this.aLeftActions.splice(a,1)):b!==-1&&(d=this.aRightActions[b],
this.aRightActions.splice(b,1));d.detatch();b=53*(this.aLeftActions.length+this.aRightActions.length)+32;this.aDrawerActions.push(d);$("#drawerActionContainer").append(d.domContainer)}for(b=53*(this.aLeftActions.length+this.aRightActions.length+1)+32;b<c&&this.removeActionOrder.index>0;)d=this.removeActionOrder.actions[--this.removeActionOrder.index],d.detatch(),this.aDrawerActions.splice(this.aDrawerActions.indexOf(d),1),d.isLeftAction?(this.aLeftActions.push(d),this.pushLeftActionInPosition(d)):
(this.aRightActions.push(d),this.pushRightActionInPosition(d)),b=53*(this.aLeftActions.length+this.aRightActions.length+1)+32};function MainViewPanel(){this.seriesPanels=[];this.domContainer=document.getElementById("viewerContainer");this.seriesLayout={rows:2,cols:2}};function GenericLayout(){}GenericLayout.prototype.constructor=GenericLayout;GenericLayout.prototype.toolsPanel=null;GenericLayout.prototype.thumbnailPanel=null;GenericLayout.prototype.mainViewPanel=null;GenericLayout.prototype.width=0;GenericLayout.prototype.height=0;GenericLayout.prototype.doLayout=function(){};GenericLayout.prototype.onViewerShown=function(){};GenericLayout.prototype.onViewerHidden=function(){};
GenericLayout.prototype.initCustomTools=function(){if(RELite.Settings.bEnableCustomTools){var c=RELite.Manager.isDisplay()?"":"../";c+="customparts/CustomTools.js";var b=document.createElement("script");b.addEventListener("load",function(){RELite.CustomTools&&RELite.CustomTools.init&&RELite.CustomTools.init()});b.addEventListener("error",console.error);b.type="text/javascript";b.src=c;document.body.appendChild(b)}};GenericLayout.prototype.updateDetailPanelPositionAndSize=function(){};function MobileLayout(){this.toolsPanel=new MobileToolsPanel;this.mainViewPanel=new MainViewPanel;this.initCustomTools()}MobileLayout.prototype=new GenericLayout;MobileLayout.prototype.constructor=MobileLayout;
MobileLayout.prototype.doLayout=function(){this.width=window.innerWidth;this.height=window.innerHeight-58;this.toolsPanel.doLayout();var c=RELite.Viewer.getPixelRatioWrtSettings(),b=Math.floor(this.width/this.mainViewPanel.seriesLayout.cols)-2,d=Math.floor(this.height/this.mainViewPanel.seriesLayout.rows)-2,a=b*c;c*=d;for(var g=this.mainViewPanel.seriesPanels,e=0;e<g.length;e++){g[e].canvas.width=a;g[e].canvas.height=c;g[e].canvas.style.width=b+"px";g[e].canvas.style.height=d+"px";if(g[e].canvas.parentElement)g[e].canvas.parentElement.style.height=
d+"px",g[e].canvas.parentElement.style.width=b+"px";g[e].canvas.iCSSWidth=b;g[e].canvas.iCSSHeight=d;g[e].translateX=null;g[e].translateY=null;g[e].calculateDICOMImageSize();g[e].redraw()}this.mainViewPanel.domContainer.style.width=this.width+"px";this.mainViewPanel.domContainer.style.height=this.height+"px";this.thumbnailPanel&&this.thumbnailPanel.redraw(!0,!1)};
MobileLayout.prototype.updateDetailPanelPositionAndSize=function(){var c=RELite.Viewer.getDetailPanel();if(c){this.width=window.innerWidth;this.height=window.innerHeight-58;var b=RELite.Viewer.getPixelRatioWrtSettings(),d=Math.floor(this.width)-0,a=Math.floor(this.height);if(c.canvas.parentElement)c.canvas.parentElement.style.height=a+"px",c.canvas.parentElement.style.width=d+0-2+"px",c.canvas.parentElement.style.top=this.mainViewPanel.domContainer.style.top,c.canvas.parentElement.style.left=this.mainViewPanel.domContainer.style.left;
c.canvas.width=d*b;c.canvas.height=a*b;c.canvas.style.width=d+"px";c.canvas.style.height=a+"px";c.canvas.iCSSWidth=d;c.canvas.iCSSHeight=a;c.translateX=null;c.translateY=null;c.calculateDICOMImageSize();c.redraw()}};function DesktopLayout(){this.toolsPanel=RELite.Manager.isLocalViewer()?new DesktopToolsPanelForLocalViewer:new DesktopToolsPanel;this.mainViewPanel=new MainViewPanel;$("#showThumbnails, #showThumbnailsMenuItem").remove();this.initCustomTools()}DesktopLayout.prototype=new GenericLayout;DesktopLayout.prototype.constructor=DesktopLayout;DesktopLayout.prototype.showQuickScrollBar=!0;
DesktopLayout.prototype.setShowQuickScrollBarEnabled=function(c){this.showQuickScrollBar=c;c===!0?$("div.quick-scrollbar").removeClass("hidden"):$("div.quick-scrollbar").addClass("hidden");this.doLayout()};
DesktopLayout.prototype.doLayout=function(){this.width=window.innerWidth-150;this.height=window.innerHeight-48-10;this.toolsPanel.doLayout();for(var c=this.showQuickScrollBar?SeriesPanel.SCROLLBAR_WIDTH:0,b=RELite.Viewer.getPixelRatioWrtSettings(),d=Math.floor(this.width/this.mainViewPanel.seriesLayout.cols)-c,a=Math.floor(this.height/this.mainViewPanel.seriesLayout.rows)-2,g=d*b,e=a*b,f=this.mainViewPanel.seriesPanels,i=0;i<f.length;i++){f[i].canvas.width=g;f[i].canvas.height=e;f[i].canvas.style.width=
d+"px";f[i].canvas.style.height=a+"px";if(f[i].canvas.parentElement)f[i].canvas.parentElement.style.height=a+"px",f[i].canvas.parentElement.style.width=d+c-2+"px";f[i].canvas.iCSSWidth=d;f[i].canvas.iCSSHeight=a;f[i].translateX=null;f[i].translateY=null;f[i].calculateDICOMImageSize();f[i].redraw()}if(this.thumbnailPanel)this.thumbnailPanel.domContainer.style.position="absolute",this.thumbnailPanel.domContainer.style.left="0px",this.thumbnailPanel.domContainer.style.top="48px",d=150,a=this.height,
this.thumbnailPanel.domContainer.width=d*b,this.thumbnailPanel.domContainer.height=a*b,this.thumbnailPanel.domContainer.style.width=d+"px",this.thumbnailPanel.domContainer.style.height=a+"px",this.thumbnailPanel.domContainer.iCSSWidth=d,this.thumbnailPanel.domContainer.iCSSHeight=a,this.thumbnailPanel.redraw();this.mainViewPanel.domContainer.style.left="150px";this.mainViewPanel.domContainer.style.width=this.width+"px";this.mainViewPanel.domContainer.style.height=this.height+"px";this.updateDetailPanelPositionAndSize()};
DesktopLayout.prototype.onViewerShown=function(){this.thumbnailPanel.show()};DesktopLayout.prototype.onViewerHidden=function(){this.thumbnailPanel.hide()};
DesktopLayout.prototype.updateDetailPanelPositionAndSize=function(){var c=RELite.Viewer.getDetailPanel();if(c){this.width=window.innerWidth-150;this.height=window.innerHeight-48-10;var b=this.showQuickScrollBar?SeriesPanel.SCROLLBAR_WIDTH:0,d=RELite.Viewer.getPixelRatioWrtSettings(),a=Math.floor(this.width)-b,g=Math.floor(this.height);if(c.canvas.parentElement)c.canvas.parentElement.style.height=g+"px",c.canvas.parentElement.style.width=a+b-2+"px",c.canvas.parentElement.style.top=this.mainViewPanel.domContainer.style.top,
c.canvas.parentElement.style.left=this.mainViewPanel.domContainer.style.left;c.canvas.width=a*d;c.canvas.height=g*d;c.canvas.style.width=a+"px";c.canvas.style.height=g+"px";c.canvas.iCSSWidth=a;c.canvas.iCSSHeight=g;c.translateX=null;c.translateY=null;c.calculateDICOMImageSize();c.redraw()}};this.RELite===void 0&&(RELite={});
RELite.Viewer=function(){var c=null,b=null,d=null,a=0,g=[],e=null,f=null,i=!1;RELite.Utils.isMobile();var h=null,k=null,l={},j=null,m=function(){j.doLayout();$(".overlay").hide()},n=function(){for(var a=j.mainViewPanel.seriesPanels,b=0;b<a.length&&b<g.length;b++)a[b].setViewingSeries(g[b]),g[b].dicomImages.length>0&&g[b].fireOnViewingSeriesChanged(g[b].dicomImages[0].ds)},o=function(){for(var a=j.mainViewPanel.seriesPanels,b=0;b<a.length;b++)if(a[b].viewingSeries==null)return a[b];return null},q=
function(){document.getElementById("jpegCount").innerHTML="Loading... "},p=function(a){var a=a.reLiteData,b=0,c=[],d=[],e=DataSet.isSRSOPClass(a.sopClassUID),f=DataSet.isEncapPDFClass(a.sopClassUID);if(a.isImage){e=0;if(a.numOfFrames>1)h=null,h=a.localImages&&a.localImages.length?new DICOMImage(a.localImages[e].localPath):new DICOMImage,h.ds=a,h.frameNumber=e+1,a.dicomImages.push(h),d.push(h),e=1;for(;e<a.numOfFrames;e++)h=null,h=a.localImages&&a.localImages.length?new DICOMImage(a.localImages[e].localPath):
new DICOMImage,h.ds=a,h.frameNumber=e+1,a.dicomImages.push(h),c.push(h);a.aDICOMImages&&delete a.localImages}else{var h;if(e)h=DICOMSR.getNewInstance(),h.ds=a,a.dicomImages.push(h);else if(f)h=DICOMPDF.getNewInstance(),h.ds=a,a.dicomImages.push(h);else{a.seriesNumber=999999;h=InvalidDICOMImage.getNewInstance();h.ds=a;a.dicomImages.push(h);return}if(e||f){l[a.studyUID]===void 0&&(l[a.studyUID]=[]);e=l[a.studyUID];for(f=0;f<e.length;){if(a.compareTo(e[f].ds)<0){e.splice(f,0,h);break}f++}f===e.length&&
e.push(h)}}if(ViewingSeries.mapOfSOPUIDs[a.sopInstUID]===void 0){h=null;for(h=!1;b<g.length;){e=g[b].dicomImages[0].ds;if(a.compareToStudyLevel(e)>0){h=new ViewingSeries;g.splice(b,0,h);n();h.addDataSet(a);j.thumbnailPanel.onNewViewingSeriesAvailable();h=!0;break}else if(a.compareToStudyLevel(e)==0){if(a.studyUID<e.studyUID){h=new ViewingSeries;g.splice(b,0,h);n();h.addDataSet(a);j.thumbnailPanel.onNewViewingSeriesAvailable();h=!0;break}else if(a.studyUID>e.studyUID){b++;continue}if(a.compareToSeriesLevel(e)<
0){h=new ViewingSeries;g.splice(b,0,h);n();h.addDataSet(a);j.thumbnailPanel.onNewViewingSeriesAvailable();h=!0;break}else if(a.compareToSeriesLevel(e)==0){if(a.seriesUID!=e.seriesUID){b++;continue}f=e.numOfFrames;if(e.sopInstUID!=a.sopInstUID)if(f>1){if(a.compareTo(e)<0){h=new ViewingSeries;g.splice(b,0,h);n();h.addDataSet(a);j.thumbnailPanel.onNewViewingSeriesAvailable();h=!0;break}b++;continue}else if(a.numOfFrames>1){if(a.compareTo(e)<0){h=new ViewingSeries;g.splice(b,0,h);n();h.addDataSet(a);
j.thumbnailPanel.onNewViewingSeriesAvailable();h=!0;break}b++;continue}else{g[b].addDataSet(a);h=!0;break}}}b++}if(!h&&(h=new ViewingSeries,b=o(),b!=null&&b.setViewingSeries(h),h.addDataSet(a),g.push(h),j.thumbnailPanel))j.thumbnailPanel.onNewViewingSeriesAvailable();d.forEach(function(a){RELite.JPEGDownloadSerializer.addDICOMImageOnTop(a)});c.forEach(function(a){RELite.JPEGDownloadSerializer.addDICOMImage(a)})}},u=function(){},s=function(){},r=function(a){f&&($(f.canvas.parentElement).addClass("hidden"),
RELite.Settings.bEnableHDOverlay&&(f.$overlay.hide().css("z-index","-1"),f.$warningOverlay.hide().css("z-index","-1")),f.reset(),a!==!1&&v(j.mainViewPanel.seriesPanels[0]))},v=function(a){var b=e;e=a;b&&a!=b&&b.redraw();x();if(a){for(var c=0;c<j.mainViewPanel.seriesPanels.length;c++)if(j.mainViewPanel.seriesPanels[c]!=a)j.mainViewPanel.seriesPanels[c].curRefLine=ReferenceLine.getRefLineWrtPanel(j.mainViewPanel.seriesPanels[c],a),j.mainViewPanel.seriesPanels[c].redraw();a.redraw()}a!=b&&RELite.Utils.dispatchEvent(document,
"selectedPanelChanged",e)},x=function(){for(var a=j.mainViewPanel.seriesPanels,b=0;b<a.length;b++)a[b].curRefLine=null},t=function(){var a=j.mainViewPanel.seriesPanels;$("#drawer").panel("close");e?j.thumbnailPanel.show(e):a.length&&(v(a[0]),t())},w=function(){for(var a=j.mainViewPanel.seriesPanels,b=0;b<a.length;b++)a[b].redraw();f.redraw()},y=function(a,b,c){if(c)j.mainViewPanel.seriesLayout.rows=a,j.mainViewPanel.seriesLayout.cols=b;else{if(k)k.style.display="none",document.body.appendChild(k);
RELite.Device.bIsSmartphone&&j&&j.thumbnailPanel.hide();e=null;for(c=j.mainViewPanel.seriesPanels.pop();c;)c.destroy(),c=j.mainViewPanel.seriesPanels.pop();for(c=0;c<g.length;c++)g[c].removeAllOnViewingSeriesChangedListeners();j.mainViewPanel.seriesLayout.rows=a;j.mainViewPanel.seriesLayout.cols=b;for(c=0;c<a*b;c++){var d=document.createElement("div");d.className="series-panel-container "+(RELite.Device.bIsSmartphone?"smartphone":"");var f=document.createElement("div");f.className="quick-scrollbar";
var h=document.createElement("div");h.className="scrollbar-picker";f.appendChild(h);h=K();h.style.backgroundColor="black";var i=new SeriesPanel(h);i.init();j.mainViewPanel.seriesPanels.push(i);d.appendChild(h);d.appendChild(f);i.setScrollBarContainer(f);j.mainViewPanel.domContainer.appendChild(d);j.setShowQuickScrollBarEnabled&&j.setShowQuickScrollBarEnabled(j.showQuickScrollBar)}n();m()}},z=function(a){a.reLiteData.was!=a.reLiteData.is&&(RELite.Manager.setIsValidLicense(a.reLiteData.is,parseInt(a.reLiteData.iErr)),
w())},A=function(a){if(a.reLiteData){x();for(var b=j.mainViewPanel.seriesPanels,c=0;c<b.length;c++)if(b[c]!=a.reLiteData)b[c].curRefLine=ReferenceLine.getRefLineWrtPanel(b[c],a.reLiteData),b[c].redraw()}},C=function(a){if(a.which==32){var b=RELite.Viewer.getSelectedImagePanel();b&&(b.bPlayingCine?b.stopCine():b.viewingSeries&&b.viewingSeries.bIsCine&&b.startCine())}else if(a.which==40)e&&e.showNextImage();else if(a.which==38)e&&e.showPreviousImage();else if(a.which==39)if(e){a=0;b=RELite.Viewer.getLayout();
for(a=0;a<b.mainViewPanel.seriesPanels.length;a++)if(b.mainViewPanel.seriesPanels[a]==e){a++;break}b.mainViewPanel.seriesPanels[a]&&v(b.mainViewPanel.seriesPanels[a])}else v(b.mainViewPanel.seriesPanels[0]);else if(a.which==37)if(e){a=0;b=RELite.Viewer.getLayout();for(a=0;a<b.mainViewPanel.seriesPanels.length;a++)if(b.mainViewPanel.seriesPanels[a]==e){a--;break}b.mainViewPanel.seriesPanels[a]&&a>=0&&v(b.mainViewPanel.seriesPanels[a])}else v(b.mainViewPanel.seriesPanels[0]);else if(a.which===33)RELite.Viewer.getThumbnailPanel().onPageUp();
else if(a.which===34)RELite.Viewer.getThumbnailPanel().onPageDown();else a.which===113&&(b=RELite.Viewer.getLayout(),b.setShowQuickScrollBarEnabled&&b.setShowQuickScrollBarEnabled(!b.showQuickScrollBar));this.onPageUp=function(){var a=iCurrentYTranslation-canvas.height;iCurrentYTranslation=a<0?0:a;RELite.Viewer.getThumbnailPanel().redraw()}},B=function(){if("CanvasRenderingContext2D"in window&&CanvasRenderingContext2D.prototype.setLineDash===void 0)CanvasRenderingContext2D.prototype.setLineDash="mozDash"in
CanvasRenderingContext2D.prototype?function(a){a[0]===0&&(a=null);this.mozDash=a}:"webkitLineDash"in CanvasRenderingContext2D.prototype?CanvasRenderingContext2D.prototype.webkitLineDash:$.noop},E=function(b){a=b.reLiteData;document.getElementById("jpegCount").innerHTML="";a==0&&alert(js_StringTable.NO_LOAD)},J=function(){$("#errorPopup").popup("open",{x:$(window).width(),y:$(window).height()})},H=function(a){var b=a.reLiteData,a=b.succeeded+b.failed,b=b.total,c=Math.floor(a/b*100);document.getElementById("jpegCount").innerHTML=
"Loading... "+c+"% ("+a+"/"+b+")";if(b==0)document.getElementById("jpegCount").innerHTML="";RELite.Viewer.getThumbnailPanel()&&RELite.Viewer.getThumbnailPanel().redraw()},F=function(){if(i)RELite.JPEGDownloadSerializer.clearQueues(),S();else{B();window.addEventListener("resize",m,!0);window.addEventListener("orientationchange",m,!0);window.addEventListener("keydown",C,!1);RELite.Utils.addEventListener(document,"queryStarted",q);RELite.Utils.addEventListener(document,"dataSetDownloaded",p);RELite.Utils.addEventListener(document,
"unknownObjectToDownload",u);RELite.Utils.addEventListener(document,"downloadFinished",s);RELite.Utils.addEventListener(document,"heartbeat",z);RELite.Utils.addEventListener(document,"computeRefLines",A);RELite.Utils.addEventListener(document,"queryPerformed",E);RELite.Utils.addEventListener(document,"datasetDecodingError",J);RELite.Utils.addEventListener(document,"jpegProgress",H);c=document.getElementById("viewerContainer");document.getElementById("toolbarContainer");var b=document.createElement("div");
b.className="series-panel-container detail-panel hidden "+(RELite.Device.bIsSmartphone?"smartphone":"");var d=document.createElement("div");d.className="quick-scrollbar";var e=document.createElement("div");e.className="scrollbar-picker";d.appendChild(e);e=K();b.style.position="absolute";b.style.top="0px";b.style.left="0px";b.style.zIndex="15";f=new SeriesPanel(e,!0);f.init();b.appendChild(e);b.appendChild(d);f.setScrollBarContainer(d);document.body.appendChild(b);j.thumbnailPanel=new ThumbnailPanel;
j.thumbnailPanel.init();b=document.createElement("div");b.id="jpegCount";b.style.position="absolute";b.style.bottom="13pt";b.style.right="0px";b.style.padding="5px";b.style.color="red";b.style.fontFamily="'Segoe UI', helvetica, sans-serif";b.style.fontSize="13pt";b.style.lineHeight="100%";b.style.textAlign="right";document.body.appendChild(b)}a=0;y(j.mainViewPanel.seriesLayout.rows,j.mainViewPanel.seriesLayout.cols);i=!0},S=function(){RELite.Viewer.Cache.removeAll();l={};if(k)k.style.display="none",
document.body.appendChild(k);if(j){r(!1);for(var a=j.mainViewPanel.seriesPanels.pop();a;)a.destroy(),a=j.mainViewPanel.seriesPanels.pop();f.reset();j.onViewerHidden()}e=null;for(a=g.pop();a;)a.destroy(),a=g.pop();var h=a=0,i=0,n=null,m=null,o=null,q=null;if(b)for(a=0;a<b.length;a++){n=b[a];for(h=0;h<n.childrenSeries.length;h++){m=n.childrenSeries[h];for(i=0;i<m.childrenInstances.length;i++){o=m.childrenInstances[i];if(o.dataSet)o.dataSet.instanceDirectoryRecord=null;for(q in o)o[q]=null,delete o[q]}for(q in m)m[q]=
null,delete m[q]}for(q in n)n[q]=null,delete n[q]}b=null;if(d)d.aborted=!0,d.destroy(),d=null;$(c).empty();$("#viewerPage").siblings("img").remove();ViewingSeries.mapOfSOPUIDs={}},K=function(a,b,c){c||(c=RELite.Viewer.getPixelRatioWrtSettings());var d=document.createElement("canvas");d.className="series-panel";d.width=a*c;d.height=b*c;d.style.width=a+"px";d.style.height=b+"px";d.iCSSWidth=a;d.iCSSHeight=b;return d};return{init:F,streamPatient:function(a,b,c){F();j.onViewerShown();var d=RELite.Utils,
e=RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/StreamDICOMDataSets",f="",f="PatientIDsList="+encodeURIComponent(a),e=d.addParameterToURL(e,f),e=d.addParameterToURL(e,"CliSessID="+encodeURIComponent(RELite.CredentialManager.cliSessID)),e=d.addParameterToURL(e,"AuthenticationToken="+encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())),e=d.addParameterToURL(e,"Username="+encodeURIComponent(RELite.CredentialManager.getUsername()));if(RELite.Settings.queryAETitlesURL&&(b||c))e=
d.addParameterToURL(e,"CallingAETitle="+encodeURIComponent(b)),e=d.addParameterToURL(e,"CalledAETitle="+encodeURIComponent(c));RELite.Settings.bUseRedirect&&(e=d.addParameterToURL(RELite.Settings.sRedirectURL,"to="+encodeURIComponent(e)));h=new DataSetStreamHandler;h.start(e,RELite.Manager.areParamsEncrypted())},streamStudy:function(a,b,c){F();j.onViewerShown();var d=RELite.Utils,e=RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/StreamDICOMDataSets",f="",f="StudyUIDsList="+encodeURIComponent(a),
e=d.addParameterToURL(e,f),e=d.addParameterToURL(e,"CliSessID="+encodeURIComponent(RELite.CredentialManager.cliSessID)),e=d.addParameterToURL(e,"AuthenticationToken="+encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())),e=d.addParameterToURL(e,"Username="+encodeURIComponent(RELite.CredentialManager.getUsername()));if(RELite.Settings.queryAETitlesURL&&(b||c))e=d.addParameterToURL(e,"CallingAETitle="+encodeURIComponent(b)),e=d.addParameterToURL(e,"CalledAETitle="+encodeURIComponent(c));
RELite.Settings.bUseRedirect&&(e=d.addParameterToURL(RELite.Settings.sRedirectURL,"to="+encodeURIComponent(e)));h=new DataSetStreamHandler;h.start(e,RELite.Manager.areParamsEncrypted())},streamStudyByAccNum:function(a,b,c){F();j.onViewerShown();var d=RELite.Utils,e=RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/StreamDICOMDataSets",f="",f="AccNumsList="+encodeURIComponent(a),e=d.addParameterToURL(e,f),e=d.addParameterToURL(e,"CliSessID="+encodeURIComponent(RELite.CredentialManager.cliSessID)),
e=d.addParameterToURL(e,"AuthenticationToken="+encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())),e=d.addParameterToURL(e,"Username="+encodeURIComponent(RELite.CredentialManager.getUsername()));if(RELite.Settings.queryAETitlesURL&&(b||c))e=d.addParameterToURL(e,"CallingAETitle="+encodeURIComponent(b)),e=d.addParameterToURL(e,"CalledAETitle="+encodeURIComponent(c));RELite.Settings.bUseRedirect&&(e=d.addParameterToURL(RELite.Settings.sRedirectURL,"to="+encodeURIComponent(e)));h=
new DataSetStreamHandler;h.start(e,RELite.Manager.areParamsEncrypted())},streamStudyByInitialTree:function(){F();j.onViewerShown();var a=RELite.Utils,b=RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/StreamDICOMDataSets",c=RELite.Viewer.toRetrieveCallingAETitle,d=RELite.Viewer.toRetrieveCalledAETitle,b=a.addParameterToURL(b,"InitialTreeURL="+encodeURIComponent(RELite.Viewer.toRetrieveInitialTreeURL)),b=a.addParameterToURL(b,"CliSessID="+encodeURIComponent(RELite.CredentialManager.cliSessID)),
b=a.addParameterToURL(b,"AuthenticationToken="+encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())),b=a.addParameterToURL(b,"Username="+encodeURIComponent(RELite.CredentialManager.getUsername()));if(RELite.Settings.queryAETitlesURL&&(c||d))b=a.addParameterToURL(b,"CallingAETitle="+encodeURIComponent(c)),b=a.addParameterToURL(b,"CalledAETitle="+encodeURIComponent(d));RELite.Settings.bUseRedirect&&(b=a.addParameterToURL(RELite.Settings.sRedirectURL,"to="+encodeURIComponent(b)));h=
new DataSetStreamHandler;h.start(b,RELite.Manager.areParamsEncrypted())},streamStudyByPushURL:function(){F();j.onViewerShown();var a=RELite.Utils,b=RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/StreamDICOMDataSets",c=RELite.Viewer.toRetrieveCallingAETitle,d=RELite.Viewer.toRetrieveCalledAETitle,b=a.addParameterToURL(b,"PushURL="+encodeURIComponent(RELite.Viewer.toRetrievePushURL)),b=a.addParameterToURL(b,"CliSessID="+encodeURIComponent(RELite.CredentialManager.cliSessID)),b=a.addParameterToURL(b,
"AuthenticationToken="+encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())),b=a.addParameterToURL(b,"Username="+encodeURIComponent(RELite.CredentialManager.getUsername()));if(RELite.Settings.queryAETitlesURL&&(c||d))b=a.addParameterToURL(b,"CallingAETitle="+encodeURIComponent(c)),b=a.addParameterToURL(b,"CalledAETitle="+encodeURIComponent(d));RELite.Settings.bUseRedirect&&(b=a.addParameterToURL(RELite.Settings.sRedirectURL,"to="+encodeURIComponent(b)));h=new DataSetStreamHandler;
h.start(b,RELite.Manager.areParamsEncrypted())},streamSeries:function(a,b,c,d){F();j.onViewerShown();var e=RELite.Settings,f=RELite.Utils,g=e.sRemotEyeCodebase+"/RemotEyeLiteServer/StreamDICOMDataSets",i="",i=e.sInitialTreeURL!=""?"InitialTreeURL="+encodeURIComponent(f.addParameterToURL(e.sInitialTreeURL,"StudyUIDsList="+a)):"StudyUIDsList="+encodeURIComponent(a),g=f.addParameterToURL(g,i),g=f.addParameterToURL(g,"SeriesUID="+encodeURIComponent(b)),g=f.addParameterToURL(g,"CliSessID="+encodeURIComponent(RELite.CredentialManager.cliSessID)),
g=f.addParameterToURL(g,"AuthenticationToken="+encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())),g=f.addParameterToURL(g,"Username="+encodeURIComponent(RELite.CredentialManager.getUsername()));if(RELite.Settings.queryAETitlesURL&&(c||d))g=f.addParameterToURL(g,"CallingAETitle="+encodeURIComponent(c)),g=f.addParameterToURL(g,"CalledAETitle="+encodeURIComponent(d));RELite.Settings.bUseRedirect&&(g=f.addParameterToURL(RELite.Settings.sRedirectURL,"to="+encodeURIComponent(g)));h=
new DataSetStreamHandler;h.start(g,RELite.Manager.areParamsEncrypted())},scanDICOMTree:function(a){if(a){var b=a.studyUID,a=a.seriesUID?a.seriesUID:void 0,c=RELite.localDicomTree;if(c){F();j.onViewerShown();for(var d=0;d<c.length;d++){var e=c[d];if(!(b!==void 0&&e.studyInstUID!=b))for(var f=0;f<e.childrenSeries.length;f++){var h=e.childrenSeries[f];if(!(a&&h.seriesInstUID!=a))for(var g=0;g<h.childrenInstances.length;g++){var i=h.childrenInstances[g];if(i.isImage){var k=new DataSet;k.patientName=e.patientName;
k.patientID=e.patientID;k.patientBirthdate=e.patientBirthdate;k.patientSex=e.patientSex;k.studyDescr=e.studyDescr;k.studyDate=e.studyDate;k.accessionNum=e.accessionNum;k.institutionName="";k.seriesDescr=h.seriesDescr;k.seriesDate=h.seriesDate;k.seriesNumber=h.seriesNum;k.seriesTime="";k.numOfFrames=i.aDICOMImages.length;k.instanceNumber=i.instanceNum;k.acqDate="";k.frameTimeMs=0;k.studyUID=e.studyInstUID;k.seriesUID=h.seriesInstUID;k.sopClassUID="";k.sopInstUID=i.sopInstUID;k.isLossy=!0;k.isImage=
i.isImage;k.origRows=i.origRows;k.origColumns=i.origColumns;k.localImages=i.aDICOMImages;if(i.frameTimeMs!==void 0&&i.frameTimeMs>0)k.frameTimeMs=i.frameTimeMs;RELite.Utils.dispatchEvent(document,"dataSetDownloaded",k)}}}}}}},getViewingSeries:function(){return g},getImagePanels:function(){return j.mainViewPanel.seriesPanels},setSelectedImagePanel:v,getSelectedImagePanel:function(){return e},getDetailPanel:function(){return f},showDetailPanel:function(a,b){RELite.Device.bIsSmartphone&&j&&j.thumbnailPanel.hide();
var c=e;RELite.Viewer.getLayout().updateDetailPanelPositionAndSize();$(f.canvas.parentElement).removeClass("hidden");f.setViewingSeries(a);f.iCineFPS=c.iCineFPS;f.iCineFrameTime=c.iCineFrameTime;f.setCurrentImageIndex(b);c.bPlayingCine?f.startCine():f.stopCine();c&&c.redraw()},hideDetailPanel:r,hideThumbnailPanel:function(){j.thumbnailPanel.detach()},showThumbnailPanel:t,updatePanels:w,setMainViewPanelLayout:y,isImageShown:function(a){for(var b=j.mainViewPanel.seriesPanels,c=0;c<b.length;c++)if(b[c].currentImage==
a)return!0;return!1},toRetrieveStudyUID:"",toRetrievePatientID:"",toRetrieveAccNum:"",toRetrieveInitialTreeURL:"",toRetrievePushURL:"",toRetrieveSeriesUID:"",toRetrieveCallingAETitle:"",toRetrieveCalledAETitle:"",destroyContent:S,getViewerContainer:function(){return c},abortDownload:function(){h&&(h.close(),h=null);a=0;document.getElementById("jpegCount").innerHTML="";RELite.JPEGDownloadSerializer.clearQueues()},getDICOMTree:function(){return b},getSeriesActionsPanel:function(){return k},setSeriesActionsPanel:function(a){k=
a},setSeriesActionsPanelVisible:function(a){if(k)k.style.display=a?"block":"none",$("#prevSeriesSliderTool, #nextSeriesSliderTool").find("rect").attr("fill","#ebebeb")},getThumbnailPanel:function(){return j.thumbnailPanel},showLocalStudiesDialog:function(){var a=RELite.Settings.bEnableHIPPICanvas=!0;RELite.Settings.bLocalEyeViewerPresent===!1&&(a=!1);F();var b=function(a,b,c,d){a=document.createElement(a);if(b)a.className=b;if(c)a.textContent=c;if(d)a.id=d;return a},c=function(){var a=document.createElement("div");
a.className="break";return a},d=function(a,c){var d=b("div","lineParamField");if(a!==void 0&&c!==void 0){var e=b("span","paramName");e.appendChild(document.createTextNode(a));d.appendChild(e);d.appendChild(document.createTextNode(c))}else d.innerHTML="&nbsp;";return d},e=document.createDocumentFragment(),f=b("div","resultCount");f.textContent=RELite.localDicomTree.length;e.appendChild(f);for(var h="",g="",i=null,f=f=0;f<RELite.localDicomTree.length;f++){var h=null,k=!1,j=!1,g=f%2?"odd":"even",i=RELite.localDicomTree[f];
i.aPDFs=[];i.aSRs=[];h="";i.patientSex=="M"&&(h="male");i.patientSex=="F"&&(h="female");var l={patientID:i.patientID,accessionNum:i.accessionNum,studyUID:i.studyInstUID},n=b("div","resultContainer "+g+" "+h+" study");n.study=i;var h=b("div","leftCol"),g=b("div","checkImgContainer"),m=b("img","itemImage");m.src="Viewer-html5/images/study_mini.png";var o=b("span","checkUID");o.textContent=i.studyInstUID;var q=b("span","itemOpenImg study opened");g.appendChild(m);g.appendChild(o);g.appendChild(q);g.appendChild(c());
h.appendChild(g);n.appendChild(h);m=b("div","rightCol");o=b("div","resultFirstLine");h=b("div","patientNameField");h.textContent=i.patientName;o.appendChild(h);g=b("div","firstLineParamField");h=b("span","paramName");h.appendChild(document.createTextNode(js_StringTable.STUDY_DATE+": "));g.appendChild(h);g.appendChild(document.createTextNode(i.studyDate));o.appendChild(g);q=b("div","statusField");h=b("span","status pdfPresent");g=b("span","status reportPresent");q.appendChild(h);q.appendChild(g);o.appendChild(q);
var q=b("div","actionsPanelField"),p=b("span","action show");p.title="Show";q.appendChild(p);if(RELite.Viewer.getNonDICOMFilesForDataset(l).length)p=b("span","action show-nondicom"),p.title=js_StringTable.SHOW_NON_DICOM_FILES,p.ds=l,q.appendChild(p);o.appendChild(q);o.appendChild(c());m.appendChild(o);n.appendChild(m);l=b("div","resultLine");l.appendChild(d(js_StringTable.PATIENT_BD+": ",i.patientBirthdate));l.appendChild(d(js_StringTable.STUDY_DESCR+": ",i.studyDescr));l.appendChild(d(js_StringTable.REF_PHYS+
": ",i.refPhysName));l.appendChild(c());m.appendChild(l);l=b("div","resultLine");l.appendChild(d("Patient ID: ",i.patientID));l.appendChild(d("Study ID: ",i.studyID));l.appendChild(d(js_StringTable.ACC_NUM+": ",i.accessionNum));l.appendChild(c());m.appendChild(l);o=function(){for(var a="",b={},c=0;c<i.childrenSeries.length;c++){var d=i.childrenSeries[c];b[d.modality]=d.modality}for(var e in b)a+=e+" ";return a}();l=b("div","resultLine");l.appendChild(d(js_StringTable.MODALITY+": ",o));l.appendChild(c());
m.appendChild(l);var r=b("div","dataNeeded"),l=b("span","uid");l.textContent=i.studyInstUID;m=b("span","patientID");m.textContent=i.patientID;o=b("span","studyDescr");o.textContent=i.studyDescr;q=b("span","studyDate");q.textContent=i.studyDate;r.appendChild(l);r.appendChild(m);r.appendChild(o);r.appendChild(q);r.id=i.sStudyUID;r.result=i;n.appendChild(r);l=b("div","seriesPanel");n.appendChild(l);e.appendChild(n);n=document.createDocumentFragment();m=d;for(o=0;o<i.childrenSeries.length;o++){var q=
i.childrenSeries[o],p=b("div","seriesResultContainer resultContainer series"),r=b("div","column1"),s=b("div"),u=b("img","itemImage");u.src="Viewer-html5/images/series_mini.png";var t=b("span","seriesUID");t.style.display="none";s.appendChild(t);s.appendChild(u);u=b("span","itemOpenImg series");u.style.display="none";s.appendChild(u);r.appendChild(s);s=b("div","column2");u=m("Series Num: ",q.seriesNum,"seriesNumber");t=m(js_StringTable.MODALITY+": ",q.modality,"modality",!0);s.appendChild(u);s.appendChild(t);
u=b("div","column3");u.appendChild(m(js_StringTable.SERIES_DESCR+": ",q.seriesDescr,"seriesDescription",!0));u.appendChild(m(js_StringTable.IMG_COUNT+": ",q.childrenInstances.length,"imageCount"));t=b("div","instancePanel");t.appendChild(b("div","instancePanelLoader"));t.appendChild(b("div","instancePanelContent"));var v=b("div","actionPanel"),w=b("span","action show");v.appendChild(w);p.appendChild(v);p.appendChild(r);p.appendChild(s);p.appendChild(u);p.appendChild(t);r=b("div","dataNeeded");r.appendChild(b("span",
"uid",q.seriesInstUID));r.appendChild(b("span","studyInstanceUID",i.studyInstUID));r.appendChild(b("span","patientID",i.patientID));p.appendChild(r);n.appendChild(p);for(p=0;p<q.childrenInstances.length;p++)if(r=q.childrenInstances[p],r.aDICOMImages.length){if(r.bSR)r.aDICOMImages[0].parent=r,i.aSRs.push(r.aDICOMImages[0]),j=!0;if(r.bPDF)r.aDICOMImages[0].parent=r,i.aPDFs.push(r.aDICOMImages[0]),k=!0}}l.appendChild(n);l.appendChild(c());h.style.visibility=k?"visible":"hidden";g.style.visibility=j?
"visible":"hidden"}k=b("div","mainContainer");d=b("div","queryDialog");j=b("div","queryDialogHeader");f=b("div","queryDialogContent");f.id="queryDialogContent";j.innerHTML=js_StringTable.FIND_PAGE_TITLE;a&&j.appendChild(b("div","localEyeButton",js_StringTable.OPEN_LE,"launchLocalEye"));j.appendChild(b("div","openAllButton",js_StringTable.OPEN_ALL));k.appendChild(e);f.appendChild(k);d.appendChild(j);a=b("div","queryDialogTip");a.innerHTML=js_StringTable.LOAD_TIP;e=b("div","footer");k=b("div","lpLogo");
j=b("div","nlLogo");e.appendChild(k);e.appendChild(j);e.appendChild(c());d.appendChild(a);d.appendChild(f);d.appendChild(e);$(d).appendTo("body");RELite.Manager.initLocalEvents();if(RELite.localDicomTree.length===1)setTimeout(function(){RELite.Viewer.scanDICOMTree({studyUID:RELite.localDicomTree[0].studyInstUID})},100);else RELite.Manager.onLocalShowStudiesButtonClicked()},showReferencedImage:function(a,b){for(var c=0;c<RELite.localDicomTree.length;c++)for(var d=RELite.localDicomTree[c],e=0;e<d.childrenSeries.length;e++)for(var f=
d.childrenSeries[e],h=0;h<f.childrenInstances.length;h++){var g=f.childrenInstances[h];if(g.sopInstUID==a){b-1<g.aDICOMImages.length&&window.open(g.aDICOMImages[b-1].localPath);break}}},setLayoutObject:function(a){j=a},getLayout:function(){return j},createHIPPICanvas:K,getPixelRatioWrtSettings:function(){return RELite.Settings.bEnableHIPPICanvas?RELite.Device.pixelRatio:1},getCurrentDataSetStreamHandler:function(){return h},refreshJPEGForSelectedPanel:function(){var a=e;if(a){var b=a.viewingSeries;
if(b&&!b.winLevLut.isNull()){for(var c=a.currentImageIndex,a=[],d=c-1,f=b.dicomImages.length;c>=0||d<f;)d++,c--,d<f&&a.push(b.dicomImages[d]),c>=0&&a.push(b.dicomImages[c]);RELite.JPEGDownloadSerializer.addDICOMImagesOnTop(a,!0)}}},getAllReports:function(){return l},getNonDICOMFilesForDataset:function(a){var b=[];if(RELite.localNonDicomTree&&RELite.localNonDicomTree.length)for(var c=0;c<RELite.localNonDicomTree.length;c++){var d=RELite.localNonDicomTree[c];(d.PatientID&&!d.AccessionNumber&&a.patientID===
d.PatientID||d.PatientID&&d.AccessionNumber&&a.patientID===d.PatientID&&a.accessionNum===d.AccessionNumber||d.StudyInstanceUID&&a.studyUID===d.StudyInstanceUID)&&b.push({name:d.FilePathname.substring(d.FilePathname.lastIndexOf("\\")+1),url:d.FilePathname,size:RELite.Utils.formatBytes(d.FileSize)})}return b}}}();if(this.RELite===void 0)this.RELite={};
RELite.Viewer.Cache=function(){var c=[],b=0,d=function(a){b+=a.rawPixelsIntArray.length*4+a.columns*a.rows*16;if(b>=RELite.Settings.iMaxMemory){for(var d=c.shift(),f=[],i=0,h=!1;b>=RELite.Settings.iMaxMemory&&d;){h=!1;if(RELite.Viewer.isImageShown(d))f.push(d),h=!0;else{if(!d.rawPixelsIntArray){d.reset();continue}b-=d.rawPixelsIntArray.length*4+d.columns*d.rows*16;d.reset();i++}d=c.shift()}h||f.push(d);c=f.concat(c)}c.push(a)},a=function(){for(var a=c.pop();a;)a.reset(),a=c.pop()};return function(){var a=
navigator.userAgent.match(/Windows|Macintosh|Linux|Android/gi);return!!a&&a.length==1}()?{add:$.noop,removeAll:$.noop,getImages:[]}:{add:d,removeAll:a,getImages:function(){return c}}}();this.RELite===void 0&&(RELite={});
RELite.Manager=function(){var c="WindowLevel",b=!0,d=null,a=!1,g=!1,e=null,f=0,i=0,h=!1,k="",l="",j="00000",m="mousedown",n=null,o=0,q=0,p=[],u=[],s={},r={},v=!1,x=function(){var a=window.location.pathname.split("/");a.pop();return"/"+a.pop()}();"ontouchstart"in document&&(m="touchstart",RELite.Utils.isMobile()||(m="touchstart mousedown"));var t=null,w=Math.round((new Date).getTime()/1E3),y=[],z=function(){var a=0,b=["all","selected",""];return{getNextState:function(){a++;g&&a==1?a=2:a>2&&(a=0);switch(a){case 0:RELite.Settings.bShowInfoOverlays=
!0;RELite.Settings.bShowRefLines=!0;break;case 1:RELite.Settings.bShowInfoOverlays=!1;RELite.Settings.bShowRefLines=!0;break;case 2:RELite.Settings.bShowInfoOverlays=!1;RELite.Settings.bShowRefLines=!1;break;default:RELite.Settings.bShowInfoOverlays=!0,RELite.Settings.bShowRefLines=!0}return b[a]}}}(),A=function(a){a.preventDefault();a.stopPropagation();var b=RELite.Viewer.getSelectedImagePanel();$(this).find("rect").attr("fill","#7be1b2");b&&b.loadPrevViewingSeries();if(a.type=="click"){var c=this;
setTimeout(function(){B.call(c,a)},150)}},C=function(a){a.preventDefault();a.stopPropagation();var b=RELite.Viewer.getSelectedImagePanel();$(this).find("rect").attr("fill","#7be1b2");b&&b.loadNextViewingSeries();if(a.type=="click"){var c=this;setTimeout(function(){B.call(c,a)},150)}},B=function(){$(this).find("rect").attr("fill","#ebebeb")},E=function(){for(var a={},b=0,c="argName"+b,d="argValue"+b;r[c]&&r[d];)c=r[c],d=r[d],c&&(a[c]=d),c="argName"+ ++b,d="argValue"+b;RELite.CredentialManager.setAdditionalParamsMap(a)},
J=function(a){a.preventDefault();a.stopPropagation();$("#drawer").panel("close");a=$.trim($(this).text()).split("x");a.length==2&&(RELite.Viewer.hideDetailPanel(),RELite.Viewer.setMainViewPanelLayout(parseInt(a[0],10),parseInt(a[1],10)),$("#layoutDialog").hide(),$("#selectLayoutTool").prop("selected",!1).find("rect").attr("fill","#ebebeb"))},H=function(){var a=RELite.Settings.defaultSeriesTiling.rows,b=RELite.Settings.defaultSeriesTiling.cols;r.username&&RELite.CredentialManager.setUsername(r.username);
r.rows&&(a=parseInt(r.rows,10));r.columns&&(b=parseInt(r.columns,10));if(r.studyUIDsList)RELite.Viewer.toRetrieveStudyUID=r.studyUIDsList;if(r.patientIDsList)RELite.Viewer.toRetrievePatientID=r.patientIDsList;if(r.accNumsList)RELite.Viewer.toRetrieveAccNum=r.accNumsList;if(r.initialTreeURL)RELite.Viewer.toRetrieveInitialTreeURL=r.initialTreeURL;if(r.pushURL)RELite.Viewer.toRetrievePushURL=r.pushURL;if(r.autoStartCine)RELite.Settings.bAutoStartCineSequences=r.autoStartCine=="true";if(r.p4)RELite.Settings.viewerParametersEncryptionEnabled===
!0?(v=!0,RELite.Viewer.toRetrievePatientID=r.p4):RELite.Viewer.toRetrievePatientID=RELite.Utils.b64Dec(r.p4);if(r.p5)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,RELite.Viewer.toRetrieveStudyUID=r.p5):RELite.Viewer.toRetrieveStudyUID=RELite.Utils.b64Dec(r.p5);if(r.p6)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,RELite.Viewer.toRetrieveAccNum=r.p6):RELite.Viewer.toRetrieveAccNum=RELite.Utils.b64Dec(r.p6);if(r.p7)RELite.Settings.viewerParametersEncryptionEnabled===!0?
(v=!0,RELite.Viewer.toRetrieveInitialTreeURL=r.p7):RELite.Viewer.toRetrieveInitialTreeURL=RELite.Utils.b64Dec(r.p7),RELite.Viewer.toRetrieveStudyUID="void";if(r.p8)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,RELite.Viewer.toRetrievePushURL=r.p8):RELite.Viewer.toRetrievePushURL=RELite.Utils.b64Dec(r.p8),RELite.Viewer.toRetrieveStudyUID="void";if(r.windowWidth){var c=parseFloat(r.windowWidth,10);c!=NaN&&(o=c)}r.windowLevel&&(c=parseFloat(r.windowLevel,10),c!=NaN&&(q=c));if(r.callingAETitle)RELite.Viewer.toRetrieveCallingAETitle=
decodeURIComponent(r.callingAETitle);if(r.calledAETitle)RELite.Viewer.toRetrieveCalledAETitle=decodeURIComponent(r.calledAETitle);if(r.p9)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,RELite.Viewer.toRetrieveCallingAETitle=r.p9):RELite.Viewer.toRetrieveCallingAETitle=RELite.Utils.b64Dec(r.p9);if(r.p10)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,RELite.Viewer.toRetrieveCalledAETitle=r.p10):RELite.Viewer.toRetrieveCalledAETitle=RELite.Utils.b64Dec(r.p10);E();g?(RELite.Viewer.getLayout()||
RELite.Viewer.setLayoutObject(new DesktopLayout),RELite.Viewer.showLocalStudiesDialog()):RELite.Settings.loadUserSettingsFromServer(function(){RELite.Settings.queryAETitlesURL&&(ha(),ia());ca();RELite.Device.bIsSmartphone&&!RELite.Viewer.getLayout()?RELite.Viewer.setLayoutObject(new MobileLayout):RELite.Viewer.getLayout()||RELite.Viewer.setLayoutObject(new DesktopLayout);RELite.Viewer.setMainViewPanelLayout(a,b,!0);RELite.Viewer.toRetrieveAccNum!=""?RELite.Viewer.streamStudyByAccNum(RELite.Viewer.toRetrieveAccNum,
RELite.Viewer.toRetrieveCallingAETitle,RELite.Viewer.toRetrieveCalledAETitle):RELite.Viewer.toRetrieveInitialTreeURL!=""?RELite.Viewer.streamStudyByInitialTree():RELite.Viewer.toRetrievePushURL!=""?RELite.Viewer.streamStudyByPushURL():RELite.Viewer.toRetrieveStudyUID!=""?RELite.Viewer.streamStudy(RELite.Viewer.toRetrieveStudyUID,RELite.Viewer.toRetrieveCallingAETitle,RELite.Viewer.toRetrieveCalledAETitle):RELite.Viewer.toRetrievePatientID!=""&&RELite.Viewer.streamPatient(RELite.Viewer.toRetrievePatientID,
RELite.Viewer.toRetrieveCallingAETitle,RELite.Viewer.toRetrieveCalledAETitle)})},F=function(){$("#requestAuthButton").prop("disabled",!1).text(js_StringTable.LOGIN_BUTTON);$("#updatePasswordButton").prop("disabled",!1).text(js_StringTable.UPDATE_PWD);$("#displayAuthDialog").fadeOut("slow");$("#errorMessageDiv").length>0&&$("#errorMessageDiv").fadeOut("slow",function(){$("#errorMessageDiv").remove()});RELite.Settings.loadUserSettingsFromServer();RELite.Settings.queryAETitlesURL&&(ha(),ia());ca();H();
RELite.CredentialManager.setUsername($("#sUsername").val());$(window).unbind("resize",N);a||($("#authenticationForm").fadeOut("fast",function(){$("#needAuthentication").fadeIn("fase")}),$("#logoutButton").show());RELite.HeartBeat.init();T()},S=function(a){a&&a.respAuthenticationStatusDetails&&RELite.Manager.showError(a.respAuthenticationStatusDetails.replace(/\n/gi,"<br />"));$("#requestAuthButton").prop("disabled",!1).text(js_StringTable.LOGIN_BUTTON);$("#updatePasswordButton").prop("disabled",!1).text(js_StringTable.UPDATE_PWD);
$("#displayAuthDialog").show()},K=function(a){a&&a.respAuthenticationStatus.toLowerCase()==="failure_password_expired"?(R(!0),$("#PWD_EXPIRED_MSG").removeClass("hidden")):$("#PWD_EXPIRED_MSG").addClass("hidden");$("#requestAuthButton").prop("disabled",!1).text(js_StringTable.LOGIN_BUTTON);$("#updatePasswordButton").prop("disabled",!1).text(js_StringTable.UPDATE_PWD);$("#displayAuthDialog").show()},X=function(a){a.preventDefault();a.stopPropagation();pa()&&($("#updatePasswordButton").prop("disabled",
!0).text(js_StringTable.LOGIN_BUTTON_WORKING),RELite.CredentialManager.requestChangePassword({username:$("#sUsername").val(),password:$("#sOldPassword").val(),newPassword:$("#sNewPassword").val(),success:F,error:S}))},I=function(a){a.preventDefault();a.stopPropagation();$("#requestAuthButton").prop("disabled",!0).text(js_StringTable.LOGIN_BUTTON_WORKING);RELite.CredentialManager.requestAuthentication({username:$("#sUsername").val(),password:$("#sPassword").val(),success:F,error:K})},R=function(a){a?
($("#authenticationForm .authentication").removeClass("visible").addClass("hidden"),$("#authenticationForm .changePassword").removeClass("hidden").addClass("visible"),$("#sUsername").prop("disabled",!0)):($("#authenticationForm .authentication").removeClass("hidden").addClass("visible"),$("#authenticationForm .changePassword").removeClass("visible").addClass("hidden"),$("#sUsername").prop("disabled",!1));$("#errorMessageDiv").hide()},U=function(){R(!0);$("#sUsername").prop("disabled",!1)};_onCancelUpdatePasswordButtonClicked=
function(){R(!1);$("#PWD_EXPIRED_MSG").addClass("hidden");$("#errorMessageDiv").hide()};var N=function(){$("#displayAuthDialog").css({width:$(window).width(),height:$(window).height})},Q=function(){RELite.Viewer.destroyContent();if(b)$("#errorMessageDiv").hide();else{var a=js_StringTable.INV_LIC;RELite.CredentialManager.getLicenseManagerError()===4&&(a=js_StringTable.USG_NOT_ALLOWED);Y(a)}},G=function(a){a=a!==void 0?a:document.body;$("a[data-rel=back]").text(js_StringTable.BACK);for(var b in js_StringTable){var c=
$("#"+b,a);c.is("input")?c.val(js_StringTable[b]):c.text(js_StringTable[b]);for(var d=1;d<3;d++)if(c=$("#"+b+d,a),c.length>0)c.is("input")?c.val(js_StringTable[b]):c.text(js_StringTable[b]);else break}$("#COPYRIGHT").text("Copyright (C) 2002 - "+(new Date).getFullYear()+" - NeoLogica");$("#saveFilterButton").text(js_StringTable.ACCEPT)},Y=function(a){if($("#errorMessageDiv").length==0){var b=$("<div />");b.attr("id","errorMessageDiv");b.html(a);$("#authenticationForm").append(b)}else $("#errorMessageDiv").html(a),
$("#errorMessageDiv").show()},D=function(){$.mobile.pageContainer.pagecontainer("change","WindowLevelPresetDetail.html",{reverse:!1,changeHash:!1})},O=function(){var b=RELite.Settings;$("#rows").slider().val(b.defaultSeriesTiling.rows).slider("refresh");$("#cols").slider().val(b.defaultSeriesTiling.cols).slider("refresh");var c=b.infoOverlays;$("#bPatientName").prop("checked",c.bPatientName);$("#bPatientSex").prop("checked",c.bPatientSex);$("#bPatientID").prop("checked",!!c.bPatientID);$("#bStudyDate").prop("checked",
c.bStudyDate);$("#bPatientBirthDate").prop("checked",c.bPatientBirthDate);$("#bSeriesDescription").prop("checked",c.bSeriesDescription);c.bModality===void 0&&c.bSeriesDescription?$("#bModality").prop("checked",!0):c.bModality!==void 0&&$("#bModality").prop("checked",c.bModality);$("#bStudyDescription").prop("checked",!!c.bStudyDescription);$("#bStudyComments").prop("checked",!!c.bStudyComments);$("#bAccNum").prop("checked",!!c.bAccNum);$("#bNumOfFrames").prop("checked",c.bNumOfFrames);$("#bWinLevel").prop("checked",
c.bWinLevel);$("#bSliceThickness").prop("checked",c.bSliceThickness);$("#bEnableHIPPICanvas").prop("checked",b.bEnableHIPPICanvas);$(".settingsDlg input[type='checkbox']").checkboxradio("refresh");var d=$("#windowLevelPresetsListView");d.empty();var e=a?"WindowLevelPresetDetail.html":"WindowLevelPresetDetail.html";$(RELite.Settings.windowLevelPresets).each(function(){var a=$("<li />").attr("data-icon","delete");$("<a />").attr("href",e).append("<h2>"+this.description+"</h2>").append("<p>Modality: "+
this.modality+", Window width: "+this.window+", Window level: "+this.level+"</p>").appendTo(a);$("<a />").attr({href:"#"}).addClass("delete").text("Remove preset").on(m,Ba).appendTo(a);a[0].windowLevelPreset=this;a.on(m,qa);d.append(a)});d.listview("refresh");$("#SAVE").off(m,W);$("#SAVE").on(m,W);$("#CANCEL").off(m,V);$("#CANCEL").on(m,V);$("#addWindowLevelPresetButton").off(m,D);$("#addWindowLevelPresetButton").on(m,D)},V=function(){RELite.Settings.loadUserSettingsFromServer()},W=function(){var b=
RELite.Settings;b.defaultSeriesTiling={rows:parseInt($("#rows").val(),10),cols:parseInt($("#cols").val(),10)};var c=b.infoOverlays;c.bPatientName=$("#bPatientName")[0].checked;c.bPatientSex=$("#bPatientSex")[0].checked;c.bPatientID=$("#bPatientID")[0].checked;c.bStudyDate=$("#bStudyDate")[0].checked;c.bPatientBirthDate=$("#bPatientBirthDate")[0].checked;c.bModality=$("#bModality")[0].checked;c.bSeriesDescription=$("#bSeriesDescription")[0].checked;c.bNumOfFrames=$("#bNumOfFrames")[0].checked;c.bWinLevel=
$("#bWinLevel")[0].checked;c.bStudyDescription=$("#bStudyDescription")[0].checked;c.bStudyComments=$("#bStudyComments")[0].checked;c.bAccNum=$("#bAccNum")[0].checked;c.bSliceThickness=$("#bSliceThickness")[0].checked;c=b.bEnableHIPPICanvas;b.bEnableHIPPICanvas=$("#bEnableHIPPICanvas")[0].checked;if(c!=b.bEnableHIPPICanvas)b.bEnableHIPPICanvas=$("#bEnableHIPPICanvas")[0].checked,RELite.Viewer.setMainViewPanelLayout(RELite.Viewer.getLayout().mainViewPanel.seriesLayout.rows,RELite.Viewer.getLayout().mainViewPanel.seriesLayout.cols);
a&&ca();b.saveUserSettingsToServer()},L=function(){RELite.Utils.doRequest({data:{CliSessID:RELite.CredentialManager.cliSessID,ReleaseUsage:"true"},to:RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/ConnectToLicenseManager",method:"GET",success:$.noop,error:$.noop},!1)},M=function(b){b.preventDefault();var b=RELite.Viewer.getSelectedImagePanel(),c=a?"images/svgs/":"../images/svgs/";g&&(c="Viewer-html5/images/svgs/");b.bPlayingCine?($(this).find("image").attr("xlink:href",c+"action.play.svg"),
b.stopCine()):($(this).find("image").attr("xlink:href",c+"action.stop.svg"),b.startCine())},P=function(b){var c=this.windowLevelPreset,d=RELite.Viewer.getSelectedImagePanel();if(c){b.preventDefault();b.stopPropagation();if(d){if(b=d.currentImage)b.setWindowLevel(c.window*b.multiplyVal,c.level*b.multiplyVal+b.additiveVal),RELite.Viewer.refreshJPEGForSelectedPanel();d.redraw()}$("#windowLevelPresetsPopup").popup("close")}else c="Preferences.html",a&&(c="gui/"+c),$(document.body).pagecontainer("change",
c,{changeHash:!1})},ga=function(a){a.preventDefault();a.stopPropagation();this.report&&this.report.open();$("#reportsPopup").popup("close")},Z=function(){$("#reportToolbar, #reportContainer").hide();$("#reportContainer").empty()},aa=function(a){a=a.replace("_AUTHTOKEN_",encodeURIComponent(RELite.CredentialManager.getAuthenticationToken())).replace("_CLISESSID_",encodeURIComponent(RELite.CredentialManager.cliSessID));RELite.Utils.doRequest({data:{URL:a},to:RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/PeriodicCall",
method:"POST",success:$.noop,error:$.noop})},ba=function(){Math.round((new Date).getTime()/1E3)-w>RELite.Settings.autoLogoffTimeoutSecs&&da()},da=function(){$("#logoffDlgOverlay, #logoffDialog").fadeIn();clearInterval(t);var b=60,c=0;$("#remainingLogoffSecs").text(b);var d=function(){c=setTimeout(d,1E3);if(--b===0){clearTimeout(c);for(var e=0;e<y.length;e++)clearInterval(y[e]);y=[];a||!RELite.Settings.sAuthenticationURL?($(document).off(),L(),$("#logoffDialog").fadeOut(),$("#loggedOffDialog").fadeIn(),
RELite.Viewer.destroyContent(),$('#mainPage, div[data-role="page"]').remove(),RELite.JPEGDownloadSerializer.closeWebSockConnection()):(RELite.Utils.setCookie("login_msg",js_StringTable.LOGGEDOFF_MSG),oa())}else $("#remainingLogoffSecs").text(b)};$(document).one("mousemove click",function(){clearTimeout(c);w=Math.round((new Date).getTime()/1E3);$("#logoffDlgOverlay, #logoffDialog").fadeOut();t=setInterval(ba,5E3)});c=setTimeout(d,1E3)},T=function(){for(var a=0;a<RELite.Settings.periodicCallURLs.length;a++){var b=
RELite.Settings.periodicCallURLs[a];y.push(setInterval(aa.bind(window,b.url),b.periodMillis))}RELite.Settings.autoLogoffTimeoutSecs&&(t=setInterval(ba,5E3),la(500),$(document).on(m,function(){w=Math.round((new Date).getTime()/1E3)}))},la=function(a){$(document).one("mousemove",function(){w=Math.round((new Date).getTime()/1E3);setTimeout(function(){la(a)},a)})},Aa=function(){RELite.Settings.sAuthenticationURL&&RELite.Settings.userPasswordChangeEnabled===!0?$("#changePasswordButton").removeClass("hidden"):
$("#changePasswordButton").remove()},na=function(){var a="mousedown";"ontouchstart"in document&&(a="touchstart",RELite.Utils.isMobile()||(a="touchstart mousedown"));$("#prevFrameTool").on("mouseup touchend",B);$("#nextFrameTool").on("mouseup touchend",B);$("#prevSeriesTool, #prevSeriesSliderTool").on("mouseup touchend",B);$("#nextSeriesTool, #nextSeriesSliderTool").on("mouseup touchend",B);$("#prevSeriesSliderTool").on(a,A);$("#nextSeriesSliderTool").on(a,C);$("#layoutDialog table tr td").on(a,J);
$("#playAction").on(a,M);$("#closeReport").on(a,Z);$("#openDialogOverlay").on(a,ra);$("#openDialog a").on("click",ra);$(window).unload(L);$(window).on("beforeunload",L);$("#windowLevelPresetsPopup ul").on(a,"li",P);$(document).on("settings-ready",Aa);$("#authenticationForm").on("keydown",function(a){var b=$("#authenticationForm .changePassword").is(".visible");b&&pa();a.keyCode==13&&(b?X(a):I(a))});$("#requestAuthButton").on("click",I);$("#updatePasswordButton").on(a,X);$("#changePasswordButton").on(a,
U);$("#cancelUpdatePasswordButton").on(a,_onCancelUpdatePasswordButtonClicked)},oa=function(){RELite.CredentialManager.invalidateAuthToken();window.location.href="../"},ka=function(){var a=$("#studyListViewContainer");a.children().remove();a.append($("<ul />").attr("data-role","listview"));for(var b="",c=0,d=i*RELite.Settings.iStudiesPerPage;d<e.length&&c<RELite.Settings.iStudiesPerPage;d++){b+="<li>";b+='<a class="studyItem" >';b+="<img src='../images/patientIcon.svg' alt='patient' class='ui-li-icon' style=\"font-size: 24px\"/>";
b+='<div class="ui-grid-b">';b+='<div class="ui-block-a">';b+="<div>";b+="<h3>"+js_StringTable.PATIENT_NAME+":<br/> "+RELite.Utils.beautyfyName(e[d].patientName)+"</h3>";b+="<p>Patient ID: "+e[d].patientID+"</p>";b+="</div>";b+="</div>";b+='<div class="ui-block-b">';b+="<div>";b+="<h3>"+js_StringTable.STUDY_DATE+": "+RELite.Utils.beautyfyDate(e[d].studyDate)+"</h3>";var h=e[d].modsInStudy.toUpperCase(),g=e[d].studyDescr;h&&(h=h.replace(/\\/gi,", "),h="[<b>"+h+"</b>]",g&&(h+=", "));b+="<p>"+js_StringTable.STUDY_DESCR+
": "+h+g+"</p>";b+="<p>"+js_StringTable.STUDY_TIME+": "+RELite.Utils.beautyfyTime(e[d].studyTime?e[d].studyTime:"")+"</p>";b+="</div>";b+="</div>";b+='<div class="ui-block-c" >';b+='<svg height="64" width="64" class="studyShowLauncher"><image x="0" y="0" height="64" width="64"  xlink:href="../images/svgs/action.show.svg" ></image></svg>';b+="</div>";b+="</div>";b+="<div style='display: none' class='uid'>"+e[d].studyInstUID+"</div>";b+="<div style='display: none' class='patientID'>"+e[d].patientID+
"</div>";b+="</a>";b+="</li>";c++}$("div#studyListViewContainer ul").html(b);$("div#studyListViewContainer ul").listview().enhanceWithin();a.show();a=Math.max(1,f);$("#STUDIES_FOUND").text(js_StringTable.STUDIES_FOUND+" ("+(i+1)+"/"+a+")")},fa=function(){b=!1;console.log("_onInvalidLicense");$("body").pagecontainer("change","#mainPage",{reverse:!0})};_orderResultsByStudyDate=function(a){var b=e.length,c=e,d="",f="";if(a&&a=="asc")for(a=0;a<b;a++)for(var h=b-1;h>a;h--)d=c[h-1].studyDate+" "+c[h-1].studyTime,
f=c[h].studyDate+" "+c[h].studyTime,d>f&&(d=c[h-1],c[h-1]=c[h],c[h]=d);else for(a=0;a<b;a++)for(h=b-1;h>a;h--)d=c[h-1].studyDate+" "+c[h-1].studyTime,f=c[h].studyDate+" "+c[h].studyTime,d<f&&(d=c[h-1],c[h-1]=c[h],c[h]=d)};var za=function(){s={};s.sPatientName=$("#sPatientName").val()!=""?$("#sPatientName").val():"*";s.sPatientID=$("#sPatientID").val()!=""?$("#sPatientID").val():"*";s.sReferringPhysName=$("#sReferringPhysName").val()!=""?$("#sReferringPhysName").val():"*";s.sAccessionNumber=$("#sAccessionNumber").val()!=
""?$("#sAccessionNumber").val():"*";s.sStudyDescr=$("#sStudyDescr").val()!=""?$("#sStudyDescr").val():"*";var a=RELite.Utils.getLast7DaysDateRange("yyyy.mm.dd");RELite.Settings.bTodayFilter?a=RELite.Utils.getTodayRangeDate("yyyy.mm.dd"):RELite.Settings.bLastMonthFilter&&(a=RELite.Utils.getLastMonthDateRange("yyyy.mm.dd"));s.sStudyDateStart=$("#sStudyDateStart").val()!=""?$("#sStudyDateStart").val():a.start;s.sStudyDateEnd=$("#sStudyDateEnd").val()!=""?$("#sStudyDateEnd").val():a.end;s.sStudyDateStart=
s.sStudyDateStart.replace(/\./gi,"");s.sStudyDateEnd=s.sStudyDateEnd.replace(/\./gi,"");s.sModality=$("#sModality").val()!=""?$("#sModality").val():"*";RELite.Settings.queryAETitlesURL?(s.sCallingAETitle=$("#sCallingAETitle").val()!=""?$("#sCallingAETitle").val():"*",s.sCalledAETitle=$("#sCalledAETitle").val()!=""?$("#sCalledAETitle").val():"*"):(s.sCallingAETitle="*",s.sCalledAETitle="*");a={QueryType:"find",PatientName:RELite.Utils.sorroundWithAsterisk(s.sPatientName),PatientID:RELite.Utils.sorroundWithAsterisk(s.sPatientID),
RefPhysName:RELite.Utils.sorroundWithAsterisk(s.sReferringPhysName),AccessionNumber:RELite.Utils.sorroundWithAsterisk(s.sAccessionNumber),StudyDescription:RELite.Utils.sorroundWithAsterisk(s.sStudyDescr),StudyDate:s.sStudyDateStart+"-"+s.sStudyDateEnd,CallingAETitle:s.sCallingAETitle,CalledAETitle:s.sCalledAETitle,Modality:s.sModality,CliSessID:RELite.CredentialManager.cliSessID,AuthenticationToken:RELite.CredentialManager.getAuthenticationToken(),Username:RELite.CredentialManager.getUsername()};
$.mobile.loading("show",{textVisible:!1,theme:"z"});RELite.Utils.doRequest({data:a,to:RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/QueryStudies",method:"POST",success:function(a,b,c){if(c.getResponseHeader("LicManRetVal")==null)try{var d=JSON.parse(a);d&&(e=d,f=Math.ceil(e.length/RELite.Settings.iStudiesPerPage),_orderResultsByStudyDate("desc"),ka(),$.mobile.loading("hide"))}catch(h){$.mobile.loading("hide")}else fa(),$.mobile.loading("hide")},error:function(a){a.getResponseHeader("LicManRetVal")!=
null&&fa();$.mobile.loading("hide")}})},Ca=function(){var a=$("#seriesListviewContainer");a.children("ul").remove();a.append($("<ul />"));var b={QueryType:"find",StudyInstanceUID:l,CliSessID:RELite.CredentialManager.cliSessID,AuthenticationToken:RELite.CredentialManager.getAuthenticationToken(),Username:RELite.CredentialManager.getUsername(),PatientID:k,Modality:"*",CallingAETitle:s.sCallingAETitle,CalledAETitle:s.sCalledAETitle};$.mobile.loading("show",{textVisible:!1,theme:"z"});RELite.Utils.doRequest({data:b,
to:RELite.Settings.sRemotEyeCodebase+"/RemotEyeLiteServer/QuerySeries",method:"POST",success:function(b,c,d){if(d.getResponseHeader("LicManRetVal")==null)try{var e=JSON.parse(b);if(e){b="";for(c=0;c<e.length;c++)b+='<li data-icon="false">',b+='<a class="seriesItem" >',b+="<img src='../images/svgs/action.showThumbnailPanel.svg' alt='patient' class='ui-li-icon' style=\"font-size: 24px\"/>",b+='<div class="ui-grid-b">',b+='<div class="ui-block-a">',b+="<div>",b+="<h3>"+e[c].seriesNum+"</h3>",b+="<p>Modality: "+
e[c].modality+"</p>",b+="</div>",b+="</div>",b+='<div class="ui-block-b">',b+="<div>",b+="<h3>&nbsp;</h3>",b+="<p>"+js_StringTable.SERIES_DESCR+": "+e[c].seriesDescr+"</p>",b+="</div>",b+="</div>",b+='<div class="ui-block-c" >',b+='<svg height="64" width="64" class="seriesShowLauncher"><image x="0" y="0" height="64" width="64"  xlink:href="../images/svgs/action.show.svg" ></image></svg>',b+="</div>",b+="</div>",b+="<div style='display: none' class='uid'>"+e[c].seriesInstUID+"</div>",b+="</a>",b+=
"</li>";$("div#seriesListviewContainer ul").html(b);$("div#seriesListviewContainer ul").listview().enhanceWithin();a.show();$.mobile.loading("hide")}}catch(f){$.mobile.loading("hide")}else fa(),$.mobile.loading("hide")},error:function(a){a.getResponseHeader("LicManRetVal")!=null&&fa();$.mobile.loading("hide")}})},Da=function(){RELite.Viewer.getLayout()&&RELite.Viewer.getLayout().thumbnailPanel&&RELite.Viewer.getLayout().thumbnailPanel.hide();document.getElementById("queryAETitles").style.display=
RELite.Settings.queryAETitlesURL?"block":"none";za();RELite.Viewer.destroyContent();RELite.Viewer.toRetrieveSeriesUID="";RELite.Viewer.toRetrieveAccNum="";RELite.Viewer.toRetrieveStudyUID=""},Ea=function(){if(!h){h=!0;var a=RELite.Utils.getLast7DaysDateRange("yyyy.mm.dd");RELite.Settings.bTodayFilter?a=RELite.Utils.getTodayRangeDate("yyyy.mm.dd"):RELite.Settings.bLastMonthFilter&&(a=RELite.Utils.getLastMonthDateRange("yyyy.mm.dd"));$("#sStudyDateStart").val(a.start);$("#sStudyDateEnd").val(a.end)}},
Fa=function(){var a={},b=this.id;b=="bToday"&&(a=RELite.Utils.getTodayRangeDate("yyyy.mm.dd"),$("#sStudyDateStart").val(a.start),$("#sStudyDateEnd").val(a.end));b=="bLastWeek"&&(a=RELite.Utils.getLast7DaysDateRange("yyyy.mm.dd"),$("#sStudyDateStart").val(a.start),$("#sStudyDateEnd").val(a.end));b=="bLastMonth"&&(a=RELite.Utils.getLastMonthDateRange("yyyy.mm.dd"),$("#sStudyDateStart").val(a.start),$("#sStudyDateEnd").val(a.end));b=="bWhenever"&&(a=RELite.Utils.getTodayRangeDate("yyyy.mm.dd"),$("#sStudyDateStart").val("1900.01.01"),
$("#sStudyDateEnd").val(a.end))},Ga=function(a){a.preventDefault();a.stopPropagation();if($(this).is("svg"))a=$.trim($(this).parents("a.studyItem").children(".uid").text()),$("#studyListViewContainer").children().remove(),RELite.Viewer.toRetrieveStudyUID=a,RELite.Viewer.setMainViewPanelLayout(RELite.Settings.defaultSeriesTiling.rows,RELite.Settings.defaultSeriesTiling.cols,!0),$("body").pagecontainer("change","#viewerPage")},Ha=function(){ca();var a=s.sCallingAETitle?s.sCallingAETitle:"*",b=s.sCalledAETitle?
s.sCalledAETitle:"*";RELite.Viewer.toRetrieveStudyUID!=""&&(RELite.Viewer.toRetrieveSeriesUID!=""?RELite.Viewer.streamSeries(RELite.Viewer.toRetrieveStudyUID,RELite.Viewer.toRetrieveSeriesUID,a,b):RELite.Viewer.streamStudy(RELite.Viewer.toRetrieveStudyUID,a,b))},Ia=function(){$(this).is("a.studyItem")&&(l=$.trim($(this).children(".uid").text()),k=$.trim($(this).children(".patientID").text()),$("body").pagecontainer("change","#findSeriesPage"))},Ja=function(){RELite.Viewer.getLayout()&&RELite.Viewer.getLayout().thumbnailPanel&&
(RELite.Viewer.getLayout().thumbnailPanel.hide(),RELite.Viewer.destroyContent());RELite.Viewer.toRetrieveSeriesUID="";RELite.Viewer.toRetrieveAccNum="";RELite.Viewer.toRetrieveStudyUID="";e=[];Ca()},Ka=function(a){a.preventDefault();a.stopPropagation();a=$("#seriesListviewContainer");a.children().remove();a=$("#studyListViewContainer");a.children().remove();RELite.Viewer.toRetrieveStudyUID=l;RELite.Viewer.toRetrieveSeriesUID=$.trim($(this).parents("a.seriesItem").children(".uid").text());RELite.Viewer.setMainViewPanelLayout(1,
1,!0);$("body").pagecontainer("change","#viewerPage")},La=function(){i<f-1&&(i++,ka())},Ma=function(){i>0&&(i--,ka())},Na=function(){i=0},Oa=function(){$("#swSerialNumber").text(j)},Ba=function(){var a=$(this).parents("li"),b=RELite.Settings.windowLevelPresets,c=b.indexOf(a[0].windowLevelPreset);c!=-1&&b.splice(c,1);a.remove()},qa=function(){n=this.windowLevelPreset},ua=function(){var a=n;a===null&&(a={description:"",modality:"*",window:256,level:128});$("#sPresetDescription").val(a.description);
$("#sPresetModality").val(a.modality);$("#sPresetWidth").val(a.window);$("#sPresetLevel").val(a.level);$("#sPresetModality").selectmenu("refresh");$("#saveWindowLevelPresetButton").off(m,sa);$("#saveWindowLevelPresetButton").on(m,sa);$("#cancelWindowLevelPresetButton").off(m,ta);$("#cancelWindowLevelPresetButton").on(m,ta)},ta=function(){n=null;var b="Preferences.html";a&&(b=x+"/gui/Preferences.html");$.mobile.pageContainer.pagecontainer("change",b,{reverse:!0})},sa=function(){var b=n,c=!1;b===null&&
(b={},c=!0);b.description=$("#sPresetDescription").val();b.modality=$("#sPresetModality").val();b.window=parseInt($("#sPresetWidth").val(),10);b.level=parseInt($("#sPresetLevel").val(),10);for(var d=!0,e=[],f=0;f<RELite.Settings.windowLevelPresets.length;f++)if(RELite.Settings.windowLevelPresets[f].description==b.description&&RELite.Settings.windowLevelPresets[f]!==b){e.push(js_StringTable.WINLEVSAMEDESCR);d=!1;break}RELite.Utils.isNumeric(b.window)||(d=!1,e.push(js_StringTable.WININVALID));RELite.Utils.isNumeric(b.level)||
(d=!1,e.push(js_StringTable.LEVINVALID));if(d)c&&RELite.Settings.windowLevelPresets.push(b),b="Preferences.html",ca(),a&&(b=x+"/gui/Preferences.html"),n=null,ja?$(".preferencesButton").trigger(m):$.mobile.pageContainer.pagecontainer("change",b,{reverse:!0});else{var h=$("#winLevelPresetErrorsContainer").empty();$(e).each(function(){h.append("<p>"+this+"</p>")});$("#winLevelPresetErrorPopup").popup("open")}},ja=!1,pa=function(){var a=!0;$("#sOldPassword").val()?$($("#sOldPassword").parents(".input-field-wrapper")[0]).find(".validation").removeClass("validate-ko").addClass("validate-ok"):
($($("#sOldPassword").parents(".input-field-wrapper")[0]).find(".validation").removeClass("validate-ok").addClass("validate-ko"),a=!1);$("#sNewPassword").val().length>3?$($("#sNewPassword").parents(".input-field-wrapper")[0]).find(".validation").removeClass("validate-ko").addClass("validate-ok"):($($("#sNewPassword").parents(".input-field-wrapper")[0]).find(".validation").removeClass("validate-ok").addClass("validate-ko"),a=!1);$("#sNewPasswordConfirm").val().length>3&&$("#sNewPasswordConfirm").val()===
$("#sNewPassword").val()?$($("#sNewPasswordConfirm").parents(".input-field-wrapper")[0]).find(".validation").removeClass("validate-ko").addClass("validate-ok"):($($("#sNewPasswordConfirm").parents(".input-field-wrapper")[0]).find(".validation").removeClass("validate-ok").addClass("validate-ko"),a=!1);return a},Pa=function(){$(document).on("pagecontainerbeforeshow",function(a,b){var c=b.toPage.prop("id");switch(c){case "mainPage":Q.call(document.getElementById(c));break;case "settingsDlg":G(document.getElementById(c));
document.getElementById("addWindowLevelPresetButton").textContent=js_StringTable.ADDWINLEVELPRESET;O.call(document.getElementById(c));b.prevPage.prop("id")!=="windowLevePresetDetailDlg"?$(".preferencesSaveButton, .preferencesCancelButton").prop("href","#"+b.prevPage.prop("id")):b.prevPage.prop("id")==="windowLevePresetDetailDlg"&&ja&&$(".preferencesSaveButton, .preferencesCancelButton").prop("href","#viewerPage");b.prevPage.prop("id")==="viewerPage"&&(ja=!0);b.prevPage.prop("id")==="mainPage"&&(ja=
!1);break;case "filterDialog":Ea.call(document.getElementById(c));break;case "viewerPage":b.prevPage.prop("id")!="settingsDlg"&&b.prevPage.prop("id")!="aboutDlg"&&Ha.call(document.getElementById(c));break;case "aboutDlg":G(document.getElementById(c));Oa.call(document.getElementById(c));$("#aboutOkButton").prop("href","#"+b.prevPage.prop("id"));break;case "windowLevePresetDetailDlg":G(document.getElementById(c)),document.getElementById("saveWindowLevelPresetButton").textContent=js_StringTable.SAVE,
document.getElementById("cancelWindowLevelPresetButton").textContent=js_StringTable.CANCEL,ua.call(document.getElementById(c))}});$(document).on("pagecontainerchange",function(a,b){var c=b.toPage.prop("id");switch(c){case "findPage":Da.call(document.getElementById(c));break;case "findSeriesPage":Ja.call(document.getElementById(c))}});var a="mousedown";"ontouchstart"in document&&(a="touchstart",RELite.Utils.isMobile()||(a="touchstart mousedown"));$("#logoutButton").on(a,oa);$("#saveFilterButton").on(a,
Na);$("#dateRadio input[type=radio]").on("change",Fa);$("div#studyListViewContainer").on(a,"ul svg",Ga);$("div#studyListViewContainer").on("click","ul a.studyItem",Ia);$("div#seriesListviewContainer").on(a,"ul svg",Ka);$("#nextStudyPage").on(a,La);$("#previousStudyPage").on(a,Ma);$("#windowLevelPresetsListView").on(a,"li",qa);$("button.preferencesButton, button.aboutButton").on(a,function(){var a=$(this).attr("data-href");$("body").pagecontainer("change",a,{changeHash:!1})})},va=function(){$("#authenticationForm")},
wa=function(a,b){va();a!=""&&b!=""?($("#sUsername").val(a),$("#sPassword").val(b),$("#requestAuthButton").trigger("click")):($("#displayAuthDialog").show(),$("#sUsername").focus())},Qa=function(){$(document).on("pagecontainerbeforeshow",function(a,b){var c=b.toPage.prop("id");switch(c){case "settingsDlg":G(document.getElementById(c));document.getElementById("addWindowLevelPresetButton").textContent=js_StringTable.ADDWINLEVELPRESET;O.call(document.getElementById(c));break;case "aboutDlg":G(document.getElementById(c));
$("#swSerialNumber").text(j);break;case "windowLevePresetDetailDlg":G(document.getElementById(c)),document.getElementById("saveWindowLevelPresetButton").textContent=js_StringTable.SAVE,document.getElementById("cancelWindowLevelPresetButton").textContent=js_StringTable.CANCEL,ua.call(document.getElementById(c))}});$("button.preferencesButton, button.aboutButton").on(m,function(){var a=$(this).attr("data-href");$("body").pagecontainer("change",a,{changeHash:!1})});$(window).bind("resize",N)},Ra=function(){var a=
$($(this).parents(".resultContainer")[0]),b=$.trim(a.children("div.dataNeeded").find("span.uid").text());ea.call(this);RELite.Viewer.hideDetailPanel();a.is(".study")?(RELite.Viewer.scanDICOMTree({studyUID:b}),$("#queryDialogContent").parent().hide()):a.is(".series")&&(a=$.trim(a.children("div.dataNeeded").find("span.studyInstanceUID").text()),RELite.Viewer.scanDICOMTree({studyUID:a,seriesUID:b}),$("#queryDialogContent").parent().hide())},Sa=function(){xa.call(this)},xa=function(){var a=null;if(this&&
this.ds)a=this.ds;else{var b=RELite.Viewer.getSelectedImagePanel();if(b&&b.currentImage)a=b.currentImage.ds}if(a&&(a=RELite.Viewer.getNonDICOMFilesForDataset(a),a.length)){$("#nonDICOMFilesList").empty();for(b=0;b<a.length;b++){var c=$("#nonDICOMFilesDlg .nonDICOMFile.template").clone().removeClass("template");c.find("a.name").attr("href",a[b].url).attr("title",a[b].name).find(".name-text").text(a[b].name);c.find("span.size").text(a[b].size);c.appendTo("#nonDICOMFilesList")}$("#nonDICOMFilesDlg").center().show().css("z-index",
102);$("#neoOverlay").show();$("#drawer").panel("close")}},Ta=function(){var a=$(this).parents(".resultContainer")[0];if(a.study&&a.study.aPDFs.length)if(a.study.aPDFs.length==1)window.location.href=a.study.aPDFs[0].localPath;else{var b=$("#pdfChooser"),c=$("#pdfChooser div.content");if(b.length==0){var b=$("<div />").attr("id","pdfChooser"),d=$("<div />").addClass("header"),c=$("<div />").addClass("closeButton");c.on("click",function(){$("#pdfChooser").hide()});d.text(js_StringTable.PDF_DOCS);d.append(c);
c=$("<div />").addClass("content");b.append(d);b.append(c)}c.empty();for(d=0;d<a.study.aPDFs.length;d++){var e=$("<div />").addClass("srRow");e.text("Document #"+(d+1));e[0].pdf=a.study.aPDFs[d];e.on("click",function(){$("#pdfChooser").hide();window.location.href=this.pdf.localPath});c.append(e)}b.appendTo("body").center().show()}},ya=function(a){var b=$("#srContent"),c=$("#srDialogContainer");if(c.length==0){c=$("<div />").attr("id","srDialogContainer");b=$("<div />").addClass("srDialogHeader");
b.append($("<div />").addClass("title").text("SR Report"));var d=$("<div />").addClass("closeButton").html("&nbsp;");d.on("click",function(){$("#srDialogContainer").hide()});b.append(d);b.append($("<div />").addClass("break"));c.append(b);b=$("<div />").attr("id","srContent").appendTo(c);c.appendTo("body")}b[0].innerHTML=a.sHtmlContent;c.center().show()},Ua=function(){var a=$(this).parents(".resultContainer")[0];if(a.study&&a.study.aSRs.length)if(a.study.aSRs.length==1)ya(a.study.aSRs[0]);else{var b=
$("#srChooser"),c=$("#srChooser div.content");if(b.length==0){var b=$("<div />").attr("id","srChooser"),d=$("<div />").addClass("header"),c=$("<div />").addClass("closeButton");c.on("click",function(){$("#srChooser").hide()});d.text(js_StringTable.SR_REPORTS);d.append(c);c=$("<div />").addClass("content");b.append(d);b.append(c)}c.empty();for(d=0;d<a.study.aSRs.length;d++){var e=$("<div />").addClass("srRow");e.text("Report #"+(d+1));e[0].sr=a.study.aSRs[d];e.on("click",function(){ya(this.sr);$("#srChooser").hide()});
c.append(e)}b.appendTo("body").center().show()}},ma=function(){if($("#viewerContainer").is(".ie-internal")){var a=js_StringTable.LE_IS_STARTING;$("#expertModeTutorial").html(a);$("#shareToDropBoxDlg div.window").css({left:-374});$("#shareToDropBoxDlg").center().show().css("z-index",101);$("#queryDialogContent").parent().hide()}else if(a=function(){$("#queryDialogContent").parent().hide();this===document.getElementById("exportToDropBoxExpertModeButton")?$("#shareToDropBoxDlg div.window").animate({left:-374}):
($("#shareToDropBoxDlg div.window").css({left:-374}),$("#shareToDropBoxDlg").center().show().css("z-index",101))},NeoLogica.Utils.isWindows()&&"ActiveXObject"in window){var b=window.location.href,c=b.indexOf("file:");if(c!=-1)for(c+=5;b[c]=="/";)c++;else c=0;try{var d=b[c]+":\\Viewer-Windows\\LocalEyeLauncher.exe";(new ActiveXObject("WScript.Shell")).Exec(d)}catch(e){a.call(this)}}else a.call(this)},Va=function(){ea.call(this);RELite.Viewer.scanDICOMTree({});RELite.Viewer.hideDetailPanel()},ca=function(){var a=
$("#windowLevelPresetsPopup ul").empty();$(RELite.Settings.windowLevelPresets).each(function(){var b=this.modality.length>1?this.modality.toLowerCase():"all";$("<li />").addClass(b).text(this.description).appendTo(a)[0].windowLevelPreset=this});$("<li />").addClass("none").text(js_StringTable.ADDWINLEVELPRESET).appendTo(a)[0].windowLevelPreset=null;a.listview("refresh");$("#windowLevelPresetsPopup").popup().enhanceWithin()},ha=function(){if(RELite.Settings.queryAETitlesURL){var a={data:{Context:"search_calling",
CliSessID:RELite.CredentialManager.cliSessID,AuthenticationToken:RELite.CredentialManager.getAuthenticationToken(),Username:RELite.CredentialManager.getUsername()},to:RELite.Settings.queryAETitlesURL,method:"POST",success:function(a){p=JSON.parse(a);$("#sCallingAETitle").empty();for(a=0;a<p.length;a++)$("#sCallingAETitle").append($("<option />").val(p[a]).text(p[a]).prop("selected",a==0))},error:function(){p=[]}};RELite.Utils.doRequest(a)}},ia=function(){if(RELite.Settings.queryAETitlesURL){var a=
{data:{Context:"search_called",CliSessID:RELite.CredentialManager.cliSessID,AuthenticationToken:RELite.CredentialManager.getAuthenticationToken(),Username:RELite.CredentialManager.getUsername()},to:RELite.Settings.queryAETitlesURL,method:"POST",success:function(a){u=JSON.parse(a);$("#sCalledAETitle").empty();for(a=0;a<u.length;a++)$("#sCalledAETitle").append($("<option />").val(u[a]).text(u[a]).prop("selected",a==0))},error:function(){u=[]}};RELite.Utils.doRequest(a)}},Wa=function(){ma.call(this)},
ea=function(){$("#shareToDropBoxDlg").hide().find("div.window").css({left:0});$("#nonDICOMFilesDlg").hide();this.id!="closeNonDICOMFilesDlg"&&$("#queryDialogContent").parent().hide();!$("#nonDICOMFilesDlg").is(":visible")&&!$("#queryDialogContent").parent().is(":visible")&&$("#neoOverlay").hide()},ra=function(){$("#openDialogOverlay, #openDialog").hide();return!0};return{initDisplayStudy:function(){a=!0;var b=window.location.toString().split("?")[1];if(b){b=b.split("&");r={};for(var c=0;c<b.length;c++){var d=
b[c].split("=",2);d.length===2&&(r[d[0]]=decodeURIComponent(d[1]))}}G();va();RELite.localDicomTree&&(g=!0);na();Qa();g||RELite.Settings.loadFromServer();c=b="";d=void 0;r.username&&(b=r.username);r.password&&(c=r.password);r.authenticationToken&&(d=r.authenticationToken);if(r.p1)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,b=r.p1):b=RELite.Utils.b64Dec(r.p1);if(r.p2)RELite.Settings.viewerParametersEncryptionEnabled===!0?(v=!0,c=r.p2):c=RELite.Utils.b64Dec(r.p2);if(r.p3)RELite.Settings.viewerParametersEncryptionEnabled===
!0?(v=!0,d=r.p3):d=RELite.Utils.b64Dec(r.p3);RELite.Settings.sAuthenticationURL==""?(H(),d&&RELite.CredentialManager.setAuthenticationToken(d),RELite.HeartBeat.init(),T()):(E(),d===void 0&&(d=RELite.Utils.getCookie("AuthenticationToken")),d===void 0?wa(b,c):RELite.CredentialManager.validateAuthToken({sAuthToken:d,sUsername:b,sPassword:c,success:function(){RELite.Settings.loadUserSettingsFromServer();RELite.Settings.queryAETitlesURL&&(ha(),ia());ca();H();RELite.HeartBeat.init();T()},error:function(){wa("",
"")}}));if(RELite.Settings.bLocalEyeViewerPresent===!0){$("#EXP_DROP_POP").html(js_StringTable.EXP_DROP_POP);var e=$("#shareToDropBoxPopup").css({top:48,left:Math.ceil($("#exportToDropbox").position().left)+4}).show();$("#shareToDropBoxPopup > div.pointer").css({position:"absolute"});var f=function(){e.hide();$(document.body).off("click",f)};$(document.body).on("click",f);setTimeout(f,1E4);b=js_StringTable.LOCALEYE_LAUNCH_FILE;c=js_StringTable.LE_FILE_PREFIX;b=navigator.userAgent.toLowerCase().indexOf("mac os")!==
-1?b.replace("%1",'<div class="expModeFileName">'+c+"CDMacOSXExpertMode.command</div>"):navigator.userAgent.toLowerCase().indexOf("linux")!==-1?b.replace("%1",'<div class="expModeFileName">'+c+"CDLinuxExpertMode.sh</div>"):b.replace("%1",'<div class="expModeFileName">'+c+"CDWindowsExpertMode.bat</div>");$("#expertModeTutorial").html(b)}},initWebApp:function(){na();RELite.Settings.loadFromServer();G();$("#windowLevelPresetsPopup ul").listview().enhanceWithin();Pa();E();RELite.Settings.bTodayFilter?
($("#bToday").prop("checked",!0),$("#bLastWeek").prop("checked",!1),$("#bLastMonth").prop("checked",!1)):RELite.Settings.bLastMonthFilter?($("#bToday").prop("checked",!1),$("#bLastWeek").prop("checked",!1),$("#bLastMonth").prop("checked",!0)):($("#bToday").prop("checked",!1),$("#bLastWeek").prop("checked",!0),$("#bLastMonth").prop("checked",!1));$("#bWhenever").prop("checked",!1);var a=RELite.Utils.getCookie("AuthenticationToken");if(a==void 0&&RELite.Settings.sAuthenticationURL!=""){if($("#authenticationForm").show(),
$("#sUsername").focus(),$("#needAuthentication").hide(),a=RELite.Utils.getCookie("login_msg"))Y(a),RELite.Utils.deleteCookie("login_msg")}else a!=void 0?($("#needAuthentication").hide(),RELite.CredentialManager.validateAuthToken({sAuthToken:a,success:function(){$("#authenticationForm").hide();$("#needAuthentication").show();RELite.Settings.loadUserSettingsFromServer();RELite.Settings.queryAETitlesURL&&(ha(),ia());ca();RELite.Settings.sAuthenticationURL!=""&&$("#logoutButton").show();RELite.HeartBeat.init();
T()},error:function(){RELite.CredentialManager.invalidateAuthToken();window.location.reload()}})):($("#authenticationForm").hide(),$("#needAuthentication").show(),RELite.HeartBeat.init(),T());RELite.Device.bIsSmartphone?RELite.Viewer.setLayoutObject(new MobileLayout):RELite.Viewer.setLayoutObject(new DesktopLayout);RELite.Viewer.init();RELite.Viewer.getLayout().thumbnailPanel.hide()},getSelectedTool:function(){return RELite.ToolsRepository[c]},setSelectedToolName:function(a){c=a},checkInvalidLicenseResponse:function(a,
c){a.getResponseHeader("SwSerialNum")!=null&&(j=a.getResponseHeader("SwSerialNum"));if(a.getResponseHeader("LicManRetVal")!=null)return b=!1,c||RELite.Viewer.updatePanels(),!1;b||(b=!0,c||RELite.Viewer.updatePanels());return!0},getIsValidLicense:function(){return b},getLicenseError:function(){return d},setIsValidLicense:function(a,c){b=a;d=c},showError:Y,isDisplay:function(){return a},isLocalViewer:function(){return g},getSwSerialNum:function(){return j},initLocalEvents:function(){$("#queryDialogContent").on("click",
"span.action.show",Ra);$("#queryDialogContent").on("click","span.action.show-nondicom",Sa);$("#queryDialogContent").on("click","span.status.pdfPresent",Ta);$("#queryDialogContent").on("click","span.status.reportPresent",Ua);$("div.localEyeButton").on("click",ma);$("div.openAllButton").on("click",Va);$("#exportToDropBoxExpertModeButton").on("click",Wa);$("#exportToDropBoxOkButton").on("click",ea);$("#neoOverlay").on("click",ea);$("#closeNonDICOMFilesDlg").on("click",ea)},getEventName:function(){return m},
onToolClick:function(b){b.preventDefault();b.stopPropagation();var d=!0,e=a?"images/svgs/":"../images/svgs/",f=$(this);if(f.is("#windowLevel")){c="WindowLevel";var h=f.offset().left,g=b.pageX;if(b.touches&&b.touches.length)g=b.touches[0].pageX;if(g>h+48&&(b=RELite.Viewer.getSelectedImagePanel()))if(b=b.currentImage)f.find("rect:nth-child(2)").attr("fill","#7be1b2"),setTimeout(function(){f.find("rect:nth-child(2)").attr("fill","#ebebeb")},100),b="."+b.ds.modality.toLowerCase(),$("#windowLevelPresetsPopup ul li").not(".all").not(b).hide(),
$("#windowLevelPresetsPopup ul li.all, #windowLevelPresetsPopup ul li"+b).length==0?$("#windowLevelPresetsPopup ul li.none").show():$("#windowLevelPresetsPopup ul li.none").hide(),$("#windowLevelPresetsPopup").popup({tolerance:"48,160"}),$("#windowLevelPresetsPopup").enhanceWithin().popup("open",{positionTo:"#windowLevel",y:40})}f.is("#zoom")&&(c="Zoom");f.is("#scroll")&&(c="Scroll");f.is("#pan")&&(c="Pan");f.is("#measLineTool")&&(c="MeasLine",$("#measMenuImage").attr("xlink:href",e+"tool.MeasDistance.svg"),
f.find("rect").attr("fill","#ebebeb"));f.is("#measRectAreaTool")&&(c="MeasRectArea",$("#measMenuImage").attr("xlink:href",e+"tool.MeasRectArea.svg"),f.find("rect").attr("fill","#ebebeb"));f.is("#measElliptAreaTool")&&(c="MeasElliptArea",$("#measMenuImage").attr("xlink:href",e+"tool.MeasElliptArea.svg"),f.find("rect").attr("fill","#ebebeb"));f.is("#measAngle")&&(c="MeasAngle",$("#measMenuImage").attr("xlink:href",e+"tool.MeasAngleA.svg"),f.find("rect").attr("fill","#ebebeb"));if(f.is("#measMenu")){var d=
!1,h=$(this).offset(),i=h.left,k=h.top-32;$(this.actionObj.getChildren()).each(function(){$(this.domContainer).css({position:"absolute",left:i,top:k+=48,zIndex:1002}).appendTo(document.body).show()})}else $("#measLineTool, #measRectAreaTool, #measElliptAreaTool, #measAngle").hide();f.is("#magnifier")&&(c="Magnifier");f.is("#measDensity")&&(c="MeasDensity");if(f.is("#measLineTool")||f.is("#measRectAreaTool")||f.is("#measElliptAreaTool")||f.is("#measAngle"))f=$("#measMenu");$(".actionContainer.selected svg").find("rect:first").attr("fill",
"#ebebeb");f.addClass("selected").find("rect").first().attr("fill","#7be1b2");f.siblings().removeClass("selected");d&&$("#drawer").panel("close")},onPrevSeriesToolClicked:A,onNextSeriesToolClicked:C,onPrevImageToolClicked:function(a){a.preventDefault();a.stopPropagation();var b=RELite.Viewer.getSelectedImagePanel();$(this).find("rect").attr("fill","#7be1b2");b&&b.showPreviousImage();if(a.type=="click"){var c=this;setTimeout(function(){B.call(c,a)},150)}},onNextImageToolClicked:function(a){a.preventDefault();
a.stopPropagation();var b=RELite.Viewer.getSelectedImagePanel();this.className+=" selected ";$(this).find("rect").attr("fill","#7be1b2");b&&b.showNextImage();if(a.type=="click"){var c=this;setTimeout(function(){B.call(c,a)},150)}},onChooseSeriesToolClicked:function(a){a.preventDefault();a.stopPropagation();a=$("#showThumbnails");a.prop("selected")?(a.prop("selected",!1),RELite.Viewer.hideThumbnailPanel(),a.find("rect").attr("fill","#ebebeb")):(a.prop("selected",!0),a.find("rect").attr("fill","#7be1b2"),
RELite.Viewer.showThumbnailPanel())},onSelectLayoutToolClicked:function(a){a.preventDefault();a.stopPropagation();RELite.Viewer.setSeriesActionsPanelVisible(!1);var b=function(){$("#layoutDialog").hide();$("#selectLayoutTool").prop("selected",!1).find("rect").attr("fill","#ebebeb");$("body").off(m,b);$("#layoutDialog").hide()},a=$("#selectLayoutTool");a.prop("selected")?(a.prop("selected",!1),a.find("rect").attr("fill","#ebebeb"),$("#layoutDialog").hide()):(a.prop("selected",!0),a.find("rect").attr("fill",
"#7be1b2"),$("#layoutDialog").center(),$("#layoutDialog").css("z-index",1005).show(),$("body").on(m,b))},onShowReportsToolClicked:function(b){b.stopPropagation();b.preventDefault();$("#drawer").panel("close");setTimeout(function(){var b=RELite.Viewer.getSelectedImagePanel(),c=$("#reportsPopup ul").empty();if(b&&b.currentImage){if(b=RELite.Viewer.getAllReports()[b.currentImage.ds.studyUID]){if(b.length===1){b[0].open();return}var d=js_StringTable.REPORTS,d=$("<div>").append($("<span />").text(d)),
d=$("<li />").append(d).appendTo(c),e="../images/";a&&(e="images/");for(var f=0;f<b.length;f++){var h=b[f],d=h.ds.imageSmartDate.replace(/ \(.+\)/gi,"")+" "+h.ds.imageSmartTime.replace(/ \(.+\)/gi,"");h.ds.completionFlag&&(d+=' <span class="report-flag">['+h.ds.completionFlag+"] </span>");h.ds.verificationFlag&&(d+=' <span class="report-flag">['+h.ds.verificationFlag+"]</span> ");var g=$("<img />"),i=e;d+=" "+h.getDocumentTitle();i+=h.constructor===DICOMPDF?"svgs/pdf-file.svg":"svgs/dcm-file.svg";
g.prop("src",i);d=$("<div>").append(g).append($("<span />").html(d));d=$("<li />").append(d).appendTo(c).on("click",ga);d[0].report=b[f]}}else $("<li />").text(js_StringTable.NO_REPORT_FOUND).appendTo(c);c.listview("refresh");$("#reportsPopup").enhanceWithin().popup("open")}},100)},onOverlayToolClicked:function(b){b.preventDefault();b.stopPropagation();var b=z.getNextState(),c=$("#overlayTool, #overlayToolMenuItem"),d=a?"images/svgs/":"../images/svgs/";g&&(d="viewer-html5/images/svgs/");b=="selected"?
(c.find("image").attr("xlink:href",d+"action.imageToggleRefLines.svg"),c.find("rect").attr("fill","#7be1b2")):b=="all"?(c.find("image").attr("xlink:href",d+"action.imageToggleTextOverlays.svg"),c.find("rect").attr("fill","#7be1b2")):(c.find("image").attr("xlink:href",d+"action.imageToggleTextOverlays.svg"),c.find("rect").attr("fill","#ebebeb"));RELite.Viewer.updatePanels()},onBackButtonClicked:function(b){b.preventDefault();b.stopPropagation();b=RELite.Viewer.getDetailPanel();$("#drawer").panel("close");
$(b.canvas.parentElement).is(".hidden")?(RELite.Device.bIsSmartphone&&RELite.Viewer.hideThumbnailPanel(),a||(RELite.Viewer.abortDownload(),RELite.Viewer.getLayout().thumbnailPanel.hide(),history.back())):RELite.Viewer.hideDetailPanel()},onResetToolClicked:function(a){a.preventDefault();a.stopPropagation();(a=RELite.Viewer.getSelectedImagePanel())&&a.resetOps();$("#drawer").panel("close")},onShowPanelButtonClicked:function(a){a.preventDefault();a.stopPropagation();RELite.Viewer.getLayout().toolsPanel.$drawer.panel("open")},
onForceCineActionClicked:function(a){a.preventDefault();a.stopPropagation();if((a=RELite.Viewer.getSelectedImagePanel())&&a.viewingSeries){if(a.viewingSeries.bIsCine)a.viewingSeries.bIsCine=!1,a.stopCine();else{a.viewingSeries.bIsCine=!0;if(a.viewingSeries.iDefFPS==0&&a.viewingSeries.frameTimeMs==0)a.viewingSeries.iDefFPS=25,a.viewingSeries.frameTimeMs=0.025;a.iCineFPS=a.viewingSeries.iDefFPS}a.redraw()}},onRotateActionClicked:function(a){a.preventDefault();a.stopPropagation();var a=RELite.Viewer.getSelectedImagePanel(),
b=this.id=="rotateClockwiseTool"?90:-90;a&&a.addRotationDeg(b);$("#drawer").panel("close")},onFlipActionClicked:function(a){a.preventDefault();a.stopPropagation();(a=RELite.Viewer.getSelectedImagePanel())&&(this.id=="flipHorizontalTool"?a.flipHorizontal():a.flipVertical());$("#drawer").panel("close")},onExportToDropBoxActionClicked:function(){$("#shareToDropBoxDlg").center().show().css("z-index",101);$("#neoOverlay").show().css("z-index",100)},onLocalShowStudiesButtonClicked:function(){$("#queryDialogContent").parent().center().show().css("z-index",
101);$("#neoOverlay").show();$("#drawer").panel("close")},onLaunchLocalEyeButtonClicked:ma,getForcedWL:function(){return q!=0&&o!=0?{ww:o,wl:q}:null},getCallingAETitles:function(){return p},getCalledAETitles:function(){return u},showOpenDialog:function(a){$("#openDialogOverlay").show();$("#openDialog").find("a.fileLink").prop("href",a);$("#openDialog").show()},onInvertImageActionClicked:function(){var a=RELite.Viewer.getSelectedImagePanel();if(a)a.invertImageColors=!a.invertImageColors,a.redraw()},
areParamsEncrypted:function(){return v},onShowNonDICOMClicked:xa}}();function Downloader(){this.aObjectToDownload=[];this.aborted=this.downloadFinished=!1}Downloader.prototype.addObjectToDownload=function(c){this.aObjectToDownload.push(c)};Downloader.prototype.destroy=function(){for(var c=this.aObjectToDownload.pop();c;){for(var b in c)c[b]=null,delete c[b];c=this.aObjectToDownload.pop()}};
Downloader.prototype.start=function(){var c=this.aObjectToDownload.shift(),b=this;if(c&&!this.aborted)if(c.hasOwnProperty("dataSet")){var d=c.dataSet;d.load({success:function(){RELite.Utils.dispatchEvent(document,"dataSetDownloaded",d);b.start()},error:function(){b.start()}})}else c.hasOwnProperty("func")?(c.func(),b.start()):RELite.Utils.dispatchEvent(document,"unknownObjectToDownload",c);else if(c===void 0)this.downloadFinished=!0,RELite.Utils.dispatchEvent(document,"downloadFinished")};function DataSetStreamHandler(){var c=this;this.evSrc=null;this.dataSetsErrors=this.dataSetsReceived=0;this.errors={};this.queryPerformed=!1;this._onClose=function(b){c.onCloseEvent(b)};this._onError=function(b){c.onError(b)}}
DataSetStreamHandler.prototype.start=function(c,b){b===!0&&(c=RELite.Utils.addParameterToURL(c,"Encrypted=true"));this.evSrc=new EventSource(c);this.evSrc.addEventListener("message",this.onMessage.bind(this));this.evSrc.addEventListener("error",this._onError);this.evSrc.addEventListener("queryPerformed",this.onQueryPerformed.bind(this));this.evSrc.addEventListener("datasetDecodingError",this.datasetDecodingError.bind(this));this.evSrc.addEventListener("close",this._onClose);RELite.Utils.dispatchEvent(document,
"queryStarted",this)};DataSetStreamHandler.prototype.close=function(){this.evSrc&&this.evSrc.close()};DataSetStreamHandler.prototype.onQueryPerformed=function(c){this.queryPerformed=!0;RELite.Utils.dispatchEvent(document,"queryPerformed",c.data)};DataSetStreamHandler.prototype.datasetDecodingError=function(c){this.dataSetsErrors++;console&&console.error&&console.error(c.data)};
DataSetStreamHandler.prototype.onMessage=function(c){var c=JSON.parse(c.data),b=new DataSet;b.extendFrom(c);b.bDownloaded=!0;for(var d in c)delete c[d],this[d]=null;delete null;this.dataSetsReceived++;RELite.Utils.dispatchEvent(document,"dataSetDownloaded",b)};
DataSetStreamHandler.prototype.onError=function(){this.evSrc.removeEventListener("message",this.onMessage);this.evSrc.removeEventListener("error",this._onError);this.evSrc.removeEventListener("close",this._onClose);this.dataSetsErrors&&RELite.Utils.dispatchEvent(document,"datasetDecodingError",this.dataSetsErrors);this.evSrc.close();this.evSrc=null};
DataSetStreamHandler.prototype.onCloseEvent=function(){this.evSrc.removeEventListener("message",this.onMessage);this.evSrc.removeEventListener("error",this._onError);this.evSrc.removeEventListener("close",this._onClose);!this.queryPerformed&&this.dataSetsReceived==0&&RELite.Utils.dispatchEvent(document,"queryPerformed",0);this.dataSetsErrors&&RELite.Utils.dispatchEvent(document,"datasetDecodingError",this.dataSetsErrors);this.evSrc.close();this.evSrc=null};function DataSet(){this.bDownloaded=!1;this.instanceDirectoryRecord=null;this.dicomImages=[];this.iJPEGToLoad=0;this.dataElementsHash={}}DataSet.isSRSOPClass=function(c){return c==="1.2.840.10008.5.1.4.1.1.88.11"||c==="1.2.840.10008.5.1.4.1.1.88.22"||c==="1.2.840.10008.5.1.4.1.1.88.33"||c==="1.2.840.10008.5.1.4.1.1.88.65"||c==="1.2.840.10008.5.1.4.1.1.88.67"?!0:!1};DataSet.isEncapPDFClass=function(c){return c==="1.2.840.10008.5.1.4.1.1.104.1"?!0:!1};
DataSet.prototype.extendFrom=function(c){this.dicomImages=[];$.extend(this,c);this.iJPEGToLoad=this.numOfFrames};
DataSet.prototype.load=function(c){var b=this,d={success:$.noop,error:$.noop};$.extend(d,c);var c={studyUID:b.instanceDirectoryRecord.parent.parent.studyInstUID,seriesUID:b.instanceDirectoryRecord.parent.seriesInstUID,objectUID:b.instanceDirectoryRecord.sopInstUID,CliSessID:RELite.CredentialManager.cliSessID,AuthenticationToken:RELite.CredentialManager.getAuthenticationToken(),Username:RELite.CredentialManager.getUsername()},a=b.getRetrieveURLParam();if(a!=void 0)c.URL=a;RELite.Utils.doRequest({data:c,
async:d.async,to:RELite.Settings.retrieveDataSetURL,method:"GET",success:function(a,c,f){if(RELite.Manager.checkInvalidLicenseResponse(f))try{var i=JSON.parse(a);b.bDownloaded=!0;$.extend(b,i);for(var h in i)delete i[h],this[h]=null;delete null;i=null;delete i;if(b.isImage)for(a=0;a<b.numOfFrames;a++){var k=new DICOMImage;k.ds=b;k.frameNumber=a+1;b.dicomImages.push(k);k.preloadJPEG()}else k=InvalidDICOMImage.getNewInstance(),k.ds=b,b.dicomImages.push(k);d.success(i)}catch(l){b.bDownloaded=!1}},error:function(){b.bDownloaded=
!1}})};DataSet.prototype.getRetrieveURLParam=function(){if(this.instanceDirectoryRecord&&this.instanceDirectoryRecord.retrieveURL!=void 0&&this.instanceDirectoryRecord.retrieveURL!="")return this.instanceDirectoryRecord.retrieveURL;if(this.url!="")return this.url};
DataSet.prototype.compareTo=function(c){var b=DataSet.isSRSOPClass(this.sopClassUID),d=DataSet.isEncapPDFClass(this.sopClassUID);if(b||d){if(this.verificationFlag.toLowerCase()==="verified"&&c.verificationFlag.toLowerCase()!=="verified")return-1;else if(c.verificationFlag.toLowerCase()==="verified"&&this.verificationFlag.toLowerCase()!=="verified")return 1;if(this.completionFlag.toLowerCase()==="complete"&&c.completionFlag.toLowerCase()!=="complete")return-1;else if(c.completionFlag.toLowerCase()===
"complete"&&this.completionFlag.toLowerCase()!=="complete")return 1;var d=$.trim(this.imageSmartDate.replace(/\(cnt\)|\(acq\)|\(se\)|\(st\)/gi,""))+$.trim(this.imageSmartTime.replace(/\(cnt\)|\(acq\)|\(se\)|\(st\)/gi,"")),a=$.trim(c.imageSmartDate.replace(/\(cnt\)|\(acq\)|\(se\)|\(st\)/gi,""))+$.trim(c.imageSmartTime.replace(/\(cnt\)|\(acq\)|\(se\)|\(st\)/gi,"")),d=-d.localeCompare(a);if(d!==0)return d}d=0;a=this.seriesUID.localeCompare(c.seriesUID);if(a!==0){var g=parseInt(this.serieNumber,10),e=
parseInt(c.seriesNumber,10);if(!isNaN(g)&&!isNaN(e))return e>g&&(d=-1),e<g&&(d=1),d!==0?d:a}g=parseInt(this.instanceNumber,10);e=parseInt(c.instanceNumber,10);!isNaN(g)&&!isNaN(e)&&(e>g&&(d=-1),e<g&&(d=1));b&&(d=-d);if(d!==0)return d;if(this.sopInstUID>c.sopInstUID)return 1;else if(c.sopInstUID<this.sopInstUID)return-1;return 0};DataSet.prototype.compareToStudyLevel=function(c){if(this.studyDate<c.studyDate)return-1;else if(this.studyDate>c.studyDate)return 1;return 0};
DataSet.prototype.compareToSeriesLevel=function(c){if(this.seriesUID==c.seriesUID)return 0;var b=parseInt(this.seriesNumber,10),d=parseInt(c.seriesNumber,10);if(!isNaN(b)&&!isNaN(!d)){if(b<d)return-1;if(b>d)return 1}if(this.seriesDate<c.seriesDate)return-1;if(this.seriesDate>c.seriesDate)return 1;if(this.seriesDate==c.seriesDate){if(this.seriesTime<c.seriesTime)return-1;if(this.seriesTime>c.seriesTime)return 1}if(this.instanceDirectoryRecord){if(this.instanceDirectoryRecord.parent.iIndexInParent<
c.instanceDirectoryRecord.parent.iIndexInParent)return-1;if(this.instanceDirectoryRecord.parent.iIndexInParent>c.instanceDirectoryRecord.parent.iIndexInParent)return 1}return 0};DataSet.prototype.getDataElementByPath=function(c){return this.dataElementsHash[c]};function WinLevLut(){this.physicalWL=this.physicalWW=this.rawWL=this.rawWW=0;this.lut=[];this.isImageDefault=!0;this.isNull=function(){return this.lut.length==0};this.reset=function(){this.physicalWL=this.physicalWW=this.rawWL=this.rawWW=0;this.lut=[];this.isImageDefault=!0}};function DICOMImage(c){this.localPath=void 0;this.isLocal=!1;if(c!==void 0)this.localPath=c,this.isLocal=!0;this.ds=null;this.thumbDownloaded=this.downloading=this.downloaded=!1;this.frameNumber=1;this.ctx=this.workingCanvas=null;this.wl=this.ww=0;this.aDrawables=[];this.iRetries=0}DICOMImage.prototype.constructor=DICOMImage;DICOMImage.prototype.onJPEGImageLoaded=function(){};DICOMImage.prototype.preloadJPEG=function(){RELite.JPEGDownloadSerializer.addDICOMImage(this)};
DICOMImage.prototype.prepareDataForJPEG=function(){var c=this.ds,b={};b.studyUID=c.studyUID;b.seriesUID=c.seriesUID;b.objectUID=c.sopInstUID;b.FrameNumber=this.frameNumber;b.Compress="false";b.CliSessID=RELite.CredentialManager.cliSessID;b.AuthenticationToken=RELite.CredentialManager.getAuthenticationToken();b.Username=RELite.CredentialManager.getUsername();b.screenResPx=screen.width*screen.height*(window.devicePixelRatio||1);var d=RELite.Manager.getForcedWL();if(d)b.windowWidth=d.ww,b.windowLevel=
d.wl;if(!this.ds.viewingSeries.winLevLut.isImageDefault)b.windowWidth=this.ds.viewingSeries.winLevLut.physicalWW,b.windowLevel=this.ds.viewingSeries.winLevLut.physicalWL;if(c.callingAETitle)b.CallingAETitle=c.callingAETitle;if(c.calledAETitle)b.CalledAETitle=c.calledAETitle;c=c.getRetrieveURLParam();if(c!=void 0)b.URL=c;return b};
DICOMImage.prototype.prepareDataForJPEGWS=function(){var c=this.ds,b={};b.studyInstUID=c.studyUID;b.seriesInstUID=c.seriesUID;b.sopInstUID=c.sopInstUID;b.frameNumber=this.frameNumber;b.compressRequested="false";b.cliSessID=RELite.CredentialManager.cliSessID;b.authToken=RELite.CredentialManager.getAuthenticationToken();b.screenResPx=screen.width*screen.height*(window.devicePixelRatio||1);var d=RELite.Manager.getForcedWL();if(d)b.windowWidth=d.ww,b.windowLevel=d.wl;if(!this.ds.viewingSeries.winLevLut.isImageDefault)b.windowWidth=
this.ds.viewingSeries.winLevLut.physicalWW,b.windowLevel=this.ds.viewingSeries.winLevLut.physicalWL;if(c.callingAETitle)b.callingAE=c.callingAETitle;if(c.calledAETitle)b.calledAE=c.calledAETitle;c=c.getRetrieveURLParam();if(c!=void 0)b.instanceURL=c;return b};
DICOMImage.prototype.getJPEGUrl=function(){if(this.localPath!==void 0)return this.localPath;var c=this.prepareDataForJPEG(),b=RELite.Settings.sRemotEyeCodebase+RELite.Settings.retrieveJPEGURL+"?",d;for(d in c)b+=d+"="+encodeURIComponent(c[d])+"&";c=b.slice(0,-1);if(!RELite.Settings.bUseRedirect)return c;b=RELite.Settings.sRedirectURL;b=RELite.Utils.addParameterToURL(b,"to="+encodeURIComponent(c));return b=RELite.Utils.addParameterToURL(b,"method=GET")};
DICOMImage.prototype.reset=function(){this.thumbDownloaded=this.downloading=this.downloaded=!1;this.ctx=this.workingCanvas=null;this.wl=this.ww=0;for(var c=this.aDrawables.pop();c;)c=this.aDrawables.pop();delete this.rawPixelsIntArray};
DICOMImage.prototype.load=function(c){var b=this.ds,d=this;this.downloading=!0;var a={success:$.noop,error:$.noop,useSharedDownloader:!0,thumbnail:!1};$.extend(a,c);if(this.downloaded)a.success(d);else{c={};c.studyUID=b.studyUID;c.seriesUID=b.seriesUID;c.objectUID=b.sopInstUID;c.FrameNumber=d.frameNumber;c.Compress="true";c.CliSessID=RELite.CredentialManager.cliSessID;c.AuthenticationToken=RELite.CredentialManager.getAuthenticationToken();c.Username=RELite.CredentialManager.getUsername();c.screenResPx=
screen.width*screen.height*(window.devicePixelRatio||1);if(b.callingAETitle)c.CallingAETitle=b.callingAETitle;if(b.calledAETitle)c.CalledAETitle=b.calledAETitle;b=b.getRetrieveURLParam();if(b!=void 0)c.URL=b;RELite.Utils.doRequest({data:c,to:RELite.Settings.retrieveDICOMImageURL,method:"GET",src:d,success:function(b,c,f){try{if(RELite.Manager.checkInvalidLicenseResponse(f)){f=c=0;if(d.ww!=0&&d.wl!=0)c=d.ww,f=d.wl;$.extend(d,JSON.parse(b));if(c!=0||f!=0)d.ww=c,d.wl=f;delete null;d.commonInitAfterDownload();
a.thumbnail===!1?d.downloaded=!0:d.thumbDownloaded=!0;d.downloading=!1;RELite.Utils.dispatchEvent(document,"dicomImageReady",d);a.success(d);a.thumbnail||RELite.Viewer.Cache.add(d)}}catch(i){d.reset(),d.iRetries++}},error:function(){d.iRetries++;d.iRetries>=RELite.Settings.IMAGE_MAX_RETR?(d.commonInitAfterTooManyErrors(),RELite.Utils.dispatchEvent(document,"dicomImageReady",d),a.success(d),a.thumbnail||RELite.Viewer.Cache.add(d)):d.reset()}},a.useSharedDownloader)}};
DICOMImage.prototype.commonInitAfterTooManyErrors=function(){var c=InvalidDICOMImage.getNewInstance(),b=this.ds;$.extend(this,c);this.ds=b;this.thumbDownloaded=this.downloaded=!0;this.downloading=!1};
DICOMImage.prototype.commonInitAfterDownload=function(){if(this.workingCanvas==null)this.workingCanvas=document.createElement("canvas");var c=this.workingCanvas;c.width=this.columns;c.height=this.rows;this.ctx=c.getContext("2d");this.ctx.imageSmoothingEnabled=!1;this.ctx.fillStyle="black";this.ctx.fillRect(0,0,c.width,c.height);if(this.ds.viewingSeries.winLevLut.isImageDefault)this.calculateDefaultLUT();else{var c=this.ds.viewingSeries.winLevLut.physicalWW*this.multiplyVal,b=this.ds.viewingSeries.winLevLut.physicalWL*
this.multiplyVal+this.additiveVal;(c!=this.ds.viewingSeries.winLevLut.rawWW||b!=this.ds.viewingSeries.winLevLut.rawWL)&&this.calculateLUT(c,b)}this.createWorkingCanvasPixels()};DICOMImage.prototype.calculateDefaultLUT=function(){this.calculateLUT(this.defWinWidth,this.defWinLevel)};
DICOMImage.prototype.calculateLUT=function(c,b){var d=256;this.imageType==1&&(d=65536);var a=b-0.5-(c-1)/2,g=b-0.5+(c-1)/2,e=this.origPhotomInterpr=="MONOCHROME1",f=0;delete this.ds.viewingSeries.winLevLut.lut;this.ds.viewingSeries.winLevLut.reset();for(var i=this.ds.viewingSeries.winLevLut.lut,f=0;f<d;f++)if(e)if(f<=a)i[f]=255;else if(f>g)i[f]=0;else{var h=((f-b-0.5)/(c-1)+0.5)*255;i[f]=255-h}else f<=a?i[f]=0:f>g?i[f]=255:(h=((f-b-0.5)/(c-1)+0.5)*255,i[f]=h);this.ww=c;this.wl=b;this.ds.viewingSeries.winLevLut.rawWW=
c;this.ds.viewingSeries.winLevLut.rawWL=b;this.ds.viewingSeries.winLevLut.physicalWW=this.ww/this.multiplyVal;this.ds.viewingSeries.winLevLut.physicalWL=(this.wl-this.additiveVal)/this.multiplyVal;this.ds.viewingSeries.winLevLut.isImageDefault=this.ww==this.defWinWidth&&this.wl==this.defWinLevel};
DICOMImage.prototype.createWorkingCanvasPixels=function(){var c=this.ctx,b=this.workingCanvas,d=this.ds.viewingSeries.winLevLut.lut,b=c.getImageData(0,0,b.width,b.height),a=0,g=0,e=b.data.length,f=b.data,i=this.rawPixelsIntArray,h=0;if(this.imageType==0)for(h=0;h<e;g++)a=d[i[g]],f[h++]=a,f[h++]=a,f[h++]=a,h++;else if(this.imageType==1)for(h=0;h<e;g++)a=d[i[g]],f[h++]=a,f[h++]=a,f[h++]=a,h++;else for(h=0;h<e;)f[h]=d[i[g]],h++,g++,f[h]=d[i[g]],h++,g++,f[h]=d[i[g]],h++,g++,h++;c.putImageData(b,0,0)};
DICOMImage.prototype.setWindowLevel=function(c,b){if(this.ww==c&&this.wl==b)return!1;this.calculateLUT(c,b);this.createWorkingCanvasPixels();return!0};
DICOMImage.prototype.getOrientationMarkers=function(c){var b=["","","",""],d=null;this.ds&&this.ds.imgGeomList&&this.ds.imgGeomList[this.frameNumber-1]&&(d=this.ds.imgGeomList[this.frameNumber-1]);if(d==null)return b;var a=d.imgOrientPatientRowI,g=d.imgOrientPatientRowJ,e=d.imgOrientPatientRowK,f=d.imgOrientPatientColI,i=d.imgOrientPatientColJ,h=d.imgOrientPatientColK;if(a!=Number.MAX_VALUE&&g!=Number.MAX_VALUE&&e!=Number.MAX_VALUE&&f!=Number.MAX_VALUE&&i!=Number.MAX_VALUE&&h!=Number.MAX_VALUE){var k=
[],l=[],j=[];j[0]=a;j[1]=g;j[2]=e;for(var m=!0;m;){m=!1;for(d=0;d<j.length-1;d++)if(Math.abs(j[d])<Math.abs(j[d+1])){var m=!0,n=j[d];j[d]=j[d+1];j[d+1]=n}}for(d=0;d<j.length;d++)j[d]==a?j[d]>0.01?(k.push("R"),l.push("L")):j[d]<-0.01&&(k.push("L"),l.push("R")):j[d]==g?j[d]>0.01?(k.push("A"),l.push("P")):j[d]<-0.01&&(k.push("P"),l.push("A")):j[d]==e&&(j[d]>0.01?(k.push("I"),l.push("S")):j[d]<-0.01&&(k.push("S"),l.push("I")));for(d=0;d<k.length;d++)d>0&&(b[3]+="-"),b[3]+=k[d];for(d=0;d<l.length;d++)d>
0&&(b[1]+="-"),b[1]+=l[d];a=[];g=[];e=[];e[0]=f;e[1]=i;e[2]=h;for(m=!0;m;){m=!1;for(d=0;d<e.length-1;d++)Math.abs(e[d])<Math.abs(e[d+1])&&(m=!0,n=e[d],e[d]=e[d+1],e[d+1]=n)}for(d=0;d<e.length;d++)e[d]==f?e[d]>0.01?(a.push("R"),g.push("L")):e[d]<-0.01&&(a.push("L"),g.push("R")):e[d]==i?e[d]>0.01?(a.push("A"),g.push("P")):e[d]<-0.01&&(a.push("P"),g.push("A")):e[d]==h&&(e[d]>0.01?(a.push("I"),g.push("S")):e[d]<-0.01&&(a.push("S"),g.push("I")));for(d=0;d<a.length;d++)d>0&&(b[0]+="-"),b[0]+=a[d];for(d=
0;d<g.length;d++)d>0&&(b[2]+="-"),b[2]+=g[d];f=function(){var a=[];c.iFlipHorizontal<0&&a.push("F_H");c.iFlipVertical<0&&(a.push("F_H"),a.push("R_180"));var b=c.rotationRad;c.iFlipHorizontal*c.iFlipVertical<0&&(b=2*Math.PI-b);b==Math.PI/2?a.push("R_90"):b==Math.PI?a.push("R_180"):b==3*Math.PI/2&&a.push("R_270");return a}();for(d=0;d<f.length;d++)i=f[d],h=b[3],m=b[1],n=b[0],a=b[2],i=="F_H"?(b[3]=m,b[1]=h):i=="R_90"?(b[0]=h,b[1]=n,b[2]=m,b[3]=a):i=="R_180"?(b[0]=a,b[1]=h,b[2]=n,b[3]=m):(i="R_270",b[0]=
m,b[1]=a,b[2]=h,b[3]=n)}return b};DICOMImage.prototype.getYPixelSpacingForMeas=function(c){if(this.ds&&(this.domImg||this.downloaded)){var b=this.ds.imgGeomList[this.frameNumber-1];if(b)if(b.rowSpacing>0)return b.rowSpacing;else if(b.usRegions&&b.usRegions.length)for(var d=0;d<b.usRegions.length;d++){var a=b.usRegions[d];if(c.x>=a.minX&&c.x<=a.maxX&&c.y>=a.minY&&c.y<=a.maxY)return a.physDeltaY*10}}return-1};
DICOMImage.prototype.getXPixelSpacingForMeas=function(c){if(this.ds&&(this.domImg||this.downloaded)){var b=this.ds.imgGeomList[this.frameNumber-1];if(b)if(b.colSpacing>0)return b.colSpacing;else if(b.usRegions&&b.usRegions.length)for(var d=0;d<b.usRegions.length;d++){var a=b.usRegions[d];if(c.x>=a.minX&&c.x<=a.maxX&&c.y>=a.minY&&c.y<=a.maxY)return a.physDeltaX*10}}return-1};
DICOMImage.prototype.getRawPixelValueAtIndex=function(c){if(this.rawPixelsIntArray&&c<this.rawPixelsIntArray.length)return this.voiLUTPresent===!0?this.rawPixelsIntArray[c]:Math.round(this.rawPixelsIntArray[c]-this.additiveVal)/this.multiplyVal};function DICOMSR(c){this.sHtmlContent=c;this.ds=null;this.downloaded=!0;this.downloading=!1;this.thumbDownloaded=!0;this.rows=256;this.wl=this.additiveVal=this.ww=0;this.columns=256;this.defWinLevel=this.defWinWidth=0}DICOMSR.prototype=new DICOMImage;DICOMSR.prototype.constructor=DICOMSR;DICOMSR.prototype.reset=function(){};DICOMSR.prototype.load=function(){};DICOMSR.prototype.reset=$.noop;DICOMSR.prototype.commonInitAfterDownload=$.noop;DICOMSR.prototype.calculateDefaultLUT=$.noop;
DICOMSR.prototype.calculateLUT=$.noop;DICOMSR.prototype.createWorkingCanvasPixels=$.noop;DICOMSR.prototype.setWindowLevel=function(c,b){this.ww=c;this.wl=b};DICOMSR.workingCanvas=null;DICOMSR.ctx=null;
DICOMSR.init=function(){DICOMSR.workingCanvas=$("<canvas />")[0];DICOMSR.ctx=DICOMSR.workingCanvas.getContext("2d");var c=DICOMSR.workingCanvas,b=DICOMSR.ctx;c.width=1024;c.height=1024;c.id="invalidDICOMImageCanvas";b=c.getContext("2d");b.fillStyle="black";b.fillRect(0,0,c.width,c.height);var d=js_StringTable.DICOM_SR;b.font="60px Arial";b.fillStyle="#f3f3f3";var a=b.measureText(d).width,g=Math.round(c.height/2+30);b.fillText(d,Math.round(c.width/2-a/2),g);b.font="40px Arial";d=js_StringTable.DBL_CLICK_OPEN;
a=b.measureText(d).width;b.fillText(d,Math.round(c.width/2-a/2),g+60)};DICOMSR.getNewInstance=function(){DICOMSR.workingCanvas==null&&DICOMSR.init();var c=new DICOMSR;c.workingCanvas=DICOMSR.workingCanvas;c.ctx=DICOMSR.ctx;return c};
DICOMSR.prototype.prepareDataForSR=function(){var c=this.ds,b={};b.studyUID=c.studyUID;b.seriesUID=c.seriesUID;b.objectUID=c.sopInstUID;b.FrameNumber=this.frameNumber;b.Compress="false";b.CliSessID=RELite.CredentialManager.cliSessID;b.AuthenticationToken=RELite.CredentialManager.getAuthenticationToken();b.Username=RELite.CredentialManager.getUsername();c=c.getRetrieveURLParam();if(c!=void 0)b.URL=c;return b};
DICOMSR.prototype.getSRUrl=function(){if(this.localPath!==void 0)return this.localPath;var c=this.prepareDataForJPEG(),b=RELite.Settings.sRemotEyeCodebase+RELite.Settings.retrieveSRURL+"?",d;for(d in c)b+=d+"="+encodeURIComponent(c[d])+"&";c=b.slice(0,-1);if(!RELite.Settings.bUseRedirect)return c;b=RELite.Settings.sRedirectURL;b=RELite.Utils.addParameterToURL(b,"to="+encodeURIComponent(c));return b=RELite.Utils.addParameterToURL(b,"method=GET")};
DICOMSR.prototype.open=function(){window.open(this.getSRUrl())||($("#reportToolbar").show(),$("#reportContainer").show().load(this.getSRUrl()))};DICOMSR.prototype.getDocumentTitle=function(){return js_StringTable.DICOM_SR};function DICOMPDF(c){this.ds=null;this.localPath=void 0;if(c!==void 0)this.localPath=c,this.isLocal=!0;this.ds=null;this.downloaded=!0;this.downloading=!1;this.thumbDownloaded=!0;this.rows=256;this.wl=this.additiveVal=this.ww=0;this.columns=256;this.defWinLevel=this.defWinWidth=0}DICOMPDF.prototype=new DICOMImage;DICOMPDF.prototype.constructor=DICOMPDF;DICOMPDF.prototype.reset=function(){};DICOMPDF.prototype.load=function(){};DICOMPDF.prototype.reset=$.noop;
DICOMPDF.prototype.commonInitAfterDownload=$.noop;DICOMPDF.prototype.calculateDefaultLUT=$.noop;DICOMPDF.prototype.calculateLUT=$.noop;DICOMPDF.prototype.createWorkingCanvasPixels=$.noop;DICOMPDF.prototype.setWindowLevel=function(c,b){this.ww=c;this.wl=b};DICOMPDF.workingCanvas=null;DICOMPDF.ctx=null;
DICOMPDF.init=function(){DICOMPDF.workingCanvas=$("<canvas />")[0];DICOMPDF.ctx=DICOMPDF.workingCanvas.getContext("2d");var c=DICOMPDF.workingCanvas,b=DICOMPDF.ctx;c.width=1024;c.height=1024;c.id="invalidDICOMImageCanvas";b=c.getContext("2d");b.fillStyle="black";b.fillRect(0,0,c.width,c.height);var d=js_StringTable.ENCAP_PDF;b.font="60px Arial";b.fillStyle="#f3f3f3";var a=b.measureText(d).width,g=Math.round(c.height/2+30);b.fillText(d,Math.round(c.width/2-a/2),g);b.font="40px Arial";d=js_StringTable.DBL_CLICK_OPEN;
a=b.measureText(d).width;b.fillText(d,Math.round(c.width/2-a/2),g+60)};DICOMPDF.getNewInstance=function(){DICOMPDF.workingCanvas==null&&DICOMPDF.init();var c=new DICOMPDF;c.workingCanvas=DICOMPDF.workingCanvas;c.ctx=DICOMPDF.ctx;return c};
DICOMPDF.prototype.prepareDataForSR=function(){var c=this.ds,b={};b.studyUID=c.studyUID;b.seriesUID=c.seriesUID;b.objectUID=c.sopInstUID;b.FrameNumber=this.frameNumber;b.Compress="false";b.CliSessID=RELite.CredentialManager.cliSessID;b.AuthenticationToken=RELite.CredentialManager.getAuthenticationToken();b.Username=RELite.CredentialManager.getUsername();c=c.getRetrieveURLParam();if(c!=void 0)b.URL=c;return b};
DICOMPDF.prototype.getSRUrl=function(){if(this.localPath!==void 0)return this.localPath;var c=this.prepareDataForJPEG(),b=RELite.Settings.sRemotEyeCodebase+RELite.Settings.retrievePDFURL+"?",d;for(d in c)b+=d+"="+encodeURIComponent(c[d])+"&";c=b.slice(0,-1);if(!RELite.Settings.bUseRedirect)return c;b=RELite.Settings.sRedirectURL;b=RELite.Utils.addParameterToURL(b,"to="+encodeURIComponent(c));return b=RELite.Utils.addParameterToURL(b,"method=GET")};
DICOMPDF.prototype.open=function(){window.open(this.getSRUrl())||RELite.Manager.showOpenDialog(this.getSRUrl())};DICOMPDF.prototype.getDocumentTitle=function(){return this.ds.getDataElementByPath("0042,0010")||js_StringTable.ENCAP_PDF};function InvalidDICOMImage(){this.thumbDownloaded=this.downloading=this.downloaded=!0;this.rows=1024;this.wl=this.additiveVal=this.ww=0;this.columns=1024;this.defWinLevel=this.defWinWidth=0}InvalidDICOMImage.prototype=new DICOMImage;InvalidDICOMImage.prototype.constructor=InvalidDICOMImage;InvalidDICOMImage.prototype.reset=function(){};InvalidDICOMImage.prototype.load=function(){};InvalidDICOMImage.prototype.reset=$.noop;InvalidDICOMImage.prototype.commonInitAfterDownload=$.noop;
InvalidDICOMImage.prototype.calculateDefaultLUT=$.noop;InvalidDICOMImage.prototype.calculateLUT=$.noop;InvalidDICOMImage.prototype.createWorkingCanvasPixels=$.noop;InvalidDICOMImage.prototype.setWindowLevel=function(c,b){this.ww=c;this.wl=b};InvalidDICOMImage.workingCanvas=null;InvalidDICOMImage.ctx=null;
InvalidDICOMImage.init=function(){InvalidDICOMImage.workingCanvas=$("<canvas />")[0];InvalidDICOMImage.ctx=InvalidDICOMImage.workingCanvas.getContext("2d");var c=InvalidDICOMImage.workingCanvas,b=InvalidDICOMImage.ctx;c.width=1024;c.height=1024;c.id="invalidDICOMImageCanvas";b=c.getContext("2d");b.fillStyle="black";b.fillRect(0,0,c.width,c.height);b.font="60px Arial";b.fillStyle="Yellow";var d=b.measureText("Invalid Image").width;b.fillText("Invalid Image",Math.round(c.width/2-d/2),Math.round(c.height/
2+10))};InvalidDICOMImage.getNewInstance=function(){InvalidDICOMImage.workingCanvas==null&&InvalidDICOMImage.init();var c=new InvalidDICOMImage;c.workingCanvas=InvalidDICOMImage.workingCanvas;c.ctx=InvalidDICOMImage.ctx;return c};function ViewingSeries(){this.dicomImages=[];this.seriesUID="";this.bIsCine=!1;this.frameTimeMs=this.iDefFPS=0;this.onViewingSeriesChangedListeners=[];this.winLevLut=new WinLevLut;this.physicalWL=this.physicalWW=0;this.thumbnailPos={x:0,y:0,transY:0};if(wl=RELite.Manager.getForcedWL())this.winLevLut.physicalWW=wl.ww,this.winLevLut.physicalWL=wl.wl,this.winLevLut.isImageDefault=!1}ViewingSeries.mapOfSOPUIDs={};
ViewingSeries.prototype.destroy=function(){this.removeAllOnViewingSeriesChangedListeners();for(var c=this.dicomImages.pop();c;)c.reset(),c.ds=void 0,c=this.dicomImages.pop()};ViewingSeries.prototype.fireOnViewingSeriesChanged=function(c,b){for(var d={source:this,ds:c,changedIndex:b},a=0;a<this.onViewingSeriesChangedListeners.length;a++)this.onViewingSeriesChangedListeners[a].onViewingSeriesChanged(d)};
ViewingSeries.prototype.removeAllOnViewingSeriesChangedListeners=function(){delete this.onViewingSeriesChangedListeners;this.onViewingSeriesChangedListeners=[]};ViewingSeries.prototype.addOnViewingSeriesChangedListener=function(c){if("onViewingSeriesChanged"in c){for(var b=0;b<this.onViewingSeriesChangedListeners.length;b++)if(c==this.onViewingSeriesChangedListeners[b])return;this.onViewingSeriesChangedListeners.push(c)}};
ViewingSeries.prototype.removeOnViewingSeriesChangedListener=function(c){for(var b=0;b<this.onViewingSeriesChangedListeners.length;b++)c==this.onViewingSeriesChangedListeners[b]&&this.onViewingSeriesChangedListeners.splice(b,1)};
ViewingSeries.prototype.addInstance=function(c,b){ViewingSeries.mapOfSOPUIDs[c.sopInstUID]=!0;if(b>=0){var d=this.dicomImages.slice(0,b);this.dicomImages=d=d.concat(c.dicomImages).concat(this.dicomImages.slice(b))}else this.dicomImages=this.dicomImages.concat(c.dicomImages);c.viewingSeries=this;this.fireOnViewingSeriesChanged(c,b)};
ViewingSeries.prototype.addDataSet=function(c){var b=0;this.seriesUID=c.seriesUID;this.iDefFPS=(this.bIsCine=!!c.frameTimeMs)?Math.round(1E3/c.frameTimeMs):0;this.frameTimeMs=c.frameTimeMs;if(c.sopClassUID==="1.2.840.10008.5.1.4.1.1.13.1.3"&&c.numOfFrames>1)this.bIsCine=!0,this.iDefFPS=10,this.frameTimeMs=100;for(;b<this.dicomImages.length;){var d=this.dicomImages[b].ds;if(c.compareTo(d)>0)b+=d.dicomImages.length;else{c.compareTo(d);this.addInstance(c,b);return}}this.addInstance(c)};this.RELite===void 0&&(RELite={});
RELite.GlobalEventHandler=function(){var c=0,b={x:0,y:0},d={x:0,y:0},a=[],g=0,e=function(a){RELite.Viewer.setSelectedImagePanel(a.reLiteData)},f=function(a){c=a.scale},i=function(a){var b=a.reLiteData;b.bIsLocked=!0;a.deltaY!==void 0?a.deltaY>0?b.showNextImage():b.showPreviousImage():a.wheelDelta>0?b.showPreviousImage():b.showNextImage()};return{mousedown:e,mousewheel:i,wheel:i,DOMMouseScroll:function(a){var b=a.detail,a=a.reLiteData;a.bIsLocked=!0;b>0?a.showNextImage():a.showPreviousImage()},touchstart:function(a){e(a);
var c=a.reLiteData;if(a.touches&&a.touches.length>0&&a.touches.length!=3&&(d.x=a.canvasX,d.y=a.canvasY,b.x=(d.x-c.translateX)/c.zoom,b.y=(d.y-c.translateY)/c.zoom,a.touches.length===2)){var i={x:0,y:0},j=a.touches[0],m=a.touches[1];i.x=(m.canvasX+j.canvasX)/2;i.y=(m.canvasY+j.canvasY)/2;b.x=(i.x-c.translateX)/c.zoom;b.y=(i.y-c.translateY)/c.zoom;d=i;g=Math.sqrt(Math.pow(m.canvasX-j.canvasX,2)+Math.pow(m.canvasY-j.canvasY,2));a.scale=0;f(a)}},touchmove:function(e){if((a=e.touches)&&a.length>0)if(d.x=
e.canvasX,d.y=e.canvasY,a.length===2){var f={x:0,y:0},i=e.touches[0],j=e.touches[1];f.x=(j.canvasX+i.canvasX)/2;f.y=(j.canvasY+i.canvasY)/2;d=f;e.scale=(Math.sqrt(Math.pow(j.canvasX-i.canvasX,2)+Math.pow(j.canvasY-i.canvasY,2))-g)/100;f=e.reLiteData;if(a.length==2)i=f.zoom,i+=e.scale-c,j=b.y*i,f.translateX=d.x-b.x*i,f.translateY=d.y-j,f.zoom=i,c=e.scale,f.redraw()}},touchend:function(){d.x=0;g=c=d.y=0},gesturestart:f,gesturechange:function(d){var e=d.reLiteData;if(a.length==2){e.bIsLocked=!0;var f=
e.zoom;f+=d.scale-c;var g=b.y*f;e.translateX=fakePoint.x-b.x*f;e.translateY=fakePoint.y-g;e.zoom=f;c=d.scale;e.redraw()}},gestureend:function(){c=0}}}();this.RELite===void 0&&(RELite={});RELite.ToolsRepository={};function Shape(){this.selected=!1}Shape.prototype.draw=function(){};Shape.prototype.intersect=function(){return!1};Shape.prototype.getMessages=function(){return[]};function MeasLine(){this.mmDistance=this.pixelDistance=this.endY=this.endX=this.startY=this.startX=0;this.bCompleted=!1;this.type="MeasLine"}MeasLine.prototype=new Shape;
MeasLine.prototype.draw=function(c){var b=c.ctx,d=this.startX*c.scaleRatio*1,a=this.startY*c.scaleRatio*1,g=this.endX*c.scaleRatio*1,e=this.endY*c.scaleRatio*1;b.save();b.beginPath();b.lineWidth=3/c.zoom;b.strokeStyle="red";b.moveTo(d,a);b.lineTo(g,e);b.stroke();b.beginPath();b.lineWidth=1/c.zoom;b.strokeStyle="yellow";b.moveTo(d,a);b.lineTo(g,e);b.stroke();if(this.selected)d=30/c.zoom,b.save(),b.strokeStyle="yellow",a=this.startX*c.scaleRatio-d/2,g=this.startY*c.scaleRatio-d/2,b.strokeRect(a,g,d,
d),a=this.endX*c.scaleRatio-d/2,g=this.endY*c.scaleRatio-d/2,b.strokeRect(a,g,d,d),b.restore();b.restore()};MeasLine.prototype.intersect=function(c,b,d){var a=1;if(d&&d.zoom>1)a=d.zoom;var d=0,g=this.startX,e=this.startY,d=(this.endY-e)/(this.endX-g);return Math.abs(b-(d*(c-g)+e))<=20/a?!0:!1};
MeasLine.prototype.intersectHandles=function(c,b,d){var a=1;if(d&&d.zoom>1)a=d.zoom;for(var g=[{x:this.startX,y:this.startY},{x:this.endX,y:this.endY}],d=30/a/d.scaleRatio/2,a=0;a<g.length;a++){var e=g[a].x+d,f=g[a].y-d,i=g[a].y+d;if(c>=g[a].x-d&&c<=e&&b>=f&&b<=i)return a}return!1};
MeasLine.prototype.calculateDistance=function(c){var b=1,d=1,b=c.rows/c.ds.origRows,d=c.columns/c.ds.origColumns,a=this.startX/d,g=this.startY/b,d=this.endX/d,e=this.endY/b,b=(a-d)*(a-d),f=(g-e)*(g-e);this.pixelDistance=Math.sqrt(b+f);var i=0,i=0,i=c.getYPixelSpacingForMeas({x:a,y:g}),a=c.getXPixelSpacingForMeas({x:a,y:g}),g=c.getYPixelSpacingForMeas({x:d,y:e}),c=c.getXPixelSpacingForMeas({x:d,y:e});this.mmDistance=i>0&&a>0&&i==g&&a==c?Math.sqrt(b*a*a+f*i*i):-1};
MeasLine.prototype.getMessages=function(){if(this.bCompleted){var c="",c=this.mmDistance<0?" ? mm":this.mmDistance.toFixed(2)+" mm";return[js_StringTable.DISTANCE+": "+c]}return[]};function ReferenceLine(){this.endY=this.endX=this.startY=this.startX=0;this.type="ReferenceLine"}ReferenceLine.prototype=new Shape;
ReferenceLine.prototype.draw=function(c){var b=c.ctx,d=1,a=1,d=c.currentImage.rows/c.currentImage.origRows,a=c.currentImage.columns/c.currentImage.origColumns,g=this.startX*a*c.scaleRatio,e=this.startY*d*c.scaleRatio,a=this.endX*a*c.scaleRatio,d=this.endY*d*c.scaleRatio;b.save();b.beginPath();b.setLineDash([0]);b.lineWidth=2/c.zoom;b.setLineDash([5/c.zoom]);b.strokeStyle="#00eb00";b.moveTo(g,e);b.lineTo(a,d);b.stroke();b.closePath();b.restore()};
ReferenceLine.getRefLineWrtPanel=function(c,b){var d=[],a=[],g=c.currentImage,e=b.currentImage;if(!g||!e||!RELite.Settings.bShowRefLines)return null;if(g.ds.studyUID!=e.ds.studyUID)return null;try{var f=e.ds.imgGeomList[e.frameNumber-1],i=f.imgPosPatientX,h=f.imgPosPatientY,k=f.imgPosPatientZ;if(i===Number.MAX_VALUE||h===Number.MAX_VALUE||h===Number.MAX_VALUE)return null;var l=f.imgOrientPatientRowI,j=f.imgOrientPatientRowJ,m=f.imgOrientPatientRowK,n=f.imgOrientPatientColI,o=f.imgOrientPatientColJ,
q=f.imgOrientPatientColK;if(Number.MAX_VALUE===l||Number.MAX_VALUE===j||Number.MAX_VALUE===m||Number.MAX_VALUE===n||Number.MAX_VALUE===o||Number.MAX_VALUE===q)return null;var p=Math.sqrt(l*l+j*j+m*m);l/=p;j/=p;m/=p;var u=Math.sqrt(l*l+j*j+m*m);n/=u;o/=u;q/=u;var s=f.rowSpacing,r=f.colSpacing,v=e.ds.origRows,x=e.ds.origColumns,e=j*q-m*o,f=-(l*q-m*n),p=l*o-j*n,t=g.ds.imgGeomList[g.frameNumber-1],w=t.imgPosPatientX,y=t.imgPosPatientY,z=t.imgPosPatientZ;if(w===Number.MAX_VALUE||y===Number.MAX_VALUE||
z===Number.MAX_VALUE)return null;var A=t.imgOrientPatientRowI,C=t.imgOrientPatientRowJ,B=t.imgOrientPatientRowK,E=t.imgOrientPatientColI,J=t.imgOrientPatientColJ,H=t.imgOrientPatientColK;if(Number.MAX_VALUE===A||Number.MAX_VALUE===C||Number.MAX_VALUE===B||Number.MAX_VALUE===E||Number.MAX_VALUE===J||Number.MAX_VALUE===H)return null;var F=Math.sqrt(A*A+C*C+B*B);A/=F;C/=F;B/=F;var S=Math.sqrt(A*A+C*C+B*B);E/=S;J/=S;H/=S;var K=t.rowSpacing,X=t.colSpacing,I=g.ds.origRows,R=g.ds.origColumns,U;U=Math.abs(A*
e+C*f+B*p);if(U>0.001){var N=w,Q=y,G=z,Y,D=(-e*(N-i)+-f*(Q-h)+-p*(G-k))/(e*A+f*C+p*B),O=R*X;if(D>=0&&D<O){var V={x:Math.floor(D/O*(R+0.5)),y:0},W={x:N+D*A,y:Q+D*C,z:G+D*B};d.push(V);a.push(W)}}U=Math.abs(A*e+C*f+B*p);U>0.001&&(N=w+I*K*E,Q=y+I*K*J,G=z+I*K*H,D=(-e*(N-i)+-f*(Q-h)+-p*(G-k))/(e*A+f*C+p*B),O=R*X,D>=0&&D<O&&(V={x:Math.floor(D/O*(R+0.5)),y:I-1},W={x:N+D*A,y:Q+D*C,z:G+D*B},d.push(V),a.push(W)));U=Math.abs(E*e+J*f+H*p);U>0.001&&(N=w,Q=y,G=z,D=(-e*(N-i)+-f*(Q-h)+-p*(G-k))/(e*E+f*J+p*H),O=I*
K,D>=0&&D<O&&(V={x:0,y:Math.floor(D/O*(I+0.5))},W={x:N+D*E,y:Q+D*J,z:G+D*H},d.push(V),a.push(W)));U=Math.abs(E*e+J*f+H*p);U>0.001&&(N=w+R*X*A,Q=y+R*X*C,G=z+R*X*B,D=(-e*(N-i)+-f*(Q-h)+-p*(G-k))/(e*E+f*J+p*H),O=I*K,D>=0&&D<O&&(V={x:R-1,y:Math.floor(D/O*(I+0.5))},W={x:N+D*E,y:Q+D*J,z:G+D*H},d.push(V),a.push(W)));if(a.length!=2)return null;var y=w=t=0,L=a[0],M=a[1],t=M.x-L.x,w=M.y-L.y,y=M.z-L.z,P=Math.sqrt(t*t+w*w+y*y);t/=P;w/=P;y/=P;g=M=a=0;a=L.x-i;M=L.y-h;g=L.z-k;i=t*l+w*j+y*m;w=t*n+w*o+y*q;k=t=h=L=
0;i>0||i===0&&1/i===Number.POSITIVE_INFINITY?(L=-(a*l+M*j+g*m)/i,h=(-(a*l+M*j+g*m)+x*r)/i):(h=-(a*l+M*j+g*m)/i,L=(-(a*l+M*j+g*m)+x*r)/i);w>0||w===0&&1/w===Number.POSITIVE_INFINITY?(t=-(a*n+M*o+g*q)/w,k=(-(a*n+M*o+g*q)+v*s)/w):(k=-(a*n+M*o+g*q)/w,t=(-(a*n+M*o+g*q)+v*s)/w);l=0;l=t>L?t:L;l<0&&(l=0);if(l>P)return null;j=P;j=k<h?k:h;if(j<0)return null;j>P&&(j=P);Y=d[0];var ga=d[1],Z=ga.x-Y.x,aa=ga.y-Y.y,ba=Math.sqrt(Z*Z+aa*aa);Z/=ba;aa/=ba;var d=l*(ba/P),P=j*(ba/P),da={x:Y.x,y:Y.y},T=new ReferenceLine;
T.startX=da.x+d*Z;T.startY=da.y+d*aa;T.endX=da.x+P*Z;T.endY=da.y+P*aa;return T}catch(la){return null}};function MeasRectArea(){this.pixelPerimeter=this.cmPerimeter=this.pixelArea=this.cm2Area=this.endY=this.endX=this.startY=this.startX=0;this.mean=this.min=Number.MAX_VALUE;this.max=Number.MIN_SAFE_INTEGER;this.stdDev=Number.MAX_VALUE;this.isCT=!1;this.type="MeasRectArea"}MeasRectArea.prototype=new Shape;
MeasRectArea.prototype.draw=function(c){var b=c.ctx,d=this.startX*c.scaleRatio*1,a=this.startY*c.scaleRatio*1,g=this.endX*c.scaleRatio*1,e=this.endY*c.scaleRatio*1,f={x:d,y:a},a={x:g,y:a},g={x:g,y:e},d={x:d,y:e};b.beginPath();b.lineWidth=3/c.zoom;b.strokeStyle="red";b.moveTo(f.x,f.y);b.lineTo(a.x,a.y);b.lineTo(g.x,g.y);b.lineTo(d.x,d.y);b.lineTo(f.x,f.y);b.stroke();b.beginPath();b.lineWidth=1/c.zoom;b.strokeStyle="yellow";b.moveTo(f.x,f.y);b.lineTo(a.x,a.y);b.lineTo(g.x,g.y);b.lineTo(d.x,d.y);b.lineTo(f.x,
f.y);b.stroke();if(this.selected)f=30/c.zoom,b.save(),b.strokeStyle="yellow",d=this.startX*c.scaleRatio-f/2,e=this.startY*c.scaleRatio-f/2,b.strokeRect(d,e,f,f),d=this.endX*c.scaleRatio-f/2,e=this.endY*c.scaleRatio-f/2,b.strokeRect(d,e,f,f),b.restore()};MeasRectArea.prototype.intersectSide=function(c,b,d,a){var g=1;if(a&&a.zoom>1)g=a.zoom;var a=0,e=b.x,b=b.y,f=c.x,c=c.y,a=(d.y-b)/(d.x-e);return Math.abs(c-(a*(f-e)+b))<=20/g?!0:!1};
MeasRectArea.prototype.intersect=function(c,b,d){var c={x:c,y:b},b={startPoint:{x:this.startX,y:this.startY},endPoint:{x:this.endX,y:this.startY}},a={startPoint:{x:this.endX,y:this.startY},endPoint:{x:this.endX,y:this.endY}},g={startPoint:{x:this.endX,y:this.endY},endPoint:{x:this.startX,y:this.endY}},e={startPoint:{x:this.startX,y:this.endY},endPoint:{x:this.startX,y:this.startY}};return this.intersectSide(c,b.startPoint,b.endPoint,d)||this.intersectSide(c,a.startPoint,a.endPoint,d)||this.intersectSide(c,
g.startPoint,g.endPoint,d)||this.intersectSide(c,e.startPoint,e.endPoint,d)};MeasRectArea.prototype.intersectHandles=function(c,b,d){var a=1;if(d&&d.zoom>1)a=d.zoom;for(var g=[{x:this.startX,y:this.startY},{x:this.endX,y:this.endY}],d=30/a/d.scaleRatio/2,a=0;a<g.length;a++){var e=g[a].x+d,f=g[a].y-d,i=g[a].y+d;if(c>=g[a].x-d&&c<=e&&b>=f&&b<=i)return a}return!1};
MeasRectArea.prototype.calculateArea=function(c){var b=1,d=1,b=c.rows/c.ds.origRows,d=c.columns/c.ds.origColumns,a=this.startX/d,g=this.startY/b,d=this.endX/d,e=this.endY/b,b=Math.abs(d-a),f=Math.abs(e-g);this.pixelArea=b*f;var i=c.getYPixelSpacingForMeas({x:a,y:g}),a=c.getXPixelSpacingForMeas({x:a,y:g}),g=c.getYPixelSpacingForMeas({x:d,y:e}),c=c.getXPixelSpacingForMeas({x:d,y:e});this.cm2Area=i>0&&a>0&&i==g&&a==c?b*a*f*i/100:-1};
MeasRectArea.prototype.calculatePerimeter=function(c){var b=1,d=1,b=c.rows/c.ds.origRows,d=c.columns/c.ds.origColumns,a=this.startX/d,g=this.startY/b,d=this.endX/d,e=this.endY/b,b=Math.abs(d-a),f=Math.abs(e-g);this.pixelPerimeter=(b+f)*2;var i=c.getYPixelSpacingForMeas({x:a,y:g}),a=c.getXPixelSpacingForMeas({x:a,y:g}),g=c.getYPixelSpacingForMeas({x:d,y:e}),c=c.getXPixelSpacingForMeas({x:d,y:e});this.cmPerimeter=i>0&&a>0&&i==g&&a==c?(b*a+f*i)*0.2:-1};
MeasRectArea.prototype.calculateDensity=function(c){var b=Number.MAX_VALUE,d=Number.MAX_VALUE,a=Number.MIN_SAFE_INTEGER,g=Number.MAX_VALUE,e=Math.round(this.startX),f=Math.round(this.endX),i=Math.round(this.startY),h=Math.round(this.endY),k=h<i?h:i,l=h<i?i:h,j=f<e?f:e,m=f<e?e:f;if(c.rawPixelsIntArray&&(c.imageType==0||c.imageType==1)&&j>=0&&j<c.columns&&m>=0&&m<c.columns&&k>=0&&k<c.rows&&l>=0&&l<c.rows){d=0;for(g=k;g<l;g++)for(var n=j;n<m;n++){var o=g*c.columns+n,o=c.getRawPixelValueAtIndex(o);o<
b&&(b=o);o>a&&(a=o);d+=o}for(var d=(d/((h-i)*(f-e))).toFixed(1),q=0,g=k;g<l;g++)for(n=j;n<m;n++)o=g*c.columns+n,o=c.getRawPixelValueAtIndex(o),q+=Math.pow(o-d,2);g=Math.round(Math.sqrt(Math.abs(q/(Math.abs((h-i)*(f-e))-1))))}this.isCT=c.ds.modality.toLowerCase()=="ct";this.min=b;this.mean=d;this.max=a;this.stdDev=g};
MeasRectArea.prototype.getMessages=function(){var c=[];if(this.bCompleted){var b="",d="",b=this.cm2Area<0?" ? mm":this.cm2Area.toFixed(2)+" cm2",d=this.cmPerimeter<0?"? mm":this.cmPerimeter.toFixed(2)+" cm";c.push(js_StringTable.AREA+": "+b);c.push(js_StringTable.PERIMETER+": "+d);b=b=b=b="?";if(this.min<Number.MAX_VALUE)b=this.min,this.isCT&&(b+=" HU"),c.push(js_StringTable.MIN+": "+b);if(this.mean<Number.MAX_VALUE)b=this.mean,this.isCT&&(b+=" HU"),c.push(js_StringTable.MEDIA+": "+b);if(this.max>
Number.MIN_SAFE_INTEGER)b=this.max,this.isCT&&(b+=" HU"),c.push(js_StringTable.MAX+": "+b);if(this.stdDev<Number.MAX_VALUE)b=this.stdDev,c.push(js_StringTable.STD_DEV+": "+b)}return c};function MeasElliptArea(){this.pixelPerimeter=this.cmPerimeter=this.pixelArea=this.cm2Area=this.endY=this.endX=this.startY=this.startX=0;this.mean=this.min=Number.MAX_VALUE;this.max=Number.MIN_SAFE_INTEGER;this.stdDev=Number.MAX_VALUE;this.isCT=!1;this.type="MeasElliptArea"}MeasElliptArea.prototype=new Shape;
MeasElliptArea.prototype.draw=function(c){var b=c.ctx,d=this.startX*c.scaleRatio*1,a=this.startY*c.scaleRatio*1,g=this.endY*c.scaleRatio*1-a,e=this.endX*c.scaleRatio*1-d,f=e/2*0.5522848,i=g/2*0.5522848,h=d+e,k=a+g,e=d+e/2,g=a+g/2;b.beginPath();b.lineWidth=3/c.zoom;b.strokeStyle="red";b.moveTo(d,g);b.bezierCurveTo(d,g-i,e-f,a,e,a);b.bezierCurveTo(e+f,a,h,g-i,h,g);b.bezierCurveTo(h,g+i,e+f,k,e,k);b.bezierCurveTo(e-f,k,d,g+i,d,g);b.stroke();b.beginPath();b.lineWidth=1/c.zoom;b.strokeStyle="yellow";b.moveTo(d,
g);b.bezierCurveTo(d,g-i,e-f,a,e,a);b.bezierCurveTo(e+f,a,h,g-i,h,g);b.bezierCurveTo(h,g+i,e+f,k,e,k);b.bezierCurveTo(e-f,k,d,g+i,d,g);b.closePath();b.stroke();if(this.selected)f=30/c.zoom,b.save(),b.strokeStyle="yellow",d=this.startX*c.scaleRatio-f/2,a=this.startY*c.scaleRatio-f/2,b.strokeRect(d,a,f,f),d=this.endX*c.scaleRatio-f/2,a=this.endY*c.scaleRatio-f/2,b.strokeRect(d,a,f,f),b.restore()};
MeasElliptArea.prototype.intersectSide=function(c,b,d,a){var g=1;if(a&&a.zoom>1)g=a.zoom;var a=20/g,g=Math.max(b.x,d.x)+a,e=Math.min(b.y,d.y)-a,f=Math.max(b.y,d.y)+a,g=c.x>=Math.min(b.x,d.x)-a&&c.y>=e&&c.x<=g&&c.y<=f;if(!g)return!1;if(d.x!=b.x){if(e=(c.x-b.x)/(d.x-b.x)*(d.y-b.y)+b.y,Math.abs(e-c.y)<a)return!0}else return!0;if(d.y!=b.y){if(b=(d.x-b.x)*(c.y-b.y)/(d.y-b.y)+b.x,Math.abs(b-c.x)<a)return!0}else return!0;c=Math.abs(e-c.y)<a&&Math.abs(b-c.x)<a;return g&&c};
MeasElliptArea.prototype.intersect=function(c,b,d){var a=(this.endX-this.startX)/2,g=(this.endY-this.startY)/2,d=20/d.zoom,e={x:a+this.startX,y:g+this.startY},c=e.y+Math.sqrt(Math.pow(g,2)-Math.pow(g,2)*(Math.pow(c-e.x,2)/Math.pow(a,2)));b<e.y&&(c=e.y-(c-e.y));return Math.abs(b-c)<=d?!0:!1};
MeasElliptArea.prototype.intersectHandles=function(c,b,d){var a=1;if(d&&d.zoom>1)a=d.zoom;for(var g=[{x:this.startX,y:this.startY},{x:this.endX,y:this.endY}],d=30/a/d.scaleRatio/2,a=0;a<g.length;a++){var e=g[a].x+d,f=g[a].y-d,i=g[a].y+d;if(c>=g[a].x-d&&c<=e&&b>=f&&b<=i)return a}return!1};
MeasElliptArea.prototype.calculateArea=function(c){var b=1,d=1,b=c.rows/c.ds.origRows,d=c.columns/c.ds.origColumns,a=this.startX/d,g=this.startY/b,d=this.endX/d,e=this.endY/b,b=Math.abs(d-a),f=Math.abs(e-g);this.pixelArea=Math.PI*(b/2)*(f/2);var i=c.getYPixelSpacingForMeas({x:a,y:g}),a=c.getXPixelSpacingForMeas({x:a,y:g}),g=c.getYPixelSpacingForMeas({x:d,y:e}),c=c.getXPixelSpacingForMeas({x:d,y:e});this.cm2Area=i>0&&a>0&&i==g&&a==c?b*a/2*(f*i/2)*Math.PI/100:-1};
MeasElliptArea.prototype.calculatePerimeter=function(c){var b=1,d=1,b=c.rows/c.ds.origRows,d=c.columns/c.ds.origColumns,a=this.startX/d,g=this.startY/b,d=this.endX/d,e=this.endY/b,b=Math.abs(d-a)/2,f=Math.abs(e-g)/2,i=Math.pow(b-f,2)/Math.pow(b+f,2);this.pixelPerimeter=Math.PI*(b+f)*(1+3*i/(10+Math.sqrt(6-3*i)));i=c.getYPixelSpacingForMeas({x:a,y:g});a=c.getXPixelSpacingForMeas({x:a,y:g});g=c.getYPixelSpacingForMeas({x:d,y:e});c=c.getXPixelSpacingForMeas({x:d,y:e});i>0&&a>0&&i==g&&a==c?(b*=a,f*=i,
i=Math.pow(b-f,2)/Math.pow(b+f,2),this.cmPerimeter=Math.PI*(b+f)*(1+3*i/(10+Math.sqrt(6-3*i)))/10):this.cmPerimeter=-1};
MeasElliptArea.prototype.calculateDensity=function(c){var b=Number.MAX_VALUE,d=Number.MAX_VALUE,a=Number.MIN_SAFE_INTEGER,g=Number.MAX_VALUE,e=Math.round(this.startX),f=Math.round(this.endX),i=Math.round(this.startY),h=Math.round(this.endY),k=h<i?h:i,l=h<i?i:h,j=f<e?f:e,m=f<e?e:f,f=(f-e)/2,h=(h-i)/2;e+=f;var n=i+h,i=[];if(c.rawPixelsIntArray&&(c.imageType==0||c.imageType==1)&&j>=0&&j<c.columns&&m>=0&&m<c.columns&&k>=0&&k<c.rows&&l>=0&&l<c.rows){for(d=0;k<l;k++)for(var o=j;o<m;o++)Math.pow(o-e,2)/
Math.pow(f,2)+Math.pow(k-n,2)/Math.pow(h,2)<=1&&(g=c.getRawPixelValueAtIndex(k*c.columns+o),g<b&&(b=g),g>a&&(a=g),d+=g,i.push(g));d=(d/i.length).toFixed(1);for(j=l=0;j<i.length;j++)g=i[j],l+=Math.pow(g-d,2);g=Math.round(Math.sqrt(Math.abs(l/(i.length-1))))}this.isCT=c.ds.modality.toLowerCase()=="ct";this.min=b;this.mean=d;this.max=a;this.stdDev=g};
MeasElliptArea.prototype.getMessages=function(){var c=[];if(this.bCompleted){var b="",d="",b=this.cm2Area<0?" ? mm":this.cm2Area.toFixed(2)+" cm2",d=this.cmPerimeter<0?"? mm":this.cmPerimeter.toFixed(2)+" cm";c.push(js_StringTable.AREA+": "+b);c.push(js_StringTable.PERIMETER+": "+d);b=b=b=b="?";if(this.min<Number.MAX_VALUE)b=this.min,this.isCT&&(b+=" HU"),c.push(js_StringTable.MIN+": "+b);if(this.mean<Number.MAX_VALUE)b=this.mean,this.isCT&&(b+=" HU"),c.push(js_StringTable.MEDIA+": "+b);if(this.max>
Number.MIN_SAFE_INTEGER)b=this.max,this.isCT&&(b+=" HU"),c.push(js_StringTable.MAX+": "+b);if(this.stdDev<Number.MAX_VALUE)b=this.stdDev,c.push(js_StringTable.STD_DEV+": "+b)}return c};function MeasAngle(){this.angleBAnnotPoint=this.angleAAnnotPoint=this.secondSegment=this.firstSegment=null;this.bCompleted=!1;this.angleB=this.angleA=-1;this.type="MeasAngle"}MeasAngle.prototype=new Shape;
MeasAngle.prototype.draw=function(c){var b=c.ctx,d=c.scaleRatio,a,g,e,f=0,i,h,k,l=0;if(this.firstSegment)a=this.firstSegment.startX*d,g=this.firstSegment.startY*d,e=this.firstSegment.endX*d,f=this.firstSegment.endY*d,b.save(),b.beginPath(),b.lineWidth=3/c.zoom,b.strokeStyle="red",b.moveTo(a,g),b.lineTo(e,f),b.stroke(),b.beginPath(),b.lineWidth=1/c.zoom,b.strokeStyle="yellow",b.moveTo(a,g),b.lineTo(e,f),b.stroke(),b.restore();if(this.secondSegment){i=this.secondSegment.startX*d;h=this.secondSegment.startY*
d;k=this.secondSegment.endX*d;l=this.secondSegment.endY*d;b.save();b.beginPath();b.lineWidth=3/c.zoom;b.strokeStyle="red";b.moveTo(i,h);b.lineTo(k,l);b.stroke();b.beginPath();b.lineWidth=1/c.zoom;b.strokeStyle="yellow";b.moveTo(i,h);b.lineTo(k,l);b.stroke();b.restore();var j=(e+a)/2,m=(f+g)/2,n=(k+i)/2-j,o=(l+h)/2-m,n={startX:i-n,startY:h-o,endX:k-n,endY:l-o};b.save();b.beginPath();b.lineWidth=1/c.zoom;b.strokeStyle="#00fe00";o=10/c.zoom;b.arc(j,m,o,0,2*Math.PI,!1);o=15/c.zoom;b.arc(j,m,o,0,2*Math.PI,
!1);b.stroke();b.restore();b.save();b.beginPath();b.setLineDash([5/c.zoom]);b.lineWidth=3/c.zoom;b.strokeStyle="red";b.moveTo(n.startX,n.startY);b.lineTo(n.endX,n.endY);b.stroke();b.beginPath();b.setLineDash([5/c.zoom]);b.lineWidth=1/c.zoom;b.strokeStyle="yellow";b.moveTo(n.startX,n.startY);b.lineTo(n.endX,n.endY);b.stroke();b.restore();if(this.bCompleted)b.save(),j=[a-e,g-f],i=[i-k,h-l],i=Math.acos((j[0]*i[0]+j[1]*i[1])/Math.sqrt(i[0]*i[0]+i[1]*i[1],2)/Math.sqrt(j[0]*j[0]+j[1]*j[1],2))*(180/Math.PI),
i-180>=0&&(i=360-i),this.angleA=i,this.angleB=180-i,b.restore(),b.lineWidth=1/c.zoom,b.strokeStyle="cyan",i=(n.endX+e)/2,h=(n.endY+f)/2,b.save(),b.translate(i,h),b.rotate(-c.rotationRad),k=c.iFlipHorizontal<0?-1:1,l=c.iFlipVertical<0?-1:1,b.scale(k,l),b.translate(-i,-h),k=this.angleA.toFixed(1)+"\u00b0",f=12/c.zoom,b.font=f+"px monospace",b.fillStyle="rgba(50,50,50,1)",b.strokeStyle="#777777",b.lineWidth=1/c.zoom,e=4/c.zoom,l=b.measureText(k).width,i=i-l/2-e,h=h-f/2-e,b.fillRect(i,h,l+e*2,f+e*2),
b.strokeRect(i,h,l+e*2,f+e*2),b.fillStyle="cyan",b.fillText(k,i+e,h+e/2+f),b.restore(),a=(n.endX+a)/2,g=(n.endY+g)/2,b.save(),b.translate(a,g),b.rotate(-c.rotationRad),k=c.iFlipHorizontal<0?-1:1,l=c.iFlipVertical<0?-1:1,b.scale(k,l),b.translate(-a,-g),k=this.angleB.toFixed(1)+"\u00b0",b.font=f+"px monospace",b.fillStyle="rgba(50,50,50,1)",b.strokeStyle="#777777",b.lineWidth=1/c.zoom,l=b.measureText(k).width,a=a-l/2-e,g=g-f/2-e,b.fillRect(a,g,l+e*2,f+e*2),b.strokeRect(a,g,l+e*2,f+e*2),b.fillStyle=
"cyan",b.fillText(k,a+e,g+e/2+f),b.restore()}if(this.selected)g=30/c.zoom,b.save(),b.lineWidth=1/c.zoom,b.strokeStyle="yellow",b.fillStyle="yellow",b.beginPath(),c=this.firstSegment.startX*d-g/2,a=this.firstSegment.startY*d-g/2,b.strokeRect(c,a,g,g),b.beginPath(),c=this.firstSegment.endX*d-g/2,a=this.firstSegment.endY*d-g/2,b.strokeRect(c,a,g,g),b.beginPath(),c=this.secondSegment.startX*d-g/2,a=this.secondSegment.startY*d-g/2,b.strokeRect(c,a,g,g),b.beginPath(),c=this.secondSegment.endX*d-g/2,a=this.secondSegment.endY*
d-g/2,b.strokeRect(c,a,g,g),b.restore()};MeasAngle.prototype.intersect=function(c,b,d){var a=1;if(d&&d.zoom>1)a=d.zoom;var d=20/a,a=0,a=this.firstSegment.startX,g=this.firstSegment.startY,e=this.firstSegment.endX,f=this.firstSegment.endY;if(Math.abs(b-((f-g)/(e-a)*(c-a)+g))<=d)return!0;a=this.secondSegment.startX;g=this.secondSegment.startY;e=this.secondSegment.endX;f=this.secondSegment.endY;return Math.abs(b-((f-g)/(e-a)*(c-a)+g))<=d?!0:!1};
MeasAngle.prototype.intersectHandles=function(c,b,d){var a=1;if(d&&d.zoom>1)a=d.zoom;for(var g=[{x:this.firstSegment.startX,y:this.firstSegment.startY},{x:this.firstSegment.endX,y:this.firstSegment.endY},{x:this.secondSegment.startX,y:this.secondSegment.startY},{x:this.secondSegment.endX,y:this.secondSegment.endY}],d=30/a/d.scaleRatio/2,a=0;a<g.length;a++){var e=g[a].x+d,f=g[a].y-d,i=g[a].y+d;if(c>=g[a].x-d&&c<=e&&b>=f&&b<=i)return a}return!1};
MeasAngle.prototype.calculateSegmentsLen=function(c){var b=[];if(this.firstSegment){var d=this.firstSegment.startX*c.scaleRatio,a=this.firstSegment.startY*c.scaleRatio,g=this.firstSegment.endX*c.scaleRatio,e=this.firstSegment.endY*c.scaleRatio;b.push(Math.sqrt((d-g)*(d-g)+(a-e)*(a-e)))}this.secondSegment&&(d=this.secondSegment.startX*c.scaleRatio,a=this.secondSegment.startY*c.scaleRatio,g=this.secondSegment.endX*c.scaleRatio,e=this.secondSegment.endY*c.scaleRatio,b.push(Math.sqrt((d-g)*(d-g)+(a-e)*
(a-e))));return b};MeasAngle.prototype.getMessages=function(){return[]};MeasAngle.prototype.reset=function(){this.secondSegment=this.firstSegment=null};MeasAngle.prototype.moveBy=function(c,b){this.firstSegment&&(this.firstSegment.startX+=c,this.firstSegment.startY+=b,this.firstSegment.endX+=c,this.firstSegment.endY+=b);this.secondSegment&&(this.secondSegment.startX+=c,this.secondSegment.startY+=b,this.secondSegment.endX+=c,this.secondSegment.endY+=b)};function MeasDensity(){this.selected=!1;this.val="-";this.point={x:0,y:0}}MeasDensity.prototype.draw=function(c){var b=c.ctx,d=this.point.x*c.scaleRatio*1,a=this.point.y*c.scaleRatio*1;b.save();b.beginPath();b.arc(d,a,3/c.zoom,0,2*Math.PI,!1);b.fillStyle="red";b.fill();b.lineWidth=1/c.zoom;b.strokeStyle="yellow";b.stroke();b.restore()};MeasDensity.prototype.intersect=function(){return!1};MeasDensity.prototype.getMessages=function(){return[this.val]};RELite.ToolsRepository.WindowLevel=function(){var c=!1,b={x:0,y:0},d=!1,a=0,g=0,e=function(e){if(c)c=!1,b.x=0,b.y=0,d=!1,(g!=e.reLiteData.currentImage.wl||a!=e.reLiteData.currentImage.ww)&&RELite.Viewer.refreshJPEGForSelectedPanel()},f=function(e){d=c=!0;b.x=e.canvasX;b.y=e.canvasY;a=e.reLiteData.currentImage.ww;g=e.reLiteData.currentImage.wl},i=function(a){var e=a.reLiteData.currentImage;if(c&&e.downloaded&&d){d=!1;var f=a.canvasX-b.x,g=a.canvasY-b.y,i=e.ww,n=e.wl;f*=e.defWinWidth/200;g*=e.defWinWidth/
200;(i+f!=e.defWinWidth||n+g!=e.defWinLevel)&&e.setWindowLevel(Math.round(i+f),Math.round(n+g));b.x=a.canvasX;b.y=a.canvasY;a.reLiteData.redraw();setTimeout(function(){d=!0},50)}};return{mouseup:e,mousedown:f,mousemove:i,touchstart:f,touchmove:i,touchend:e,mouseleave:e}}();RELite.ToolsRepository.Zoom=function(){var c=!1,b={x:0,y:0},d=0,a={x:0,y:0},g=function(){c=!1;b.x=0;d=b.y=0;a.x=0;a.y=0},e=function(e){c=!0;b.x=e.canvasX;d=b.y=e.canvasY;var f=e.reLiteData.zoom;a.x=(e.canvasX-e.reLiteData.translateX)/f;a.y=(e.canvasY-e.reLiteData.translateY)/f},f=function(e){var f=e.reLiteData.currentImage,g=e.reLiteData,l=g.zoom;if(c&&(f.domImg||f.downloaded||f.isLocal))l=Math.max(0,l+(e.canvasY-d)/200),f=b.y-a.y*l,g.translateX=b.x-a.x*l,g.translateY=f,g.zoom=l,d=e.canvasY,g.redraw()};
return{mouseup:g,mousedown:e,mousemove:f,touchstart:e,touchmove:f,touchend:g,mouseleave:g}}();RELite.ToolsRepository.Pan=function(){var c=!1,b={x:0,y:0},d=function(){c=!1;b.x=0;b.y=0},a=function(a){c=!0;b.x=a.canvasX;b.y=a.canvasY},g=function(a){var d=a.reLiteData.currentImage,g=a.reLiteData;if(c&&(d.domImg||d.downloaded||d.isLocal))g.translateX+=a.canvasX-b.x,g.translateY+=a.canvasY-b.y,b.x=a.canvasX,b.y=a.canvasY,g.redraw()};return{mouseup:d,mousedown:a,mousemove:g,touchstart:a,touchmove:g,touchend:d,mouseleave:d}}();RELite.ToolsRepository.Scroll=function(){var c=!1,b={x:0,y:0},d=0,a=0,g=function(e){c=!1;b.x=0;b.y=0;e.isGesture&&e.reLiteData.setCurrentImageIndex(d);a=d=0},e=function(e){c=!0;b.x=e.canvasX;b.y=e.canvasY;d=e.reLiteData.currentImageIndex;a=e.reLiteData.viewingSeries.dicomImages.length},f=function(e){var f=e.reLiteData;if(c){var g=b.y-e.canvasY;g<=-10?(d++,d>=a&&(d=a-1)):g>=10&&(d--,d<0&&(d=0));if(g>=10||g<=-10)f.setCurrentImageIndex(d),b.y=e.canvasY}};return{mouseup:g,mousedown:e,mousemove:f,touchstart:e,
touchmove:f,touchend:g,gesturestart:$.noop,gesturechange:$.noop,gestureend:function(){},mouseleave:g}}();RELite.ToolsRepository.MeasLine=function(){var c=!1,b={lastY:0,lastX:0},d=null,a=null,g=function(e){c=!1;b={lastY:0,lastX:0};a=null;if(d){d.calculateDistance(e.reLiteData.currentImage);if(d.pixelDistance*e.reLiteData.scaleRatio*e.reLiteData.zoom>10)d.bCompleted=!0;else{for(var f=0,f=0;f<e.reLiteData.currentImage.aDrawables.length;f++)if(e.reLiteData.currentImage.aDrawables[f]==d)break;f<e.reLiteData.currentImage.aDrawables.length&&e.reLiteData.currentImage.aDrawables.splice(f,1)}e.reLiteData.redraw()}d=
null},e=function(e){c=!0;var f=e.reLiteData,g=f.currentImage;if(g){var l=e.pointOnDICOMImage.x,j=e.pointOnDICOMImage.y;b.lastX=l;b.lastY=j;for(var m=0;m<g.aDrawables.length;m++)if(g.aDrawables[m].type=="MeasLine"){var n=g.aDrawables[m].intersectHandles(l,j,f);n!==!1?(a=n,d=g.aDrawables[m]):a=null;g.aDrawables[m].intersect(l,j,f)&&(d=g.aDrawables[m]);if(d){d.selected=!0;d.bCompleted=!1;e.reLiteData.redraw();return}}if(d)d.selected=!1;g.aDrawables.length>0&&g.aDrawables.splice(0,1);d=new MeasLine;d.startX=
l;d.startY=j;d.endX=l;d.endY=j;g.aDrawables.push(d)}},f=function(e){var f=e.reLiteData.currentImage;if(c&&f&&(f.downloaded||f.domImg)){var f=e.pointOnDICOMImage.x,g=e.pointOnDICOMImage.y;if(d.selected){var l=f-b.lastX,j=g-b.lastY;a!=null?a===0?(d.startX+=l,d.startY+=j):a===1&&(d.endX+=l,d.endY+=j):(d.startX+=l,d.startY+=j,d.endX+=l,d.endY+=j);b.lastX=f;b.lastY=g}else d.endX=f,d.endY=g;e.reLiteData.redraw()}};return{mouseup:g,mousedown:e,mousemove:f,touchstart:e,touchmove:f,touchend:g,mouseleave:g}}();RELite.ToolsRepository.MeasRectArea=function(){var c=!1,b={lastY:0,lastX:0},d=null,a=null,g=function(e){c=!1;b={lastY:0,lastX:0};a=null;if(d){d.calculateArea(e.reLiteData.currentImage);d.calculatePerimeter(e.reLiteData.currentImage);d.calculateDensity(e.reLiteData.currentImage);if(d.pixelArea*e.reLiteData.scaleRatio*e.reLiteData.zoom>10)d.bCompleted=!0;else{for(var f=0,f=0;f<e.reLiteData.currentImage.aDrawables.length;f++)if(e.reLiteData.currentImage.aDrawables[f]==d)break;f<e.reLiteData.currentImage.aDrawables.length&&
e.reLiteData.currentImage.aDrawables.splice(f,1)}e.reLiteData.redraw()}d=null},e=function(e){c=!0;var f=e.reLiteData,g=f.currentImage;if(g){var l=e.pointOnDICOMImage.x,j=e.pointOnDICOMImage.y;b.lastX=l;b.lastY=j;for(var m=0;m<g.aDrawables.length;m++)if(g.aDrawables[m].type=="MeasRectArea"){var n=g.aDrawables[m].intersectHandles(l,j,f);n!==!1?(a=n,d=g.aDrawables[m]):a=null;g.aDrawables[m].intersect(l,j,f)&&(d=g.aDrawables[m]);if(d){d.selected=!0;d.bCompleted=!1;e.reLiteData.redraw();return}}if(d)d.selected=
!1;g.aDrawables.length>0&&g.aDrawables.splice(0,1);d=new MeasRectArea;d.startX=l;d.startY=j;d.endX=l;d.endY=j;g.aDrawables.push(d)}},f=function(e){var f=e.reLiteData.currentImage;if(c&&f&&(f.downloaded||f.domImg)){var f=e.pointOnDICOMImage.x,g=e.pointOnDICOMImage.y;if(d.selected){var l=f-b.lastX,j=g-b.lastY;a!=null?a===0?(d.startX+=l,d.startY+=j):a===1&&(d.endX+=l,d.endY+=j):(d.startX+=l,d.startY+=j,d.endX+=l,d.endY+=j);b.lastX=f;b.lastY=g}else d.endX=f,d.endY=g;e.reLiteData.redraw()}};return{mouseup:g,
mousedown:e,mousemove:f,touchstart:e,touchmove:f,touchend:g,mouseleave:g}}();RELite.ToolsRepository.MeasElliptArea=function(){var c=!1,b={lastY:0,lastX:0},d=null,a=null,g=function(e){c=!1;b={lastY:0,lastX:0};a=null;if(d){d.calculateArea(e.reLiteData.currentImage);d.calculatePerimeter(e.reLiteData.currentImage);d.calculateDensity(e.reLiteData.currentImage);if(d.pixelArea*e.reLiteData.scaleRatio*e.reLiteData.zoom>10)d.bCompleted=!0;else{for(var f=0,f=0;f<e.reLiteData.currentImage.aDrawables.length;f++)if(e.reLiteData.currentImage.aDrawables[f]==d)break;f<e.reLiteData.currentImage.aDrawables.length&&
e.reLiteData.currentImage.aDrawables.splice(f,1)}e.reLiteData.redraw()}d=null},e=function(e){c=!0;var f=e.reLiteData,g=f.currentImage;if(g){var l=e.pointOnDICOMImage.x,j=e.pointOnDICOMImage.y;b.lastX=l;b.lastY=j;for(var m=0;m<g.aDrawables.length;m++)if(g.aDrawables[m].type=="MeasElliptArea"){var n=g.aDrawables[m].intersectHandles(l,j,f);n!==!1?(a=n,d=g.aDrawables[m]):a=null;g.aDrawables[m].intersect(l,j,f)&&(d=g.aDrawables[m]);if(d){d.selected=!0;d.bCompleted=!1;e.reLiteData.redraw();return}}if(d)d.selected=
!1;g.aDrawables.length>0&&g.aDrawables.splice(0,1);d=new MeasElliptArea;d.startX=l;d.startY=j;d.endX=l;d.endY=j;g.aDrawables.push(d)}},f=function(e){var f=e.reLiteData.currentImage;if(c&&f&&(f.downloaded||f.domImg)){var f=e.pointOnDICOMImage.x,g=e.pointOnDICOMImage.y;if(d.selected){var l=f-b.lastX,j=g-b.lastY;a!=null?a===0?(d.startX+=l,d.startY+=j):a===1&&(d.endX+=l,d.endY+=j):(d.startX+=l,d.startY+=j,d.endX+=l,d.endY+=j);b.lastX=f;b.lastY=g}else d.endX=f,d.endY=g;e.reLiteData.redraw()}};return{mouseup:g,
mousedown:e,mousemove:f,touchstart:e,touchmove:f,touchend:g,mouseleave:g}}();RELite.ToolsRepository.MeasAngle=function(){var c=!1,b={lastY:0,lastX:0},d=null,a=null,g=!0,e=function(e){b={lastY:0,lastX:0};if(e.type==="mouseleave"&&c){c=!1;var f=e.reLiteData.currentImage;if(f){f.aDrawables.length>0&&f.aDrawables.splice(0,1);a=d=null;g=!0;e.reLiteData.redraw();return}}c=!1;a=null;if(d){var f=d.calculateSegmentsLen(e.reLiteData),i=e.reLiteData.zoom;if(f[0]*i<20||f.length>1&&f[1]*i<20){g=!0;for(f=f=0;f<e.reLiteData.currentImage.aDrawables.length;f++)if(e.reLiteData.currentImage.aDrawables[f]==
d)break;f<e.reLiteData.currentImage.aDrawables.length&&e.reLiteData.currentImage.aDrawables.splice(f,1);d=null;e.reLiteData.redraw()}else g===!0?g=!1:(g=d.bCompleted=!0,e.reLiteData.redraw(),d=null)}},f=function(e){c=!0;var f=e.reLiteData,i=f.currentImage;if(i){var j=e.pointOnDICOMImage.x,m=e.pointOnDICOMImage.y;b.lastX=j;b.lastY=m;if(g===!1)d.secondSegment={},d.secondSegment.startX=j,d.secondSegment.startY=m,d.secondSegment.endX=j,d.secondSegment.endY=m;else{for(var n=0;n<i.aDrawables.length;n++)if(i.aDrawables[n].type==
"MeasAngle"){var o=i.aDrawables[n].intersectHandles(j,m,f);o!==!1?(a=o,d=i.aDrawables[n]):a=null;i.aDrawables[n].intersect(j,m,f)&&(d=i.aDrawables[n]);if(d){d.selected=!0;g=d.bCompleted=!1;e.reLiteData.redraw();return}}if(d)d.selected=!1;i.aDrawables.length>0&&i.aDrawables.splice(0,1);g=!0;d=new MeasAngle;d.firstSegment={};d.firstSegment.startX=j;d.firstSegment.startY=m;d.firstSegment.endX=j;d.firstSegment.endY=m;i.aDrawables.push(d)}}},i=function(e){var f=e.reLiteData.currentImage;if(c&&f&&(f.downloaded||
f.domImg)){var f=e.pointOnDICOMImage.x,i=e.pointOnDICOMImage.y;if(d.selected){var j=f-b.lastX,m=i-b.lastY;if(a!=null)switch(a){case 0:d.firstSegment.startX+=j;d.firstSegment.startY+=m;break;case 1:d.firstSegment.endX+=j;d.firstSegment.endY+=m;break;case 2:d.secondSegment.startX+=j;d.secondSegment.startY+=m;break;case 3:d.secondSegment.endX+=j,d.secondSegment.endY+=m}else d.moveBy(j,m);b.lastX=f;b.lastY=i}else g===!0?(d.firstSegment.endX=f,d.firstSegment.endY=i):(d.secondSegment.endX=f,d.secondSegment.endY=
i);e.reLiteData.redraw()}};return{mouseup:e,mousedown:f,mousemove:i,touchstart:f,touchmove:i,touchend:e,mouseleave:e}}();RELite.ToolsRepository.MeasDensity=function(){var c=!1,b=null,d=function(){c=!1;b=null},a=function(a){c=!0;var d=a.reLiteData.currentImage;d.aDrawables.length>0&&d.aDrawables.splice(0,1);d.downloaded&&(b=new MeasDensity,d.aDrawables.push(b),g(a))},g=function(a){var d=a.reLiteData.currentImage,g=a.reLiteData;if(c&&d.downloaded&&a.pointOnDICOMImage){var h=Math.round(a.pointOnDICOMImage.x),a=Math.round(a.pointOnDICOMImage.y);b.point.x=h;b.point.y=a;if(d.rawPixelsIntArray&&(d.imageType==0||d.imageType==
1)){var k=a*d.columns+h;h>=0&&a>=0&&h<=d.columns&&a<=d.rows?(h=d.getRawPixelValueAtIndex(k),d=d.ds.modality.toLowerCase()==="ct"?" HU ":"   ",b.val="  "+h+d):b.val="   -   "}else b.val="   -   ";g.redraw()}};return{mouseup:d,mousedown:a,mousemove:g,touchstart:a,touchmove:g,touchend:d,mouseleave:d}}();RELite.ToolsRepository.Magnifier=function(){var c=null,b=null,d=!1,a=200,g=200,e=null,f="mouse",i=function(c){var d=RELite.Viewer.getPixelRatioWrtSettings(),e=c.reLiteData,f=b;f.setTransform(d,0,0,d,0,0);f.save();f.fillStyle="silver";f.strokeStyle="yellow";f.fillRect(0,0,300,300);f.restore();var d=null,h=c.pointOnDICOMImage,i=c=0;if(e.currentImage&&e.currentImage.downloaded&&!e.bPlayingCine)c=e.currentImage.columns,i=e.currentImage.rows,d=e.currentImage.workingCanvas;else if(e.currentImage&&(!e.currentImage.downloaded||
e.bPlayingCine))if(e.currentImage.domImg!==void 0){c=e.currentImage.domImg.width;if(c==0&&e.currentImage.domImg.naturalWidth)c=e.currentImage.domImg.naturalWidth;i=e.currentImage.domImg.height;if(i==0&&e.currentImage.domImg.naturalHeight)i=e.currentImage.domImg.naturalHeight;d=e.currentImage.domImg}else f.save(),f.fillStyle="black",f.fillRect(0,0,a,g),f.restore();if(d){f.save();f.fillStyle="black";f.fillRect(0,0,a,g);var k=3+e.imageResizedWidth/e.currentImage.columns*e.zoom,l=3+e.imageResizedWidth/
e.currentImage.columns*e.zoom,r=1,v=1;e.iFlipVertical<0&&(v*=-1);e.iFlipHorizontal<0&&(r*=-1);var x={x:h.x*k*r,y:h.y*l*v},t={x:a/2,y:a/2},h=x.x-t.x,x=x.y-t.y;f.translate(a/2,a/2);f.rotate(e.rotationRad*v*r);f.translate(-a/2,-a/2);f.scale(k*r,l*v);f.translate(-h/k*r,-x/l*v);f.drawImage(d,0,0,c,i);f.restore()}},h=function(a){d=!1;c&&document.body.removeChild(c);e=b=c=null;a.reLiteData.redraw()},k=function(h){f=h.type=="touchstart"?"touch":"mouse";if(!c)c=RELite.Viewer.createHIPPICanvas(a,g),a=c.iCSSWidth?
c.iCSSWidth:c.width,g=c.iCSSHeight?c.iCSSHeight:c.height,c.id="magnifierCanvas",b=c.getContext("2d"),c.className="magnifier",document.body.appendChild(c);d=!0;e={x:h.canvasX,y:h.canvasY};i(h);h.reLiteData.redraw()},l=function(a){d&&(e={x:a.canvasX,y:a.canvasY},i(a),a.reLiteData.redraw())};return{mouseup:h,mousedown:k,mousemove:l,touchstart:k,touchmove:l,touchend:h,mouseleave:h,getCanvas:function(){return c},getPointOnPanel:function(){return e},getEventType:function(){return f}}}();function ThumbnailPanel(){var c=this,b=null,d=this.domContainer=null,a=0,g=!1,e=null,f=!1,i=0,h=null,k={x:0,y:0},l=null;this.init=function(){this.domContainer=b=RELite.Viewer.createHIPPICanvas();b.id="thumbnailPanel";b.style.position="absolute";b.style.bottom=0;b.style.display="none";$(b).css("zIndex",15);d=b.getContext("2d");if(RELite.Device.bIsDesktop)l=document.createElement("canvas"),l.width=96,l.height=96,l.style.width="96px",l.style.height="96px",l.style.position="absolute",l.style.top="-1000px",
l.style.left="-1000px",document.body.appendChild(l),this.domContainer.draggable=!0,b.addEventListener("dragstart",function(a){a.stopPropagation();a._x=a.clientX-this.offsetLeft;a._y=a.clientY-this.offsetTop;var b=m(a);if(b>=0&&(a.dataTransfer.effectAllowed="all",a.dataTransfer.setData("Text",b.toString()),(b=RELite.Viewer.getViewingSeries()[b].dicomImages[0])&&b.domImg)){var c=l.getContext("2d");c.save();c.fillStyle="black";c.clearRect(0,0,96,96);var d=1,e=b.columns,f=b.rows,d=96/e,g=96/f,d=d<g?d:
g;c.drawImage(b.domImg,0,0,Math.round(e*d),Math.round(f*d));c.restore();a.dataTransfer.setDragImage&&a.dataTransfer.setDragImage(l,-10,-10)}return!1},!1),b.addEventListener("mousedown",j,!1);b.addEventListener("touchstart",j,!1);b.addEventListener("touchmove",j,!1);b.addEventListener("touchend",j,!1);b.addEventListener("dblclick",j,!1);"onwheel"in document?RELite.Utils.addEventListener(b,"wheel",j):"onmousewheel"in document?RELite.Utils.addEventListener(b,"mousewheel",j):RELite.Utils.addEventListener(b,
"DOMMouseScroll",j);RELite.Utils.addEventListener(document,"selectedPanelChanged",this.onSelectedPanelChanged.bind(this))};var j=function(d){d.bGesture=!1;if(d.type=="mousewheel"){d.preventDefault();d.stopPropagation();var f=d.wheelDelta;f>0?a+=20:a-=20;c.redraw(!1,!1)}if(d.type=="wheel")d.preventDefault(),d.stopPropagation(),f=d.deltaY,f<0?a+=20:a-=20,c.redraw(!1,!1);a>0&&(a=0);d.type=="taphold"?(d._x=k.x,d._y=k.y):d.type=="touchmove"||d.type=="touchstart"?(d.preventDefault(),d.stopPropagation(),
d._y=d.touches[0].clientY-b.offsetTop,d._x=d.touches[0].clientX-b.offsetLeft,d.bGesture=d.touches.length>1):d.type=="touchend"?(d.preventDefault(),d.stopPropagation(),d._y=d.changedTouches[0].clientY-b.offsetTop,d._x=d.changedTouches[0].clientX-b.offsetLeft,d.bGesture=d.touches.length>1):(d._x=d.clientX-this.offsetLeft,d._y=d.clientY-this.offsetTop);f=e;f||(f=RELite.Viewer.getSelectedImagePanel())||(f=RELite.Viewer.getImagePanels()[0]);if(d.type=="dblclick"||d.type=="taphold"){var g=m(d);g>=0&&(f.loadViewingSeries(RELite.Viewer.getViewingSeries()[g]),
d="mousedown","ontouchstart"in window&&(d="touchstart"),$("#showThumbnails").trigger(d))}else{if(d.type=="touchstart"){k.x=d._x;k.y=d._y;i=0;var g=m(d),h=RELite.Viewer.getViewingSeries();g<h.length&&g>=0&&c.redraw(!1,!1)}if(d.type=="touchmove")a+=d._y-k.y,i+=d._y-k.y,c.redraw(!1,!1),k.y=d._y,k.x=d._x;if(d.type=="touchend"){if(Math.abs(i)<10){g=m(d);g>=0&&(f.loadViewingSeries(RELite.Viewer.getViewingSeries()[g]),RELite.Manager.onChooseSeriesToolClicked(d));return}k.x=0;i=k.y=0}d.type=="mousedown"&&
(g=m(d),h=RELite.Viewer.getViewingSeries(),g<h.length&&g>=0&&c.redraw(!1,!1))}},m=function(b){for(var c=RELite.Viewer.getViewingSeries(),d=0;d<c.length;d++){var e=c[d].thumbnailPos.y+(a-c[d].thumbnailPos.transY),f=c[d].thumbnailPos.x;if(b._y-a>=e&&b._y-a<=e+96&&b._x>=f&&b._x<=f+96)return h=c[d],d}return-1};this.redraw=function(c){if(f){if(c&&e)b.width=e.canvas.width,b.height=e.canvas.height,b.style.top=$(e.canvas).offset().top+"px",b.style.left=$(e.canvas).offset().left+"px";var g=b.iCSSWidth,c=b.iCSSHeight,
i=RELite.Viewer.getPixelRatioWrtSettings();d.setTransform(i,0,0,i,0,0);d.save();d.clearRect(0,0,g,c);d.fillStyle="rgb(64, 64, 64)";d.fillRect(0,0,g,c);d.restore();var c=Math.floor(g/101),i=g=Math.floor((g-c*101)/2),j=15,k=0;d.save();d.translate(0,a);for(var l=RELite.Viewer.getViewingSeries(),m="",v=0;v<l.length;v++){var x=l[v];d.font="11px Arial";d.fillStyle="white";var t=x.dicomImages[0],w=t.ds.studyUID;if(m!=w){i!=g?(j+=111,i=g):v!=0&&(j+=15);var k=0,m=w,w=RELite.Utils.beautyfyName(t.ds.patientName),
y=RELite.Utils.beautyfyDate(t.ds.studyDate);d.fillText(w,i,j);d.fillText(y,i,j+=15);d.fill();j+=15}d.fillStyle="black";if(t.domImg){var z=1,y=t.domImg.width,A=96,w=t.domImg.height,z=96;A/=y;z/=w;z=A<z?A:z;y=Math.round(y*z);w=Math.round(w*z);d.drawImage(t.domImg,i+(96-y)/2,j+(96-w)/2,y,w);d.fillStyle="#eee";d.strokeStyle="#333";d.font="20px Arial";d.strokeText((v+1).toString(),i+5,j+25);d.fillText((v+1).toString(),i+5,j+25);d.fillStyle="yellow";d.font="11px Arial";d.fillText("#"+t.ds.seriesNumber.toString()+
" ["+x.dicomImages.length+"]",i+5,j+96-10)}else t.ds.isImage&&t.downloaded?(y=t.columns,A=96,w=t.rows,z=96,A/=y,z/=w,z=A<z?A:z,y=Math.round(y*z),w=Math.round(w*z),d.drawImage(t.workingCanvas,i+(96-y)/2,j+(96-w)/2,y,w),d.fillStyle="rgb(128, 128, 128)",d.font="20px Arial",d.strokeText((v+1).toString(),i+5,j+25),d.fillText((v+1).toString(),i+5,j+25),d.fillStyle="yellow",d.font="11px Arial",d.fillText("#"+t.ds.seriesNumber.toString()+" ["+x.dicomImages.length+"]",i+5,j+96-10)):t.ds.isImage?(d.fillRect(i,
j,96,96),d.fillStyle="rgb(128, 128, 128)",d.font="20px Arial",d.strokeText((v+1).toString(),i+5,j+25),d.fillText((v+1).toString(),i+5,j+25),d.fillStyle="yellow",d.font="11px Arial",d.fillText("#"+t.ds.seriesNumber.toString()+" ["+x.dicomImages.length+"]",i+5,j+96-10),d.fillRect(i+33,j+42,6,6),d.fillRect(i+41,j+42,6,6),d.fillRect(i+49,j+42,6,6),d.fillStyle="black"):(d.drawImage(t.workingCanvas,i,j,96,96),d.fillStyle="rgb(128, 128, 128)",d.font="20px Arial",d.strokeText((v+1).toString(),i+5,j+25),d.fillText((v+
1).toString(),i+5,j+25),d.fillStyle="yellow",d.font="11px Arial",d.fillText("#"+t.ds.seriesNumber.toString()+" ["+x.dicomImages.length+"]",i+5,j+96-10));x.bIsCine&&d.drawImage(document.getElementById("cineImg"),i+96-20,j+96-20,20,20);if(h===x)d.strokeStyle="yellow",d.fillStyle="transparent",d.lineWidth=2,d.strokeRect(i,j,96,96);x.thumbnailPos={x:i,y:j,transY:a};k++;k<c?i+=101:(k=0,i=g,j+=101)}d.restore()}};this.show=function(a){if(!f){g||(document.body.appendChild(b),g=!0);if(a)b.style.top=$(a.canvas).offset().top+
"px",b.style.left=$(a.canvas).offset().left+"px",b.width=a.canvas.width,b.height=a.canvas.height,b.style.width=a.canvas.style.width,b.style.height=a.canvas.style.height,b.iCSSWidth=a.canvas.iCSSWidth,b.iCSSHeight=a.canvas.iCSSHeight;e=a;for(var a=RELite.Viewer.getViewingSeries(),d=0;d<a.length&&a[d]!==e.viewingSeries;)d++;$(b).show();f=!0;c.redraw(!1,!0)}};this.hide=function(){$(b).hide();f=!1};this.detach=function(){g=f=!1;$(b).detach();a=0};this.onNewViewingSeriesAvailable=function(){c.redraw(!1,
!0)};this.onSelectedPanelChanged=function(c){if(c=c.reLiteData)if((c=c.viewingSeries)&&c!=h){h=c;var c=c.thumbnailPos,d=b.iCSSHeight;if(c.y+96>d-a||c.y<-a)a=Math.min((d-96)/2-c.y,0);RELite.Viewer.getThumbnailPanel().redraw()}};this.onPageUp=function(){var c=a+b.height;a=c>0?0:c;RELite.Viewer.getThumbnailPanel().redraw()};this.onPageDown=function(){var c=a-b.height,d=RELite.Viewer.getViewingSeries().length;a=Math.max(c,-(d*101));RELite.Viewer.getThumbnailPanel().redraw()}};this.RELite===void 0&&(RELite={});RELite.HeartBeat=function(){return{init:function(){}}}();this.RELite===void 0&&(RELite={});
RELite.JPEGDownloadSerializer=function(){var c=!1,b=null,d=window.location.protocol==="https:"?"wss://":"ws://",a=!1,g=0,e=0,f=0,i=null,h=function(){this.bDownloading||this.doDownload()},k=function(){f++;RELite.Utils.dispatchEvent(document,"jpegLoad",this.dicomImage);RELite.Utils.dispatchEvent(document,"jpegProgress",{total:g,succeeded:e,failed:f});this.queue.doDownload();delete this.dicomImage;delete this.queue},l=function(){e++;this.dicomImage.domImg=this;if(this.dicomImage.isLocal&&this.dicomImage.ds)this.dicomImage.columns=
this.dicomImage.ds.origColumns,this.dicomImage.rows=this.dicomImage.ds.origRows,this.dicomImage.defWinWidth=256,this.dicomImage.defWinLevel=128,this.dicomImage.ww=256,this.dicomImage.wl=128,this.dicomImage.multiplyVal=1,this.dicomImage.additiveVal=0;else if(this.dicomImage.ds&&!this.dicomImage.isLocal){var a=this.width;if(a==0&&this.naturalWidth)a=this.naturalWidth;var b=this.height;if(b==0&&this.naturalHeight)b=this.naturalHeight;if(this.dicomImage.columns===void 0&&this.dicomImage.rows===void 0)this.dicomImage.columns=
a,this.dicomImage.rows=b}a=RELite.Viewer.getImagePanels();for(b=0;b<a.length;b++)a[b].redrawIfImageShown(this.dicomImage);RELite.Utils.dispatchEvent(document,"jpegLoad",this.dicomImage);RELite.Utils.dispatchEvent(document,"jpegProgress",{total:g,succeeded:e,failed:f});this.queue.doDownload();this.dicomImage.onJPEGImageLoaded()},j=function(){var a=this.shift();if(a&&a.ds){this.bDownloading=!0;var c="JPG_"+a.ds.sopInstUID+"_"+a.frameNumber,d=document.getElementById(c);if(b!=null&&b.readyState==1){c=
JSON.stringify({msgType:"MSG_RETRJPEG_RQ",dataMap:a.prepareDataForJPEGWS()});if(!d)d=new Image,d.style.position="absolute",d.style.top="-1000px",d.style.left="-1000px",d.style.display="none",d.id="JPG_"+a.ds.sopInstUID+"_"+a.frameNumber,d.className="dicomJPG",d.addEventListener("load",l,!1),d.addEventListener("error",k,!1),RELite.Viewer.getViewerContainer().appendChild(d);d.dicomImage=a;d.queue=this;b.onmessage=function(a){a.data.constructor==Blob?(a=URL.createObjectURL(a.data),d.src=a):k.call(d)};
b.send(c)}else{if(!d)d=new Image,d.style.position="absolute",d.style.top="-1000px",d.style.left="-1000px",d.style.display="none",d.id=c,d.className="dicomJPG",d.addEventListener("load",l,!1),d.addEventListener("error",k,!1),RELite.Viewer.getViewerContainer().appendChild(d);d.dicomImage=a;d.queue=this;d.src=a.getJPEGUrl()}}else this.bDownloading=!1,f=e=g=0,RELite.Utils.dispatchEvent(document,"jpegProgress",{total:g,succeeded:e,failed:f})},m=function(){for(var a=[],b=0;b<1;b++){var c=[];c.onNewDICOMImageAdded=
h;c.doDownload=j;c.bDownloading=!1;a.push(c)}return a},n=m(),o=function(){a=!0},q=function(){b=null;if(a)a=!1,b=new WebSocket(d+window.location.host+"/RemotEyeLiteServer/WebSocket"),b.addEventListener("open",o,!1),b.addEventListener("error",q,!1),b.onmessage=function(){}};if(c)try{b=new WebSocket(d+window.location.host+"/RemotEyeLiteServer/WebSocket"),b.addEventListener("open",o,!1),b.addEventListener("error",q,!1),b.onmessage=function(){}}catch(p){c=!1}return{addDICOMImage:function(a,b){i||(i=document.createElement("div"));
var c=g%1;b===!0&&n[c].indexOf(a)>=0||(n[c].push(a),n[c].onNewDICOMImageAdded(),g++)},addDICOMImageOnTop:function(a,b){i||(i=document.createElement("div"));var c=g%1;b===!0&&n[c].indexOf(a)>=0||(n[c].unshift(a),g++,n[c].onNewDICOMImageAdded())},addDICOMImagesOnTop:function(a,b){for(var c=g%1,d=a.length,e=a.pop();e;){if(b===!0){var f=n[c].indexOf(e);f>=0&&(n[c].splice(f,1),d--)}n[c].unshift(e);e=a.pop()}g+=d;n[c].onNewDICOMImageAdded()},getSuccCount:function(){return e},clearQueues:function(){n=m();
$(i).empty()},isImageInQueue:function(a){for(var b=0;b<n.length;b++)if(n[b].indexOf(a)>=0)return!0;return!1},closeWebSockConnection:function(){a&&b&&b.close()}}}();
